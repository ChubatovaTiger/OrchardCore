# Orchard Core 1.9.0

Release date: Not yet released

## Breaking Changes

### Email Module

The `OrchardCore.Email` module now only provides email settings and the basics of the email infrastructure, and can't be enabled in itself. To actually send out e-mails, you need to enable an email provider, like `OrchardCore.Email.Smtp` or the new `OrchardCore.Email.Azure` (see notes below). The new `OrchardCore.Email.Smtp` module provides the same capabilities previously built into the `OrchardCore.Email` module, so for simple SMTP emails, enable that.

Module authors who were using `ISmtpService` service previously should now use `IEmailDeliveryService` instead.

**Migration Process**

- If the email settings have been configured in the site settings:
    1. Copy the settings before the upgrade.
    2. Upgrade Orchard Core to the new version.
    3. Re-configure settings. Until you do this, the site won't be able to send e-mails and the old settings won't be loaded.
- If the email settings have been configured in the `appsettings.json` or other configuration provider:
    1. You can still use the old `OrchardCore_Email` section, but we encourage you to use `OrchardCore_Email_Smtp` section instead.

### Media Indexing

Previously, `.PDF` file where auto indexed in the search providers (Elasticsearch, Lucene or Azure AI Search). Now, if you want to continue to index `.PDF` file you'll need to enable `OrchardCore.Media.Indexing.Pdf` feature.

Additionally, if you needed to enable indexing for text file with `.txt`, `.md` extensions, you'll needed `OrchardCore.Media.Indexing.Text` feature.

If you needed to enable indexing for other extensions like (`.docx`, or `.pptx`), you'll needed `OrchardCore.Media.Indexing.OpenXML` feature.

### SMS Module

In the past, we utilized the injection of `ISmsProvider`for sending SMS messages. However, in this release, it is now necessary to inject `ISmsService` instead.

Additionally, `Twilio` provider is no longer enabled by default. If you want to use Twilio SMS provider, you must enable `OrchardCore.Sms.Twilio` feature.

## Change Logs

### Azure Email Module

Introducing a new "Azure Email" module, designed to send emails using Azure Email Communication Services (ACS). For more info read the [Azure Email](../reference/modules/Email.Azure/README.md) docs.


### Azure AI Search Module

Introducing a new "Azure AI Search" module, designed to empower you in the administration of Azure AI Search indices. When enabled with the "Search" module, it facilitates frontend full-text search capabilities through Azure AI Search. For more info read the [Azure AI Search](../reference/modules/AzureAISearch/README.md) docs.

### Deployment Module

Added new extensions to make registering custom deployment step easier

- services.AddDeployment<TSource, TStep>();
- services.AddDeployment<TSource, TStep, TDisplayDriver>();
- services.AddDeploymentWithoutSource<TStep, TDisplayDriver>();

### Workflow Module

 The method `public async Task TriggerEventAsync(string name, IDictionary<string, object> input = null, string correlationId = null, bool isExclusive = false, bool isAlwaysCorrelated = false)` 
 was changed to return Task<IEnumerable<WorkflowExecutionContext>> instead.


### GraphQL Module

When identifying content types for GraphQL exposure, we identify those without a stereotype to provide you with control over the behavior of stereotyped content types. A new option, `DiscoverableSterotypes`, has been introduced in `GraphQLContentOptions`. This allows you to specify stereotypes that should be discoverable by default.

For instance, if you have several content types stereotyped as `ExampleStereotype`, you can make them discoverable by incorporating the following code into the startup class:

```csharp
services.Configure<GraphQLContentOptions>(options =>
{
    options.DiscoverableSterotypes.Add("ExampleStereotype");
});
```

### Admin

The admin menu has undergone performance enhancements, and new helpers have been added. When incorporating `INavigationProvider` in your project, you can now utilize `NavigationHelper.IsAdminMenu(name)` instead of the previous approach using `string.Equals(name, "admin", StringComparison.OrdinalIgnoreCase)`. Moreover, when passing route values to an action, it is advised to store them in a constant variable. An illustrative example is provided below.
```
public class AdminMenu : INavigationProvider
{
    private static readonly RouteValueDictionary _routeValues = new()
    {
        { "area", "OrchardCore.Settings" },
        { "groupId", AdminSiteSettingsDisplayDriver.GroupId },
    };

    protected readonly IStringLocalizer S;

    public AdminMenu(IStringLocalizer<AdminMenu> stringLocalizer)
    {
        S = stringLocalizer;
    }

    public Task BuildNavigationAsync(string name, NavigationBuilder builder)
    {
        if (!NavigationHelper.IsAdminMenu(name))
        {
            return Task.CompletedTask;
        }

        builder
            .Add(S["Configuration"], configuration => configuration
                .Add(S["Settings"], settings => settings
                    .Add(S["Admin"], S["Admin"].PrefixPosition(), admin => admin
                        .AddClass("admin")
                        .Id("admin")
                        .Action("Index", "Admin", _routeValues)
                        .Permission(PermissionsAdminSettings.ManageAdminSettings)
                        .LocalNav()
                    )
                )
            );

        return Task.CompletedTask;
    }
}
```

### Smtp Email Module

The "Smtp Email" module is a replacement for old Email module. For more info read the [Smtp Email](../reference/modules/Email.Smtp/README.md) docs.

You can still use the old email module configuration, but it is recommended to use the new one.
