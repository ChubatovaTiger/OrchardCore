/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

///<reference path='../Lib/jquery/typings.d.ts' />
var applyFilter = function applyFilter(category, q) {
  var type = $('.modal-activities').data('activity-type');
  category = category || $('.activity-picker-categories .nav-link.active').attr('href').substr(1);
  q = q || $('.modal-activities input[type=search]').val();
  var $cards = $('.activity.col').show();
  // Remove activities whoes type doesn't match the configured activity type.
  $cards.filter(function (i, el) {
    return $(el).data('activity-type') != type;
  }).hide();
  if (q.length > 0) {
    // Remove activities whose title doesn't match the query.
    $cards.filter(function (i, el) {
      return $(el).find('.card-title').text().toLowerCase().indexOf(q.toLowerCase()) < 0 && q && q.length > 0;
    }).hide();
  } else {
    // Remove activities whose category doesn't match the selected one.
    $cards.filter(function (i, el) {
      return $(el).data('category').toLowerCase() != category.toLowerCase() && category.toLowerCase() != 'all';
    }).hide();
  }
  // Show or hide categories based on whether there are any available activities.
  $('.activity-picker-categories [data-category]').each(function (i, el) {
    var categoryListItem = $(el);
    var category = categoryListItem.data('category');
    // Count number of activities within this category and for the specified activity type (Event or Task).
    var activityCount = $(".activity.col[data-category='".concat(category, "'][data-activity-type='").concat(type, "']")).length;
    activityCount == 0 ? categoryListItem.hide() : categoryListItem.show();
  });
};
$(function () {
  $('.activity-picker-categories').on('click', '.nav-link', function (e) {
    applyFilter($(e.target).attr('href').substr(1), null);
  });
  $('.modal-activities input[type=search]').on('keyup', function (e) {
    applyFilter(null, $(e.target).val());
  });
  $('#activity-picker').on('show.bs.modal', function (event) {
    var modalEvent = event;
    var button = $(modalEvent.relatedTarget); // Button that triggered the modal.
    var title = button.data('picker-title');
    var type = button.data('activity-type');
    var modal = $(this);
    modal.find('[href="#all"]').click();
    modal.find('.modal-title').text(title);
    modal.data('activity-type', type);
    applyFilter(null, null);
  });
});
///<reference path="../../../Assets/Lib/jquery/typings.d.ts" />
$(function () {
  var generateWorkflowUrl = function generateWorkflowUrl() {
    var workflowTypeId = $('[data-workflow-type-id]').data('workflow-type-id');
    var activityId = $('[data-activity-id]').data('activity-id');
    var tokenLifeSpan = $('#token-lifespan').val();
    var generateUrl = $('[data-generate-url]').data('generate-url') + "?workflowTypeId=".concat(workflowTypeId, "&activityId=").concat(activityId, "&tokenLifeSpan=").concat(tokenLifeSpan);
    var antiforgeryHeaderName = $('[data-antiforgery-header-name]').data('antiforgery-header-name');
    var antiforgeryToken = $('[data-antiforgery-token]').data('antiforgery-token');
    var headers = {};
    headers[antiforgeryHeaderName] = antiforgeryToken;
    $.post({
      url: generateUrl,
      headers: headers
    }).done(function (url) {
      $('#workflow-url-text').val(url);
    });
  };
  $('#generate-url-button').on('click', function (e) {
    generateWorkflowUrl();
  });
  if ($('#workflow-url-text').val() == '') {
    generateWorkflowUrl();
  }
});
///<reference path='../Lib/jquery/typings.d.ts' />
///<reference path='../Lib/jsplumb/typings.d.ts' />
///<reference path='./workflow-models.ts' />
var WorkflowCanvas = /** @class */function () {
  function WorkflowCanvas(container, workflowType) {
    var _this = this;
    this.container = container;
    this.workflowType = workflowType;
    this.minCanvasHeight = 400;
    this.getActivityElements = function () {
      return $(_this.container).find('.activity');
    };
    this.getDefaults = function () {
      return {
        Anchor: "Continuous",
        DragOptions: {
          cursor: 'pointer',
          zIndex: 2000
        },
        EndpointStyles: [{
          fillStyle: '#225588'
        }],
        Endpoints: [["Dot", {
          radius: 7
        }], ["Blank"]],
        ConnectionOverlays: [["Arrow", {
          width: 12,
          length: 12,
          location: -5
        }]],
        ConnectorZIndex: 5
      };
    };
    this.createJsPlumbInstance = function () {
      return jsPlumb.getInstance({
        DragOptions: {
          cursor: 'pointer',
          zIndex: 2000
        },
        ConnectionOverlays: [['Arrow', {
          location: 1,
          visible: true,
          width: 11,
          length: 11
        }], ['Label', {
          location: 0.5,
          id: 'label',
          cssClass: 'connection-label'
        }]],
        Container: _this.container
      });
    };
    this.getEndpointColor = function (activity) {
      return activity.isBlocking || activity.isStart ? '#7ab02c' : activity.isEvent ? '#3a8acd' : '#7ab02c';
    };
    this.getSourceEndpointOptions = function (activity, outcome) {
      // The definition of source endpoints.
      var paintColor = _this.getEndpointColor(activity);
      return {
        endpoint: 'Dot',
        anchor: 'Continuous',
        paintStyle: {
          stroke: paintColor,
          fill: paintColor,
          radius: 7,
          strokeWidth: 1
        },
        isSource: true,
        connector: ['Flowchart', {
          stub: [40, 60],
          gap: 0,
          cornerRadius: 5,
          alwaysRespectStubs: true
        }],
        connectorStyle: {
          strokeWidth: 2,
          stroke: '#999999',
          joinstyle: 'round',
          outlineStroke: 'white',
          outlineWidth: 2
        },
        hoverPaintStyle: {
          fill: '#216477',
          stroke: '#216477'
        },
        connectorHoverStyle: {
          strokeWidth: 3,
          stroke: '#216477',
          outlineWidth: 5,
          outlineStroke: 'white'
        },
        connectorOverlays: [['Label', {
          location: [3, -1.5],
          cssClass: 'endpointSourceLabel'
        }]],
        dragOptions: {},
        uuid: "".concat(activity.id, "-").concat(outcome.name),
        parameters: {
          outcome: outcome
        }
      };
    };
    this.getActivity = function (id, activities) {
      if (activities === void 0) {
        activities = null;
      }
      if (!activities) {
        activities = this.workflowType.activities;
      }
      return $.grep(activities, function (x) {
        return x.id === id;
      })[0];
    };
    this.updateConnections = function (plumber) {
      var workflowId = _this.workflowType.id;
      // Connect activities.
      for (var _i = 0, _a = _this.workflowType.transitions; _i < _a.length; _i++) {
        var transitionModel = _a[_i];
        var sourceEndpointUuid = "".concat(transitionModel.sourceActivityId, "-").concat(transitionModel.sourceOutcomeName);
        var sourceEndpoint = plumber.getEndpoint(sourceEndpointUuid);
        var destinationElementId = "activity-".concat(workflowId, "-").concat(transitionModel.destinationActivityId);
        plumber.connect({
          source: sourceEndpoint,
          target: destinationElementId
        });
      }
    };
    this.updateCanvasHeight = function () {
      var $container = $(this.container);
      // Get the activity element with the highest Y coordinate.
      var $activityElements = $container.find(".activity");
      var currentElementTop = 0;
      var currentActivityHeight = 0;
      for (var _i = 0, _a = $activityElements.toArray(); _i < _a.length; _i++) {
        var activityElement = _a[_i];
        var $activityElement = $(activityElement);
        var top_1 = $activityElement.position().top;
        if (top_1 > currentElementTop) {
          currentElementTop = top_1;
          currentActivityHeight = $activityElement.height();
        }
      }
      var newCanvasHeight = currentElementTop + currentActivityHeight;
      var elementBottom = currentElementTop + currentActivityHeight;
      var stretchValue = 100;
      if (newCanvasHeight - elementBottom <= stretchValue) {
        newCanvasHeight += stretchValue;
      }
      $container.height(Math.max(this.minCanvasHeight, newCanvasHeight));
    };
  }
  return WorkflowCanvas;
}();
///<reference path='../Lib/jquery/typings.d.ts' />
///<reference path='../Lib/jsplumb/typings.d.ts' />
///<reference path='./workflow-models.ts' />
///<reference path='./workflow-canvas.ts' />
var __extends = this && this.__extends || function () {
  var _extendStatics = function extendStatics(d, b) {
    _extendStatics = Object.setPrototypeOf || {
      __proto__: []
    } instanceof Array && function (d, b) {
      d.__proto__ = b;
    } || function (d, b) {
      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];
    };
    return _extendStatics(d, b);
  };
  return function (d, b) {
    if (typeof b !== "function" && b !== null) throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
    _extendStatics(d, b);
    function __() {
      this.constructor = d;
    }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
  };
}();
// TODO: Re-implement this using a MVVM approach.
var WorkflowEditor = /** @class */function (_super) {
  __extends(WorkflowEditor, _super);
  function WorkflowEditor(container, workflowType, deleteActivityPrompt, localId, loadLocalState) {
    var _this = _super.call(this, container, workflowType) || this;
    _this.container = container;
    _this.workflowType = workflowType;
    _this.deleteActivityPrompt = deleteActivityPrompt;
    _this.localId = localId;
    _this.getState = function () {
      var $allActivityElements = $(_this.container).find('.activity');
      var workflow = {
        id: _this.workflowType.id,
        activities: [],
        transitions: [],
        removedActivities: _this.workflowType.removedActivities
      };
      // Collect activities.
      for (var i = 0; i < $allActivityElements.length; i++) {
        var $activityElement = $($allActivityElements[i]);
        var activityId = $activityElement.data('activity-id');
        var activityIsStart = $activityElement.data('activity-start');
        var activityIsEvent = $activityElement.data('activity-type') === 'Event';
        var activityPosition = $activityElement.position();
        var activity = _this.getActivity(activityId);
        workflow.activities.push({
          id: activityId,
          isStart: activityIsStart,
          isEvent: activityIsEvent,
          outcomes: activity.outcomes,
          x: activityPosition.left,
          y: activityPosition.top
        });
      }
      // Collect connections.
      var allConnections = _this.jsPlumbInstance.getConnections();
      for (var i = 0; i < allConnections.length; i++) {
        var connection = allConnections[i];
        var sourceEndpoint = connection.endpoints[0];
        var sourceOutcomeName = sourceEndpoint.getParameters().outcome.name;
        var sourceActivityId = $(connection.source).data('activity-id');
        var destinationActivityId = $(connection.target).data('activity-id');
        workflow.transitions.push({
          sourceActivityId: sourceActivityId,
          destinationActivityId: destinationActivityId,
          sourceOutcomeName: sourceOutcomeName
        });
      }
      return workflow;
    };
    _this.serialize = function () {
      var workflow = _this.getState();
      return JSON.stringify(workflow);
    };
    _this.saveLocalState = function () {
      sessionStorage[_this.localId] = _this.serialize();
    };
    _this.loadLocalState = function () {
      return JSON.parse(sessionStorage[_this.localId]);
    };
    var self = _this;
    jsPlumb.ready(function () {
      jsPlumb.importDefaults(_this.getDefaults());
      var plumber = _this.createJsPlumbInstance();
      // Listen for new connections.
      plumber.bind('connection', function (connInfo, originalEvent) {
        var connection = connInfo.connection;
        var outcome = connection.getParameters().outcome;
        var label = connection.getOverlay('label');
        label.setLabel(outcome.displayName);
      });
      var activityElements = _this.getActivityElements();
      var areEqualOutcomes = function areEqualOutcomes(outcomes1, outcomes2) {
        if (outcomes1.length != outcomes2.length) {
          return false;
        }
        for (var i = 0; i < outcomes1.length; i++) {
          var outcome1 = outcomes1[i];
          var outcome2 = outcomes2[i];
          if (outcome1.name != outcome2.displayName || outcome1.displayName != outcome2.displayName) {
            return false;
          }
        }
        return true;
      };
      // Suspend drawing and initialize.
      plumber.batch(function () {
        var serverworkflowType = _this.workflowType;
        var workflowId = _this.workflowType.id;
        if (loadLocalState) {
          var localState = _this.loadLocalState();
          if (localState) {
            _this.workflowType = localState;
          }
        }
        activityElements.each(function (_, activityElement) {
          var $activityElement = $(activityElement);
          var activityId = $activityElement.data('activity-id');
          var isDeleted = _this.workflowType.removedActivities.indexOf(activityId) > -1;
          if (isDeleted) {
            $activityElement.remove();
            return;
          }
          var activity = _this.getActivity(activityId);
          var serverActivity = _this.getActivity(activityId, serverworkflowType.activities);
          // Update the activity's visual state.
          if (loadLocalState) {
            if (activity == null) {
              // This is a newly added activity not yet added to local state.
              activity = serverActivity;
              _this.workflowType.activities.push(activity);
              activity.x = 50;
              activity.y = 50;
            } else {
              // The available outcomes might have changed when editing an activity,
              // so we need to check for that and update the client's activity outcomes if so.
              var sameOutcomes = areEqualOutcomes(activity.outcomes, serverActivity.outcomes);
              if (!sameOutcomes) {
                activity.outcomes = serverActivity.outcomes;
              }
              $activityElement.css({
                left: activity.x,
                top: activity.y
              }).toggleClass('activity-start', activity.isStart).data('activity-start', activity.isStart);
            }
          }
          // Make the activity draggable.
          plumber.draggable(activityElement, {
            grid: [10, 10],
            containment: true,
            start: function start(args) {
              _this.dragStart = {
                left: args.e.screenX,
                top: args.e.screenY
              };
            },
            stop: function stop(args) {
              _this.hasDragged = _this.dragStart.left != args.e.screenX || _this.dragStart.top != args.e.screenY;
              _this.updateCanvasHeight();
            }
          });
          // Configure the activity as a target.
          plumber.makeTarget(activityElement, {
            dropOptions: {
              hoverClass: 'hover'
            },
            anchor: 'Continuous',
            endpoint: ['Blank', {
              radius: 8
            }]
          });
          // Add source endpoints.
          for (var _i = 0, _a = activity.outcomes; _i < _a.length; _i++) {
            var outcome = _a[_i];
            var sourceEndpointOptions = _this.getSourceEndpointOptions(activity, outcome);
            plumber.addEndpoint(activityElement, {
              connectorOverlays: [['Label', {
                label: outcome.displayName,
                cssClass: 'connection-label'
              }]]
            }, sourceEndpointOptions);
          }
        });
        // Connect activities.
        _this.updateConnections(plumber);
        // Re-query the activity elements.
        activityElements = _this.getActivityElements();
        // Make all activity elements visible.
        activityElements.show();
        _this.updateCanvasHeight();
      });
      // Initialize popovers.
      activityElements.each(function (_, item) {
        var activityElement = $(item);
        activityElement.popover({
          trigger: 'manual',
          html: true,
          content: function content() {
            var $content = activityElement.find('.activity-commands').clone();
            var startButton = $content.find('.activity-start-action');
            var isStart = activityElement.data('activity-start') === true;
            var activityId = activityElement.data('activity-id');
            startButton.attr('aria-pressed', activityElement.data('activity-start'));
            startButton.toggleClass('active', isStart);
            $content.on('click', '.activity-start-action', function (e) {
              e.preventDefault();
              var button = $(e.currentTarget);
              var isStart = button.is('.active');
              activityElement.data('activity-start', isStart);
              activityElement.toggleClass('activity-start', isStart);
            });
            $content.on('click', '.activity-delete-action', function (e) {
              e.preventDefault();
              // TODO: The prompts are really annoying. Consider showing some sort of small message balloon somewhere to undo the action instead.
              //if (!confirm(self.deleteActivityPrompt)) {
              //    return;
              //}
              self.workflowType.removedActivities.push(activityId);
              plumber.remove(activityElement);
              activityElement.popover('dispose');
            });
            $content.on('click', '[data-persist-workflow]', function (e) {
              self.saveLocalState();
            });
            return $content.get(0);
          }
        });
      });
      $(container).on('click', '.activity', function (e) {
        if (_this.hasDragged) {
          _this.hasDragged = false;
          return;
        }
        // if any other popovers are visible, hide them
        if (_this.isPopoverVisible) {
          activityElements.popover('hide');
        }
        var sender = $(e.currentTarget);
        sender.popover('show');
        // handle clicking on the popover itself.
        $('.popover').off('click').on('click', function (e2) {
          e2.stopPropagation();
        });
        e.stopPropagation();
        _this.isPopoverVisible = true;
      });
      $(container).on('dblclick', '.activity', function (e) {
        var sender = $(e.currentTarget);
        var hasEditor = sender.data('activity-has-editor');
        if (hasEditor) {
          _this.saveLocalState();
          sender.find('.activity-edit-action').get(0).click();
        }
      });
      // Hide all popovers when clicking anywhere but on an activity.
      $('body').on('click', function (e) {
        activityElements.popover('hide');
        _this.isPopoverVisible = false;
      });
      // Save local changes if the event target has the 'data-persist-workflow' attribute.
      $('body').on('click', '[data-persist-workflow]', function (e) {
        _this.saveLocalState();
      });
      _this.jsPlumbInstance = plumber;
    });
    return _this;
  }
  return WorkflowEditor;
}(WorkflowCanvas);
$.fn.workflowEditor = function () {
  this.each(function (index, element) {
    var $element = $(element);
    var workflowType = $element.data('workflow-type');
    var deleteActivityPrompt = $element.data('workflow-delete-activity-prompt');
    var localId = $element.data('workflow-local-id');
    var loadLocalState = $element.data('workflow-load-local-state');
    workflowType.removedActivities = workflowType.removedActivities || [];
    $element.data('workflowEditor', new WorkflowEditor(element, workflowType, deleteActivityPrompt, localId, loadLocalState));
  });
  return this;
};
$(document).ready(function () {
  var workflowEditor = $('.workflow-canvas').workflowEditor().data('workflowEditor');
  $('#workflowEditorForm').on('submit', function (s, e) {
    var state = workflowEditor.serialize();
    $('#workflowStateInput').val(state);
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjdGl2aXR5LXBpY2tlci50cyIsImFjdGl2aXR5LXBpY2tlci5qcyIsIndvcmtmbG93LXVybC1nZW5lcmF0b3IudHMiLCJ3b3JrZmxvdy11cmwtZ2VuZXJhdG9yLmpzIiwid29ya2Zsb3ctY2FudmFzLnRzIiwid29ya2Zsb3ctY2FudmFzLmpzIiwid29ya2Zsb3ctZWRpdG9yLnRzIiwid29ya2Zsb3ctZWRpdG9yLmpzIl0sIm5hbWVzIjpbImFwcGx5RmlsdGVyIiwiY2F0ZWdvcnkiLCJxIiwidHlwZSIsIiQiLCJkYXRhIiwiYXR0ciIsInN1YnN0ciIsInZhbCIsIiRjYXJkcyIsInNob3ciLCJmaWx0ZXIiLCJpIiwiZWwiLCJoaWRlIiwibGVuZ3RoIiwiZmluZCIsInRleHQiLCJ0b0xvd2VyQ2FzZSIsImluZGV4T2YiLCJlYWNoIiwiY2F0ZWdvcnlMaXN0SXRlbSIsImFjdGl2aXR5Q291bnQiLCJjb25jYXQiLCJvbiIsImUiLCJ0YXJnZXQiLCJldmVudCIsIm1vZGFsRXZlbnQiLCJidXR0b24iLCJyZWxhdGVkVGFyZ2V0IiwidGl0bGUiLCJtb2RhbCIsImNsaWNrIiwiZ2VuZXJhdGVXb3JrZmxvd1VybCIsIndvcmtmbG93VHlwZUlkIiwiYWN0aXZpdHlJZCIsInRva2VuTGlmZVNwYW4iLCJnZW5lcmF0ZVVybCIsImFudGlmb3JnZXJ5SGVhZGVyTmFtZSIsImFudGlmb3JnZXJ5VG9rZW4iLCJoZWFkZXJzIiwicG9zdCIsInVybCIsImRvbmUiLCJXb3JrZmxvd0NhbnZhcyIsImNvbnRhaW5lciIsIndvcmtmbG93VHlwZSIsIl90aGlzIiwibWluQ2FudmFzSGVpZ2h0IiwiZ2V0QWN0aXZpdHlFbGVtZW50cyIsImdldERlZmF1bHRzIiwiQW5jaG9yIiwiRHJhZ09wdGlvbnMiLCJjdXJzb3IiLCJ6SW5kZXgiLCJFbmRwb2ludFN0eWxlcyIsImZpbGxTdHlsZSIsIkVuZHBvaW50cyIsInJhZGl1cyIsIkNvbm5lY3Rpb25PdmVybGF5cyIsIndpZHRoIiwibG9jYXRpb24iLCJDb25uZWN0b3JaSW5kZXgiLCJjcmVhdGVKc1BsdW1iSW5zdGFuY2UiLCJqc1BsdW1iIiwiZ2V0SW5zdGFuY2UiLCJ2aXNpYmxlIiwiaWQiLCJjc3NDbGFzcyIsIkNvbnRhaW5lciIsImdldEVuZHBvaW50Q29sb3IiLCJhY3Rpdml0eSIsImlzQmxvY2tpbmciLCJpc1N0YXJ0IiwiaXNFdmVudCIsImdldFNvdXJjZUVuZHBvaW50T3B0aW9ucyIsIm91dGNvbWUiLCJwYWludENvbG9yIiwiZW5kcG9pbnQiLCJhbmNob3IiLCJwYWludFN0eWxlIiwic3Ryb2tlIiwiZmlsbCIsInN0cm9rZVdpZHRoIiwiaXNTb3VyY2UiLCJjb25uZWN0b3IiLCJzdHViIiwiZ2FwIiwiY29ybmVyUmFkaXVzIiwiYWx3YXlzUmVzcGVjdFN0dWJzIiwiY29ubmVjdG9yU3R5bGUiLCJqb2luc3R5bGUiLCJvdXRsaW5lU3Ryb2tlIiwib3V0bGluZVdpZHRoIiwiaG92ZXJQYWludFN0eWxlIiwiY29ubmVjdG9ySG92ZXJTdHlsZSIsImNvbm5lY3Rvck92ZXJsYXlzIiwiZHJhZ09wdGlvbnMiLCJ1dWlkIiwibmFtZSIsInBhcmFtZXRlcnMiLCJnZXRBY3Rpdml0eSIsImFjdGl2aXRpZXMiLCJncmVwIiwieCIsInVwZGF0ZUNvbm5lY3Rpb25zIiwicGx1bWJlciIsIndvcmtmbG93SWQiLCJfaSIsIl9hIiwidHJhbnNpdGlvbnMiLCJ0cmFuc2l0aW9uTW9kZWwiLCJzb3VyY2VFbmRwb2ludFV1aWQiLCJzb3VyY2VBY3Rpdml0eUlkIiwic291cmNlT3V0Y29tZU5hbWUiLCJzb3VyY2VFbmRwb2ludCIsImdldEVuZHBvaW50IiwiZGVzdGluYXRpb25FbGVtZW50SWQiLCJkZXN0aW5hdGlvbkFjdGl2aXR5SWQiLCJjb25uZWN0Iiwic291cmNlIiwidXBkYXRlQ2FudmFzSGVpZ2h0IiwiJGNvbnRhaW5lciIsIiRhY3Rpdml0eUVsZW1lbnRzIiwiY3VycmVudEVsZW1lbnRUb3AiLCJjdXJyZW50QWN0aXZpdHlIZWlnaHQiLCJ0b0FycmF5IiwiYWN0aXZpdHlFbGVtZW50IiwiJGFjdGl2aXR5RWxlbWVudCIsInRvcF8xIiwicG9zaXRpb24iLCJ0b3AiLCJoZWlnaHQiLCJuZXdDYW52YXNIZWlnaHQiLCJlbGVtZW50Qm90dG9tIiwic3RyZXRjaFZhbHVlIiwiTWF0aCIsIm1heCIsIl9fZXh0ZW5kcyIsImV4dGVuZFN0YXRpY3MiLCJkIiwiYiIsIk9iamVjdCIsInNldFByb3RvdHlwZU9mIiwiX19wcm90b19fIiwiQXJyYXkiLCJwIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiVHlwZUVycm9yIiwiU3RyaW5nIiwiX18iLCJjb25zdHJ1Y3RvciIsImNyZWF0ZSIsIldvcmtmbG93RWRpdG9yIiwiX3N1cGVyIiwiZGVsZXRlQWN0aXZpdHlQcm9tcHQiLCJsb2NhbElkIiwibG9hZExvY2FsU3RhdGUiLCJnZXRTdGF0ZSIsIiRhbGxBY3Rpdml0eUVsZW1lbnRzIiwid29ya2Zsb3ciLCJyZW1vdmVkQWN0aXZpdGllcyIsImFjdGl2aXR5SXNTdGFydCIsImFjdGl2aXR5SXNFdmVudCIsImFjdGl2aXR5UG9zaXRpb24iLCJwdXNoIiwib3V0Y29tZXMiLCJsZWZ0IiwieSIsImFsbENvbm5lY3Rpb25zIiwianNQbHVtYkluc3RhbmNlIiwiZ2V0Q29ubmVjdGlvbnMiLCJjb25uZWN0aW9uIiwiZW5kcG9pbnRzIiwiZ2V0UGFyYW1ldGVycyIsInNlcmlhbGl6ZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJzYXZlTG9jYWxTdGF0ZSIsInNlc3Npb25TdG9yYWdlIiwicGFyc2UiLCJzZWxmIiwicmVhZHkiLCJpbXBvcnREZWZhdWx0cyIsImJpbmQiLCJjb25uSW5mbyIsIm9yaWdpbmFsRXZlbnQiLCJsYWJlbCIsImdldE92ZXJsYXkiLCJzZXRMYWJlbCIsImRpc3BsYXlOYW1lIiwiYWN0aXZpdHlFbGVtZW50cyIsImFyZUVxdWFsT3V0Y29tZXMiLCJvdXRjb21lczEiLCJvdXRjb21lczIiLCJvdXRjb21lMSIsIm91dGNvbWUyIiwiYmF0Y2giLCJzZXJ2ZXJ3b3JrZmxvd1R5cGUiLCJsb2NhbFN0YXRlIiwiXyIsImlzRGVsZXRlZCIsInJlbW92ZSIsInNlcnZlckFjdGl2aXR5Iiwic2FtZU91dGNvbWVzIiwiY3NzIiwidG9nZ2xlQ2xhc3MiLCJkcmFnZ2FibGUiLCJncmlkIiwiY29udGFpbm1lbnQiLCJzdGFydCIsImFyZ3MiLCJkcmFnU3RhcnQiLCJzY3JlZW5YIiwic2NyZWVuWSIsInN0b3AiLCJoYXNEcmFnZ2VkIiwibWFrZVRhcmdldCIsImRyb3BPcHRpb25zIiwiaG92ZXJDbGFzcyIsInNvdXJjZUVuZHBvaW50T3B0aW9ucyIsImFkZEVuZHBvaW50IiwiaXRlbSIsInBvcG92ZXIiLCJ0cmlnZ2VyIiwiaHRtbCIsImNvbnRlbnQiLCIkY29udGVudCIsImNsb25lIiwic3RhcnRCdXR0b24iLCJwcmV2ZW50RGVmYXVsdCIsImN1cnJlbnRUYXJnZXQiLCJpcyIsImdldCIsImlzUG9wb3ZlclZpc2libGUiLCJzZW5kZXIiLCJvZmYiLCJlMiIsInN0b3BQcm9wYWdhdGlvbiIsImhhc0VkaXRvciIsImZuIiwid29ya2Zsb3dFZGl0b3IiLCJpbmRleCIsImVsZW1lbnQiLCIkZWxlbWVudCIsImRvY3VtZW50IiwicyIsInN0YXRlIl0sIm1hcHBpbmdzIjoiOzs7OztBQUFBO0FBRUEsSUFBSUEsV0FBVyxHQUFHLFNBQWRBLFdBQVdBLENBQWFDLFFBQWdCLEVBQUVDLENBQVMsRUFBQTtFQUNuRCxJQUFNQyxJQUFJLEdBQUdDLENBQUMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDQyxJQUFJLENBQUMsZUFBZSxDQUFDO0VBQ3pESixRQUFRLEdBQUdBLFFBQVEsSUFBSUcsQ0FBQyxDQUFDLDhDQUE4QyxDQUFDLENBQUNFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQ0MsTUFBTSxDQUFDLENBQUMsQ0FBQztFQUMvRkwsQ0FBQyxHQUFHQSxDQUFDLElBQVlFLENBQUMsQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDSSxHQUFHLENBQUEsQ0FBRTtFQUVoRSxJQUFNQyxNQUFNLEdBQUdMLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQ00sSUFBSSxDQUFBLENBQUU7RUFFeEM7RUFDQUQsTUFBTSxDQUFDRSxNQUFNLENBQUMsVUFBQ0MsQ0FBQyxFQUFFQyxFQUFFLEVBQUE7SUFDaEIsT0FBT1QsQ0FBQyxDQUFDUyxFQUFFLENBQUMsQ0FBQ1IsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJRixJQUFJO0VBQzlDLENBQUMsQ0FBQyxDQUFDVyxJQUFJLENBQUEsQ0FBRTtFQUVULElBQUlaLENBQUMsQ0FBQ2EsTUFBTSxHQUFHLENBQUMsRUFBRTtJQUNkO0lBQ0FOLE1BQU0sQ0FBQ0UsTUFBTSxDQUFDLFVBQUNDLENBQUMsRUFBRUMsRUFBRSxFQUFBO01BQ2hCLE9BQU9ULENBQUMsQ0FBQ1MsRUFBRSxDQUFDLENBQUNHLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQ0MsSUFBSSxDQUFBLENBQUUsQ0FBQ0MsV0FBVyxDQUFBLENBQUUsQ0FBQ0MsT0FBTyxDQUFDakIsQ0FBQyxDQUFDZ0IsV0FBVyxDQUFBLENBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSWhCLENBQUMsSUFBSUEsQ0FBQyxDQUFDYSxNQUFNLEdBQUcsQ0FBQztJQUMzRyxDQUFDLENBQUMsQ0FBQ0QsSUFBSSxDQUFBLENBQUU7RUNIYixDRElDLE1BQ0k7SUFDRDtJQUNBTCxNQUFNLENBQUNFLE1BQU0sQ0FBQyxVQUFDQyxDQUFDLEVBQUVDLEVBQUUsRUFBQTtNQUNoQixPQUFPVCxDQUFDLENBQUNTLEVBQUUsQ0FBQyxDQUFDUixJQUFJLENBQUMsVUFBVSxDQUFDLENBQUNhLFdBQVcsQ0FBQSxDQUFFLElBQUlqQixRQUFRLENBQUNpQixXQUFXLENBQUEsQ0FBRSxJQUFJakIsUUFBUSxDQUFDaUIsV0FBVyxDQUFBLENBQUUsSUFBSSxLQUFLO0lBQzVHLENBQUMsQ0FBQyxDQUFDSixJQUFJLENBQUEsQ0FBRTtFQ0hiO0VETUE7RUFDQVYsQ0FBQyxDQUFDLDZDQUE2QyxDQUFDLENBQUNnQixJQUFJLENBQUMsVUFBQ1IsQ0FBQyxFQUFFQyxFQUFFLEVBQUE7SUFDeEQsSUFBTVEsZ0JBQWdCLEdBQUdqQixDQUFDLENBQUNTLEVBQUUsQ0FBQztJQUM5QixJQUFNWixRQUFRLEdBQUdvQixnQkFBZ0IsQ0FBQ2hCLElBQUksQ0FBQyxVQUFVLENBQUM7SUFFbEQ7SUFDQSxJQUFNaUIsYUFBYSxHQUFHbEIsQ0FBQyxDQUFDLCtCQUFBLENBQUFtQixNQUFBLENBQWdDdEIsUUFBUSxFQUFBLHlCQUFBLENBQUEsQ0FBQXNCLE1BQUEsQ0FBMEJwQixJQUFJLEVBQUEsSUFBQSxDQUFJLENBQUMsQ0FBQ1ksTUFBTTtJQUMxR08sYUFBYSxJQUFJLENBQUMsR0FBR0QsZ0JBQWdCLENBQUNQLElBQUksQ0FBQSxDQUFFLEdBQUdPLGdCQUFnQixDQUFDWCxJQUFJLENBQUEsQ0FBRTtFQUMxRSxDQUFDLENBQUM7QUFDTixDQUFDO0FBRUROLENBQUMsQ0FBQyxZQUFBO0VBQ0VBLENBQUMsQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDb0IsRUFBRSxDQUFDLE9BQU8sRUFBRSxXQUFXLEVBQUUsVUFBQUMsQ0FBQyxFQUFBO0lBQ3ZEekIsV0FBVyxDQUFDSSxDQUFDLENBQUNxQixDQUFDLENBQUNDLE1BQU0sQ0FBQyxDQUFDcEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDO0VBQ3pELENBQUMsQ0FBQztFQUVGSCxDQUFDLENBQUMsc0NBQXNDLENBQUMsQ0FBQ29CLEVBQUUsQ0FBQyxPQUFPLEVBQUUsVUFBQUMsQ0FBQyxFQUFBO0lBQ25EekIsV0FBVyxDQUFDLElBQUksRUFBVUksQ0FBQyxDQUFDcUIsQ0FBQyxDQUFDQyxNQUFNLENBQUMsQ0FBQ2xCLEdBQUcsQ0FBQSxDQUFFLENBQUM7RUFDaEQsQ0FBQyxDQUFDO0VBRUZKLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDb0IsRUFBRSxDQUFDLGVBQWUsRUFBRSxVQUFVRyxLQUFLLEVBQUE7SUFDckQsSUFBSUMsVUFBVSxHQUFHRCxLQUFZO0lBQzdCLElBQUlFLE1BQU0sR0FBR3pCLENBQUMsQ0FBQ3dCLFVBQVUsQ0FBQ0UsYUFBYSxDQUFDLENBQUMsQ0FBQztJQUMxQyxJQUFJQyxLQUFLLEdBQUdGLE1BQU0sQ0FBQ3hCLElBQUksQ0FBQyxjQUFjLENBQUM7SUFDdkMsSUFBSUYsSUFBSSxHQUFHMEIsTUFBTSxDQUFDeEIsSUFBSSxDQUFDLGVBQWUsQ0FBQztJQUN2QyxJQUFJMkIsS0FBSyxHQUFHNUIsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUNuQjRCLEtBQUssQ0FBQ2hCLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQ2lCLEtBQUssQ0FBQSxDQUFFO0lBQ25DRCxLQUFLLENBQUNoQixJQUFJLENBQUMsY0FBYyxDQUFDLENBQUNDLElBQUksQ0FBQ2MsS0FBSyxDQUFDO0lBQ3RDQyxLQUFLLENBQUMzQixJQUFJLENBQUMsZUFBZSxFQUFFRixJQUFJLENBQUM7SUFDakNILFdBQVcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDO0VBQzNCLENBQUMsQ0FBQztBQUNOLENBQUMsQ0FBQztBRTFERjtBQUVBSSxDQUFDLENBQUMsWUFBQTtFQUNFLElBQU04QixtQkFBbUIsR0FBRyxTQUF0QkEsbUJBQW1CQSxDQUFBLEVBQUc7SUFDeEIsSUFBTUMsY0FBYyxHQUFXL0IsQ0FBQyxDQUFDLHlCQUF5QixDQUFDLENBQUNDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQztJQUNwRixJQUFNK0IsVUFBVSxHQUFXaEMsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLENBQUNDLElBQUksQ0FBQyxhQUFhLENBQUM7SUFDdEUsSUFBSWdDLGFBQWEsR0FBR2pDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDSSxHQUFHLENBQUEsQ0FBRTtJQUM5QyxJQUFNOEIsV0FBVyxHQUFXbEMsQ0FBQyxDQUFDLHFCQUFxQixDQUFDLENBQUNDLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxrQkFBQSxDQUFBa0IsTUFBQSxDQUFtQlksY0FBYyxFQUFBLGNBQUEsQ0FBQSxDQUFBWixNQUFBLENBQWVhLFVBQVUsRUFBQSxpQkFBQSxDQUFBLENBQUFiLE1BQUEsQ0FBa0JjLGFBQWEsQ0FBRTtJQUN2SyxJQUFNRSxxQkFBcUIsR0FBV25DLENBQUMsQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDQyxJQUFJLENBQUMseUJBQXlCLENBQUM7SUFDekcsSUFBTW1DLGdCQUFnQixHQUFXcEMsQ0FBQyxDQUFDLDBCQUEwQixDQUFDLENBQUNDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQztJQUN4RixJQUFNb0MsT0FBTyxHQUFRLENBQUEsQ0FBRTtJQUV2QkEsT0FBTyxDQUFDRixxQkFBcUIsQ0FBQyxHQUFHQyxnQkFBZ0I7SUFFakRwQyxDQUFDLENBQUNzQyxJQUFJLENBQUM7TUFDSEMsR0FBRyxFQUFFTCxXQUFXO01BQ2hCRyxPQUFPLEVBQUVBO0lDRmIsQ0RHQyxDQUFDLENBQUNHLElBQUksQ0FBQyxVQUFBRCxHQUFHLEVBQUE7TUFDUHZDLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDSSxHQUFHLENBQUNtQyxHQUFHLENBQUM7SUFDcEMsQ0FBQyxDQUFDO0VBQ04sQ0FBQztFQUVEdkMsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUNvQixFQUFFLENBQUMsT0FBTyxFQUFFLFVBQUFDLENBQUMsRUFBQTtJQUNuQ1MsbUJBQW1CLENBQUEsQ0FBRTtFQUN6QixDQUFDLENBQUM7RUFFRixJQUFJOUIsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLENBQUNJLEdBQUcsQ0FBQSxDQUFFLElBQUksRUFBRSxFQUFFO0lBQ3JDMEIsbUJBQW1CLENBQUEsQ0FBRTtFQ0p6QjtBRE1KLENBQUMsQ0FBQztBRTdCRjtBQUNBO0FBQ0E7QUFFQSxJQUFBVyxjQUFBLEdBQUEsYUFBQSxZQUFBO0VBR0ksU0FBQUEsY0FBQUEsQ0FBc0JDLFNBQXNCLEVBQVlDLFlBQW9DLEVBQUE7SUFBNUYsSUFBQUMsS0FBQSxHQUFBLElBQUE7SUFBc0IsSUFBQSxDQUFBRixTQUFTLEdBQVRBLFNBQVM7SUFBeUIsSUFBQSxDQUFBQyxZQUFZLEdBQVpBLFlBQVk7SUFGNUQsSUFBQSxDQUFBRSxlQUFlLEdBQVcsR0FBRztJQUszQixJQUFBLENBQUFDLG1CQUFtQixHQUFHLFlBQUE7TUFDNUIsT0FBTzlDLENBQUMsQ0FBQzRDLEtBQUksQ0FBQ0YsU0FBUyxDQUFDLENBQUM5QixJQUFJLENBQUMsV0FBVyxDQUFDO0lBQzlDLENBQUM7SUFFUyxJQUFBLENBQUFtQyxXQUFXLEdBQUcsWUFBQTtNQUNwQixPQUFPO1FBQ0hDLE1BQU0sRUFBRSxZQUFZO1FBQ3BCQyxXQUFXLEVBQUU7VUFBRUMsTUFBTSxFQUFFLFNBQVM7VUFBRUMsTUFBTSxFQUFFO1FBQUksQ0FBRTtRQUNoREMsY0FBYyxFQUFFLENBQUM7VUFBRUMsU0FBUyxFQUFFO1FBQVMsQ0FBRSxDQUFDO1FBQzFDQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLEtBQUssRUFBRTtVQUFFQyxNQUFNLEVBQUU7UUFBQyxDQUFFLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzlDQyxrQkFBa0IsRUFBRSxDQUNoQixDQUFDLE9BQU8sRUFBRTtVQUFFQyxLQUFLLEVBQUUsRUFBRTtVQUFFOUMsTUFBTSxFQUFFLEVBQUU7VUFBRStDLFFBQVEsRUFBRSxDQUFDO1FBQUMsQ0FBRSxDQUFDLENBQ3JEO1FBQ0RDLGVBQWUsRUFBRTtNQ0RqQixDREVIO0lBQ0wsQ0FBQztJQUVTLElBQUEsQ0FBQUMscUJBQXFCLEdBQUcsWUFBQTtNQUM5QixPQUFPQyxPQUFPLENBQUNDLFdBQVcsQ0FBQztRQUN2QmIsV0FBVyxFQUFFO1VBQUVDLE1BQU0sRUFBRSxTQUFTO1VBQUVDLE1BQU0sRUFBRTtRQUFJLENBQUU7UUFDaERLLGtCQUFrQixFQUFFLENBQ2hCLENBQUMsT0FBTyxFQUFFO1VBQ05FLFFBQVEsRUFBRSxDQUFDO1VBQ1hLLE9BQU8sRUFBRSxJQUFJO1VBQ2JOLEtBQUssRUFBRSxFQUFFO1VBQ1Q5QyxNQUFNLEVBQUU7UUNGSixDREdQLENBQUMsRUFDRixDQUFDLE9BQU8sRUFBRTtVQUNOK0MsUUFBUSxFQUFFLEdBQUc7VUFDYk0sRUFBRSxFQUFFLE9BQU87VUFDWEMsUUFBUSxFQUFFO1FDRk4sQ0RHUCxDQUFDLENBQ0w7UUFDREMsU0FBUyxFQUFFdEIsS0FBSSxDQUFDRjtNQ0ZoQixDREdILENBQUM7SUFDTixDQUFDO0lBRVMsSUFBQSxDQUFBeUIsZ0JBQWdCLEdBQUcsVUFBQ0MsUUFBNEIsRUFBQTtNQUN0RCxPQUFPQSxRQUFRLENBQUNDLFVBQVUsSUFBSUQsUUFBUSxDQUFDRSxPQUFPLEdBQUcsU0FBUyxHQUFHRixRQUFRLENBQUNHLE9BQU8sR0FBRyxTQUFTLEdBQUcsU0FBUztJQUN6RyxDQUFDO0lBRVMsSUFBQSxDQUFBQyx3QkFBd0IsR0FBRyxVQUFDSixRQUE0QixFQUFFSyxPQUEwQixFQUFBO01BQzFGO01BQ0EsSUFBTUMsVUFBVSxHQUFHOUIsS0FBSSxDQUFDdUIsZ0JBQWdCLENBQUNDLFFBQVEsQ0FBQztNQUNsRCxPQUFPO1FBQ0hPLFFBQVEsRUFBRSxLQUFLO1FBQ2ZDLE1BQU0sRUFBRSxZQUFZO1FBQ3BCQyxVQUFVLEVBQUU7VUFDUkMsTUFBTSxFQUFFSixVQUFVO1VBQ2xCSyxJQUFJLEVBQUVMLFVBQVU7VUFDaEJuQixNQUFNLEVBQUUsQ0FBQztVQUNUeUIsV0FBVyxFQUFFO1FDSmIsQ0RLSDtRQUNEQyxRQUFRLEVBQUUsSUFBSTtRQUNkQyxTQUFTLEVBQUUsQ0FBQyxXQUFXLEVBQUU7VUFBRUMsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQztVQUFFQyxHQUFHLEVBQUUsQ0FBQztVQUFFQyxZQUFZLEVBQUUsQ0FBQztVQUFFQyxrQkFBa0IsRUFBRTtRQUFJLENBQUUsQ0FBQztRQUMvRkMsY0FBYyxFQUFFO1VBQ1pQLFdBQVcsRUFBRSxDQUFDO1VBQ2RGLE1BQU0sRUFBRSxTQUFTO1VBQ2pCVSxTQUFTLEVBQUUsT0FBTztVQUNsQkMsYUFBYSxFQUFFLE9BQU87VUFDdEJDLFlBQVksRUFBRTtRQ0pkLENES0g7UUFDREMsZUFBZSxFQUFFO1VBQ2JaLElBQUksRUFBRSxTQUFTO1VBQ2ZELE1BQU0sRUFBRTtRQ0pSLENES0g7UUFDRGMsbUJBQW1CLEVBQUU7VUFDakJaLFdBQVcsRUFBRSxDQUFDO1VBQ2RGLE1BQU0sRUFBRSxTQUFTO1VBQ2pCWSxZQUFZLEVBQUUsQ0FBQztVQUNmRCxhQUFhLEVBQUU7UUNKZixDREtIO1FBQ0RJLGlCQUFpQixFQUFFLENBQUMsQ0FBQyxPQUFPLEVBQUU7VUFBRW5DLFFBQVEsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQztVQUFFTyxRQUFRLEVBQUU7UUFBcUIsQ0FBRSxDQUFDLENBQUM7UUFDeEY2QixXQUFXLEVBQUUsQ0FBQSxDQUFFO1FBQ2ZDLElBQUksRUFBRSxFQUFBLENBQUE1RSxNQUFBLENBQUdpRCxRQUFRLENBQUNKLEVBQUUsRUFBQSxHQUFBLENBQUEsQ0FBQTdDLE1BQUEsQ0FBSXNELE9BQU8sQ0FBQ3VCLElBQUksQ0FBRTtRQUN0Q0MsVUFBVSxFQUFFO1VBQ1J4QixPQUFPLEVBQUVBO1FDSlQ7TUFDSixDREtIO0lBQ0wsQ0FBQztJQUVTLElBQUEsQ0FBQXlCLFdBQVcsR0FBRyxVQUFVbEMsRUFBVSxFQUFFbUMsVUFBNEMsRUFBQTtNQUE1QyxJQUFBQSxVQUFBLEtBQUEsS0FBQSxDQUFBLEVBQUE7UUFBQUEsVUFBQSxHQUFBLElBQTRDO01BQUE7TUFDdEYsSUFBSSxDQUFDQSxVQUFVLEVBQUU7UUFDYkEsVUFBVSxHQUFHLElBQUksQ0FBQ3hELFlBQVksQ0FBQ3dELFVBQVU7TUNKekM7TURNSixPQUFPbkcsQ0FBQyxDQUFDb0csSUFBSSxDQUFDRCxVQUFVLEVBQUUsVUFBQ0UsQ0FBcUIsRUFBQTtRQUFLLE9BQUFBLENBQUMsQ0FBQ3JDLEVBQUUsS0FBS0EsRUFBRTtNQUFYLENBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN4RSxDQUFDO0lBRVMsSUFBQSxDQUFBc0MsaUJBQWlCLEdBQUcsVUFBQ0MsT0FBd0IsRUFBQTtNQUNuRCxJQUFJQyxVQUFVLEdBQVc1RCxLQUFJLENBQUNELFlBQVksQ0FBQ3FCLEVBQUU7TUFFN0M7TUFDQSxLQUE0QixJQUFBeUMsRUFBQSxHQUFBLENBQTZCLEVBQTdCQyxFQUFBLEdBQUE5RCxLQUFJLENBQUNELFlBQVksQ0FBQ2dFLFdBQVcsRUFBN0JGLEVBQUEsR0FBQUMsRUFBQSxDQUFBL0YsTUFBNkIsRUFBN0I4RixFQUFBLEVBQTZCLEVBQUU7UUFBdEQsSUFBSUcsZUFBZSxHQUFBRixFQUFBLENBQUFELEVBQUEsQ0FBQTtRQUNwQixJQUFNSSxrQkFBa0IsR0FBVyxFQUFBLENBQUExRixNQUFBLENBQUd5RixlQUFlLENBQUNFLGdCQUFnQixFQUFBLEdBQUEsQ0FBQSxDQUFBM0YsTUFBQSxDQUFJeUYsZUFBZSxDQUFDRyxpQkFBaUIsQ0FBRTtRQUM3RyxJQUFNQyxjQUFjLEdBQWFULE9BQU8sQ0FBQ1UsV0FBVyxDQUFDSixrQkFBa0IsQ0FBQztRQUN4RSxJQUFNSyxvQkFBb0IsR0FBVyxXQUFBLENBQUEvRixNQUFBLENBQVlxRixVQUFVLEVBQUEsR0FBQSxDQUFBLENBQUFyRixNQUFBLENBQUl5RixlQUFlLENBQUNPLHFCQUFxQixDQUFFO1FBRXRHWixPQUFPLENBQUNhLE9BQU8sQ0FBQztVQUNaQyxNQUFNLEVBQUVMLGNBQWM7VUFDdEIxRixNQUFNLEVBQUU0RjtRQ05SLENET0gsQ0FBQztNQ05GO0lEUVIsQ0FBQztJQUVTLElBQUEsQ0FBQUksa0JBQWtCLEdBQUcsWUFBQTtNQUMzQixJQUFNQyxVQUFVLEdBQUd2SCxDQUFDLENBQUMsSUFBSSxDQUFDMEMsU0FBUyxDQUFDO01BRXBDO01BQ0EsSUFBTThFLGlCQUFpQixHQUFHRCxVQUFVLENBQUMzRyxJQUFJLENBQUMsV0FBVyxDQUFDO01BQ3RELElBQUk2RyxpQkFBaUIsR0FBRyxDQUFDO01BQ3pCLElBQUlDLHFCQUFxQixHQUFHLENBQUM7TUFFN0IsS0FBNEIsSUFBQWpCLEVBQUEsR0FBQSxDQUEyQixFQUEzQkMsRUFBQSxHQUFBYyxpQkFBaUIsQ0FBQ0csT0FBTyxDQUFBLENBQUUsRUFBM0JsQixFQUFBLEdBQUFDLEVBQUEsQ0FBQS9GLE1BQTJCLEVBQTNCOEYsRUFBQSxFQUEyQixFQUFFO1FBQXBELElBQUltQixlQUFlLEdBQUFsQixFQUFBLENBQUFELEVBQUEsQ0FBQTtRQUNwQixJQUFNb0IsZ0JBQWdCLEdBQUc3SCxDQUFDLENBQUM0SCxlQUFlLENBQUM7UUFDM0MsSUFBTUUsS0FBRyxHQUFHRCxnQkFBZ0IsQ0FBQ0UsUUFBUSxDQUFBLENBQUUsQ0FBQ0MsR0FBRztRQUUzQyxJQUFJRixLQUFHLEdBQUdMLGlCQUFpQixFQUFFO1VBQ3pCQSxpQkFBaUIsR0FBR0ssS0FBRztVQUN2QkoscUJBQXFCLEdBQUdHLGdCQUFnQixDQUFDSSxNQUFNLENBQUEsQ0FBRTtRQ1RqRDtNQUNKO01EWUosSUFBSUMsZUFBZSxHQUFHVCxpQkFBaUIsR0FBR0MscUJBQXFCO01BQy9ELElBQU1TLGFBQWEsR0FBR1YsaUJBQWlCLEdBQUdDLHFCQUFxQjtNQUMvRCxJQUFNVSxZQUFZLEdBQUcsR0FBRztNQUV4QixJQUFJRixlQUFlLEdBQUdDLGFBQWEsSUFBSUMsWUFBWSxFQUFFO1FBQ2pERixlQUFlLElBQUlFLFlBQVk7TUNYL0I7TURjSmIsVUFBVSxDQUFDVSxNQUFNLENBQUNJLElBQUksQ0FBQ0MsR0FBRyxDQUFDLElBQUksQ0FBQ3pGLGVBQWUsRUFBRXFGLGVBQWUsQ0FBQyxDQUFDO0lBQ3RFLENBQUM7RUFySUQ7RUFzSUosT0FBQXpGLGNBQUM7QUFBRCxDQTFJQSxDQUFBLENBQUE7QUVKQTtBQUNBO0FBQ0E7QUFDQTtBQ0NBLElBQUk4RixTQUFTLEdBQUksSUFBSSxJQUFJLElBQUksQ0FBQ0EsU0FBUyxJQUFNLFlBQVk7RUFDckQsSUFBSUMsY0FBYSxHQUFHLFNBQUFBLGNBQVVDLENBQUMsRUFBRUMsQ0FBQyxFQUFFO0lBQ2hDRixjQUFhLEdBQUdHLE1BQU0sQ0FBQ0MsY0FBYyxJQUNoQztNQUFFQyxTQUFTLEVBQUU7SUFBRyxDQUFDLFlBQVlDLEtBQUssSUFBSSxVQUFVTCxDQUFDLEVBQUVDLENBQUMsRUFBRTtNQUFFRCxDQUFDLENBQUNJLFNBQVMsR0FBR0gsQ0FBQztJQUFFLENBQUUsSUFDNUUsVUFBVUQsQ0FBQyxFQUFFQyxDQUFDLEVBQUU7TUFBRSxLQUFLLElBQUlLLENBQUMsSUFBSUwsQ0FBQyxFQUFFLElBQUlDLE1BQU0sQ0FBQ0ssU0FBUyxDQUFDQyxjQUFjLENBQUNDLElBQUksQ0FBQ1IsQ0FBQyxFQUFFSyxDQUFDLENBQUMsRUFBRU4sQ0FBQyxDQUFDTSxDQUFDLENBQUMsR0FBR0wsQ0FBQyxDQUFDSyxDQUFDLENBQUM7SUFBRSxDQUFDO0lBQ3JHLE9BQU9QLGNBQWEsQ0FBQ0MsQ0FBQyxFQUFFQyxDQUFDLENBQUM7RUFDOUIsQ0FBQztFQUNELE9BQU8sVUFBVUQsQ0FBQyxFQUFFQyxDQUFDLEVBQUU7SUFDbkIsSUFBSSxPQUFPQSxDQUFDLEtBQUssVUFBVSxJQUFJQSxDQUFDLEtBQUssSUFBSSxFQUNyQyxNQUFNLElBQUlTLFNBQVMsQ0FBQyxzQkFBc0IsR0FBR0MsTUFBTSxDQUFDVixDQUFDLENBQUMsR0FBRywrQkFBK0IsQ0FBQztJQUM3RkYsY0FBYSxDQUFDQyxDQUFDLEVBQUVDLENBQUMsQ0FBQztJQUNuQixTQUFTVyxFQUFFQSxDQUFBLEVBQUc7TUFBRSxJQUFJLENBQUNDLFdBQVcsR0FBR2IsQ0FBQztJQUFFO0lBQ3RDQSxDQUFDLENBQUNPLFNBQVMsR0FBR04sQ0FBQyxLQUFLLElBQUksR0FBR0MsTUFBTSxDQUFDWSxNQUFNLENBQUNiLENBQUMsQ0FBQyxJQUFJVyxFQUFFLENBQUNMLFNBQVMsR0FBR04sQ0FBQyxDQUFDTSxTQUFTLEVBQUUsSUFBSUssRUFBRSxDQUFDLENBQUMsQ0FBQztFQUN4RixDQUFDO0FBQ0wsQ0FBQyxDQUFFLENBQUM7QURiSjtBQUNBLElBQUFHLGNBQUEsR0FBQSxhQUFBLFVBQUFDLE1BQUEsRUFBQTtFQUE2QmxCLFNBQUEsQ0FBQWlCLGNBQUEsRUFBQUMsTUFBQSxDQUFBO0VBTXpCLFNBQUFELGNBQUFBLENBQXNCOUcsU0FBc0IsRUFBWUMsWUFBb0MsRUFBVStHLG9CQUE0QixFQUFVQyxPQUFlLEVBQUVDLGNBQXVCLEVBQUE7SUFBcEwsSUFBQWhILEtBQUEsR0FDSTZHLE1BQUEsQ0FBQVAsSUFBQSxDQUFBLElBQUEsRUFBTXhHLFNBQVMsRUFBRUMsWUFBWSxDQUFDLElBQUEsSUFBQTtJQURaQyxLQUFBLENBQUFGLFNBQVMsR0FBVEEsU0FBUztJQUF5QkUsS0FBQSxDQUFBRCxZQUFZLEdBQVpBLFlBQVk7SUFBa0NDLEtBQUEsQ0FBQThHLG9CQUFvQixHQUFwQkEsb0JBQW9CO0lBQWtCOUcsS0FBQSxDQUFBK0csT0FBTyxHQUFQQSxPQUFPO0lBNk4zSS9HLEtBQUEsQ0FBQWlILFFBQVEsR0FBRyxZQUFBO01BQ2YsSUFBTUMsb0JBQW9CLEdBQUc5SixDQUFDLENBQUM0QyxLQUFJLENBQUNGLFNBQVMsQ0FBQyxDQUFDOUIsSUFBSSxDQUFDLFdBQVcsQ0FBQztNQUNoRSxJQUFNbUosUUFBUSxHQUEyQjtRQUNyQy9GLEVBQUUsRUFBRXBCLEtBQUksQ0FBQ0QsWUFBWSxDQUFDcUIsRUFBRTtRQUN4Qm1DLFVBQVUsRUFBRSxFQUFFO1FBQ2RRLFdBQVcsRUFBRSxFQUFFO1FBQ2ZxRCxpQkFBaUIsRUFBRXBILEtBQUksQ0FBQ0QsWUFBWSxDQUFDcUg7TUM1TXJDLENENk1IO01BRUQ7TUFDQSxLQUFLLElBQUl4SixDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUdzSixvQkFBb0IsQ0FBQ25KLE1BQU0sRUFBRUgsQ0FBQyxFQUFFLEVBQUU7UUFDbEQsSUFBTXFILGdCQUFnQixHQUFXN0gsQ0FBQyxDQUFDOEosb0JBQW9CLENBQUN0SixDQUFDLENBQUMsQ0FBQztRQUMzRCxJQUFNd0IsVUFBVSxHQUFXNkYsZ0JBQWdCLENBQUM1SCxJQUFJLENBQUMsYUFBYSxDQUFDO1FBQy9ELElBQU1nSyxlQUFlLEdBQVlwQyxnQkFBZ0IsQ0FBQzVILElBQUksQ0FBQyxnQkFBZ0IsQ0FBQztRQUN4RSxJQUFNaUssZUFBZSxHQUFZckMsZ0JBQWdCLENBQUM1SCxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssT0FBTztRQUNuRixJQUFNa0ssZ0JBQWdCLEdBQXVCdEMsZ0JBQWdCLENBQUNFLFFBQVEsQ0FBQSxDQUFFO1FBQ3hFLElBQU0zRCxRQUFRLEdBQXVCeEIsS0FBSSxDQUFDc0QsV0FBVyxDQUFDbEUsVUFBVSxDQUFDO1FBRWpFK0gsUUFBUSxDQUFDNUQsVUFBVSxDQUFDaUUsSUFBSSxDQUFDO1VBQ3JCcEcsRUFBRSxFQUFFaEMsVUFBVTtVQUNkc0MsT0FBTyxFQUFFMkYsZUFBZTtVQUN4QjFGLE9BQU8sRUFBRTJGLGVBQWU7VUFDeEJHLFFBQVEsRUFBRWpHLFFBQVEsQ0FBQ2lHLFFBQVE7VUFDM0JoRSxDQUFDLEVBQUU4RCxnQkFBZ0IsQ0FBQ0csSUFBSTtVQUN4QkMsQ0FBQyxFQUFFSixnQkFBZ0IsQ0FBQ25DO1FDOU1wQixDRCtNSCxDQUFDO01DOU1GO01EaU5KO01BQ0EsSUFBTXdDLGNBQWMsR0FBRzVILEtBQUksQ0FBQzZILGVBQWUsQ0FBQ0MsY0FBYyxDQUFBLENBQUU7TUFFNUQsS0FBSyxJQUFJbEssQ0FBQyxHQUFHLENBQUMsRUFBRUEsQ0FBQyxHQUFHZ0ssY0FBYyxDQUFDN0osTUFBTSxFQUFFSCxDQUFDLEVBQUUsRUFBRTtRQUM1QyxJQUFJbUssVUFBVSxHQUFHSCxjQUFjLENBQUNoSyxDQUFDLENBQUM7UUFDbEMsSUFBSXdHLGNBQWMsR0FBYTJELFVBQVUsQ0FBQ0MsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUN0RCxJQUFJN0QsaUJBQWlCLEdBQUdDLGNBQWMsQ0FBQzZELGFBQWEsQ0FBQSxDQUFFLENBQUNwRyxPQUFPLENBQUN1QixJQUFJO1FBQ25FLElBQUljLGdCQUFnQixHQUFXOUcsQ0FBQyxDQUFDMkssVUFBVSxDQUFDdEQsTUFBTSxDQUFDLENBQUNwSCxJQUFJLENBQUMsYUFBYSxDQUFDO1FBQ3ZFLElBQUlrSCxxQkFBcUIsR0FBV25ILENBQUMsQ0FBQzJLLFVBQVUsQ0FBQ3JKLE1BQU0sQ0FBQyxDQUFDckIsSUFBSSxDQUFDLGFBQWEsQ0FBQztRQUU1RThKLFFBQVEsQ0FBQ3BELFdBQVcsQ0FBQ3lELElBQUksQ0FBQztVQUN0QnRELGdCQUFnQixFQUFFQSxnQkFBZ0I7VUFDbENLLHFCQUFxQixFQUFFQSxxQkFBcUI7VUFDNUNKLGlCQUFpQixFQUFFQTtRQ2pObkIsQ0RrTkgsQ0FBQztNQ2pORjtNRG9OSixPQUFPZ0QsUUFBUTtJQUNuQixDQUFDO0lBRU1uSCxLQUFBLENBQUFrSSxTQUFTLEdBQUcsWUFBQTtNQUNmLElBQU1mLFFBQVEsR0FBMkJuSCxLQUFJLENBQUNpSCxRQUFRLENBQUEsQ0FBRTtNQUN4RCxPQUFPa0IsSUFBSSxDQUFDQyxTQUFTLENBQUNqQixRQUFRLENBQUM7SUFDbkMsQ0FBQztJQUVPbkgsS0FBQSxDQUFBcUksY0FBYyxHQUFHLFlBQUE7TUFDckJDLGNBQWMsQ0FBQ3RJLEtBQUksQ0FBQytHLE9BQU8sQ0FBQyxHQUFHL0csS0FBSSxDQUFDa0ksU0FBUyxDQUFBLENBQUU7SUFDbkQsQ0FBQztJQUVPbEksS0FBQSxDQUFBZ0gsY0FBYyxHQUFHLFlBQUE7TUFDckIsT0FBT21CLElBQUksQ0FBQ0ksS0FBSyxDQUFDRCxjQUFjLENBQUN0SSxLQUFJLENBQUMrRyxPQUFPLENBQUMsQ0FBQztJQUNuRCxDQUFDO0lBdFJHLElBQU15QixJQUFJLEdBQUd4SSxLQUFJO0lBRWpCaUIsT0FBTyxDQUFDd0gsS0FBSyxDQUFDLFlBQUE7TUFDVnhILE9BQU8sQ0FBQ3lILGNBQWMsQ0FBQzFJLEtBQUksQ0FBQ0csV0FBVyxDQUFBLENBQUUsQ0FBQztNQUUxQyxJQUFNd0QsT0FBTyxHQUFHM0QsS0FBSSxDQUFDZ0IscUJBQXFCLENBQUEsQ0FBRTtNQUU1QztNQUNBMkMsT0FBTyxDQUFDZ0YsSUFBSSxDQUFDLFlBQVksRUFBRSxVQUFVQyxRQUFRLEVBQUVDLGFBQWEsRUFBQTtRQUN4RCxJQUFNZCxVQUFVLEdBQWVhLFFBQVEsQ0FBQ2IsVUFBVTtRQUNsRCxJQUFNbEcsT0FBTyxHQUFzQmtHLFVBQVUsQ0FBQ0UsYUFBYSxDQUFBLENBQUUsQ0FBQ3BHLE9BQU87UUFFckUsSUFBTWlILEtBQUssR0FBUWYsVUFBVSxDQUFDZ0IsVUFBVSxDQUFDLE9BQU8sQ0FBQztRQUNqREQsS0FBSyxDQUFDRSxRQUFRLENBQUNuSCxPQUFPLENBQUNvSCxXQUFXLENBQUM7TUFDdkMsQ0FBQyxDQUFDO01BRUYsSUFBSUMsZ0JBQWdCLEdBQUdsSixLQUFJLENBQUNFLG1CQUFtQixDQUFBLENBQUU7TUFFakQsSUFBSWlKLGdCQUFnQixHQUFHLFNBQW5CQSxnQkFBZ0JBLENBQWFDLFNBQThCLEVBQUVDLFNBQThCLEVBQUE7UUFDM0YsSUFBSUQsU0FBUyxDQUFDckwsTUFBTSxJQUFJc0wsU0FBUyxDQUFDdEwsTUFBTSxFQUFFO1VBQ3RDLE9BQU8sS0FBSztRQzREaEI7UUR6REEsS0FBSyxJQUFJSCxDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUd3TCxTQUFTLENBQUNyTCxNQUFNLEVBQUVILENBQUMsRUFBRSxFQUFFO1VBQ3ZDLElBQU0wTCxRQUFRLEdBQUdGLFNBQVMsQ0FBQ3hMLENBQUMsQ0FBQztVQUM3QixJQUFNMkwsUUFBUSxHQUFHRixTQUFTLENBQUN6TCxDQUFDLENBQUM7VUFFN0IsSUFBSTBMLFFBQVEsQ0FBQ2xHLElBQUksSUFBSW1HLFFBQVEsQ0FBQ04sV0FBVyxJQUFJSyxRQUFRLENBQUNMLFdBQVcsSUFBSU0sUUFBUSxDQUFDTixXQUFXLEVBQUU7WUFDdkYsT0FBTyxLQUFLO1VDMERoQjtRQUNKO1FEdkRBLE9BQU8sSUFBSTtNQUNmLENBQUM7TUFFRDtNQUNBdEYsT0FBTyxDQUFDNkYsS0FBSyxDQUFDLFlBQUE7UUFDVixJQUFJQyxrQkFBa0IsR0FBMkJ6SixLQUFJLENBQUNELFlBQVk7UUFDbEUsSUFBSTZELFVBQVUsR0FBVzVELEtBQUksQ0FBQ0QsWUFBWSxDQUFDcUIsRUFBRTtRQUU3QyxJQUFJNEYsY0FBYyxFQUFFO1VBQ2hCLElBQU0wQyxVQUFVLEdBQTJCMUosS0FBSSxDQUFDZ0gsY0FBYyxDQUFBLENBQUU7VUFFaEUsSUFBSTBDLFVBQVUsRUFBRTtZQUNaMUosS0FBSSxDQUFDRCxZQUFZLEdBQUcySixVQUFVO1VDc0RsQztRQUNKO1FEbkRBUixnQkFBZ0IsQ0FBQzlLLElBQUksQ0FBQyxVQUFDdUwsQ0FBQyxFQUFFM0UsZUFBZSxFQUFBO1VBQ3JDLElBQU1DLGdCQUFnQixHQUFHN0gsQ0FBQyxDQUFDNEgsZUFBZSxDQUFDO1VBQzNDLElBQU01RixVQUFVLEdBQUc2RixnQkFBZ0IsQ0FBQzVILElBQUksQ0FBQyxhQUFhLENBQUM7VUFDdkQsSUFBTXVNLFNBQVMsR0FBRzVKLEtBQUksQ0FBQ0QsWUFBWSxDQUFDcUgsaUJBQWlCLENBQUNqSixPQUFPLENBQUNpQixVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7VUFFOUUsSUFBSXdLLFNBQVMsRUFBRTtZQUNYM0UsZ0JBQWdCLENBQUM0RSxNQUFNLENBQUEsQ0FBRTtZQUN6QjtVQ29ESjtVRGpEQSxJQUFJckksUUFBUSxHQUFHeEIsS0FBSSxDQUFDc0QsV0FBVyxDQUFDbEUsVUFBVSxDQUFDO1VBQzNDLElBQU0wSyxjQUFjLEdBQUc5SixLQUFJLENBQUNzRCxXQUFXLENBQUNsRSxVQUFVLEVBQUVxSyxrQkFBa0IsQ0FBQ2xHLFVBQVUsQ0FBQztVQUVsRjtVQUNBLElBQUl5RCxjQUFjLEVBQUU7WUFDaEIsSUFBSXhGLFFBQVEsSUFBSSxJQUFJLEVBQUU7Y0FDbEI7Y0FDQUEsUUFBUSxHQUFHc0ksY0FBYztjQUN6QjlKLEtBQUksQ0FBQ0QsWUFBWSxDQUFDd0QsVUFBVSxDQUFDaUUsSUFBSSxDQUFDaEcsUUFBUSxDQUFDO2NBRTNDQSxRQUFRLENBQUNpQyxDQUFDLEdBQUcsRUFBRTtjQUNmakMsUUFBUSxDQUFDbUcsQ0FBQyxHQUFHLEVBQUU7WUNpRG5CLENEaERDLE1BQ0k7Y0FDRDtjQUNBO2NBQ0EsSUFBTW9DLFlBQVksR0FBR1osZ0JBQWdCLENBQUMzSCxRQUFRLENBQUNpRyxRQUFRLEVBQUVxQyxjQUFjLENBQUNyQyxRQUFRLENBQUM7Y0FFakYsSUFBSSxDQUFDc0MsWUFBWSxFQUFFO2dCQUNmdkksUUFBUSxDQUFDaUcsUUFBUSxHQUFHcUMsY0FBYyxDQUFDckMsUUFBUTtjQ2dEL0M7Y0Q3Q0F4QyxnQkFBZ0IsQ0FDWCtFLEdBQUcsQ0FBQztnQkFBRXRDLElBQUksRUFBRWxHLFFBQVEsQ0FBQ2lDLENBQUM7Z0JBQUUyQixHQUFHLEVBQUU1RCxRQUFRLENBQUNtRztjQUFDLENBQUUsQ0FBQyxDQUMxQ3NDLFdBQVcsQ0FBQyxnQkFBZ0IsRUFBRXpJLFFBQVEsQ0FBQ0UsT0FBTyxDQUFDLENBQy9DckUsSUFBSSxDQUFDLGdCQUFnQixFQUFFbUUsUUFBUSxDQUFDRSxPQUFPLENBQUM7WUMrQ2pEO1VBQ0o7VUQ1Q0E7VUFDQWlDLE9BQU8sQ0FBQ3VHLFNBQVMsQ0FBQ2xGLGVBQWUsRUFBRTtZQUMvQm1GLElBQUksRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUM7WUFDZEMsV0FBVyxFQUFFLElBQUk7WUFDakJDLEtBQUssRUFBRSxTQUFBQSxNQUFDQyxJQUFTLEVBQUE7Y0FDYnRLLEtBQUksQ0FBQ3VLLFNBQVMsR0FBRztnQkFBRTdDLElBQUksRUFBRTRDLElBQUksQ0FBQzdMLENBQUMsQ0FBQytMLE9BQU87Z0JBQUVwRixHQUFHLEVBQUVrRixJQUFJLENBQUM3TCxDQUFDLENBQUNnTTtjQUFPLENBQUU7WUFDbEUsQ0FBQztZQUNEQyxJQUFJLEVBQUUsU0FBQUEsS0FBQ0osSUFBUyxFQUFBO2NBQ1p0SyxLQUFJLENBQUMySyxVQUFVLEdBQUczSyxLQUFJLENBQUN1SyxTQUFTLENBQUM3QyxJQUFJLElBQUk0QyxJQUFJLENBQUM3TCxDQUFDLENBQUMrTCxPQUFPLElBQUl4SyxLQUFJLENBQUN1SyxTQUFTLENBQUNuRixHQUFHLElBQUlrRixJQUFJLENBQUM3TCxDQUFDLENBQUNnTSxPQUFPO2NBQy9GekssS0FBSSxDQUFDMEUsa0JBQWtCLENBQUEsQ0FBRTtZQUM3QjtVQzhDSixDRDdDQyxDQUFDO1VBRUY7VUFDQWYsT0FBTyxDQUFDaUgsVUFBVSxDQUFDNUYsZUFBZSxFQUFFO1lBQ2hDNkYsV0FBVyxFQUFFO2NBQUVDLFVBQVUsRUFBRTtZQUFPLENBQUU7WUFDcEM5SSxNQUFNLEVBQUUsWUFBWTtZQUNwQkQsUUFBUSxFQUFFLENBQUMsT0FBTyxFQUFFO2NBQUVwQixNQUFNLEVBQUU7WUFBQyxDQUFFO1VDNkNyQyxDRDVDQyxDQUFDO1VBRUY7VUFDQSxLQUFvQixJQUFBa0QsRUFBQSxHQUFBLENBQWlCLEVBQWpCQyxFQUFBLEdBQUF0QyxRQUFRLENBQUNpRyxRQUFRLEVBQWpCNUQsRUFBQSxHQUFBQyxFQUFBLENBQUEvRixNQUFpQixFQUFqQjhGLEVBQUEsRUFBaUIsRUFBRTtZQUFsQyxJQUFJaEMsT0FBTyxHQUFBaUMsRUFBQSxDQUFBRCxFQUFBLENBQUE7WUFDWixJQUFNa0gscUJBQXFCLEdBQUcvSyxLQUFJLENBQUM0Qix3QkFBd0IsQ0FBQ0osUUFBUSxFQUFFSyxPQUFPLENBQUM7WUFDOUU4QixPQUFPLENBQUNxSCxXQUFXLENBQUNoRyxlQUFlLEVBQUU7Y0FBRS9CLGlCQUFpQixFQUFFLENBQUMsQ0FBQyxPQUFPLEVBQUU7Z0JBQUU2RixLQUFLLEVBQUVqSCxPQUFPLENBQUNvSCxXQUFXO2dCQUFFNUgsUUFBUSxFQUFFO2NBQWtCLENBQUUsQ0FBQztZQUFDLENBQUUsRUFBRTBKLHFCQUFxQixDQUFDO1VDNkNqSztRRDNDSixDQUFDLENBQUM7UUFFRjtRQUNBL0ssS0FBSSxDQUFDMEQsaUJBQWlCLENBQUNDLE9BQU8sQ0FBQztRQUUvQjtRQUNBdUYsZ0JBQWdCLEdBQUdsSixLQUFJLENBQUNFLG1CQUFtQixDQUFBLENBQUU7UUFFN0M7UUFDQWdKLGdCQUFnQixDQUFDeEwsSUFBSSxDQUFBLENBQUU7UUFFdkJzQyxLQUFJLENBQUMwRSxrQkFBa0IsQ0FBQSxDQUFFO01BQzdCLENBQUMsQ0FBQztNQUVGO01BQ0F3RSxnQkFBZ0IsQ0FBQzlLLElBQUksQ0FBQyxVQUFDdUwsQ0FBQyxFQUFFc0IsSUFBSSxFQUFBO1FBQzFCLElBQUlqRyxlQUFlLEdBQUc1SCxDQUFDLENBQUM2TixJQUFJLENBQUM7UUFDN0JqRyxlQUFlLENBQUNrRyxPQUFPLENBQUM7VUFDcEJDLE9BQU8sRUFBRSxRQUFRO1VBQ2pCQyxJQUFJLEVBQUUsSUFBSTtVQUNWQyxPQUFPLEVBQUUsU0FBQUEsUUFBQSxFQUFBO1lBQ0wsSUFBTUMsUUFBUSxHQUFvQnRHLGVBQWUsQ0FBQ2hILElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDdU4sS0FBSyxDQUFBLENBQUU7WUFDcEYsSUFBTUMsV0FBVyxHQUFHRixRQUFRLENBQUN0TixJQUFJLENBQUMsd0JBQXdCLENBQUM7WUFDM0QsSUFBTTBELE9BQU8sR0FBR3NELGVBQWUsQ0FBQzNILElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLElBQUk7WUFDL0QsSUFBTStCLFVBQVUsR0FBVzRGLGVBQWUsQ0FBQzNILElBQUksQ0FBQyxhQUFhLENBQUM7WUFDOURtTyxXQUFXLENBQUNsTyxJQUFJLENBQUMsY0FBYyxFQUFFMEgsZUFBZSxDQUFDM0gsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7WUFDeEVtTyxXQUFXLENBQUN2QixXQUFXLENBQUMsUUFBUSxFQUFFdkksT0FBTyxDQUFDO1lBRTFDNEosUUFBUSxDQUFDOU0sRUFBRSxDQUFDLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxVQUFBQyxDQUFDLEVBQUE7Y0FDNUNBLENBQUMsQ0FBQ2dOLGNBQWMsQ0FBQSxDQUFFO2NBQ2xCLElBQU01TSxNQUFNLEdBQUd6QixDQUFDLENBQUNxQixDQUFDLENBQUNpTixhQUFhLENBQUM7Y0FFakMsSUFBTWhLLE9BQU8sR0FBRzdDLE1BQU0sQ0FBQzhNLEVBQUUsQ0FBQyxTQUFTLENBQUM7Y0FDcEMzRyxlQUFlLENBQUMzSCxJQUFJLENBQUMsZ0JBQWdCLEVBQUVxRSxPQUFPLENBQUM7Y0FDL0NzRCxlQUFlLENBQUNpRixXQUFXLENBQUMsZ0JBQWdCLEVBQUV2SSxPQUFPLENBQUM7WUFDMUQsQ0FBQyxDQUFDO1lBRUY0SixRQUFRLENBQUM5TSxFQUFFLENBQUMsT0FBTyxFQUFFLHlCQUF5QixFQUFFLFVBQUFDLENBQUMsRUFBQTtjQUM3Q0EsQ0FBQyxDQUFDZ04sY0FBYyxDQUFBLENBQUU7Y0FFbEI7Y0FDQTtjQUNBO2NBQ0E7Y0FFQWpELElBQUksQ0FBQ3pJLFlBQVksQ0FBQ3FILGlCQUFpQixDQUFDSSxJQUFJLENBQUNwSSxVQUFVLENBQUM7Y0FDcER1RSxPQUFPLENBQUNrRyxNQUFNLENBQUM3RSxlQUFlLENBQUM7Y0FDL0JBLGVBQWUsQ0FBQ2tHLE9BQU8sQ0FBQyxTQUFTLENBQUM7WUFDdEMsQ0FBQyxDQUFDO1lBRUZJLFFBQVEsQ0FBQzlNLEVBQUUsQ0FBQyxPQUFPLEVBQUUseUJBQXlCLEVBQUUsVUFBQUMsQ0FBQyxFQUFBO2NBQzdDK0osSUFBSSxDQUFDSCxjQUFjLENBQUEsQ0FBRTtZQUN6QixDQUFDLENBQUM7WUFFRixPQUFPaUQsUUFBUSxDQUFDTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1VBQzFCO1FDaUNKLENEaENDLENBQUM7TUFDTixDQUFDLENBQUM7TUFFRnhPLENBQUMsQ0FBQzBDLFNBQVMsQ0FBQyxDQUFDdEIsRUFBRSxDQUFDLE9BQU8sRUFBRSxXQUFXLEVBQUUsVUFBQUMsQ0FBQyxFQUFBO1FBQ25DLElBQUl1QixLQUFJLENBQUMySyxVQUFVLEVBQUU7VUFDakIzSyxLQUFJLENBQUMySyxVQUFVLEdBQUcsS0FBSztVQUN2QjtRQ2dDSjtRRDdCQTtRQUNBLElBQUkzSyxLQUFJLENBQUM2TCxnQkFBZ0IsRUFBRTtVQUN2QjNDLGdCQUFnQixDQUFDZ0MsT0FBTyxDQUFDLE1BQU0sQ0FBQztRQytCcEM7UUQ1QkEsSUFBTVksTUFBTSxHQUFHMU8sQ0FBQyxDQUFDcUIsQ0FBQyxDQUFDaU4sYUFBYSxDQUFDO1FBQ2pDSSxNQUFNLENBQUNaLE9BQU8sQ0FBQyxNQUFNLENBQUM7UUFFdEI7UUFDQTlOLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQzJPLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQ3ZOLEVBQUUsQ0FBQyxPQUFPLEVBQUUsVUFBQXdOLEVBQUUsRUFBQTtVQUNyQ0EsRUFBRSxDQUFDQyxlQUFlLENBQUEsQ0FBRTtRQUN4QixDQUFDLENBQUM7UUFFRnhOLENBQUMsQ0FBQ3dOLGVBQWUsQ0FBQSxDQUFFO1FBQ25Cak0sS0FBSSxDQUFDNkwsZ0JBQWdCLEdBQUcsSUFBSTtNQUNoQyxDQUFDLENBQUM7TUFFRnpPLENBQUMsQ0FBQzBDLFNBQVMsQ0FBQyxDQUFDdEIsRUFBRSxDQUFDLFVBQVUsRUFBRSxXQUFXLEVBQUUsVUFBQUMsQ0FBQyxFQUFBO1FBQ3RDLElBQU1xTixNQUFNLEdBQUcxTyxDQUFDLENBQUNxQixDQUFDLENBQUNpTixhQUFhLENBQUM7UUFDakMsSUFBTVEsU0FBUyxHQUFHSixNQUFNLENBQUN6TyxJQUFJLENBQUMscUJBQXFCLENBQUM7UUFFcEQsSUFBSTZPLFNBQVMsRUFBRTtVQUNYbE0sS0FBSSxDQUFDcUksY0FBYyxDQUFBLENBQUU7VUFDckJ5RCxNQUFNLENBQUM5TixJQUFJLENBQUMsdUJBQXVCLENBQUMsQ0FBQzROLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQzNNLEtBQUssQ0FBQSxDQUFFO1FDMEJ2RDtNRHhCSixDQUFDLENBQUM7TUFFRjtNQUNBN0IsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDb0IsRUFBRSxDQUFDLE9BQU8sRUFBRSxVQUFBQyxDQUFDLEVBQUE7UUFDbkJ5SyxnQkFBZ0IsQ0FBQ2dDLE9BQU8sQ0FBQyxNQUFNLENBQUM7UUFDaENsTCxLQUFJLENBQUM2TCxnQkFBZ0IsR0FBRyxLQUFLO01BQ2pDLENBQUMsQ0FBQztNQUVGO01BQ0F6TyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUNvQixFQUFFLENBQUMsT0FBTyxFQUFFLHlCQUF5QixFQUFFLFVBQUFDLENBQUMsRUFBQTtRQUM5Q3VCLEtBQUksQ0FBQ3FJLGNBQWMsQ0FBQSxDQUFFO01BQ3pCLENBQUMsQ0FBQztNQUVGckksS0FBSSxDQUFDNkgsZUFBZSxHQUFHbEUsT0FBTztJQUNsQyxDQUFDLENBQUM7SUN1QkYsT0FBTzNELEtBQUs7RUR0QmhCO0VBOERKLE9BQUE0RyxjQUFDO0FBQUQsQ0EvUkEsQ0FBNkIvRyxjQUFjLENBQUE7QUFpUzNDekMsQ0FBQyxDQUFDK08sRUFBRSxDQUFDQyxjQUFjLEdBQUcsWUFBQTtFQUNsQixJQUFJLENBQUNoTyxJQUFJLENBQUMsVUFBQ2lPLEtBQUssRUFBRUMsT0FBTyxFQUFBO0lBQ3JCLElBQUlDLFFBQVEsR0FBR25QLENBQUMsQ0FBQ2tQLE9BQU8sQ0FBQztJQUN6QixJQUFJdk0sWUFBWSxHQUEyQndNLFFBQVEsQ0FBQ2xQLElBQUksQ0FBQyxlQUFlLENBQUM7SUFDekUsSUFBSXlKLG9CQUFvQixHQUFXeUYsUUFBUSxDQUFDbFAsSUFBSSxDQUFDLGlDQUFpQyxDQUFDO0lBQ25GLElBQUkwSixPQUFPLEdBQVd3RixRQUFRLENBQUNsUCxJQUFJLENBQUMsbUJBQW1CLENBQUM7SUFDeEQsSUFBSTJKLGNBQWMsR0FBWXVGLFFBQVEsQ0FBQ2xQLElBQUksQ0FBQywyQkFBMkIsQ0FBQztJQUV4RTBDLFlBQVksQ0FBQ3FILGlCQUFpQixHQUFHckgsWUFBWSxDQUFDcUgsaUJBQWlCLElBQUksRUFBRTtJQUNyRW1GLFFBQVEsQ0FBQ2xQLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxJQUFJdUosY0FBYyxDQUFDMEYsT0FBTyxFQUFFdk0sWUFBWSxFQUFFK0csb0JBQW9CLEVBQUVDLE9BQU8sRUFBRUMsY0FBYyxDQUFDLENBQUM7RUFDN0gsQ0FBQyxDQUFDO0VBRUYsT0FBTyxJQUFJO0FBQ2YsQ0FBQztBQUVENUosQ0FBQyxDQUFDb1AsUUFBUSxDQUFDLENBQUMvRCxLQUFLLENBQUMsWUFBQTtFQUNkLElBQU0yRCxjQUFjLEdBQW1CaFAsQ0FBQyxDQUFDLGtCQUFrQixDQUFDLENBQUNnUCxjQUFjLENBQUEsQ0FBRSxDQUFDL08sSUFBSSxDQUFDLGdCQUFnQixDQUFDO0VBRXBHRCxDQUFDLENBQUMscUJBQXFCLENBQUMsQ0FBQ29CLEVBQUUsQ0FBQyxRQUFRLEVBQUUsVUFBQ2lPLENBQUMsRUFBRWhPLENBQUMsRUFBQTtJQUN2QyxJQUFNaU8sS0FBSyxHQUFHTixjQUFjLENBQUNsRSxTQUFTLENBQUEsQ0FBRTtJQUN4QzlLLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDSSxHQUFHLENBQUNrUCxLQUFLLENBQUM7RUFDdkMsQ0FBQyxDQUFDO0FBQ04sQ0FBQyxDQUFDIiwiZmlsZSI6Im9yY2hhcmQud29ya2Zsb3dzLWVkaXRvci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pxdWVyeS90eXBpbmdzLmQudHMnIC8+XG5cbnZhciBhcHBseUZpbHRlciA9IGZ1bmN0aW9uIChjYXRlZ29yeTogc3RyaW5nLCBxOiBzdHJpbmcpIHtcbiAgICBjb25zdCB0eXBlID0gJCgnLm1vZGFsLWFjdGl2aXRpZXMnKS5kYXRhKCdhY3Rpdml0eS10eXBlJyk7XG4gICAgY2F0ZWdvcnkgPSBjYXRlZ29yeSB8fCAkKCcuYWN0aXZpdHktcGlja2VyLWNhdGVnb3JpZXMgLm5hdi1saW5rLmFjdGl2ZScpLmF0dHIoJ2hyZWYnKS5zdWJzdHIoMSk7XG4gICAgcSA9IHEgfHwgPHN0cmluZz4kKCcubW9kYWwtYWN0aXZpdGllcyBpbnB1dFt0eXBlPXNlYXJjaF0nKS52YWwoKTtcblxuICAgIGNvbnN0ICRjYXJkcyA9ICQoJy5hY3Rpdml0eS5jb2wnKS5zaG93KCk7XG5cbiAgICAvLyBSZW1vdmUgYWN0aXZpdGllcyB3aG9lcyB0eXBlIGRvZXNuJ3QgbWF0Y2ggdGhlIGNvbmZpZ3VyZWQgYWN0aXZpdHkgdHlwZS5cbiAgICAkY2FyZHMuZmlsdGVyKChpLCBlbCkgPT4ge1xuICAgICAgICByZXR1cm4gJChlbCkuZGF0YSgnYWN0aXZpdHktdHlwZScpICE9IHR5cGU7XG4gICAgfSkuaGlkZSgpO1xuXG4gICAgaWYgKHEubGVuZ3RoID4gMCkge1xuICAgICAgICAvLyBSZW1vdmUgYWN0aXZpdGllcyB3aG9zZSB0aXRsZSBkb2Vzbid0IG1hdGNoIHRoZSBxdWVyeS5cbiAgICAgICAgJGNhcmRzLmZpbHRlcigoaSwgZWwpID0+IHtcbiAgICAgICAgICAgIHJldHVybiAkKGVsKS5maW5kKCcuY2FyZC10aXRsZScpLnRleHQoKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YocS50b0xvd2VyQ2FzZSgpKSA8IDAgJiYgcSAmJiBxLmxlbmd0aCA+IDA7XG4gICAgICAgIH0pLmhpZGUoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIFJlbW92ZSBhY3Rpdml0aWVzIHdob3NlIGNhdGVnb3J5IGRvZXNuJ3QgbWF0Y2ggdGhlIHNlbGVjdGVkIG9uZS5cbiAgICAgICAgJGNhcmRzLmZpbHRlcigoaSwgZWwpID0+IHtcbiAgICAgICAgICAgIHJldHVybiAkKGVsKS5kYXRhKCdjYXRlZ29yeScpLnRvTG93ZXJDYXNlKCkgIT0gY2F0ZWdvcnkudG9Mb3dlckNhc2UoKSAmJiBjYXRlZ29yeS50b0xvd2VyQ2FzZSgpICE9ICdhbGwnO1xuICAgICAgICB9KS5oaWRlKCk7XG4gICAgfVxuXG4gICAgLy8gU2hvdyBvciBoaWRlIGNhdGVnb3JpZXMgYmFzZWQgb24gd2hldGhlciB0aGVyZSBhcmUgYW55IGF2YWlsYWJsZSBhY3Rpdml0aWVzLlxuICAgICQoJy5hY3Rpdml0eS1waWNrZXItY2F0ZWdvcmllcyBbZGF0YS1jYXRlZ29yeV0nKS5lYWNoKChpLCBlbCkgPT4ge1xuICAgICAgICBjb25zdCBjYXRlZ29yeUxpc3RJdGVtID0gJChlbCk7XG4gICAgICAgIGNvbnN0IGNhdGVnb3J5ID0gY2F0ZWdvcnlMaXN0SXRlbS5kYXRhKCdjYXRlZ29yeScpO1xuXG4gICAgICAgIC8vIENvdW50IG51bWJlciBvZiBhY3Rpdml0aWVzIHdpdGhpbiB0aGlzIGNhdGVnb3J5IGFuZCBmb3IgdGhlIHNwZWNpZmllZCBhY3Rpdml0eSB0eXBlIChFdmVudCBvciBUYXNrKS5cbiAgICAgICAgY29uc3QgYWN0aXZpdHlDb3VudCA9ICQoYC5hY3Rpdml0eS5jb2xbZGF0YS1jYXRlZ29yeT0nJHtjYXRlZ29yeX0nXVtkYXRhLWFjdGl2aXR5LXR5cGU9JyR7dHlwZX0nXWApLmxlbmd0aDtcbiAgICAgICAgYWN0aXZpdHlDb3VudCA9PSAwID8gY2F0ZWdvcnlMaXN0SXRlbS5oaWRlKCkgOiBjYXRlZ29yeUxpc3RJdGVtLnNob3coKTtcbiAgICB9KTtcbn07XG5cbiQoKCkgPT4ge1xuICAgICQoJy5hY3Rpdml0eS1waWNrZXItY2F0ZWdvcmllcycpLm9uKCdjbGljaycsICcubmF2LWxpbmsnLCBlID0+IHtcbiAgICAgICAgYXBwbHlGaWx0ZXIoJChlLnRhcmdldCkuYXR0cignaHJlZicpLnN1YnN0cigxKSwgbnVsbCk7XG4gICAgfSk7XG5cbiAgICAkKCcubW9kYWwtYWN0aXZpdGllcyBpbnB1dFt0eXBlPXNlYXJjaF0nKS5vbigna2V5dXAnLCBlID0+IHtcbiAgICAgICAgYXBwbHlGaWx0ZXIobnVsbCwgPHN0cmluZz4kKGUudGFyZ2V0KS52YWwoKSk7XG4gICAgfSk7XG5cbiAgICAkKCcjYWN0aXZpdHktcGlja2VyJykub24oJ3Nob3cuYnMubW9kYWwnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdmFyIG1vZGFsRXZlbnQgPSBldmVudCBhcyBhbnk7XG4gICAgICAgIHZhciBidXR0b24gPSAkKG1vZGFsRXZlbnQucmVsYXRlZFRhcmdldCk7IC8vIEJ1dHRvbiB0aGF0IHRyaWdnZXJlZCB0aGUgbW9kYWwuXG4gICAgICAgIHZhciB0aXRsZSA9IGJ1dHRvbi5kYXRhKCdwaWNrZXItdGl0bGUnKTtcbiAgICAgICAgdmFyIHR5cGUgPSBidXR0b24uZGF0YSgnYWN0aXZpdHktdHlwZScpO1xuICAgICAgICB2YXIgbW9kYWwgPSAkKHRoaXMpO1xuICAgICAgICBtb2RhbC5maW5kKCdbaHJlZj1cIiNhbGxcIl0nKS5jbGljaygpO1xuICAgICAgICBtb2RhbC5maW5kKCcubW9kYWwtdGl0bGUnKS50ZXh0KHRpdGxlKTtcbiAgICAgICAgbW9kYWwuZGF0YSgnYWN0aXZpdHktdHlwZScsIHR5cGUpO1xuICAgICAgICBhcHBseUZpbHRlcihudWxsLCBudWxsKTtcbiAgICB9KVxufSk7XG4iLCIvLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qcXVlcnkvdHlwaW5ncy5kLnRzJyAvPlxudmFyIGFwcGx5RmlsdGVyID0gZnVuY3Rpb24gKGNhdGVnb3J5LCBxKSB7XG4gICAgdmFyIHR5cGUgPSAkKCcubW9kYWwtYWN0aXZpdGllcycpLmRhdGEoJ2FjdGl2aXR5LXR5cGUnKTtcbiAgICBjYXRlZ29yeSA9IGNhdGVnb3J5IHx8ICQoJy5hY3Rpdml0eS1waWNrZXItY2F0ZWdvcmllcyAubmF2LWxpbmsuYWN0aXZlJykuYXR0cignaHJlZicpLnN1YnN0cigxKTtcbiAgICBxID0gcSB8fCAkKCcubW9kYWwtYWN0aXZpdGllcyBpbnB1dFt0eXBlPXNlYXJjaF0nKS52YWwoKTtcbiAgICB2YXIgJGNhcmRzID0gJCgnLmFjdGl2aXR5LmNvbCcpLnNob3coKTtcbiAgICAvLyBSZW1vdmUgYWN0aXZpdGllcyB3aG9lcyB0eXBlIGRvZXNuJ3QgbWF0Y2ggdGhlIGNvbmZpZ3VyZWQgYWN0aXZpdHkgdHlwZS5cbiAgICAkY2FyZHMuZmlsdGVyKGZ1bmN0aW9uIChpLCBlbCkge1xuICAgICAgICByZXR1cm4gJChlbCkuZGF0YSgnYWN0aXZpdHktdHlwZScpICE9IHR5cGU7XG4gICAgfSkuaGlkZSgpO1xuICAgIGlmIChxLmxlbmd0aCA+IDApIHtcbiAgICAgICAgLy8gUmVtb3ZlIGFjdGl2aXRpZXMgd2hvc2UgdGl0bGUgZG9lc24ndCBtYXRjaCB0aGUgcXVlcnkuXG4gICAgICAgICRjYXJkcy5maWx0ZXIoZnVuY3Rpb24gKGksIGVsKSB7XG4gICAgICAgICAgICByZXR1cm4gJChlbCkuZmluZCgnLmNhcmQtdGl0bGUnKS50ZXh0KCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKHEudG9Mb3dlckNhc2UoKSkgPCAwICYmIHEgJiYgcS5sZW5ndGggPiAwO1xuICAgICAgICB9KS5oaWRlKCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBSZW1vdmUgYWN0aXZpdGllcyB3aG9zZSBjYXRlZ29yeSBkb2Vzbid0IG1hdGNoIHRoZSBzZWxlY3RlZCBvbmUuXG4gICAgICAgICRjYXJkcy5maWx0ZXIoZnVuY3Rpb24gKGksIGVsKSB7XG4gICAgICAgICAgICByZXR1cm4gJChlbCkuZGF0YSgnY2F0ZWdvcnknKS50b0xvd2VyQ2FzZSgpICE9IGNhdGVnb3J5LnRvTG93ZXJDYXNlKCkgJiYgY2F0ZWdvcnkudG9Mb3dlckNhc2UoKSAhPSAnYWxsJztcbiAgICAgICAgfSkuaGlkZSgpO1xuICAgIH1cbiAgICAvLyBTaG93IG9yIGhpZGUgY2F0ZWdvcmllcyBiYXNlZCBvbiB3aGV0aGVyIHRoZXJlIGFyZSBhbnkgYXZhaWxhYmxlIGFjdGl2aXRpZXMuXG4gICAgJCgnLmFjdGl2aXR5LXBpY2tlci1jYXRlZ29yaWVzIFtkYXRhLWNhdGVnb3J5XScpLmVhY2goZnVuY3Rpb24gKGksIGVsKSB7XG4gICAgICAgIHZhciBjYXRlZ29yeUxpc3RJdGVtID0gJChlbCk7XG4gICAgICAgIHZhciBjYXRlZ29yeSA9IGNhdGVnb3J5TGlzdEl0ZW0uZGF0YSgnY2F0ZWdvcnknKTtcbiAgICAgICAgLy8gQ291bnQgbnVtYmVyIG9mIGFjdGl2aXRpZXMgd2l0aGluIHRoaXMgY2F0ZWdvcnkgYW5kIGZvciB0aGUgc3BlY2lmaWVkIGFjdGl2aXR5IHR5cGUgKEV2ZW50IG9yIFRhc2spLlxuICAgICAgICB2YXIgYWN0aXZpdHlDb3VudCA9ICQoXCIuYWN0aXZpdHkuY29sW2RhdGEtY2F0ZWdvcnk9J1wiLmNvbmNhdChjYXRlZ29yeSwgXCInXVtkYXRhLWFjdGl2aXR5LXR5cGU9J1wiKS5jb25jYXQodHlwZSwgXCInXVwiKSkubGVuZ3RoO1xuICAgICAgICBhY3Rpdml0eUNvdW50ID09IDAgPyBjYXRlZ29yeUxpc3RJdGVtLmhpZGUoKSA6IGNhdGVnb3J5TGlzdEl0ZW0uc2hvdygpO1xuICAgIH0pO1xufTtcbiQoZnVuY3Rpb24gKCkge1xuICAgICQoJy5hY3Rpdml0eS1waWNrZXItY2F0ZWdvcmllcycpLm9uKCdjbGljaycsICcubmF2LWxpbmsnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBhcHBseUZpbHRlcigkKGUudGFyZ2V0KS5hdHRyKCdocmVmJykuc3Vic3RyKDEpLCBudWxsKTtcbiAgICB9KTtcbiAgICAkKCcubW9kYWwtYWN0aXZpdGllcyBpbnB1dFt0eXBlPXNlYXJjaF0nKS5vbigna2V5dXAnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBhcHBseUZpbHRlcihudWxsLCAkKGUudGFyZ2V0KS52YWwoKSk7XG4gICAgfSk7XG4gICAgJCgnI2FjdGl2aXR5LXBpY2tlcicpLm9uKCdzaG93LmJzLm1vZGFsJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHZhciBtb2RhbEV2ZW50ID0gZXZlbnQ7XG4gICAgICAgIHZhciBidXR0b24gPSAkKG1vZGFsRXZlbnQucmVsYXRlZFRhcmdldCk7IC8vIEJ1dHRvbiB0aGF0IHRyaWdnZXJlZCB0aGUgbW9kYWwuXG4gICAgICAgIHZhciB0aXRsZSA9IGJ1dHRvbi5kYXRhKCdwaWNrZXItdGl0bGUnKTtcbiAgICAgICAgdmFyIHR5cGUgPSBidXR0b24uZGF0YSgnYWN0aXZpdHktdHlwZScpO1xuICAgICAgICB2YXIgbW9kYWwgPSAkKHRoaXMpO1xuICAgICAgICBtb2RhbC5maW5kKCdbaHJlZj1cIiNhbGxcIl0nKS5jbGljaygpO1xuICAgICAgICBtb2RhbC5maW5kKCcubW9kYWwtdGl0bGUnKS50ZXh0KHRpdGxlKTtcbiAgICAgICAgbW9kYWwuZGF0YSgnYWN0aXZpdHktdHlwZScsIHR5cGUpO1xuICAgICAgICBhcHBseUZpbHRlcihudWxsLCBudWxsKTtcbiAgICB9KTtcbn0pO1xuIiwiLy8vPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vLi4vQXNzZXRzL0xpYi9qcXVlcnkvdHlwaW5ncy5kLnRzXCIgLz5cblxuJCgoKSA9PiB7XG4gICAgY29uc3QgZ2VuZXJhdGVXb3JrZmxvd1VybCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3Qgd29ya2Zsb3dUeXBlSWQ6IHN0cmluZyA9ICQoJ1tkYXRhLXdvcmtmbG93LXR5cGUtaWRdJykuZGF0YSgnd29ya2Zsb3ctdHlwZS1pZCcpO1xuICAgICAgICBjb25zdCBhY3Rpdml0eUlkOiBzdHJpbmcgPSAkKCdbZGF0YS1hY3Rpdml0eS1pZF0nKS5kYXRhKCdhY3Rpdml0eS1pZCcpO1xuICAgICAgICB2YXIgdG9rZW5MaWZlU3BhbiA9ICQoJyN0b2tlbi1saWZlc3BhbicpLnZhbCgpO1xuICAgICAgICBjb25zdCBnZW5lcmF0ZVVybDogc3RyaW5nID0gJCgnW2RhdGEtZ2VuZXJhdGUtdXJsXScpLmRhdGEoJ2dlbmVyYXRlLXVybCcpICsgYD93b3JrZmxvd1R5cGVJZD0ke3dvcmtmbG93VHlwZUlkfSZhY3Rpdml0eUlkPSR7YWN0aXZpdHlJZH0mdG9rZW5MaWZlU3Bhbj0ke3Rva2VuTGlmZVNwYW59YDtcbiAgICAgICAgY29uc3QgYW50aWZvcmdlcnlIZWFkZXJOYW1lOiBzdHJpbmcgPSAkKCdbZGF0YS1hbnRpZm9yZ2VyeS1oZWFkZXItbmFtZV0nKS5kYXRhKCdhbnRpZm9yZ2VyeS1oZWFkZXItbmFtZScpO1xuICAgICAgICBjb25zdCBhbnRpZm9yZ2VyeVRva2VuOiBzdHJpbmcgPSAkKCdbZGF0YS1hbnRpZm9yZ2VyeS10b2tlbl0nKS5kYXRhKCdhbnRpZm9yZ2VyeS10b2tlbicpO1xuICAgICAgICBjb25zdCBoZWFkZXJzOiBhbnkgPSB7fTtcblxuICAgICAgICBoZWFkZXJzW2FudGlmb3JnZXJ5SGVhZGVyTmFtZV0gPSBhbnRpZm9yZ2VyeVRva2VuO1xuXG4gICAgICAgICQucG9zdCh7XG4gICAgICAgICAgICB1cmw6IGdlbmVyYXRlVXJsLFxuICAgICAgICAgICAgaGVhZGVyczogaGVhZGVyc1xuICAgICAgICB9KS5kb25lKHVybCA9PiB7XG4gICAgICAgICAgICAkKCcjd29ya2Zsb3ctdXJsLXRleHQnKS52YWwodXJsKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICQoJyNnZW5lcmF0ZS11cmwtYnV0dG9uJykub24oJ2NsaWNrJywgZSA9PiB7XG4gICAgICAgIGdlbmVyYXRlV29ya2Zsb3dVcmwoKTtcbiAgICB9KTtcblxuICAgIGlmICgkKCcjd29ya2Zsb3ctdXJsLXRleHQnKS52YWwoKSA9PSAnJykge1xuICAgICAgICBnZW5lcmF0ZVdvcmtmbG93VXJsKCk7XG4gICAgfVxufSk7XG4iLCIvLy88cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi8uLi9Bc3NldHMvTGliL2pxdWVyeS90eXBpbmdzLmQudHNcIiAvPlxuJChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGdlbmVyYXRlV29ya2Zsb3dVcmwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB3b3JrZmxvd1R5cGVJZCA9ICQoJ1tkYXRhLXdvcmtmbG93LXR5cGUtaWRdJykuZGF0YSgnd29ya2Zsb3ctdHlwZS1pZCcpO1xuICAgICAgICB2YXIgYWN0aXZpdHlJZCA9ICQoJ1tkYXRhLWFjdGl2aXR5LWlkXScpLmRhdGEoJ2FjdGl2aXR5LWlkJyk7XG4gICAgICAgIHZhciB0b2tlbkxpZmVTcGFuID0gJCgnI3Rva2VuLWxpZmVzcGFuJykudmFsKCk7XG4gICAgICAgIHZhciBnZW5lcmF0ZVVybCA9ICQoJ1tkYXRhLWdlbmVyYXRlLXVybF0nKS5kYXRhKCdnZW5lcmF0ZS11cmwnKSArIFwiP3dvcmtmbG93VHlwZUlkPVwiLmNvbmNhdCh3b3JrZmxvd1R5cGVJZCwgXCImYWN0aXZpdHlJZD1cIikuY29uY2F0KGFjdGl2aXR5SWQsIFwiJnRva2VuTGlmZVNwYW49XCIpLmNvbmNhdCh0b2tlbkxpZmVTcGFuKTtcbiAgICAgICAgdmFyIGFudGlmb3JnZXJ5SGVhZGVyTmFtZSA9ICQoJ1tkYXRhLWFudGlmb3JnZXJ5LWhlYWRlci1uYW1lXScpLmRhdGEoJ2FudGlmb3JnZXJ5LWhlYWRlci1uYW1lJyk7XG4gICAgICAgIHZhciBhbnRpZm9yZ2VyeVRva2VuID0gJCgnW2RhdGEtYW50aWZvcmdlcnktdG9rZW5dJykuZGF0YSgnYW50aWZvcmdlcnktdG9rZW4nKTtcbiAgICAgICAgdmFyIGhlYWRlcnMgPSB7fTtcbiAgICAgICAgaGVhZGVyc1thbnRpZm9yZ2VyeUhlYWRlck5hbWVdID0gYW50aWZvcmdlcnlUb2tlbjtcbiAgICAgICAgJC5wb3N0KHtcbiAgICAgICAgICAgIHVybDogZ2VuZXJhdGVVcmwsXG4gICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzXG4gICAgICAgIH0pLmRvbmUoZnVuY3Rpb24gKHVybCkge1xuICAgICAgICAgICAgJCgnI3dvcmtmbG93LXVybC10ZXh0JykudmFsKHVybCk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgJCgnI2dlbmVyYXRlLXVybC1idXR0b24nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBnZW5lcmF0ZVdvcmtmbG93VXJsKCk7XG4gICAgfSk7XG4gICAgaWYgKCQoJyN3b3JrZmxvdy11cmwtdGV4dCcpLnZhbCgpID09ICcnKSB7XG4gICAgICAgIGdlbmVyYXRlV29ya2Zsb3dVcmwoKTtcbiAgICB9XG59KTtcbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pxdWVyeS90eXBpbmdzLmQudHMnIC8+XG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qc3BsdW1iL3R5cGluZ3MuZC50cycgLz5cbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi93b3JrZmxvdy1tb2RlbHMudHMnIC8+XG5cbmFic3RyYWN0IGNsYXNzIFdvcmtmbG93Q2FudmFzIHtcbiAgICBwcml2YXRlIG1pbkNhbnZhc0hlaWdodDogbnVtYmVyID0gNDAwO1xuXG4gICAgY29uc3RydWN0b3IocHJvdGVjdGVkIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIHByb3RlY3RlZCB3b3JrZmxvd1R5cGU6IFdvcmtmbG93cy5Xb3JrZmxvd1R5cGUpIHtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgZ2V0QWN0aXZpdHlFbGVtZW50cyA9ICgpOiBKUXVlcnkgPT4ge1xuICAgICAgICByZXR1cm4gJCh0aGlzLmNvbnRhaW5lcikuZmluZCgnLmFjdGl2aXR5Jyk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldERlZmF1bHRzID0gKCkgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgQW5jaG9yOiBcIkNvbnRpbnVvdXNcIixcbiAgICAgICAgICAgIERyYWdPcHRpb25zOiB7IGN1cnNvcjogJ3BvaW50ZXInLCB6SW5kZXg6IDIwMDAgfSxcbiAgICAgICAgICAgIEVuZHBvaW50U3R5bGVzOiBbeyBmaWxsU3R5bGU6ICcjMjI1NTg4JyB9XSxcbiAgICAgICAgICAgIEVuZHBvaW50czogW1tcIkRvdFwiLCB7IHJhZGl1czogNyB9XSwgW1wiQmxhbmtcIl1dLFxuICAgICAgICAgICAgQ29ubmVjdGlvbk92ZXJsYXlzOiBbXG4gICAgICAgICAgICAgICAgW1wiQXJyb3dcIiwgeyB3aWR0aDogMTIsIGxlbmd0aDogMTIsIGxvY2F0aW9uOiAtNSB9XSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBDb25uZWN0b3JaSW5kZXg6IDVcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwcm90ZWN0ZWQgY3JlYXRlSnNQbHVtYkluc3RhbmNlID0gKCkgPT4ge1xuICAgICAgICByZXR1cm4ganNQbHVtYi5nZXRJbnN0YW5jZSh7XG4gICAgICAgICAgICBEcmFnT3B0aW9uczogeyBjdXJzb3I6ICdwb2ludGVyJywgekluZGV4OiAyMDAwIH0sXG4gICAgICAgICAgICBDb25uZWN0aW9uT3ZlcmxheXM6IFtcbiAgICAgICAgICAgICAgICBbJ0Fycm93Jywge1xuICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogMSxcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDExLFxuICAgICAgICAgICAgICAgICAgICBsZW5ndGg6IDExXG4gICAgICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICAgICAgWydMYWJlbCcsIHtcbiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IDAuNSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdsYWJlbCcsXG4gICAgICAgICAgICAgICAgICAgIGNzc0NsYXNzOiAnY29ubmVjdGlvbi1sYWJlbCdcbiAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIENvbnRhaW5lcjogdGhpcy5jb250YWluZXJcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHByb3RlY3RlZCBnZXRFbmRwb2ludENvbG9yID0gKGFjdGl2aXR5OiBXb3JrZmxvd3MuQWN0aXZpdHkpID0+IHtcbiAgICAgICAgcmV0dXJuIGFjdGl2aXR5LmlzQmxvY2tpbmcgfHwgYWN0aXZpdHkuaXNTdGFydCA/ICcjN2FiMDJjJyA6IGFjdGl2aXR5LmlzRXZlbnQgPyAnIzNhOGFjZCcgOiAnIzdhYjAyYyc7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGdldFNvdXJjZUVuZHBvaW50T3B0aW9ucyA9IChhY3Rpdml0eTogV29ya2Zsb3dzLkFjdGl2aXR5LCBvdXRjb21lOiBXb3JrZmxvd3MuT3V0Y29tZSk6IEVuZHBvaW50T3B0aW9ucyA9PiB7XG4gICAgICAgIC8vIFRoZSBkZWZpbml0aW9uIG9mIHNvdXJjZSBlbmRwb2ludHMuXG4gICAgICAgIGNvbnN0IHBhaW50Q29sb3IgPSB0aGlzLmdldEVuZHBvaW50Q29sb3IoYWN0aXZpdHkpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZW5kcG9pbnQ6ICdEb3QnLFxuICAgICAgICAgICAgYW5jaG9yOiAnQ29udGludW91cycsXG4gICAgICAgICAgICBwYWludFN0eWxlOiB7XG4gICAgICAgICAgICAgICAgc3Ryb2tlOiBwYWludENvbG9yLFxuICAgICAgICAgICAgICAgIGZpbGw6IHBhaW50Q29sb3IsXG4gICAgICAgICAgICAgICAgcmFkaXVzOiA3LFxuICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNTb3VyY2U6IHRydWUsXG4gICAgICAgICAgICBjb25uZWN0b3I6IFsnRmxvd2NoYXJ0JywgeyBzdHViOiBbNDAsIDYwXSwgZ2FwOiAwLCBjb3JuZXJSYWRpdXM6IDUsIGFsd2F5c1Jlc3BlY3RTdHViczogdHJ1ZSB9XSxcbiAgICAgICAgICAgIGNvbm5lY3RvclN0eWxlOiB7XG4gICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiAnIzk5OTk5OScsXG4gICAgICAgICAgICAgICAgam9pbnN0eWxlOiAncm91bmQnLFxuICAgICAgICAgICAgICAgIG91dGxpbmVTdHJva2U6ICd3aGl0ZScsXG4gICAgICAgICAgICAgICAgb3V0bGluZVdpZHRoOiAyXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaG92ZXJQYWludFN0eWxlOiB7XG4gICAgICAgICAgICAgICAgZmlsbDogJyMyMTY0NzcnLFxuICAgICAgICAgICAgICAgIHN0cm9rZTogJyMyMTY0NzcnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29ubmVjdG9ySG92ZXJTdHlsZToge1xuICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAzLFxuICAgICAgICAgICAgICAgIHN0cm9rZTogJyMyMTY0NzcnLFxuICAgICAgICAgICAgICAgIG91dGxpbmVXaWR0aDogNSxcbiAgICAgICAgICAgICAgICBvdXRsaW5lU3Ryb2tlOiAnd2hpdGUnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29ubmVjdG9yT3ZlcmxheXM6IFtbJ0xhYmVsJywgeyBsb2NhdGlvbjogWzMsIC0xLjVdLCBjc3NDbGFzczogJ2VuZHBvaW50U291cmNlTGFiZWwnIH1dXSxcbiAgICAgICAgICAgIGRyYWdPcHRpb25zOiB7fSxcbiAgICAgICAgICAgIHV1aWQ6IGAke2FjdGl2aXR5LmlkfS0ke291dGNvbWUubmFtZX1gLFxuICAgICAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgICAgICAgIG91dGNvbWU6IG91dGNvbWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgcHJvdGVjdGVkIGdldEFjdGl2aXR5ID0gZnVuY3Rpb24gKGlkOiBzdHJpbmcsIGFjdGl2aXRpZXM6IEFycmF5PFdvcmtmbG93cy5BY3Rpdml0eT4gPSBudWxsKTogV29ya2Zsb3dzLkFjdGl2aXR5IHtcbiAgICAgICAgaWYgKCFhY3Rpdml0aWVzKSB7XG4gICAgICAgICAgICBhY3Rpdml0aWVzID0gdGhpcy53b3JrZmxvd1R5cGUuYWN0aXZpdGllcztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJC5ncmVwKGFjdGl2aXRpZXMsICh4OiBXb3JrZmxvd3MuQWN0aXZpdHkpID0+IHguaWQgPT09IGlkKVswXTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgdXBkYXRlQ29ubmVjdGlvbnMgPSAocGx1bWJlcjoganNQbHVtYkluc3RhbmNlKSA9PiB7XG4gICAgICAgIHZhciB3b3JrZmxvd0lkOiBudW1iZXIgPSB0aGlzLndvcmtmbG93VHlwZS5pZDtcblxuICAgICAgICAvLyBDb25uZWN0IGFjdGl2aXRpZXMuXG4gICAgICAgIGZvciAobGV0IHRyYW5zaXRpb25Nb2RlbCBvZiB0aGlzLndvcmtmbG93VHlwZS50cmFuc2l0aW9ucykge1xuICAgICAgICAgICAgY29uc3Qgc291cmNlRW5kcG9pbnRVdWlkOiBzdHJpbmcgPSBgJHt0cmFuc2l0aW9uTW9kZWwuc291cmNlQWN0aXZpdHlJZH0tJHt0cmFuc2l0aW9uTW9kZWwuc291cmNlT3V0Y29tZU5hbWV9YDtcbiAgICAgICAgICAgIGNvbnN0IHNvdXJjZUVuZHBvaW50OiBFbmRwb2ludCA9IHBsdW1iZXIuZ2V0RW5kcG9pbnQoc291cmNlRW5kcG9pbnRVdWlkKTtcbiAgICAgICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uRWxlbWVudElkOiBzdHJpbmcgPSBgYWN0aXZpdHktJHt3b3JrZmxvd0lkfS0ke3RyYW5zaXRpb25Nb2RlbC5kZXN0aW5hdGlvbkFjdGl2aXR5SWR9YDtcblxuICAgICAgICAgICAgcGx1bWJlci5jb25uZWN0KHtcbiAgICAgICAgICAgICAgICBzb3VyY2U6IHNvdXJjZUVuZHBvaW50LFxuICAgICAgICAgICAgICAgIHRhcmdldDogZGVzdGluYXRpb25FbGVtZW50SWRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIHVwZGF0ZUNhbnZhc0hlaWdodCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3QgJGNvbnRhaW5lciA9ICQodGhpcy5jb250YWluZXIpO1xuXG4gICAgICAgIC8vIEdldCB0aGUgYWN0aXZpdHkgZWxlbWVudCB3aXRoIHRoZSBoaWdoZXN0IFkgY29vcmRpbmF0ZS5cbiAgICAgICAgY29uc3QgJGFjdGl2aXR5RWxlbWVudHMgPSAkY29udGFpbmVyLmZpbmQoXCIuYWN0aXZpdHlcIik7XG4gICAgICAgIGxldCBjdXJyZW50RWxlbWVudFRvcCA9IDA7XG4gICAgICAgIGxldCBjdXJyZW50QWN0aXZpdHlIZWlnaHQgPSAwO1xuXG4gICAgICAgIGZvciAobGV0IGFjdGl2aXR5RWxlbWVudCBvZiAkYWN0aXZpdHlFbGVtZW50cy50b0FycmF5KCkpIHtcbiAgICAgICAgICAgIGNvbnN0ICRhY3Rpdml0eUVsZW1lbnQgPSAkKGFjdGl2aXR5RWxlbWVudCk7XG4gICAgICAgICAgICBjb25zdCB0b3AgPSAkYWN0aXZpdHlFbGVtZW50LnBvc2l0aW9uKCkudG9wO1xuXG4gICAgICAgICAgICBpZiAodG9wID4gY3VycmVudEVsZW1lbnRUb3ApIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50RWxlbWVudFRvcCA9IHRvcDtcbiAgICAgICAgICAgICAgICBjdXJyZW50QWN0aXZpdHlIZWlnaHQgPSAkYWN0aXZpdHlFbGVtZW50LmhlaWdodCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IG5ld0NhbnZhc0hlaWdodCA9IGN1cnJlbnRFbGVtZW50VG9wICsgY3VycmVudEFjdGl2aXR5SGVpZ2h0O1xuICAgICAgICBjb25zdCBlbGVtZW50Qm90dG9tID0gY3VycmVudEVsZW1lbnRUb3AgKyBjdXJyZW50QWN0aXZpdHlIZWlnaHQ7XG4gICAgICAgIGNvbnN0IHN0cmV0Y2hWYWx1ZSA9IDEwMDtcblxuICAgICAgICBpZiAobmV3Q2FudmFzSGVpZ2h0IC0gZWxlbWVudEJvdHRvbSA8PSBzdHJldGNoVmFsdWUpIHtcbiAgICAgICAgICAgIG5ld0NhbnZhc0hlaWdodCArPSBzdHJldGNoVmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgICAkY29udGFpbmVyLmhlaWdodChNYXRoLm1heCh0aGlzLm1pbkNhbnZhc0hlaWdodCwgbmV3Q2FudmFzSGVpZ2h0KSk7XG4gICAgfTtcbn1cbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pxdWVyeS90eXBpbmdzLmQudHMnIC8+XG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qc3BsdW1iL3R5cGluZ3MuZC50cycgLz5cbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi93b3JrZmxvdy1tb2RlbHMudHMnIC8+XG52YXIgV29ya2Zsb3dDYW52YXMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gV29ya2Zsb3dDYW52YXMoY29udGFpbmVyLCB3b3JrZmxvd1R5cGUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgICAgIHRoaXMud29ya2Zsb3dUeXBlID0gd29ya2Zsb3dUeXBlO1xuICAgICAgICB0aGlzLm1pbkNhbnZhc0hlaWdodCA9IDQwMDtcbiAgICAgICAgdGhpcy5nZXRBY3Rpdml0eUVsZW1lbnRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICQoX3RoaXMuY29udGFpbmVyKS5maW5kKCcuYWN0aXZpdHknKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5nZXREZWZhdWx0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgQW5jaG9yOiBcIkNvbnRpbnVvdXNcIixcbiAgICAgICAgICAgICAgICBEcmFnT3B0aW9uczogeyBjdXJzb3I6ICdwb2ludGVyJywgekluZGV4OiAyMDAwIH0sXG4gICAgICAgICAgICAgICAgRW5kcG9pbnRTdHlsZXM6IFt7IGZpbGxTdHlsZTogJyMyMjU1ODgnIH1dLFxuICAgICAgICAgICAgICAgIEVuZHBvaW50czogW1tcIkRvdFwiLCB7IHJhZGl1czogNyB9XSwgW1wiQmxhbmtcIl1dLFxuICAgICAgICAgICAgICAgIENvbm5lY3Rpb25PdmVybGF5czogW1xuICAgICAgICAgICAgICAgICAgICBbXCJBcnJvd1wiLCB7IHdpZHRoOiAxMiwgbGVuZ3RoOiAxMiwgbG9jYXRpb246IC01IH1dLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgQ29ubmVjdG9yWkluZGV4OiA1XG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNyZWF0ZUpzUGx1bWJJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBqc1BsdW1iLmdldEluc3RhbmNlKHtcbiAgICAgICAgICAgICAgICBEcmFnT3B0aW9uczogeyBjdXJzb3I6ICdwb2ludGVyJywgekluZGV4OiAyMDAwIH0sXG4gICAgICAgICAgICAgICAgQ29ubmVjdGlvbk92ZXJsYXlzOiBbXG4gICAgICAgICAgICAgICAgICAgIFsnQXJyb3cnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoOiAxMVxuICAgICAgICAgICAgICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICAgICAgICAgIFsnTGFiZWwnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IDAuNSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogJ2xhYmVsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3NDbGFzczogJ2Nvbm5lY3Rpb24tbGFiZWwnXG4gICAgICAgICAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgQ29udGFpbmVyOiBfdGhpcy5jb250YWluZXJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmdldEVuZHBvaW50Q29sb3IgPSBmdW5jdGlvbiAoYWN0aXZpdHkpIHtcbiAgICAgICAgICAgIHJldHVybiBhY3Rpdml0eS5pc0Jsb2NraW5nIHx8IGFjdGl2aXR5LmlzU3RhcnQgPyAnIzdhYjAyYycgOiBhY3Rpdml0eS5pc0V2ZW50ID8gJyMzYThhY2QnIDogJyM3YWIwMmMnO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmdldFNvdXJjZUVuZHBvaW50T3B0aW9ucyA9IGZ1bmN0aW9uIChhY3Rpdml0eSwgb3V0Y29tZSkge1xuICAgICAgICAgICAgLy8gVGhlIGRlZmluaXRpb24gb2Ygc291cmNlIGVuZHBvaW50cy5cbiAgICAgICAgICAgIHZhciBwYWludENvbG9yID0gX3RoaXMuZ2V0RW5kcG9pbnRDb2xvcihhY3Rpdml0eSk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGVuZHBvaW50OiAnRG90JyxcbiAgICAgICAgICAgICAgICBhbmNob3I6ICdDb250aW51b3VzJyxcbiAgICAgICAgICAgICAgICBwYWludFN0eWxlOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZTogcGFpbnRDb2xvcixcbiAgICAgICAgICAgICAgICAgICAgZmlsbDogcGFpbnRDb2xvcixcbiAgICAgICAgICAgICAgICAgICAgcmFkaXVzOiA3LFxuICAgICAgICAgICAgICAgICAgICBzdHJva2VXaWR0aDogMVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaXNTb3VyY2U6IHRydWUsXG4gICAgICAgICAgICAgICAgY29ubmVjdG9yOiBbJ0Zsb3djaGFydCcsIHsgc3R1YjogWzQwLCA2MF0sIGdhcDogMCwgY29ybmVyUmFkaXVzOiA1LCBhbHdheXNSZXNwZWN0U3R1YnM6IHRydWUgfV0sXG4gICAgICAgICAgICAgICAgY29ubmVjdG9yU3R5bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZTogJyM5OTk5OTknLFxuICAgICAgICAgICAgICAgICAgICBqb2luc3R5bGU6ICdyb3VuZCcsXG4gICAgICAgICAgICAgICAgICAgIG91dGxpbmVTdHJva2U6ICd3aGl0ZScsXG4gICAgICAgICAgICAgICAgICAgIG91dGxpbmVXaWR0aDogMlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaG92ZXJQYWludFN0eWxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGw6ICcjMjE2NDc3JyxcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlOiAnIzIxNjQ3NydcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbm5lY3RvckhvdmVyU3R5bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDMsXG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZTogJyMyMTY0NzcnLFxuICAgICAgICAgICAgICAgICAgICBvdXRsaW5lV2lkdGg6IDUsXG4gICAgICAgICAgICAgICAgICAgIG91dGxpbmVTdHJva2U6ICd3aGl0ZSdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbm5lY3Rvck92ZXJsYXlzOiBbWydMYWJlbCcsIHsgbG9jYXRpb246IFszLCAtMS41XSwgY3NzQ2xhc3M6ICdlbmRwb2ludFNvdXJjZUxhYmVsJyB9XV0sXG4gICAgICAgICAgICAgICAgZHJhZ09wdGlvbnM6IHt9LFxuICAgICAgICAgICAgICAgIHV1aWQ6IFwiXCIuY29uY2F0KGFjdGl2aXR5LmlkLCBcIi1cIikuY29uY2F0KG91dGNvbWUubmFtZSksXG4gICAgICAgICAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgICAgICAgICAgICBvdXRjb21lOiBvdXRjb21lXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5nZXRBY3Rpdml0eSA9IGZ1bmN0aW9uIChpZCwgYWN0aXZpdGllcykge1xuICAgICAgICAgICAgaWYgKGFjdGl2aXRpZXMgPT09IHZvaWQgMCkgeyBhY3Rpdml0aWVzID0gbnVsbDsgfVxuICAgICAgICAgICAgaWYgKCFhY3Rpdml0aWVzKSB7XG4gICAgICAgICAgICAgICAgYWN0aXZpdGllcyA9IHRoaXMud29ya2Zsb3dUeXBlLmFjdGl2aXRpZXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJC5ncmVwKGFjdGl2aXRpZXMsIGZ1bmN0aW9uICh4KSB7IHJldHVybiB4LmlkID09PSBpZDsgfSlbMF07XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudXBkYXRlQ29ubmVjdGlvbnMgPSBmdW5jdGlvbiAocGx1bWJlcikge1xuICAgICAgICAgICAgdmFyIHdvcmtmbG93SWQgPSBfdGhpcy53b3JrZmxvd1R5cGUuaWQ7XG4gICAgICAgICAgICAvLyBDb25uZWN0IGFjdGl2aXRpZXMuXG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gX3RoaXMud29ya2Zsb3dUeXBlLnRyYW5zaXRpb25zOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgIHZhciB0cmFuc2l0aW9uTW9kZWwgPSBfYVtfaV07XG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZUVuZHBvaW50VXVpZCA9IFwiXCIuY29uY2F0KHRyYW5zaXRpb25Nb2RlbC5zb3VyY2VBY3Rpdml0eUlkLCBcIi1cIikuY29uY2F0KHRyYW5zaXRpb25Nb2RlbC5zb3VyY2VPdXRjb21lTmFtZSk7XG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZUVuZHBvaW50ID0gcGx1bWJlci5nZXRFbmRwb2ludChzb3VyY2VFbmRwb2ludFV1aWQpO1xuICAgICAgICAgICAgICAgIHZhciBkZXN0aW5hdGlvbkVsZW1lbnRJZCA9IFwiYWN0aXZpdHktXCIuY29uY2F0KHdvcmtmbG93SWQsIFwiLVwiKS5jb25jYXQodHJhbnNpdGlvbk1vZGVsLmRlc3RpbmF0aW9uQWN0aXZpdHlJZCk7XG4gICAgICAgICAgICAgICAgcGx1bWJlci5jb25uZWN0KHtcbiAgICAgICAgICAgICAgICAgICAgc291cmNlOiBzb3VyY2VFbmRwb2ludCxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0OiBkZXN0aW5hdGlvbkVsZW1lbnRJZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnVwZGF0ZUNhbnZhc0hlaWdodCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciAkY29udGFpbmVyID0gJCh0aGlzLmNvbnRhaW5lcik7XG4gICAgICAgICAgICAvLyBHZXQgdGhlIGFjdGl2aXR5IGVsZW1lbnQgd2l0aCB0aGUgaGlnaGVzdCBZIGNvb3JkaW5hdGUuXG4gICAgICAgICAgICB2YXIgJGFjdGl2aXR5RWxlbWVudHMgPSAkY29udGFpbmVyLmZpbmQoXCIuYWN0aXZpdHlcIik7XG4gICAgICAgICAgICB2YXIgY3VycmVudEVsZW1lbnRUb3AgPSAwO1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRBY3Rpdml0eUhlaWdodCA9IDA7XG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gJGFjdGl2aXR5RWxlbWVudHMudG9BcnJheSgpOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgIHZhciBhY3Rpdml0eUVsZW1lbnQgPSBfYVtfaV07XG4gICAgICAgICAgICAgICAgdmFyICRhY3Rpdml0eUVsZW1lbnQgPSAkKGFjdGl2aXR5RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgdmFyIHRvcF8xID0gJGFjdGl2aXR5RWxlbWVudC5wb3NpdGlvbigpLnRvcDtcbiAgICAgICAgICAgICAgICBpZiAodG9wXzEgPiBjdXJyZW50RWxlbWVudFRvcCkge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50RWxlbWVudFRvcCA9IHRvcF8xO1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50QWN0aXZpdHlIZWlnaHQgPSAkYWN0aXZpdHlFbGVtZW50LmhlaWdodCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBuZXdDYW52YXNIZWlnaHQgPSBjdXJyZW50RWxlbWVudFRvcCArIGN1cnJlbnRBY3Rpdml0eUhlaWdodDtcbiAgICAgICAgICAgIHZhciBlbGVtZW50Qm90dG9tID0gY3VycmVudEVsZW1lbnRUb3AgKyBjdXJyZW50QWN0aXZpdHlIZWlnaHQ7XG4gICAgICAgICAgICB2YXIgc3RyZXRjaFZhbHVlID0gMTAwO1xuICAgICAgICAgICAgaWYgKG5ld0NhbnZhc0hlaWdodCAtIGVsZW1lbnRCb3R0b20gPD0gc3RyZXRjaFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgbmV3Q2FudmFzSGVpZ2h0ICs9IHN0cmV0Y2hWYWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRjb250YWluZXIuaGVpZ2h0KE1hdGgubWF4KHRoaXMubWluQ2FudmFzSGVpZ2h0LCBuZXdDYW52YXNIZWlnaHQpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIFdvcmtmbG93Q2FudmFzO1xufSgpKTtcbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pxdWVyeS90eXBpbmdzLmQudHMnIC8+XG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qc3BsdW1iL3R5cGluZ3MuZC50cycgLz5cbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi93b3JrZmxvdy1tb2RlbHMudHMnIC8+XG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4vd29ya2Zsb3ctY2FudmFzLnRzJyAvPlxuXG4vLyBUT0RPOiBSZS1pbXBsZW1lbnQgdGhpcyB1c2luZyBhIE1WVk0gYXBwcm9hY2guXG5jbGFzcyBXb3JrZmxvd0VkaXRvciBleHRlbmRzIFdvcmtmbG93Q2FudmFzIHtcbiAgICBwcml2YXRlIGpzUGx1bWJJbnN0YW5jZToganNQbHVtYkluc3RhbmNlO1xuICAgIHByaXZhdGUgaXNQb3BvdmVyVmlzaWJsZTogYm9vbGVhbjtcbiAgICBwcml2YXRlIGhhc0RyYWdnZWQ6IGJvb2xlYW47XG4gICAgcHJpdmF0ZSBkcmFnU3RhcnQ6IEpRdWVyeS5Db29yZGluYXRlcztcblxuICAgIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBjb250YWluZXI6IEhUTUxFbGVtZW50LCBwcm90ZWN0ZWQgd29ya2Zsb3dUeXBlOiBXb3JrZmxvd3MuV29ya2Zsb3dUeXBlLCBwcml2YXRlIGRlbGV0ZUFjdGl2aXR5UHJvbXB0OiBzdHJpbmcsIHByaXZhdGUgbG9jYWxJZDogc3RyaW5nLCBsb2FkTG9jYWxTdGF0ZTogYm9vbGVhbikge1xuICAgICAgICBzdXBlcihjb250YWluZXIsIHdvcmtmbG93VHlwZSk7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIGpzUGx1bWIucmVhZHkoKCkgPT4ge1xuICAgICAgICAgICAganNQbHVtYi5pbXBvcnREZWZhdWx0cyh0aGlzLmdldERlZmF1bHRzKCkpO1xuXG4gICAgICAgICAgICBjb25zdCBwbHVtYmVyID0gdGhpcy5jcmVhdGVKc1BsdW1iSW5zdGFuY2UoKTtcblxuICAgICAgICAgICAgLy8gTGlzdGVuIGZvciBuZXcgY29ubmVjdGlvbnMuXG4gICAgICAgICAgICBwbHVtYmVyLmJpbmQoJ2Nvbm5lY3Rpb24nLCBmdW5jdGlvbiAoY29ubkluZm8sIG9yaWdpbmFsRXZlbnQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb25uZWN0aW9uOiBDb25uZWN0aW9uID0gY29ubkluZm8uY29ubmVjdGlvbjtcbiAgICAgICAgICAgICAgICBjb25zdCBvdXRjb21lOiBXb3JrZmxvd3MuT3V0Y29tZSA9IGNvbm5lY3Rpb24uZ2V0UGFyYW1ldGVycygpLm91dGNvbWU7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBsYWJlbDogYW55ID0gY29ubmVjdGlvbi5nZXRPdmVybGF5KCdsYWJlbCcpO1xuICAgICAgICAgICAgICAgIGxhYmVsLnNldExhYmVsKG91dGNvbWUuZGlzcGxheU5hbWUpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGxldCBhY3Rpdml0eUVsZW1lbnRzID0gdGhpcy5nZXRBY3Rpdml0eUVsZW1lbnRzKCk7XG5cbiAgICAgICAgICAgIHZhciBhcmVFcXVhbE91dGNvbWVzID0gZnVuY3Rpb24gKG91dGNvbWVzMTogV29ya2Zsb3dzLk91dGNvbWVbXSwgb3V0Y29tZXMyOiBXb3JrZmxvd3MuT3V0Y29tZVtdKTogYm9vbGVhbiB7XG4gICAgICAgICAgICAgICAgaWYgKG91dGNvbWVzMS5sZW5ndGggIT0gb3V0Y29tZXMyLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvdXRjb21lczEubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3V0Y29tZTEgPSBvdXRjb21lczFbaV07XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG91dGNvbWUyID0gb3V0Y29tZXMyW2ldO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChvdXRjb21lMS5uYW1lICE9IG91dGNvbWUyLmRpc3BsYXlOYW1lIHx8IG91dGNvbWUxLmRpc3BsYXlOYW1lICE9IG91dGNvbWUyLmRpc3BsYXlOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gU3VzcGVuZCBkcmF3aW5nIGFuZCBpbml0aWFsaXplLlxuICAgICAgICAgICAgcGx1bWJlci5iYXRjaCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIHNlcnZlcndvcmtmbG93VHlwZTogV29ya2Zsb3dzLldvcmtmbG93VHlwZSA9IHRoaXMud29ya2Zsb3dUeXBlO1xuICAgICAgICAgICAgICAgIHZhciB3b3JrZmxvd0lkOiBudW1iZXIgPSB0aGlzLndvcmtmbG93VHlwZS5pZDtcblxuICAgICAgICAgICAgICAgIGlmIChsb2FkTG9jYWxTdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBsb2NhbFN0YXRlOiBXb3JrZmxvd3MuV29ya2Zsb3dUeXBlID0gdGhpcy5sb2FkTG9jYWxTdGF0ZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChsb2NhbFN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLndvcmtmbG93VHlwZSA9IGxvY2FsU3RhdGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzLmVhY2goKF8sIGFjdGl2aXR5RWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCAkYWN0aXZpdHlFbGVtZW50ID0gJChhY3Rpdml0eUVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3Rpdml0eUlkID0gJGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS1pZCcpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0RlbGV0ZWQgPSB0aGlzLndvcmtmbG93VHlwZS5yZW1vdmVkQWN0aXZpdGllcy5pbmRleE9mKGFjdGl2aXR5SWQpID4gLTE7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzRGVsZXRlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGl2aXR5RWxlbWVudC5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGxldCBhY3Rpdml0eSA9IHRoaXMuZ2V0QWN0aXZpdHkoYWN0aXZpdHlJZCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlcnZlckFjdGl2aXR5ID0gdGhpcy5nZXRBY3Rpdml0eShhY3Rpdml0eUlkLCBzZXJ2ZXJ3b3JrZmxvd1R5cGUuYWN0aXZpdGllcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBhY3Rpdml0eSdzIHZpc3VhbCBzdGF0ZS5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWRMb2NhbFN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aXZpdHkgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgYSBuZXdseSBhZGRlZCBhY3Rpdml0eSBub3QgeWV0IGFkZGVkIHRvIGxvY2FsIHN0YXRlLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5ID0gc2VydmVyQWN0aXZpdHk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy53b3JrZmxvd1R5cGUuYWN0aXZpdGllcy5wdXNoKGFjdGl2aXR5KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5LnggPSA1MDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eS55ID0gNTA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgYXZhaWxhYmxlIG91dGNvbWVzIG1pZ2h0IGhhdmUgY2hhbmdlZCB3aGVuIGVkaXRpbmcgYW4gYWN0aXZpdHksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc28gd2UgbmVlZCB0byBjaGVjayBmb3IgdGhhdCBhbmQgdXBkYXRlIHRoZSBjbGllbnQncyBhY3Rpdml0eSBvdXRjb21lcyBpZiBzby5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzYW1lT3V0Y29tZXMgPSBhcmVFcXVhbE91dGNvbWVzKGFjdGl2aXR5Lm91dGNvbWVzLCBzZXJ2ZXJBY3Rpdml0eS5vdXRjb21lcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXNhbWVPdXRjb21lcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eS5vdXRjb21lcyA9IHNlcnZlckFjdGl2aXR5Lm91dGNvbWVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpdml0eUVsZW1lbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNzcyh7IGxlZnQ6IGFjdGl2aXR5LngsIHRvcDogYWN0aXZpdHkueSB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudG9nZ2xlQ2xhc3MoJ2FjdGl2aXR5LXN0YXJ0JywgYWN0aXZpdHkuaXNTdGFydClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRhdGEoJ2FjdGl2aXR5LXN0YXJ0JywgYWN0aXZpdHkuaXNTdGFydCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBNYWtlIHRoZSBhY3Rpdml0eSBkcmFnZ2FibGUuXG4gICAgICAgICAgICAgICAgICAgIHBsdW1iZXIuZHJhZ2dhYmxlKGFjdGl2aXR5RWxlbWVudCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZDogWzEwLCAxMF0sXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250YWlubWVudDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiAoYXJnczogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmFnU3RhcnQgPSB7IGxlZnQ6IGFyZ3MuZS5zY3JlZW5YLCB0b3A6IGFyZ3MuZS5zY3JlZW5ZIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RvcDogKGFyZ3M6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzRHJhZ2dlZCA9IHRoaXMuZHJhZ1N0YXJ0LmxlZnQgIT0gYXJncy5lLnNjcmVlblggfHwgdGhpcy5kcmFnU3RhcnQudG9wICE9IGFyZ3MuZS5zY3JlZW5ZO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQ2FudmFzSGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIENvbmZpZ3VyZSB0aGUgYWN0aXZpdHkgYXMgYSB0YXJnZXQuXG4gICAgICAgICAgICAgICAgICAgIHBsdW1iZXIubWFrZVRhcmdldChhY3Rpdml0eUVsZW1lbnQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BPcHRpb25zOiB7IGhvdmVyQ2xhc3M6ICdob3ZlcicgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvcjogJ0NvbnRpbnVvdXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6IFsnQmxhbmsnLCB7IHJhZGl1czogOCB9XVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBBZGQgc291cmNlIGVuZHBvaW50cy5cbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgb3V0Y29tZSBvZiBhY3Rpdml0eS5vdXRjb21lcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc291cmNlRW5kcG9pbnRPcHRpb25zID0gdGhpcy5nZXRTb3VyY2VFbmRwb2ludE9wdGlvbnMoYWN0aXZpdHksIG91dGNvbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGx1bWJlci5hZGRFbmRwb2ludChhY3Rpdml0eUVsZW1lbnQsIHsgY29ubmVjdG9yT3ZlcmxheXM6IFtbJ0xhYmVsJywgeyBsYWJlbDogb3V0Y29tZS5kaXNwbGF5TmFtZSwgY3NzQ2xhc3M6ICdjb25uZWN0aW9uLWxhYmVsJyB9XV0gfSwgc291cmNlRW5kcG9pbnRPcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gQ29ubmVjdCBhY3Rpdml0aWVzLlxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQ29ubmVjdGlvbnMocGx1bWJlcik7XG5cbiAgICAgICAgICAgICAgICAvLyBSZS1xdWVyeSB0aGUgYWN0aXZpdHkgZWxlbWVudHMuXG4gICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cyA9IHRoaXMuZ2V0QWN0aXZpdHlFbGVtZW50cygpO1xuXG4gICAgICAgICAgICAgICAgLy8gTWFrZSBhbGwgYWN0aXZpdHkgZWxlbWVudHMgdmlzaWJsZS5cbiAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzLnNob3coKTtcblxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQ2FudmFzSGVpZ2h0KCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBwb3BvdmVycy5cbiAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudHMuZWFjaCgoXywgaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBhY3Rpdml0eUVsZW1lbnQgPSAkKGl0ZW0pO1xuICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudC5wb3BvdmVyKHtcbiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogJ21hbnVhbCcsXG4gICAgICAgICAgICAgICAgICAgIGh0bWw6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0ICRjb250ZW50OiBKUXVlcnk8RWxlbWVudD4gPSBhY3Rpdml0eUVsZW1lbnQuZmluZCgnLmFjdGl2aXR5LWNvbW1hbmRzJykuY2xvbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0QnV0dG9uID0gJGNvbnRlbnQuZmluZCgnLmFjdGl2aXR5LXN0YXJ0LWFjdGlvbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNTdGFydCA9IGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS1zdGFydCcpID09PSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYWN0aXZpdHlJZDogbnVtYmVyID0gYWN0aXZpdHlFbGVtZW50LmRhdGEoJ2FjdGl2aXR5LWlkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydEJ1dHRvbi5hdHRyKCdhcmlhLXByZXNzZWQnLCBhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktc3RhcnQnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydEJ1dHRvbi50b2dnbGVDbGFzcygnYWN0aXZlJywgaXNTdGFydCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICRjb250ZW50Lm9uKCdjbGljaycsICcuYWN0aXZpdHktc3RhcnQtYWN0aW9uJywgZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ1dHRvbiA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzU3RhcnQgPSBidXR0b24uaXMoJy5hY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktc3RhcnQnLCBpc1N0YXJ0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnQudG9nZ2xlQ2xhc3MoJ2FjdGl2aXR5LXN0YXJ0JywgaXNTdGFydCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgJGNvbnRlbnQub24oJ2NsaWNrJywgJy5hY3Rpdml0eS1kZWxldGUtYWN0aW9uJywgZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogVGhlIHByb21wdHMgYXJlIHJlYWxseSBhbm5veWluZy4gQ29uc2lkZXIgc2hvd2luZyBzb21lIHNvcnQgb2Ygc21hbGwgbWVzc2FnZSBiYWxsb29uIHNvbWV3aGVyZSB0byB1bmRvIHRoZSBhY3Rpb24gaW5zdGVhZC5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2lmICghY29uZmlybShzZWxmLmRlbGV0ZUFjdGl2aXR5UHJvbXB0KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL31cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYud29ya2Zsb3dUeXBlLnJlbW92ZWRBY3Rpdml0aWVzLnB1c2goYWN0aXZpdHlJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGx1bWJlci5yZW1vdmUoYWN0aXZpdHlFbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnQucG9wb3ZlcignZGlzcG9zZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICRjb250ZW50Lm9uKCdjbGljaycsICdbZGF0YS1wZXJzaXN0LXdvcmtmbG93XScsIGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2F2ZUxvY2FsU3RhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGNvbnRlbnQuZ2V0KDApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgXG4gICAgICAgICAgICAkKGNvbnRhaW5lcikub24oJ2NsaWNrJywgJy5hY3Rpdml0eScsIGUgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc0RyYWdnZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYXNEcmFnZ2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBpZiBhbnkgb3RoZXIgcG9wb3ZlcnMgYXJlIHZpc2libGUsIGhpZGUgdGhlbVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzUG9wb3ZlclZpc2libGUpIHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cy5wb3BvdmVyKCdoaWRlJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3Qgc2VuZGVyID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgICAgICAgICAgICAgIHNlbmRlci5wb3BvdmVyKCdzaG93Jyk7XG5cbiAgICAgICAgICAgICAgICAvLyBoYW5kbGUgY2xpY2tpbmcgb24gdGhlIHBvcG92ZXIgaXRzZWxmLlxuICAgICAgICAgICAgICAgICQoJy5wb3BvdmVyJykub2ZmKCdjbGljaycpLm9uKCdjbGljaycsIGUyID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZTIuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5pc1BvcG92ZXJWaXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkKGNvbnRhaW5lcikub24oJ2RibGNsaWNrJywgJy5hY3Rpdml0eScsIGUgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICAgICAgICAgICAgICBjb25zdCBoYXNFZGl0b3IgPSBzZW5kZXIuZGF0YSgnYWN0aXZpdHktaGFzLWVkaXRvcicpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGhhc0VkaXRvcikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmVMb2NhbFN0YXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIHNlbmRlci5maW5kKCcuYWN0aXZpdHktZWRpdC1hY3Rpb24nKS5nZXQoMCkuY2xpY2soKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gSGlkZSBhbGwgcG9wb3ZlcnMgd2hlbiBjbGlja2luZyBhbnl3aGVyZSBidXQgb24gYW4gYWN0aXZpdHkuXG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgZSA9PiB7XG4gICAgICAgICAgICAgICAgYWN0aXZpdHlFbGVtZW50cy5wb3BvdmVyKCdoaWRlJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5pc1BvcG92ZXJWaXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gU2F2ZSBsb2NhbCBjaGFuZ2VzIGlmIHRoZSBldmVudCB0YXJnZXQgaGFzIHRoZSAnZGF0YS1wZXJzaXN0LXdvcmtmbG93JyBhdHRyaWJ1dGUuXG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgJ1tkYXRhLXBlcnNpc3Qtd29ya2Zsb3ddJywgZSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zYXZlTG9jYWxTdGF0ZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuanNQbHVtYkluc3RhbmNlID0gcGx1bWJlcjtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRTdGF0ZSA9ICgpOiBXb3JrZmxvd3MuV29ya2Zsb3dUeXBlID0+IHtcbiAgICAgICAgY29uc3QgJGFsbEFjdGl2aXR5RWxlbWVudHMgPSAkKHRoaXMuY29udGFpbmVyKS5maW5kKCcuYWN0aXZpdHknKTtcbiAgICAgICAgY29uc3Qgd29ya2Zsb3c6IFdvcmtmbG93cy5Xb3JrZmxvd1R5cGUgPSB7XG4gICAgICAgICAgICBpZDogdGhpcy53b3JrZmxvd1R5cGUuaWQsXG4gICAgICAgICAgICBhY3Rpdml0aWVzOiBbXSxcbiAgICAgICAgICAgIHRyYW5zaXRpb25zOiBbXSxcbiAgICAgICAgICAgIHJlbW92ZWRBY3Rpdml0aWVzOiB0aGlzLndvcmtmbG93VHlwZS5yZW1vdmVkQWN0aXZpdGllc1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIENvbGxlY3QgYWN0aXZpdGllcy5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAkYWxsQWN0aXZpdHlFbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgJGFjdGl2aXR5RWxlbWVudDogSlF1ZXJ5ID0gJCgkYWxsQWN0aXZpdHlFbGVtZW50c1tpXSk7XG4gICAgICAgICAgICBjb25zdCBhY3Rpdml0eUlkOiBzdHJpbmcgPSAkYWN0aXZpdHlFbGVtZW50LmRhdGEoJ2FjdGl2aXR5LWlkJyk7XG4gICAgICAgICAgICBjb25zdCBhY3Rpdml0eUlzU3RhcnQ6IGJvb2xlYW4gPSAkYWN0aXZpdHlFbGVtZW50LmRhdGEoJ2FjdGl2aXR5LXN0YXJ0Jyk7XG4gICAgICAgICAgICBjb25zdCBhY3Rpdml0eUlzRXZlbnQ6IGJvb2xlYW4gPSAkYWN0aXZpdHlFbGVtZW50LmRhdGEoJ2FjdGl2aXR5LXR5cGUnKSA9PT0gJ0V2ZW50JztcbiAgICAgICAgICAgIGNvbnN0IGFjdGl2aXR5UG9zaXRpb246IEpRdWVyeS5Db29yZGluYXRlcyA9ICRhY3Rpdml0eUVsZW1lbnQucG9zaXRpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGFjdGl2aXR5OiBXb3JrZmxvd3MuQWN0aXZpdHkgPSB0aGlzLmdldEFjdGl2aXR5KGFjdGl2aXR5SWQpO1xuXG4gICAgICAgICAgICB3b3JrZmxvdy5hY3Rpdml0aWVzLnB1c2goe1xuICAgICAgICAgICAgICAgIGlkOiBhY3Rpdml0eUlkLFxuICAgICAgICAgICAgICAgIGlzU3RhcnQ6IGFjdGl2aXR5SXNTdGFydCxcbiAgICAgICAgICAgICAgICBpc0V2ZW50OiBhY3Rpdml0eUlzRXZlbnQsXG4gICAgICAgICAgICAgICAgb3V0Y29tZXM6IGFjdGl2aXR5Lm91dGNvbWVzLFxuICAgICAgICAgICAgICAgIHg6IGFjdGl2aXR5UG9zaXRpb24ubGVmdCxcbiAgICAgICAgICAgICAgICB5OiBhY3Rpdml0eVBvc2l0aW9uLnRvcFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDb2xsZWN0IGNvbm5lY3Rpb25zLlxuICAgICAgICBjb25zdCBhbGxDb25uZWN0aW9ucyA9IHRoaXMuanNQbHVtYkluc3RhbmNlLmdldENvbm5lY3Rpb25zKCk7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhbGxDb25uZWN0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGNvbm5lY3Rpb24gPSBhbGxDb25uZWN0aW9uc1tpXTtcbiAgICAgICAgICAgIHZhciBzb3VyY2VFbmRwb2ludDogRW5kcG9pbnQgPSBjb25uZWN0aW9uLmVuZHBvaW50c1swXTtcbiAgICAgICAgICAgIHZhciBzb3VyY2VPdXRjb21lTmFtZSA9IHNvdXJjZUVuZHBvaW50LmdldFBhcmFtZXRlcnMoKS5vdXRjb21lLm5hbWU7XG4gICAgICAgICAgICB2YXIgc291cmNlQWN0aXZpdHlJZDogc3RyaW5nID0gJChjb25uZWN0aW9uLnNvdXJjZSkuZGF0YSgnYWN0aXZpdHktaWQnKTtcbiAgICAgICAgICAgIHZhciBkZXN0aW5hdGlvbkFjdGl2aXR5SWQ6IHN0cmluZyA9ICQoY29ubmVjdGlvbi50YXJnZXQpLmRhdGEoJ2FjdGl2aXR5LWlkJyk7XG5cbiAgICAgICAgICAgIHdvcmtmbG93LnRyYW5zaXRpb25zLnB1c2goe1xuICAgICAgICAgICAgICAgIHNvdXJjZUFjdGl2aXR5SWQ6IHNvdXJjZUFjdGl2aXR5SWQsXG4gICAgICAgICAgICAgICAgZGVzdGluYXRpb25BY3Rpdml0eUlkOiBkZXN0aW5hdGlvbkFjdGl2aXR5SWQsXG4gICAgICAgICAgICAgICAgc291cmNlT3V0Y29tZU5hbWU6IHNvdXJjZU91dGNvbWVOYW1lXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB3b3JrZmxvdztcbiAgICB9XG5cbiAgICBwdWJsaWMgc2VyaWFsaXplID0gKCk6IHN0cmluZyA9PiB7XG4gICAgICAgIGNvbnN0IHdvcmtmbG93OiBXb3JrZmxvd3MuV29ya2Zsb3dUeXBlID0gdGhpcy5nZXRTdGF0ZSgpO1xuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkod29ya2Zsb3cpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2F2ZUxvY2FsU3RhdGUgPSAoKTogdm9pZCA9PiB7XG4gICAgICAgIHNlc3Npb25TdG9yYWdlW3RoaXMubG9jYWxJZF0gPSB0aGlzLnNlcmlhbGl6ZSgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgbG9hZExvY2FsU3RhdGUgPSAoKTogV29ya2Zsb3dzLldvcmtmbG93VHlwZSA9PiB7XG4gICAgICAgIHJldHVybiBKU09OLnBhcnNlKHNlc3Npb25TdG9yYWdlW3RoaXMubG9jYWxJZF0pO1xuICAgIH1cbn1cblxuJC5mbi53b3JrZmxvd0VkaXRvciA9IGZ1bmN0aW9uICh0aGlzOiBKUXVlcnkpOiBKUXVlcnkge1xuICAgIHRoaXMuZWFjaCgoaW5kZXgsIGVsZW1lbnQpID0+IHtcbiAgICAgICAgdmFyICRlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICAgICAgdmFyIHdvcmtmbG93VHlwZTogV29ya2Zsb3dzLldvcmtmbG93VHlwZSA9ICRlbGVtZW50LmRhdGEoJ3dvcmtmbG93LXR5cGUnKTtcbiAgICAgICAgdmFyIGRlbGV0ZUFjdGl2aXR5UHJvbXB0OiBzdHJpbmcgPSAkZWxlbWVudC5kYXRhKCd3b3JrZmxvdy1kZWxldGUtYWN0aXZpdHktcHJvbXB0Jyk7XG4gICAgICAgIHZhciBsb2NhbElkOiBzdHJpbmcgPSAkZWxlbWVudC5kYXRhKCd3b3JrZmxvdy1sb2NhbC1pZCcpO1xuICAgICAgICB2YXIgbG9hZExvY2FsU3RhdGU6IGJvb2xlYW4gPSAkZWxlbWVudC5kYXRhKCd3b3JrZmxvdy1sb2FkLWxvY2FsLXN0YXRlJyk7XG5cbiAgICAgICAgd29ya2Zsb3dUeXBlLnJlbW92ZWRBY3Rpdml0aWVzID0gd29ya2Zsb3dUeXBlLnJlbW92ZWRBY3Rpdml0aWVzIHx8IFtdO1xuICAgICAgICAkZWxlbWVudC5kYXRhKCd3b3JrZmxvd0VkaXRvcicsIG5ldyBXb3JrZmxvd0VkaXRvcihlbGVtZW50LCB3b3JrZmxvd1R5cGUsIGRlbGV0ZUFjdGl2aXR5UHJvbXB0LCBsb2NhbElkLCBsb2FkTG9jYWxTdGF0ZSkpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXM7XG59O1xuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgY29uc3Qgd29ya2Zsb3dFZGl0b3I6IFdvcmtmbG93RWRpdG9yID0gJCgnLndvcmtmbG93LWNhbnZhcycpLndvcmtmbG93RWRpdG9yKCkuZGF0YSgnd29ya2Zsb3dFZGl0b3InKTtcblxuICAgICQoJyN3b3JrZmxvd0VkaXRvckZvcm0nKS5vbignc3VibWl0JywgKHMsIGUpID0+IHtcbiAgICAgICAgY29uc3Qgc3RhdGUgPSB3b3JrZmxvd0VkaXRvci5zZXJpYWxpemUoKTtcbiAgICAgICAgJCgnI3dvcmtmbG93U3RhdGVJbnB1dCcpLnZhbChzdGF0ZSk7XG4gICAgfSk7XG59KTtcbiIsIi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vTGliL2pxdWVyeS90eXBpbmdzLmQudHMnIC8+XG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4uL0xpYi9qc3BsdW1iL3R5cGluZ3MuZC50cycgLz5cbi8vLzxyZWZlcmVuY2UgcGF0aD0nLi93b3JrZmxvdy1tb2RlbHMudHMnIC8+XG4vLy88cmVmZXJlbmNlIHBhdGg9Jy4vd29ya2Zsb3ctY2FudmFzLnRzJyAvPlxudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDbGFzcyBleHRlbmRzIHZhbHVlIFwiICsgU3RyaW5nKGIpICsgXCIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbFwiKTtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbi8vIFRPRE86IFJlLWltcGxlbWVudCB0aGlzIHVzaW5nIGEgTVZWTSBhcHByb2FjaC5cbnZhciBXb3JrZmxvd0VkaXRvciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoV29ya2Zsb3dFZGl0b3IsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gV29ya2Zsb3dFZGl0b3IoY29udGFpbmVyLCB3b3JrZmxvd1R5cGUsIGRlbGV0ZUFjdGl2aXR5UHJvbXB0LCBsb2NhbElkLCBsb2FkTG9jYWxTdGF0ZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBjb250YWluZXIsIHdvcmtmbG93VHlwZSkgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xuICAgICAgICBfdGhpcy53b3JrZmxvd1R5cGUgPSB3b3JrZmxvd1R5cGU7XG4gICAgICAgIF90aGlzLmRlbGV0ZUFjdGl2aXR5UHJvbXB0ID0gZGVsZXRlQWN0aXZpdHlQcm9tcHQ7XG4gICAgICAgIF90aGlzLmxvY2FsSWQgPSBsb2NhbElkO1xuICAgICAgICBfdGhpcy5nZXRTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciAkYWxsQWN0aXZpdHlFbGVtZW50cyA9ICQoX3RoaXMuY29udGFpbmVyKS5maW5kKCcuYWN0aXZpdHknKTtcbiAgICAgICAgICAgIHZhciB3b3JrZmxvdyA9IHtcbiAgICAgICAgICAgICAgICBpZDogX3RoaXMud29ya2Zsb3dUeXBlLmlkLFxuICAgICAgICAgICAgICAgIGFjdGl2aXRpZXM6IFtdLFxuICAgICAgICAgICAgICAgIHRyYW5zaXRpb25zOiBbXSxcbiAgICAgICAgICAgICAgICByZW1vdmVkQWN0aXZpdGllczogX3RoaXMud29ya2Zsb3dUeXBlLnJlbW92ZWRBY3Rpdml0aWVzXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgLy8gQ29sbGVjdCBhY3Rpdml0aWVzLlxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkYWxsQWN0aXZpdHlFbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciAkYWN0aXZpdHlFbGVtZW50ID0gJCgkYWxsQWN0aXZpdHlFbGVtZW50c1tpXSk7XG4gICAgICAgICAgICAgICAgdmFyIGFjdGl2aXR5SWQgPSAkYWN0aXZpdHlFbGVtZW50LmRhdGEoJ2FjdGl2aXR5LWlkJyk7XG4gICAgICAgICAgICAgICAgdmFyIGFjdGl2aXR5SXNTdGFydCA9ICRhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktc3RhcnQnKTtcbiAgICAgICAgICAgICAgICB2YXIgYWN0aXZpdHlJc0V2ZW50ID0gJGFjdGl2aXR5RWxlbWVudC5kYXRhKCdhY3Rpdml0eS10eXBlJykgPT09ICdFdmVudCc7XG4gICAgICAgICAgICAgICAgdmFyIGFjdGl2aXR5UG9zaXRpb24gPSAkYWN0aXZpdHlFbGVtZW50LnBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgdmFyIGFjdGl2aXR5ID0gX3RoaXMuZ2V0QWN0aXZpdHkoYWN0aXZpdHlJZCk7XG4gICAgICAgICAgICAgICAgd29ya2Zsb3cuYWN0aXZpdGllcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGFjdGl2aXR5SWQsXG4gICAgICAgICAgICAgICAgICAgIGlzU3RhcnQ6IGFjdGl2aXR5SXNTdGFydCxcbiAgICAgICAgICAgICAgICAgICAgaXNFdmVudDogYWN0aXZpdHlJc0V2ZW50LFxuICAgICAgICAgICAgICAgICAgICBvdXRjb21lczogYWN0aXZpdHkub3V0Y29tZXMsXG4gICAgICAgICAgICAgICAgICAgIHg6IGFjdGl2aXR5UG9zaXRpb24ubGVmdCxcbiAgICAgICAgICAgICAgICAgICAgeTogYWN0aXZpdHlQb3NpdGlvbi50b3BcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIENvbGxlY3QgY29ubmVjdGlvbnMuXG4gICAgICAgICAgICB2YXIgYWxsQ29ubmVjdGlvbnMgPSBfdGhpcy5qc1BsdW1iSW5zdGFuY2UuZ2V0Q29ubmVjdGlvbnMoKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYWxsQ29ubmVjdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgY29ubmVjdGlvbiA9IGFsbENvbm5lY3Rpb25zW2ldO1xuICAgICAgICAgICAgICAgIHZhciBzb3VyY2VFbmRwb2ludCA9IGNvbm5lY3Rpb24uZW5kcG9pbnRzWzBdO1xuICAgICAgICAgICAgICAgIHZhciBzb3VyY2VPdXRjb21lTmFtZSA9IHNvdXJjZUVuZHBvaW50LmdldFBhcmFtZXRlcnMoKS5vdXRjb21lLm5hbWU7XG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZUFjdGl2aXR5SWQgPSAkKGNvbm5lY3Rpb24uc291cmNlKS5kYXRhKCdhY3Rpdml0eS1pZCcpO1xuICAgICAgICAgICAgICAgIHZhciBkZXN0aW5hdGlvbkFjdGl2aXR5SWQgPSAkKGNvbm5lY3Rpb24udGFyZ2V0KS5kYXRhKCdhY3Rpdml0eS1pZCcpO1xuICAgICAgICAgICAgICAgIHdvcmtmbG93LnRyYW5zaXRpb25zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzb3VyY2VBY3Rpdml0eUlkOiBzb3VyY2VBY3Rpdml0eUlkLFxuICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbkFjdGl2aXR5SWQ6IGRlc3RpbmF0aW9uQWN0aXZpdHlJZCxcbiAgICAgICAgICAgICAgICAgICAgc291cmNlT3V0Y29tZU5hbWU6IHNvdXJjZU91dGNvbWVOYW1lXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gd29ya2Zsb3c7XG4gICAgICAgIH07XG4gICAgICAgIF90aGlzLnNlcmlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB3b3JrZmxvdyA9IF90aGlzLmdldFN0YXRlKCk7XG4gICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkod29ya2Zsb3cpO1xuICAgICAgICB9O1xuICAgICAgICBfdGhpcy5zYXZlTG9jYWxTdGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlW190aGlzLmxvY2FsSWRdID0gX3RoaXMuc2VyaWFsaXplKCk7XG4gICAgICAgIH07XG4gICAgICAgIF90aGlzLmxvYWRMb2NhbFN0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2Uoc2Vzc2lvblN0b3JhZ2VbX3RoaXMubG9jYWxJZF0pO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgc2VsZiA9IF90aGlzO1xuICAgICAgICBqc1BsdW1iLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGpzUGx1bWIuaW1wb3J0RGVmYXVsdHMoX3RoaXMuZ2V0RGVmYXVsdHMoKSk7XG4gICAgICAgICAgICB2YXIgcGx1bWJlciA9IF90aGlzLmNyZWF0ZUpzUGx1bWJJbnN0YW5jZSgpO1xuICAgICAgICAgICAgLy8gTGlzdGVuIGZvciBuZXcgY29ubmVjdGlvbnMuXG4gICAgICAgICAgICBwbHVtYmVyLmJpbmQoJ2Nvbm5lY3Rpb24nLCBmdW5jdGlvbiAoY29ubkluZm8sIG9yaWdpbmFsRXZlbnQpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29ubmVjdGlvbiA9IGNvbm5JbmZvLmNvbm5lY3Rpb247XG4gICAgICAgICAgICAgICAgdmFyIG91dGNvbWUgPSBjb25uZWN0aW9uLmdldFBhcmFtZXRlcnMoKS5vdXRjb21lO1xuICAgICAgICAgICAgICAgIHZhciBsYWJlbCA9IGNvbm5lY3Rpb24uZ2V0T3ZlcmxheSgnbGFiZWwnKTtcbiAgICAgICAgICAgICAgICBsYWJlbC5zZXRMYWJlbChvdXRjb21lLmRpc3BsYXlOYW1lKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIGFjdGl2aXR5RWxlbWVudHMgPSBfdGhpcy5nZXRBY3Rpdml0eUVsZW1lbnRzKCk7XG4gICAgICAgICAgICB2YXIgYXJlRXF1YWxPdXRjb21lcyA9IGZ1bmN0aW9uIChvdXRjb21lczEsIG91dGNvbWVzMikge1xuICAgICAgICAgICAgICAgIGlmIChvdXRjb21lczEubGVuZ3RoICE9IG91dGNvbWVzMi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG91dGNvbWVzMS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgb3V0Y29tZTEgPSBvdXRjb21lczFbaV07XG4gICAgICAgICAgICAgICAgICAgIHZhciBvdXRjb21lMiA9IG91dGNvbWVzMltpXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG91dGNvbWUxLm5hbWUgIT0gb3V0Y29tZTIuZGlzcGxheU5hbWUgfHwgb3V0Y29tZTEuZGlzcGxheU5hbWUgIT0gb3V0Y29tZTIuZGlzcGxheU5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAvLyBTdXNwZW5kIGRyYXdpbmcgYW5kIGluaXRpYWxpemUuXG4gICAgICAgICAgICBwbHVtYmVyLmJhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VydmVyd29ya2Zsb3dUeXBlID0gX3RoaXMud29ya2Zsb3dUeXBlO1xuICAgICAgICAgICAgICAgIHZhciB3b3JrZmxvd0lkID0gX3RoaXMud29ya2Zsb3dUeXBlLmlkO1xuICAgICAgICAgICAgICAgIGlmIChsb2FkTG9jYWxTdGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbG9jYWxTdGF0ZSA9IF90aGlzLmxvYWRMb2NhbFN0YXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsb2NhbFN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy53b3JrZmxvd1R5cGUgPSBsb2NhbFN0YXRlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudHMuZWFjaChmdW5jdGlvbiAoXywgYWN0aXZpdHlFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciAkYWN0aXZpdHlFbGVtZW50ID0gJChhY3Rpdml0eUVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aXZpdHlJZCA9ICRhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktaWQnKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlzRGVsZXRlZCA9IF90aGlzLndvcmtmbG93VHlwZS5yZW1vdmVkQWN0aXZpdGllcy5pbmRleE9mKGFjdGl2aXR5SWQpID4gLTE7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0RlbGV0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpdml0eUVsZW1lbnQucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGl2aXR5ID0gX3RoaXMuZ2V0QWN0aXZpdHkoYWN0aXZpdHlJZCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzZXJ2ZXJBY3Rpdml0eSA9IF90aGlzLmdldEFjdGl2aXR5KGFjdGl2aXR5SWQsIHNlcnZlcndvcmtmbG93VHlwZS5hY3Rpdml0aWVzKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBhY3Rpdml0eSdzIHZpc3VhbCBzdGF0ZS5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWRMb2NhbFN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aXZpdHkgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgYSBuZXdseSBhZGRlZCBhY3Rpdml0eSBub3QgeWV0IGFkZGVkIHRvIGxvY2FsIHN0YXRlLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5ID0gc2VydmVyQWN0aXZpdHk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMud29ya2Zsb3dUeXBlLmFjdGl2aXRpZXMucHVzaChhY3Rpdml0eSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHkueCA9IDUwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5LnkgPSA1MDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBhdmFpbGFibGUgb3V0Y29tZXMgbWlnaHQgaGF2ZSBjaGFuZ2VkIHdoZW4gZWRpdGluZyBhbiBhY3Rpdml0eSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzbyB3ZSBuZWVkIHRvIGNoZWNrIGZvciB0aGF0IGFuZCB1cGRhdGUgdGhlIGNsaWVudCdzIGFjdGl2aXR5IG91dGNvbWVzIGlmIHNvLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzYW1lT3V0Y29tZXMgPSBhcmVFcXVhbE91dGNvbWVzKGFjdGl2aXR5Lm91dGNvbWVzLCBzZXJ2ZXJBY3Rpdml0eS5vdXRjb21lcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzYW1lT3V0Y29tZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZpdHkub3V0Y29tZXMgPSBzZXJ2ZXJBY3Rpdml0eS5vdXRjb21lcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGl2aXR5RWxlbWVudFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY3NzKHsgbGVmdDogYWN0aXZpdHkueCwgdG9wOiBhY3Rpdml0eS55IH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50b2dnbGVDbGFzcygnYWN0aXZpdHktc3RhcnQnLCBhY3Rpdml0eS5pc1N0YXJ0KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZGF0YSgnYWN0aXZpdHktc3RhcnQnLCBhY3Rpdml0eS5pc1N0YXJ0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBNYWtlIHRoZSBhY3Rpdml0eSBkcmFnZ2FibGUuXG4gICAgICAgICAgICAgICAgICAgIHBsdW1iZXIuZHJhZ2dhYmxlKGFjdGl2aXR5RWxlbWVudCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZDogWzEwLCAxMF0sXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250YWlubWVudDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmRyYWdTdGFydCA9IHsgbGVmdDogYXJncy5lLnNjcmVlblgsIHRvcDogYXJncy5lLnNjcmVlblkgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBzdG9wOiBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmhhc0RyYWdnZWQgPSBfdGhpcy5kcmFnU3RhcnQubGVmdCAhPSBhcmdzLmUuc2NyZWVuWCB8fCBfdGhpcy5kcmFnU3RhcnQudG9wICE9IGFyZ3MuZS5zY3JlZW5ZO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnVwZGF0ZUNhbnZhc0hlaWdodCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ29uZmlndXJlIHRoZSBhY3Rpdml0eSBhcyBhIHRhcmdldC5cbiAgICAgICAgICAgICAgICAgICAgcGx1bWJlci5tYWtlVGFyZ2V0KGFjdGl2aXR5RWxlbWVudCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZHJvcE9wdGlvbnM6IHsgaG92ZXJDbGFzczogJ2hvdmVyJyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yOiAnQ29udGludW91cycsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogWydCbGFuaycsIHsgcmFkaXVzOiA4IH1dXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAvLyBBZGQgc291cmNlIGVuZHBvaW50cy5cbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IGFjdGl2aXR5Lm91dGNvbWVzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG91dGNvbWUgPSBfYVtfaV07XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlRW5kcG9pbnRPcHRpb25zID0gX3RoaXMuZ2V0U291cmNlRW5kcG9pbnRPcHRpb25zKGFjdGl2aXR5LCBvdXRjb21lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsdW1iZXIuYWRkRW5kcG9pbnQoYWN0aXZpdHlFbGVtZW50LCB7IGNvbm5lY3Rvck92ZXJsYXlzOiBbWydMYWJlbCcsIHsgbGFiZWw6IG91dGNvbWUuZGlzcGxheU5hbWUsIGNzc0NsYXNzOiAnY29ubmVjdGlvbi1sYWJlbCcgfV1dIH0sIHNvdXJjZUVuZHBvaW50T3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvLyBDb25uZWN0IGFjdGl2aXRpZXMuXG4gICAgICAgICAgICAgICAgX3RoaXMudXBkYXRlQ29ubmVjdGlvbnMocGx1bWJlcik7XG4gICAgICAgICAgICAgICAgLy8gUmUtcXVlcnkgdGhlIGFjdGl2aXR5IGVsZW1lbnRzLlxuICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudHMgPSBfdGhpcy5nZXRBY3Rpdml0eUVsZW1lbnRzKCk7XG4gICAgICAgICAgICAgICAgLy8gTWFrZSBhbGwgYWN0aXZpdHkgZWxlbWVudHMgdmlzaWJsZS5cbiAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzLnNob3coKTtcbiAgICAgICAgICAgICAgICBfdGhpcy51cGRhdGVDYW52YXNIZWlnaHQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBwb3BvdmVycy5cbiAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudHMuZWFjaChmdW5jdGlvbiAoXywgaXRlbSkge1xuICAgICAgICAgICAgICAgIHZhciBhY3Rpdml0eUVsZW1lbnQgPSAkKGl0ZW0pO1xuICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudC5wb3BvdmVyKHtcbiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogJ21hbnVhbCcsXG4gICAgICAgICAgICAgICAgICAgIGh0bWw6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkY29udGVudCA9IGFjdGl2aXR5RWxlbWVudC5maW5kKCcuYWN0aXZpdHktY29tbWFuZHMnKS5jbG9uZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXJ0QnV0dG9uID0gJGNvbnRlbnQuZmluZCgnLmFjdGl2aXR5LXN0YXJ0LWFjdGlvbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlzU3RhcnQgPSBhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktc3RhcnQnKSA9PT0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpdml0eUlkID0gYWN0aXZpdHlFbGVtZW50LmRhdGEoJ2FjdGl2aXR5LWlkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydEJ1dHRvbi5hdHRyKCdhcmlhLXByZXNzZWQnLCBhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktc3RhcnQnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydEJ1dHRvbi50b2dnbGVDbGFzcygnYWN0aXZlJywgaXNTdGFydCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkY29udGVudC5vbignY2xpY2snLCAnLmFjdGl2aXR5LXN0YXJ0LWFjdGlvbicsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBidXR0b24gPSAkKGUuY3VycmVudFRhcmdldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlzU3RhcnQgPSBidXR0b24uaXMoJy5hY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnQuZGF0YSgnYWN0aXZpdHktc3RhcnQnLCBpc1N0YXJ0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnQudG9nZ2xlQ2xhc3MoJ2FjdGl2aXR5LXN0YXJ0JywgaXNTdGFydCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRjb250ZW50Lm9uKCdjbGljaycsICcuYWN0aXZpdHktZGVsZXRlLWFjdGlvbicsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IFRoZSBwcm9tcHRzIGFyZSByZWFsbHkgYW5ub3lpbmcuIENvbnNpZGVyIHNob3dpbmcgc29tZSBzb3J0IG9mIHNtYWxsIG1lc3NhZ2UgYmFsbG9vbiBzb21ld2hlcmUgdG8gdW5kbyB0aGUgYWN0aW9uIGluc3RlYWQuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiAoIWNvbmZpcm0oc2VsZi5kZWxldGVBY3Rpdml0eVByb21wdCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy99XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi53b3JrZmxvd1R5cGUucmVtb3ZlZEFjdGl2aXRpZXMucHVzaChhY3Rpdml0eUlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbHVtYmVyLnJlbW92ZShhY3Rpdml0eUVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2aXR5RWxlbWVudC5wb3BvdmVyKCdkaXNwb3NlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRjb250ZW50Lm9uKCdjbGljaycsICdbZGF0YS1wZXJzaXN0LXdvcmtmbG93XScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYXZlTG9jYWxTdGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGNvbnRlbnQuZ2V0KDApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICQoY29udGFpbmVyKS5vbignY2xpY2snLCAnLmFjdGl2aXR5JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuaGFzRHJhZ2dlZCkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5oYXNEcmFnZ2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gaWYgYW55IG90aGVyIHBvcG92ZXJzIGFyZSB2aXNpYmxlLCBoaWRlIHRoZW1cbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuaXNQb3BvdmVyVmlzaWJsZSkge1xuICAgICAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzLnBvcG92ZXIoJ2hpZGUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHNlbmRlciA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICAgICAgICAgICAgICBzZW5kZXIucG9wb3Zlcignc2hvdycpO1xuICAgICAgICAgICAgICAgIC8vIGhhbmRsZSBjbGlja2luZyBvbiB0aGUgcG9wb3ZlciBpdHNlbGYuXG4gICAgICAgICAgICAgICAgJCgnLnBvcG92ZXInKS5vZmYoJ2NsaWNrJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUyKSB7XG4gICAgICAgICAgICAgICAgICAgIGUyLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgX3RoaXMuaXNQb3BvdmVyVmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICQoY29udGFpbmVyKS5vbignZGJsY2xpY2snLCAnLmFjdGl2aXR5JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VuZGVyID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgICAgICAgICAgICAgIHZhciBoYXNFZGl0b3IgPSBzZW5kZXIuZGF0YSgnYWN0aXZpdHktaGFzLWVkaXRvcicpO1xuICAgICAgICAgICAgICAgIGlmIChoYXNFZGl0b3IpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2F2ZUxvY2FsU3RhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgc2VuZGVyLmZpbmQoJy5hY3Rpdml0eS1lZGl0LWFjdGlvbicpLmdldCgwKS5jbGljaygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gSGlkZSBhbGwgcG9wb3ZlcnMgd2hlbiBjbGlja2luZyBhbnl3aGVyZSBidXQgb24gYW4gYWN0aXZpdHkuXG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBhY3Rpdml0eUVsZW1lbnRzLnBvcG92ZXIoJ2hpZGUnKTtcbiAgICAgICAgICAgICAgICBfdGhpcy5pc1BvcG92ZXJWaXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIFNhdmUgbG9jYWwgY2hhbmdlcyBpZiB0aGUgZXZlbnQgdGFyZ2V0IGhhcyB0aGUgJ2RhdGEtcGVyc2lzdC13b3JrZmxvdycgYXR0cmlidXRlLlxuICAgICAgICAgICAgJCgnYm9keScpLm9uKCdjbGljaycsICdbZGF0YS1wZXJzaXN0LXdvcmtmbG93XScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuc2F2ZUxvY2FsU3RhdGUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgX3RoaXMuanNQbHVtYkluc3RhbmNlID0gcGx1bWJlcjtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIFdvcmtmbG93RWRpdG9yO1xufShXb3JrZmxvd0NhbnZhcykpO1xuJC5mbi53b3JrZmxvd0VkaXRvciA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmVhY2goZnVuY3Rpb24gKGluZGV4LCBlbGVtZW50KSB7XG4gICAgICAgIHZhciAkZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIHZhciB3b3JrZmxvd1R5cGUgPSAkZWxlbWVudC5kYXRhKCd3b3JrZmxvdy10eXBlJyk7XG4gICAgICAgIHZhciBkZWxldGVBY3Rpdml0eVByb21wdCA9ICRlbGVtZW50LmRhdGEoJ3dvcmtmbG93LWRlbGV0ZS1hY3Rpdml0eS1wcm9tcHQnKTtcbiAgICAgICAgdmFyIGxvY2FsSWQgPSAkZWxlbWVudC5kYXRhKCd3b3JrZmxvdy1sb2NhbC1pZCcpO1xuICAgICAgICB2YXIgbG9hZExvY2FsU3RhdGUgPSAkZWxlbWVudC5kYXRhKCd3b3JrZmxvdy1sb2FkLWxvY2FsLXN0YXRlJyk7XG4gICAgICAgIHdvcmtmbG93VHlwZS5yZW1vdmVkQWN0aXZpdGllcyA9IHdvcmtmbG93VHlwZS5yZW1vdmVkQWN0aXZpdGllcyB8fCBbXTtcbiAgICAgICAgJGVsZW1lbnQuZGF0YSgnd29ya2Zsb3dFZGl0b3InLCBuZXcgV29ya2Zsb3dFZGl0b3IoZWxlbWVudCwgd29ya2Zsb3dUeXBlLCBkZWxldGVBY3Rpdml0eVByb21wdCwgbG9jYWxJZCwgbG9hZExvY2FsU3RhdGUpKTtcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcztcbn07XG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHdvcmtmbG93RWRpdG9yID0gJCgnLndvcmtmbG93LWNhbnZhcycpLndvcmtmbG93RWRpdG9yKCkuZGF0YSgnd29ya2Zsb3dFZGl0b3InKTtcbiAgICAkKCcjd29ya2Zsb3dFZGl0b3JGb3JtJykub24oJ3N1Ym1pdCcsIGZ1bmN0aW9uIChzLCBlKSB7XG4gICAgICAgIHZhciBzdGF0ZSA9IHdvcmtmbG93RWRpdG9yLnNlcmlhbGl6ZSgpO1xuICAgICAgICAkKCcjd29ya2Zsb3dTdGF0ZUlucHV0JykudmFsKHN0YXRlKTtcbiAgICB9KTtcbn0pO1xuIl19
