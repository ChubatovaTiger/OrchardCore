/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

/**
 * Trumbowyg v2.8.0
 */
jQuery.trumbowyg = {
    langs: {
        en: {
            viewHTML: 'View HTML',

            undo: 'Undo',
            redo: 'Redo',

            formatting: 'Formatting',
            p: 'Paragraph',
            blockquote: 'Quote',
            code: 'Code',
            header: 'Header',

            bold: 'Bold',
            italic: 'Italic',
            strikethrough: 'Stroke',
            underline: 'Underline',

            strong: 'Strong',
            em: 'Emphasis',
            del: 'Deleted',

            superscript: 'Superscript',
            subscript: 'Subscript',

            unorderedList: 'Unordered list',
            orderedList: 'Ordered list',

            insertImage: 'Insert Image',
            link: 'Link',
            createLink: 'Insert link',
            unlink: 'Remove link',

            justifyLeft: 'Align Left',
            justifyCenter: 'Align Center',
            justifyRight: 'Align Right',
            justifyFull: 'Align Justify',

            horizontalRule: 'Insert horizontal rule',
            removeformat: 'Remove format',

            fullscreen: 'Fullscreen',

            close: 'Close',

            submit: 'Confirm',
            reset: 'Cancel',

            required: 'Required',
            description: 'Description',
            title: 'Title',
            text: 'Text',
            target: 'Target'
        }
    },

    // Plugins
    plugins: {},

    // SVG Path globally
    svgPath: null,

    hideButtonTexts: null
};

// Makes default options read-only
Object.defineProperty(jQuery.trumbowyg, 'defaultOptions', {
    value: {
        lang: 'en',

        fixedBtnPane: false,
        fixedFullWidth: false,
        autogrow: false,
        autogrowOnEnter: false,

        prefix: 'trumbowyg-',

        semantic: true,
        resetCss: false,
        removeformatPasted: false,
        tagsToRemove: [],
        btns: [
            ['viewHTML'],
            ['undo', 'redo'], // Only supported in Blink browsers
            ['formatting'],
            ['strong', 'em', 'del'],
            ['foreColor', 'backColor'],
            ['superscript', 'subscript'],
            ['link'],            
            ['image'],
            ['align'],
            ['unorderedList', 'orderedList'],
            ['horizontalRule'],
            ['removeformat'],
            ['fullscreen']
        ],
        // For custom button definitions
        btnsDef: {
                align: {
                    dropdown: ['justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull'],
                    ico: 'justifyLeft'
                },
                image: {
                    dropdown: ['insertImage', 'base64', 'noembed'],
                    ico: 'insertImage'
                }
        },

        inlineElementsSelector: 'a,abbr,acronym,b,caption,cite,code,col,dfn,dir,dt,dd,em,font,hr,i,kbd,li,q,span,strikeout,strong,sub,sup,u',

        pasteHandlers: [],

        // imgDblClickHandler: default is defined in constructor

        plugins: {}
    },
    writable: false,
    enumerable: true,
    configurable: false
});


(function (navigator, window, document, $) {
    'use strict';

    var CONFIRM_EVENT = 'tbwconfirm',
        CANCEL_EVENT = 'tbwcancel';

    $.fn.trumbowyg = function (options, params) {
        var trumbowygDataName = 'trumbowyg';
        if (options === Object(options) || !options) {
            return this.each(function () {
                if (!$(this).data(trumbowygDataName)) {
                    $(this).data(trumbowygDataName, new Trumbowyg(this, options));
                }
            });
        }
        if (this.length === 1) {
            try {
                var t = $(this).data(trumbowygDataName);
                switch (options) {
                    // Exec command
                    case 'execCmd':
                        return t.execCmd(params.cmd, params.param, params.forceCss);

                    // Modal box
                    case 'openModal':
                        return t.openModal(params.title, params.content);
                    case 'closeModal':
                        return t.closeModal();
                    case 'openModalInsert':
                        return t.openModalInsert(params.title, params.fields, params.callback);

                    // Range
                    case 'saveRange':
                        return t.saveRange();
                    case 'getRange':
                        return t.range;
                    case 'getRangeText':
                        return t.getRangeText();
                    case 'restoreRange':
                        return t.restoreRange();

                    // Enable/disable
                    case 'enable':
                        return t.setDisabled(false);
                    case 'disable':
                        return t.setDisabled(true);

                    // Destroy
                    case 'destroy':
                        return t.destroy();

                    // Empty
                    case 'empty':
                        return t.empty();

                    // HTML
                    case 'html':
                        return t.html(params);
                }
            } catch (c) {
            }
        }

        return false;
    };

    // @param: editorElem is the DOM element
    var Trumbowyg = function (editorElem, options) {
        var t = this,
            trumbowygIconsId = 'trumbowyg-icons',
            $trumbowyg = $.trumbowyg;

        // Get the document of the element. It use to makes the plugin
        // compatible on iframes.
        t.doc = editorElem.ownerDocument || document;

        // jQuery object of the editor
        t.$ta = $(editorElem); // $ta : Textarea
        t.$c = $(editorElem); // $c : creator

        options = options || {};

        // Localization management
        if (options.lang != null || $trumbowyg.langs[options.lang] != null) {
            t.lang = $.extend(true, {}, $trumbowyg.langs.en, $trumbowyg.langs[options.lang]);
        } else {
            t.lang = $trumbowyg.langs.en;
        }

        t.hideButtonTexts = $trumbowyg.hideButtonTexts != null ? $trumbowyg.hideButtonTexts : options.hideButtonTexts;

        // SVG path
        var svgPathOption = $trumbowyg.svgPath != null ? $trumbowyg.svgPath : options.svgPath;
        t.hasSvg = svgPathOption !== false;
        t.svgPath = !!t.doc.querySelector('base') ? window.location.href.split('#')[0] : '';
        if ($('#' + trumbowygIconsId, t.doc).length === 0 && svgPathOption !== false) {
            if (svgPathOption == null) {
                // Hack to get svgPathOption based on trumbowyg.js path
                try {
                    throw new Error();
                } catch (e) {
                    if (!e.hasOwnProperty('stack')) {
                        console.warn('You must define svgPath: https://goo.gl/CfTY9U'); // jshint ignore:line
                    } else {
                        var stackLines = e.stack.split('\n');

                        for (var i in stackLines) {
                            if (!stackLines[i].match(/https?:\/\//)) {
                                continue;
                            }
                            svgPathOption = stackLines[Number(i)].match(/((https?:\/\/.+\/)([^\/]+\.js))(\?.*)?:/)[1].split('/');
                            svgPathOption.pop();
                            svgPathOption = svgPathOption.join('/') + '/ui/icons.svg';
                            break;
                        }
                    }
                }
            }

            var div = t.doc.createElement('div');
            div.id = trumbowygIconsId;
            t.doc.body.insertBefore(div, t.doc.body.childNodes[0]);
            $.ajax({
                async: true,
                type: 'GET',
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                dataType: 'xml',
                crossDomain: true,
                url: svgPathOption,
                data: null,
                beforeSend: null,
                complete: null,
                success: function (data) {
                    div.innerHTML = new XMLSerializer().serializeToString(data.documentElement);
                }
            });
        }


        /**
         * When the button is associated to a empty object
         * fn and title attributs are defined from the button key value
         *
         * For example
         *      foo: {}
         * is equivalent to :
         *      foo: {
         *          fn: 'foo',
         *          title: this.lang.foo
         *      }
         */
        var h = t.lang.header, // Header translation
            isBlinkFunction = function () {
                return (window.chrome || (window.Intl && Intl.v8BreakIterator)) && 'CSS' in window;
            };
        t.btnsDef = {
            viewHTML: {
                fn: 'toggle'
            },

            undo: {
                isSupported: isBlinkFunction,
                key: 'Z'
            },
            redo: {
                isSupported: isBlinkFunction,
                key: 'Y'
            },

            p: {
                fn: 'formatBlock'
            },
            blockquote: {
                fn: 'formatBlock'
            },
            h1: {
                fn: 'formatBlock',
                title: h + ' 1'
            },
            h2: {
                fn: 'formatBlock',
                title: h + ' 2'
            },
            h3: {
                fn: 'formatBlock',
                title: h + ' 3'
            },
            h4: {
                fn: 'formatBlock',
                title: h + ' 4'
            },
            subscript: {
                tag: 'sub'
            },
            superscript: {
                tag: 'sup'
            },

            bold: {
                key: 'B',
                tag: 'b'
            },
            italic: {
                key: 'I',
                tag: 'i'
            },
            underline: {
                tag: 'u'
            },
            strikethrough: {
                tag: 'strike'
            },

            strong: {
                fn: 'bold',
                key: 'B'
            },
            em: {
                fn: 'italic',
                key: 'I'
            },
            del: {
                fn: 'strikethrough'
            },

            createLink: {
                key: 'K',
                tag: 'a'
            },
            unlink: {},

            insertImage: {},

            justifyLeft: {
                tag: 'left',
                forceCss: true
            },
            justifyCenter: {
                tag: 'center',
                forceCss: true
            },
            justifyRight: {
                tag: 'right',
                forceCss: true
            },
            justifyFull: {
                tag: 'justify',
                forceCss: true
            },

            unorderedList: {
                fn: 'insertUnorderedList',
                tag: 'ul'
            },
            orderedList: {
                fn: 'insertOrderedList',
                tag: 'ol'
            },

            horizontalRule: {
                fn: 'insertHorizontalRule'
            },

            removeformat: {},

            fullscreen: {
                class: 'trumbowyg-not-disable'
            },
            close: {
                fn: 'destroy',
                class: 'trumbowyg-not-disable'
            },

            // Dropdowns
            formatting: {
                dropdown: ['p', 'blockquote', 'h1', 'h2', 'h3', 'h4'],
                ico: 'p'
            },
            link: {
                dropdown: ['createLink', 'unlink']
            }
        };

        // Defaults Options
        t.o = $.extend(true, {}, $trumbowyg.defaultOptions, options);
        if (!t.o.hasOwnProperty('imgDblClickHandler')) {
            t.o.imgDblClickHandler = t.getDefaultImgDblClickHandler();
        }

        t.disabled = t.o.disabled || (editorElem.nodeName === 'TEXTAREA' && editorElem.disabled);

        if (options.btns) {
            t.o.btns = options.btns;
        } else if (!t.o.semantic) {
            t.o.btns[3] = ['bold', 'italic', 'underline', 'strikethrough'];
        }

        $.each(t.o.btnsDef, function (btnName, btnDef) {
            t.addBtnDef(btnName, btnDef);
        });

        // put this here in the event it would be merged in with options
        t.eventNamespace = 'trumbowyg-event';

        // Keyboard shortcuts are load in this array
        t.keys = [];

        // Tag to button dynamically hydrated
        t.tagToButton = {};
        t.tagHandlers = [];

        // Admit multiple paste handlers
        t.pasteHandlers = [].concat(t.o.pasteHandlers);

        // Check if browser is IE
        t.isIE = (navigator.userAgent.indexOf('MSIE') !== -1 || navigator.appVersion.indexOf('Trident/') !== -1);

        t.init();
    };

    Trumbowyg.prototype = {
        init: function () {
            var t = this;
            t.height = t.$ta.height();

            t.initPlugins();

            try {
                // Disable image resize, try-catch for old IE
                t.doc.execCommand('enableObjectResizing', false, false);
                t.doc.execCommand('defaultParagraphSeparator', false, 'p');
            } catch (e) {
            }

            t.buildEditor();
            t.buildBtnPane();

            t.fixedBtnPaneEvents();

            t.buildOverlay();

            setTimeout(function () {
                if (t.disabled) {
                    t.setDisabled(true);
                }
                t.$c.trigger('tbwinit');
            });
        },

        addBtnDef: function (btnName, btnDef) {
            this.btnsDef[btnName] = btnDef;
        },

        buildEditor: function () {
            var t = this,
                prefix = t.o.prefix,
                html = '';

            t.$box = $('<div/>', {
                class: prefix + 'box ' + prefix + 'editor-visible ' + prefix + t.o.lang + ' trumbowyg'
            });

            // $ta = Textarea
            // $ed = Editor
            t.isTextarea = t.$ta.is('textarea');
            if (t.isTextarea) {
                html = t.$ta.val();
                t.$ed = $('<div/>');
                t.$box
                    .insertAfter(t.$ta)
                    .append(t.$ed, t.$ta);
            } else {
                t.$ed = t.$ta;
                html = t.$ed.html();

                t.$ta = $('<textarea/>', {
                    name: t.$ta.attr('id'),
                    height: t.height
                }).val(html);

                t.$box
                    .insertAfter(t.$ed)
                    .append(t.$ta, t.$ed);
                t.syncCode();
            }

            t.$ta
                .addClass(prefix + 'textarea')
                .attr('tabindex', -1)
            ;

            t.$ed
                .addClass(prefix + 'editor')
                .attr({
                    contenteditable: true,
                    dir: t.lang._dir || 'ltr'
                })
                .html(html)
            ;

            if (t.o.tabindex) {
                t.$ed.attr('tabindex', t.o.tabindex);
            }

            if (t.$c.is('[placeholder]')) {
                t.$ed.attr('placeholder', t.$c.attr('placeholder'));
            }

            if (t.$c.is('[spellcheck]')) {
                t.$ed.attr('spellcheck', t.$c.attr('spellcheck'));
            }

            if (t.o.resetCss) {
                t.$ed.addClass(prefix + 'reset-css');
            }

            if (!t.o.autogrow) {
                t.$ta.add(t.$ed).css({
                    height: t.height
                });
            }

            t.semanticCode();

            if (t.o.autogrowOnEnter) {
                t.$ed.addClass(prefix + 'autogrow-on-enter');
            }

            var ctrl = false,
                composition = false,
                debounceButtonPaneStatus,
                updateEventName = t.isIE ? 'keyup' : 'input';

            t.$ed
                .on('dblclick', 'img', t.o.imgDblClickHandler)
                .on('keydown', function (e) {
                    if ((e.ctrlKey || e.metaKey) && !e.altKey) {
                        ctrl = true;
                        var key = t.keys[String.fromCharCode(e.which).toUpperCase()];

                        try {
                            t.execCmd(key.fn, key.param);
                            return false;
                        } catch (c) {
                        }
                    }
                })
                .on('compositionstart compositionupdate', function () {
                    composition = true;
                })
                .on(updateEventName + ' compositionend', function (e) {
                    if (e.type === 'compositionend') {
                        composition = false;
                    } else if (composition) {
                        return;
                    }

                    var keyCode = e.which;

                    if (keyCode >= 37 && keyCode <= 40) {
                        return;
                    }

                    if ((e.ctrlKey || e.metaKey) && (keyCode === 89 || keyCode === 90)) {
                        t.$c.trigger('tbwchange');
                    } else if (!ctrl && keyCode !== 17) {
                        t.semanticCode(false, e.type === 'compositionend' && keyCode === 13);
                        t.$c.trigger('tbwchange');
                    } else if (typeof e.which === 'undefined') {
                        t.semanticCode(false, false, true);
                    }

                    setTimeout(function () {
                        ctrl = false;
                    }, 200);
                })
                .on('mouseup keydown keyup', function () {
                    clearTimeout(debounceButtonPaneStatus);
                    debounceButtonPaneStatus = setTimeout(function () {
                        t.updateButtonPaneStatus();
                    }, 50);
                })
                .on('focus blur', function (e) {
                    t.$c.trigger('tbw' + e.type);
                    if (e.type === 'blur') {
                        $('.' + prefix + 'active-button', t.$btnPane).removeClass(prefix + 'active-button ' + prefix + 'active');
                    }
                    if (t.o.autogrowOnEnter) {
                        if (t.autogrowOnEnterDontClose) {
                            return;
                        }
                        if (e.type === 'focus') {
                            t.autogrowOnEnterWasFocused = true;
                            t.autogrowEditorOnEnter();
                        }
                        else if (!t.o.autogrow) {
                            t.$ed.css({height: t.$ed.css('min-height')});
                            t.$c.trigger('tbwresize');
                        }
                    }
                })
                .on('cut', function () {
                    setTimeout(function () {
                        t.semanticCode(false, true);
                        t.$c.trigger('tbwchange');
                    }, 0);
                })
                .on('paste', function (e) {
                    if (t.o.removeformatPasted) {
                        e.preventDefault();

                        if (window.getSelection && window.getSelection().deleteFromDocument) {
                            window.getSelection().deleteFromDocument();
                        }

                        try {
                            // IE
                            var text = window.clipboardData.getData('Text');

                            try {
                                // <= IE10
                                t.doc.selection.createRange().pasteHTML(text);
                            } catch (c) {
                                // IE 11
                                t.doc.getSelection().getRangeAt(0).insertNode(t.doc.createTextNode(text));
                            }
                            t.$c.trigger('tbwchange', e);
                        } catch (d) {
                            // Not IE
                            t.execCmd('insertText', (e.originalEvent || e).clipboardData.getData('text/plain'));
                        }
                    }

                    // Call pasteHandlers
                    $.each(t.pasteHandlers, function (i, pasteHandler) {
                        pasteHandler(e);
                    });

                    setTimeout(function () {
                        t.semanticCode(false, true);
                        t.$c.trigger('tbwpaste', e);
                    }, 0);
                });

            t.$ta
                .on('keyup', function () {
                    t.$c.trigger('tbwchange');
                })
                .on('paste', function () {
                    setTimeout(function () {
                        t.$c.trigger('tbwchange');
                    }, 0);
                });

            t.$box.on('keydown', function (e) {
                if (e.which === 27 && $('.' + prefix + 'modal-box', t.$box).length === 1) {
                    t.closeModal();
                    return false;
                }
            });
        },

        //autogrow when entering logic
        autogrowEditorOnEnter: function () {
            var t = this;
            t.$ed.removeClass('autogrow-on-enter');
            var oldHeight = t.$ed[0].clientHeight;
            t.$ed.height('auto');
            var totalHeight = t.$ed[0].scrollHeight;
            t.$ed.addClass('autogrow-on-enter');
            if (oldHeight !== totalHeight) {
                t.$ed.height(oldHeight);
                setTimeout(function () {
                    t.$ed.css({height: totalHeight});
                    t.$c.trigger('tbwresize');
                }, 0);
            }
        },


        // Build button pane, use o.btns option
        buildBtnPane: function () {
            var t = this,
                prefix = t.o.prefix;

            var $btnPane = t.$btnPane = $('<div/>', {
                class: prefix + 'button-pane'
            });

            $.each(t.o.btns, function (i, btnGrp) {
                if (!$.isArray(btnGrp)) {
                    btnGrp = [btnGrp];
                }

                var $btnGroup = $('<div/>', {
                    class: prefix + 'button-group ' + ((btnGrp.indexOf('fullscreen') >= 0) ? prefix + 'right' : '')
                });
                $.each(btnGrp, function (i, btn) {
                    try { // Prevent buildBtn error
                        if (t.isSupportedBtn(btn)) { // It's a supported button
                            $btnGroup.append(t.buildBtn(btn));
                        }
                    } catch (c) {
                    }
                });
                $btnPane.append($btnGroup);
            });

            t.$box.prepend($btnPane);
        },


        // Build a button and his action
        buildBtn: function (btnName) { // btnName is name of the button
            var t = this,
                prefix = t.o.prefix,
                btn = t.btnsDef[btnName],
                isDropdown = btn.dropdown,
                hasIcon = btn.hasIcon != null ? btn.hasIcon : true,
                textDef = t.lang[btnName] || btnName,

                $btn = $('<button/>', {
                    type: 'button',
                    class: prefix + btnName + '-button ' + (btn.class || '') + (!hasIcon ? ' ' + prefix + 'textual-button' : ''),
                    html: t.hasSvg && hasIcon ?
                        '<svg><use xlink:href="' + t.svgPath + '#' + prefix + (btn.ico || btnName).replace(/([A-Z]+)/g, '-$1').toLowerCase() + '"/></svg>' :
                        t.hideButtonTexts ? '' : (btn.text || btn.title || t.lang[btnName] || btnName),
                    title: (btn.title || btn.text || textDef) + ((btn.key) ? ' (Ctrl + ' + btn.key + ')' : ''),
                    tabindex: -1,
                    mousedown: function () {
                        if (!isDropdown || $('.' + btnName + '-' + prefix + 'dropdown', t.$box).is(':hidden')) {
                            $('body', t.doc).trigger('mousedown');
                        }

                        if (t.$btnPane.hasClass(prefix + 'disable') && !$(this).hasClass(prefix + 'active') && !$(this).hasClass(prefix + 'not-disable')) {
                            return false;
                        }

                        t.execCmd((isDropdown ? 'dropdown' : false) || btn.fn || btnName, btn.param || btnName, btn.forceCss);

                        return false;
                    }
                });

            if (isDropdown) {
                $btn.addClass(prefix + 'open-dropdown');
                var dropdownPrefix = prefix + 'dropdown',
                    $dropdown = $('<div/>', { // the dropdown
                        class: dropdownPrefix + '-' + btnName + ' ' + dropdownPrefix + ' ' + prefix + 'fixed-top',
                        'data-dropdown': btnName
                    });
                $.each(isDropdown, function (i, def) {
                    if (t.btnsDef[def] && t.isSupportedBtn(def)) {
                        $dropdown.append(t.buildSubBtn(def));
                    }
                });
                t.$box.append($dropdown.hide());
            } else if (btn.key) {
                t.keys[btn.key] = {
                    fn: btn.fn || btnName,
                    param: btn.param || btnName
                };
            }

            if (!isDropdown) {
                t.tagToButton[(btn.tag || btnName).toLowerCase()] = btnName;
            }

            return $btn;
        },
        // Build a button for dropdown menu
        // @param n : name of the subbutton
        buildSubBtn: function (btnName) {
            var t = this,
                prefix = t.o.prefix,
                btn = t.btnsDef[btnName],
                hasIcon = btn.hasIcon != null ? btn.hasIcon : true;

            if (btn.key) {
                t.keys[btn.key] = {
                    fn: btn.fn || btnName,
                    param: btn.param || btnName
                };
            }

            t.tagToButton[(btn.tag || btnName).toLowerCase()] = btnName;

            return $('<button/>', {
                type: 'button',
                class: prefix + btnName + '-dropdown-button' + (btn.ico ? ' ' + prefix + btn.ico + '-button' : ''),
                html: t.hasSvg && hasIcon ? '<svg><use xlink:href="' + t.svgPath + '#' + prefix + (btn.ico || btnName).replace(/([A-Z]+)/g, '-$1').toLowerCase() + '"/></svg>' + (btn.text || btn.title || t.lang[btnName] || btnName) : (btn.text || btn.title || t.lang[btnName] || btnName),
                title: ((btn.key) ? ' (Ctrl + ' + btn.key + ')' : null),
                style: btn.style || null,
                mousedown: function () {
                    $('body', t.doc).trigger('mousedown');

                    t.execCmd(btn.fn || btnName, btn.param || btnName, btn.forceCss);

                    return false;
                }
            });
        },
        // Check if button is supported
        isSupportedBtn: function (b) {
            try {
                return this.btnsDef[b].isSupported();
            } catch (c) {
            }
            return true;
        },

        // Build overlay for modal box
        buildOverlay: function () {
            var t = this;
            t.$overlay = $('<div/>', {
                class: t.o.prefix + 'overlay'
            }).appendTo(t.$box);
            return t.$overlay;
        },
        showOverlay: function () {
            var t = this;
            $(window).trigger('scroll');
            t.$overlay.fadeIn(200);
            t.$box.addClass(t.o.prefix + 'box-blur');
        },
        hideOverlay: function () {
            var t = this;
            t.$overlay.fadeOut(50);
            t.$box.removeClass(t.o.prefix + 'box-blur');
        },

        // Management of fixed button pane
        fixedBtnPaneEvents: function () {
            var t = this,
                fixedFullWidth = t.o.fixedFullWidth,
                $box = t.$box;

            if (!t.o.fixedBtnPane) {
                return;
            }

            t.isFixed = false;

            $(window)
                .on('scroll.' + t.eventNamespace + ' resize.' + t.eventNamespace, function () {
                    if (!$box) {
                        return;
                    }

                    t.syncCode();

                    var scrollTop = $(window).scrollTop(),
                        offset = $box.offset().top + 1,
                        bp = t.$btnPane,
                        oh = bp.outerHeight() - 2;

                    if ((scrollTop - offset > 0) && ((scrollTop - offset - t.height) < 0)) {
                        if (!t.isFixed) {
                            t.isFixed = true;
                            bp.css({
                                position: 'fixed',
                                top: 0,
                                left: fixedFullWidth ? '0' : 'auto',
                                zIndex: 7
                            });
                            $([t.$ta, t.$ed]).css({marginTop: bp.height()});
                        }
                        bp.css({
                            width: fixedFullWidth ? '100%' : (($box.width() - 1) + 'px')
                        });

                        $('.' + t.o.prefix + 'fixed-top', $box).css({
                            position: fixedFullWidth ? 'fixed' : 'absolute',
                            top: fixedFullWidth ? oh : oh + (scrollTop - offset) + 'px',
                            zIndex: 15
                        });
                    } else if (t.isFixed) {
                        t.isFixed = false;
                        bp.removeAttr('style');
                        $([t.$ta, t.$ed]).css({marginTop: 0});
                        $('.' + t.o.prefix + 'fixed-top', $box).css({
                            position: 'absolute',
                            top: oh
                        });
                    }
                });
        },

        // Disable editor
        setDisabled: function (disable) {
            var t = this,
                prefix = t.o.prefix;

            t.disabled = disable;

            if (disable) {
                t.$ta.attr('disabled', true);
            } else {
                t.$ta.removeAttr('disabled');
            }
            t.$box.toggleClass(prefix + 'disabled', disable);
            t.$ed.attr('contenteditable', !disable);
        },

        // Destroy the editor
        destroy: function () {
            var t = this,
                prefix = t.o.prefix;

            if (t.isTextarea) {
                t.$box.after(
                    t.$ta
                        .css({height: ''})
                        .val(t.html())
                        .removeClass(prefix + 'textarea')
                        .show()
                );
            } else {
                t.$box.after(
                    t.$ed
                        .css({height: ''})
                        .removeClass(prefix + 'editor')
                        .removeAttr('contenteditable')
                        .removeAttr('dir')
                        .html(t.html())
                        .show()
                );
            }

            t.$ed.off('dblclick', 'img');

            t.destroyPlugins();

            t.$box.remove();
            t.$c.removeData('trumbowyg');
            $('body').removeClass(prefix + 'body-fullscreen');
            t.$c.trigger('tbwclose');
            $(window).off('scroll.' + t.eventNamespace + ' resize.' + t.eventNamespace);
        },


        // Empty the editor
        empty: function () {
            this.$ta.val('');
            this.syncCode(true);
        },


        // Function call when click on viewHTML button
        toggle: function () {
            var t = this,
                prefix = t.o.prefix;

            if (t.o.autogrowOnEnter) {
                t.autogrowOnEnterDontClose = !t.$box.hasClass(prefix + 'editor-hidden');
            }

            t.semanticCode(false, true);

            setTimeout(function () {
                t.doc.activeElement.blur();
                t.$box.toggleClass(prefix + 'editor-hidden ' + prefix + 'editor-visible');
                t.$btnPane.toggleClass(prefix + 'disable');
                $('.' + prefix + 'viewHTML-button', t.$btnPane).toggleClass(prefix + 'active');
                if (t.$box.hasClass(prefix + 'editor-visible')) {
                    t.$ta.attr('tabindex', -1);
                } else {
                    t.$ta.removeAttr('tabindex');
                }

                if (t.o.autogrowOnEnter && !t.autogrowOnEnterDontClose) {
                    t.autogrowEditorOnEnter();
                }
            }, 0);
        },

        // Open dropdown when click on a button which open that
        dropdown: function (name) {
            var t = this,
                d = t.doc,
                prefix = t.o.prefix,
                $dropdown = $('[data-dropdown=' + name + ']', t.$box),
                $btn = $('.' + prefix + name + '-button', t.$btnPane),
                show = $dropdown.is(':hidden');

            $('body', d).trigger('mousedown');

            if (show) {
                var o = $btn.offset().left;
                $btn.addClass(prefix + 'active');

                $dropdown.css({
                    position: 'absolute',
                    top: $btn.offset().top - t.$btnPane.offset().top + $btn.outerHeight(),
                    left: (t.o.fixedFullWidth && t.isFixed) ? o + 'px' : (o - t.$btnPane.offset().left) + 'px'
                }).show();

                $(window).trigger('scroll');

                $('body', d).on('mousedown.' + t.eventNamespace, function (e) {
                    if (!$dropdown.is(e.target)) {
                        $('.' + prefix + 'dropdown', d).hide();
                        $('.' + prefix + 'active', d).removeClass(prefix + 'active');
                        $('body', d).off('mousedown.' + t.eventNamespace);
                    }
                });
            }
        },


        // HTML Code management
        html: function (html) {
            var t = this;
            if (html != null) {
                t.$ta.val(html);
                t.syncCode(true);
                return t;
            }
            return t.$ta.val();
        },
        syncTextarea: function () {
            var t = this;
            t.$ta.val(t.$ed.text().trim().length > 0 || t.$ed.find('hr,img,embed,iframe,input').length > 0 ? t.$ed.html() : '');
        },
        syncCode: function (force) {
            var t = this;
            if (!force && t.$ed.is(':visible')) {
                t.syncTextarea();
            } else {
                // wrap the content in a div it's easier to get the innerhtml
                var html = $('<div>').html(t.$ta.val());
                //scrub the html before loading into the doc
                var safe = $('<div>').append(html);
                $(t.o.tagsToRemove.join(','), safe).remove();
                t.$ed.html(safe.contents().html());
            }

            if (t.o.autogrow) {
                t.height = t.$ed.height();
                if (t.height !== t.$ta.css('height')) {
                    t.$ta.css({height: t.height});
                    t.$c.trigger('tbwresize');
                }
            }
            if (t.o.autogrowOnEnter) {
                // t.autogrowEditorOnEnter();
                t.$ed.height('auto');
                var totalheight = t.autogrowOnEnterWasFocused ? t.$ed[0].scrollHeight : t.$ed.css('min-height');
                if (totalheight !== t.$ta.css('height')) {
                    t.$ed.css({height: totalheight});
                    t.$c.trigger('tbwresize');
                }
            }
        },

        // Analyse and update to semantic code
        // @param force : force to sync code from textarea
        // @param full  : wrap text nodes in <p>
        // @param keepRange  : leave selection range as it is
        semanticCode: function (force, full, keepRange) {
            var t = this;
            t.saveRange();
            t.syncCode(force);

            if (t.o.semantic) {
                t.semanticTag('b', 'strong');
                t.semanticTag('i', 'em');
                t.semanticTag('strike', 'del');

                if (full) {
                    var inlineElementsSelector = t.o.inlineElementsSelector,
                        blockElementsSelector = ':not(' + inlineElementsSelector + ')';

                    // Wrap text nodes in span for easier processing
                    t.$ed.contents().filter(function () {
                        return this.nodeType === 3 && this.nodeValue.trim().length > 0;
                    }).wrap('<span data-tbw/>');

                    // Wrap groups of inline elements in paragraphs (recursive)
                    var wrapInlinesInParagraphsFrom = function ($from) {
                        if ($from.length !== 0) {
                            var $finalParagraph = $from.nextUntil(blockElementsSelector).addBack().wrapAll('<p/>').parent(),
                                $nextElement = $finalParagraph.nextAll(inlineElementsSelector).first();
                            $finalParagraph.next('br').remove();
                            wrapInlinesInParagraphsFrom($nextElement);
                        }
                    };
                    wrapInlinesInParagraphsFrom(t.$ed.children(inlineElementsSelector).first());

                    t.semanticTag('div', 'p', true);

                    // Unwrap paragraphs content, containing nothing usefull
                    t.$ed.find('p').filter(function () {
                        // Don't remove currently being edited element
                        if (t.range && this === t.range.startContainer) {
                            return false;
                        }
                        return $(this).text().trim().length === 0 && $(this).children().not('br,span').length === 0;
                    }).contents().unwrap();

                    // Get rid of temporial span's
                    $('[data-tbw]', t.$ed).contents().unwrap();

                    // Remove empty <p>
                    t.$ed.find('p:empty').remove();
                }

                if (!keepRange) {
                    t.restoreRange();
                }

                t.syncTextarea();
            }
        },

        semanticTag: function (oldTag, newTag, copyAttributes) {
            $(oldTag, this.$ed).each(function () {
                var $oldTag = $(this);
                $oldTag.wrap('<' + newTag + '/>');
                if (copyAttributes) {
                    $.each($oldTag.prop('attributes'), function () {
                        $oldTag.parent().attr(this.name, this.value);
                    });
                }
                $oldTag.contents().unwrap();
            });
        },

        // Function call when user click on "Insert Link"
        createLink: function () {
            var t = this,
                documentSelection = t.doc.getSelection(),
                node = documentSelection.focusNode,
                url,
                title,
                target;

            while (['A', 'DIV'].indexOf(node.nodeName) < 0) {
                node = node.parentNode;
            }

            if (node && node.nodeName === 'A') {
                var $a = $(node);
                url = $a.attr('href');
                title = $a.attr('title');
                target = $a.attr('target');
                var range = t.doc.createRange();
                range.selectNode(node);
                documentSelection.removeAllRanges();
                documentSelection.addRange(range);
            }

            t.saveRange();

            t.openModalInsert(t.lang.createLink, {
                url: {
                    label: 'URL',
                    required: true,
                    value: url
                },
                title: {
                    label: t.lang.title,
                    value: title
                },
                text: {
                    label: t.lang.text,
                    value: t.getRangeText()
                },
                target: {
                    label: t.lang.target,
                    value: target
                }
            }, function (v) { // v is value
                var link = $(['<a href="', v.url, '">', v.text, '</a>'].join(''));
                if (v.title.length > 0) {
                    link.attr('title', v.title);
                }
                if (v.target.length > 0) {
                    link.attr('target', v.target);
                }
                t.range.deleteContents();
                t.range.insertNode(link[0]);
                return true;
            });
        },
        unlink: function () {
            var t = this,
                documentSelection = t.doc.getSelection(),
                node = documentSelection.focusNode;

            if (documentSelection.isCollapsed) {
                while (['A', 'DIV'].indexOf(node.nodeName) < 0) {
                    node = node.parentNode;
                }

                if (node && node.nodeName === 'A') {
                    var range = t.doc.createRange();
                    range.selectNode(node);
                    documentSelection.removeAllRanges();
                    documentSelection.addRange(range);
                }
            }
            t.execCmd('unlink', undefined, undefined, true);
        },
        insertImage: function () {
            var t = this;
            t.saveRange();
            t.openModalInsert(t.lang.insertImage, {
                url: {
                    label: 'URL',
                    required: true
                },
                alt: {
                    label: t.lang.description,
                    value: t.getRangeText()
                }
            }, function (v) { // v are values
                t.execCmd('insertImage', v.url);
                $('img[src="' + v.url + '"]:not([alt])', t.$box).attr('alt', v.alt);
                return true;
            });
        },
        fullscreen: function () {
            var t = this,
                prefix = t.o.prefix,
                fullscreenCssClass = prefix + 'fullscreen',
                isFullscreen;

            t.$box.toggleClass(fullscreenCssClass);
            isFullscreen = t.$box.hasClass(fullscreenCssClass);
            $('body').toggleClass(prefix + 'body-fullscreen', isFullscreen);
            $(window).trigger('scroll');
            t.$c.trigger('tbw' + (isFullscreen ? 'open' : 'close') + 'fullscreen');
        },


        /*
         * Call method of trumbowyg if exist
         * else try to call anonymous function
         * and finaly native execCommand
         */
        execCmd: function (cmd, param, forceCss, skipTrumbowyg) {
            var t = this;
            skipTrumbowyg = !!skipTrumbowyg || '';

            if (cmd !== 'dropdown') {
                t.$ed.focus();
            }

            try {
                t.doc.execCommand('styleWithCSS', false, forceCss || false);
            } catch (c) {
            }

            try {
                t[cmd + skipTrumbowyg](param);
            } catch (c) {
                try {
                    cmd(param);
                } catch (e2) {
                    if (cmd === 'insertHorizontalRule') {
                        param = undefined;
                    } else if (cmd === 'formatBlock' && t.isIE) {
                        param = '<' + param + '>';
                    }

                    t.doc.execCommand(cmd, false, param);

                    t.syncCode();
                    t.semanticCode(false, true);
                }

                if (cmd !== 'dropdown') {
                    t.updateButtonPaneStatus();
                    t.$c.trigger('tbwchange');
                }
            }
        },


        // Open a modal box
        openModal: function (title, content) {
            var t = this,
                prefix = t.o.prefix;

            // No open a modal box when exist other modal box
            if ($('.' + prefix + 'modal-box', t.$box).length > 0) {
                return false;
            }
            if (t.o.autogrowOnEnter) {
                t.autogrowOnEnterDontClose = true;
            }

            t.saveRange();
            t.showOverlay();

            // Disable all btnPane btns
            t.$btnPane.addClass(prefix + 'disable');

            // Build out of ModalBox, it's the mask for animations
            var $modal = $('<div/>', {
                class: prefix + 'modal ' + prefix + 'fixed-top'
            }).css({
                top: t.$btnPane.height()
            }).appendTo(t.$box);

            // Click on overlay close modal by cancelling them
            t.$overlay.one('click', function () {
                $modal.trigger(CANCEL_EVENT);
                return false;
            });

            // Build the form
            var $form = $('<form/>', {
                action: '',
                html: content
            })
                .on('submit', function () {
                    $modal.trigger(CONFIRM_EVENT);
                    return false;
                })
                .on('reset', function () {
                    $modal.trigger(CANCEL_EVENT);
                    return false;
                })
                .on('submit reset', function () {
                    if (t.o.autogrowOnEnter) {
                        t.autogrowOnEnterDontClose = false;
                    }
                });


            // Build ModalBox and animate to show them
            var $box = $('<div/>', {
                class: prefix + 'modal-box',
                html: $form
            })
                .css({
                    top: '-' + t.$btnPane.outerHeight() + 'px',
                    opacity: 0
                })
                .appendTo($modal)
                .animate({
                    top: 0,
                    opacity: 1
                }, 100);


            // Append title
            $('<span/>', {
                text: title,
                class: prefix + 'modal-title'
            }).prependTo($box);

            $modal.height($box.outerHeight() + 10);


            // Focus in modal box
            $('input:first', $box).focus();


            // Append Confirm and Cancel buttons
            t.buildModalBtn('submit', $box);
            t.buildModalBtn('reset', $box);


            $(window).trigger('scroll');

            return $modal;
        },
        // @param n is name of modal
        buildModalBtn: function (n, $modal) {
            var t = this,
                prefix = t.o.prefix;

            return $('<button/>', {
                class: prefix + 'modal-button ' + prefix + 'modal-' + n,
                type: n,
                text: t.lang[n] || n
            }).appendTo($('form', $modal));
        },
        // close current modal box
        closeModal: function () {
            var t = this,
                prefix = t.o.prefix;

            t.$btnPane.removeClass(prefix + 'disable');
            t.$overlay.off();

            // Find the modal box
            var $modalBox = $('.' + prefix + 'modal-box', t.$box);

            $modalBox.animate({
                top: '-' + $modalBox.height()
            }, 100, function () {
                $modalBox.parent().remove();
                t.hideOverlay();
            });

            t.restoreRange();
        },
        // Preformated build and management modal
        openModalInsert: function (title, fields, cmd) {
            var t = this,
                prefix = t.o.prefix,
                lg = t.lang,
                html = '';

            $.each(fields, function (fieldName, field) {
                var l = field.label,
                    n = field.name || fieldName,
                    a = field.attributes || {};

                var attr = Object.keys(a).map(function (prop) {
                    return prop + '="' + a[prop] + '"';
                }).join(' ');

                html += '<label><input type="' + (field.type || 'text') + '" name="' + n + '" value="' + (field.value || '').replace(/"/g, '&quot;') + '"' + attr + '><span class="' + prefix + 'input-infos"><span>' +
                    ((!l) ? (lg[fieldName] ? lg[fieldName] : fieldName) : (lg[l] ? lg[l] : l)) +
                    '</span></span></label>';
            });

            return t.openModal(title, html)
                .on(CONFIRM_EVENT, function () {
                    var $form = $('form', $(this)),
                        valid = true,
                        values = {};

                    $.each(fields, function (fieldName, field) {
                        var $field = $('input[name="' + fieldName + '"]', $form),
                            inputType = $field.attr('type');

                        if (inputType.toLowerCase() === 'checkbox') {
                            values[fieldName] = $field.is(':checked');
                        } else {
                            values[fieldName] = $.trim($field.val());
                        }
                        // Validate value
                        if (field.required && values[fieldName] === '') {
                            valid = false;
                            t.addErrorOnModalField($field, t.lang.required);
                        } else if (field.pattern && !field.pattern.test(values[fieldName])) {
                            valid = false;
                            t.addErrorOnModalField($field, field.patternError);
                        }
                    });

                    if (valid) {
                        t.restoreRange();

                        if (cmd(values, fields)) {
                            t.syncCode();
                            t.$c.trigger('tbwchange');
                            t.closeModal();
                            $(this).off(CONFIRM_EVENT);
                        }
                    }
                })
                .one(CANCEL_EVENT, function () {
                    $(this).off(CONFIRM_EVENT);
                    t.closeModal();
                });
        },
        addErrorOnModalField: function ($field, err) {
            var prefix = this.o.prefix,
                $label = $field.parent();

            $field
                .on('change keyup', function () {
                    $label.removeClass(prefix + 'input-error');
                });

            $label
                .addClass(prefix + 'input-error')
                .find('input+span')
                .append(
                    $('<span/>', {
                        class: prefix + 'msg-error',
                        text: err
                    })
                );
        },

        getDefaultImgDblClickHandler: function () {
            var t = this;

            return function () {
                var $img = $(this),
                    src = $img.attr('src'),
                    base64 = '(Base64)';

                if (src.indexOf('data:image') === 0) {
                    src = base64;
                }

                t.openModalInsert(t.lang.insertImage, {
                    url: {
                        label: 'URL',
                        value: src,
                        required: true
                    },
                    alt: {
                        label: t.lang.description,
                        value: $img.attr('alt')
                    }
                }, function (v) {
                    if (v.src !== base64) {
                        $img.attr({
                            src: v.src
                        });
                    }
                    $img.attr({
                        alt: v.alt
                    });
                    return true;
                });
                return false;
            };
        },

        // Range management
        saveRange: function () {
            var t = this,
                documentSelection = t.doc.getSelection();

            t.range = null;

            if (documentSelection.rangeCount) {
                var savedRange = t.range = documentSelection.getRangeAt(0),
                    range = t.doc.createRange(),
                    rangeStart;
                range.selectNodeContents(t.$ed[0]);
                range.setEnd(savedRange.startContainer, savedRange.startOffset);
                rangeStart = (range + '').length;
                t.metaRange = {
                    start: rangeStart,
                    end: rangeStart + (savedRange + '').length
                };
            }
        },
        restoreRange: function () {
            var t = this,
                metaRange = t.metaRange,
                savedRange = t.range,
                documentSelection = t.doc.getSelection(),
                range;

            if (!savedRange) {
                return;
            }

            if (metaRange && metaRange.start !== metaRange.end) { // Algorithm from http://jsfiddle.net/WeWy7/3/
                var charIndex = 0,
                    nodeStack = [t.$ed[0]],
                    node,
                    foundStart = false,
                    stop = false;

                range = t.doc.createRange();

                while (!stop && (node = nodeStack.pop())) {
                    if (node.nodeType === 3) {
                        var nextCharIndex = charIndex + node.length;
                        if (!foundStart && metaRange.start >= charIndex && metaRange.start <= nextCharIndex) {
                            range.setStart(node, metaRange.start - charIndex);
                            foundStart = true;
                        }
                        if (foundStart && metaRange.end >= charIndex && metaRange.end <= nextCharIndex) {
                            range.setEnd(node, metaRange.end - charIndex);
                            stop = true;
                        }
                        charIndex = nextCharIndex;
                    } else {
                        var cn = node.childNodes,
                            i = cn.length;

                        while (i > 0) {
                            i -= 1;
                            nodeStack.push(cn[i]);
                        }
                    }
                }
            }

            documentSelection.removeAllRanges();
            documentSelection.addRange(range || savedRange);
        },
        getRangeText: function () {
            return this.range + '';
        },

        updateButtonPaneStatus: function () {
            var t = this,
                prefix = t.o.prefix,
                tags = t.getTagsRecursive(t.doc.getSelection().focusNode),
                activeClasses = prefix + 'active-button ' + prefix + 'active';

            $('.' + prefix + 'active-button', t.$btnPane).removeClass(activeClasses);
            $.each(tags, function (i, tag) {
                var btnName = t.tagToButton[tag.toLowerCase()],
                    $btn = $('.' + prefix + btnName + '-button', t.$btnPane);

                if ($btn.length > 0) {
                    $btn.addClass(activeClasses);
                } else {
                    try {
                        $btn = $('.' + prefix + 'dropdown .' + prefix + btnName + '-dropdown-button', t.$box);
                        var dropdownBtnName = $btn.parent().data('dropdown');
                        $('.' + prefix + dropdownBtnName + '-button', t.$box).addClass(activeClasses);
                    } catch (e) {
                    }
                }
            });
        },
        getTagsRecursive: function (element, tags) {
            var t = this;
            tags = tags || (element && element.tagName ? [element.tagName] : []);

            if (element && element.parentNode) {
                element = element.parentNode;
            } else {
                return tags;
            }

            var tag = element.tagName;
            if (tag === 'DIV') {
                return tags;
            }
            if (tag === 'P' && element.style.textAlign !== '') {
                tags.push(element.style.textAlign);
            }

            $.each(t.tagHandlers, function (i, tagHandler) {
                tags = tags.concat(tagHandler(element, t));
            });

            tags.push(tag);

            return t.getTagsRecursive(element, tags).filter(function(tag) { return tag != null; });
        },

        // Plugins
        initPlugins: function () {
            var t = this;
            t.loadedPlugins = [];
            $.each($.trumbowyg.plugins, function (name, plugin) {
                if (!plugin.shouldInit || plugin.shouldInit(t)) {
                    plugin.init(t);
                    if (plugin.tagHandler) {
                        t.tagHandlers.push(plugin.tagHandler);
                    }
                    t.loadedPlugins.push(plugin);
                }
            });
        },
        destroyPlugins: function () {
            $.each(this.loadedPlugins, function (i, plugin) {
                if (plugin.destroy) {
                    plugin.destroy();
                }
            });
        }
    };
})(navigator, window, document, jQuery);

/* ===========================================================
 * trumbowyg.base64.js v1.0
 * Base64 plugin for Trumbowyg
 * http://alex-d.github.com/Trumbowyg
 * ===========================================================
 * Author : Cyril Biencourt (lizardK)
 */

(function ($) {
    'use strict';

    var isSupported = function () {
        return typeof FileReader !== 'undefined';
    };

    var isValidImage = function (type) {
        return /^data:image\/[a-z]?/i.test(type);
    };

    $.extend(true, $.trumbowyg, {
        langs: {
            // jshint camelcase:false
            en: {
                base64: 'Image as base64',
                file: 'File',
                errFileReaderNotSupported: 'FileReader is not supported by your browser.',
                errInvalidImage: 'Invalid image file.'
            },
            fr: {
                base64: 'Image en base64',
                file: 'Fichier'
            },
            cs: {
                base64: 'Vložit obrázek',
                file: 'Soubor'
            },
            zh_cn: {
                base64: '图片（Base64编码）',
                file: '文件'
            },
            nl: {
                errFileReaderNotSupported: 'Uw browser ondersteunt deze functionaliteit niet.',
                errInvalidImage: 'De gekozen afbeelding is ongeldig.'
            },
            ru: {
                base64: 'Изображение как код в base64',
                file: 'Файл',
                errFileReaderNotSupported: 'FileReader не поддерживается вашим браузером.',
                errInvalidImage: 'Недопустимый файл изображения.'
            },
            ja: {
                base64: '画像 (Base64形式)',
                file: 'ファイル',
                errFileReaderNotSupported: 'あなたのブラウザーはFileReaderをサポートしていません',
                errInvalidImage: '画像形式が正しくありません'
            }
        },
        // jshint camelcase:true

        plugins: {
            base64: {
                shouldInit: isSupported,
                init: function (trumbowyg) {
                    var btnDef = {
                        isSupported: isSupported,
                        fn: function () {
                            trumbowyg.saveRange();

                            var file;
                            var $modal = trumbowyg.openModalInsert(
                                // Title
                                trumbowyg.lang.base64,

                                // Fields
                                {
                                    file: {
                                        type: 'file',
                                        required: true,
                                        attributes: {
                                            accept: 'image/*'
                                        }
                                    },
                                    alt: {
                                        label: 'description',
                                        value: trumbowyg.getRangeText()
                                    }
                                },

                                // Callback
                                function (values) {
                                    var fReader = new FileReader();

                                    fReader.onloadend = function (e) {
                                        if (isValidImage(e.target.result)) {
                                            trumbowyg.execCmd('insertImage', fReader.result);
                                            $(['img[src="', fReader.result, '"]:not([alt])'].join(''), trumbowyg.$box).attr('alt', values.alt);
                                            trumbowyg.closeModal();
                                        } else {
                                            trumbowyg.addErrorOnModalField(
                                                $('input[type=file]', $modal),
                                                trumbowyg.lang.errInvalidImage
                                            );
                                        }
                                    };

                                    fReader.readAsDataURL(file);
                                }
                            );

                            $('input[type=file]').on('change', function (e) {
                                file = e.target.files[0];
                            });
                        }
                    };

                    trumbowyg.addBtnDef('base64', btnDef);
                }
            }
        }
    });
})(jQuery);

/* ===========================================================
 * trumbowyg.colors.js v1.2
 * Colors picker plugin for Trumbowyg
 * http://alex-d.github.com/Trumbowyg
 * ===========================================================
 * Author : Alexandre Demode (Alex-D)
 *          Twitter : @AlexandreDemode
 *          Website : alex-d.fr
 */

(function ($) {
    'use strict';

    $.extend(true, $.trumbowyg, {
        langs: {
            // jshint camelcase:false
            cs: {
                foreColor: 'Barva textu',
                backColor: 'Barva pozadí'
            },
            en: {
                foreColor: 'Text color',
                backColor: 'Background color'
            },
            fr: {
                foreColor: 'Couleur du texte',
                backColor: 'Couleur de fond'
            },
            sk: {
                foreColor: 'Farba textu',
                backColor: 'Farba pozadia'
            },
            zh_cn: {
                foreColor: '文字颜色',
                backColor: '背景颜色'
            },
            ru: {
                foreColor: 'Цвет текста',
                backColor: 'Цвет выделения текста'
            },
            ja: {
                foreColor: '文字色',
                backColor: '背景色'
            }
        }
    });
    // jshint camelcase:true


    function hex(x) {
        return ('0' + parseInt(x).toString(16)).slice(-2);
    }

    function colorToHex(rgb) {
        if (rgb.search('rgb') === -1) {
            return rgb.replace('#', '');
        } else if (rgb === 'rgba(0, 0, 0, 0)') {
            return 'transparent';
        } else {
            rgb = rgb.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/);
            return hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]);
        }
    }

    function colorTagHandler(element, trumbowyg) {
        var tags = [];

        if(!element.style){
            return tags;
        }

        // background color
        if (element.style.backgroundColor !== '') {
            var backColor = colorToHex(element.style.backgroundColor);
            if (trumbowyg.o.plugins.colors.colorList.indexOf(backColor) >= 0) {
                tags.push('backColor' + backColor);
            } else {
                tags.push('backColorFree');
            }
        }

        // text color
        var foreColor;
        if (element.style.color !== '') {
            foreColor = colorToHex(element.style.color);
        } else if (element.hasAttribute('color')) {
            foreColor = colorToHex(element.getAttribute('color'));
        }
        if (foreColor) {
            if (trumbowyg.o.plugins.colors.colorList.indexOf(foreColor) >= 0) {
                tags.push('foreColor' + foreColor);
            } else {
                tags.push('foreColorFree');
            }
        }

        return tags;
    }

    var defaultOptions = {
        colorList: ['ffffff', '000000', 'eeece1', '1f497d', '4f81bd', 'c0504d', '9bbb59', '8064a2', '4bacc6', 'f79646', 'ffff00', 'f2f2f2', '7f7f7f', 'ddd9c3', 'c6d9f0', 'dbe5f1', 'f2dcdb', 'ebf1dd', 'e5e0ec', 'dbeef3', 'fdeada', 'fff2ca', 'd8d8d8', '595959', 'c4bd97', '8db3e2', 'b8cce4', 'e5b9b7', 'd7e3bc', 'ccc1d9', 'b7dde8', 'fbd5b5', 'ffe694', 'bfbfbf', '3f3f3f', '938953', '548dd4', '95b3d7', 'd99694', 'c3d69b', 'b2a2c7', 'b7dde8', 'fac08f', 'f2c314', 'a5a5a5', '262626', '494429', '17365d', '366092', '953734', '76923c', '5f497a', '92cddc', 'e36c09', 'c09100', '7f7f7f', '0c0c0c', '1d1b10', '0f243e', '244061', '632423', '4f6128', '3f3151', '31859b', '974806', '7f6000']
    };

    // Add all colors in two dropdowns
    $.extend(true, $.trumbowyg, {
        plugins: {
            color: {
                init: function (trumbowyg) {
                    trumbowyg.o.plugins.colors = trumbowyg.o.plugins.colors || defaultOptions;
                    var foreColorBtnDef = {
                            dropdown: buildDropdown('foreColor', trumbowyg)
                        },
                        backColorBtnDef = {
                            dropdown: buildDropdown('backColor', trumbowyg)
                        };

                    trumbowyg.addBtnDef('foreColor', foreColorBtnDef);
                    trumbowyg.addBtnDef('backColor', backColorBtnDef);
                },
                tagHandler: colorTagHandler
            }
        }
    });

    function buildDropdown(fn, trumbowyg) {
        var dropdown = [];

        $.each(trumbowyg.o.plugins.colors.colorList, function (i, color) {
            var btn = fn + color,
                btnDef = {
                    fn: fn,
                    forceCss: true,
                    param: '#' + color,
                    style: 'background-color: #' + color + ';'
                };
            trumbowyg.addBtnDef(btn, btnDef);
            dropdown.push(btn);
        });

        var removeColorButtonName = fn + 'Remove',
            removeColorBtnDef = {
                fn: 'removeFormat',
                param: fn,
                style: 'background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAG0lEQVQIW2NkQAAfEJMRmwBYhoGBYQtMBYoAADziAp0jtJTgAAAAAElFTkSuQmCC);'
            };
        trumbowyg.addBtnDef(removeColorButtonName, removeColorBtnDef);
        dropdown.push(removeColorButtonName);

        // add free color btn
        var freeColorButtonName = fn + 'Free',
            freeColorBtnDef = {
                fn: function () {
                    trumbowyg.openModalInsert(trumbowyg.lang[fn],
                        {
                            color: {
                                label: fn,
                                value: '#FFFFFF'
                            }
                        },
                        // callback
                        function (values) {
                            trumbowyg.execCmd(fn, values.color);
                            return true;
                        }
                    );
                },
                text: '#',
                // style adjust for displaying the text
                style: 'text-indent: 0;line-height: 20px;padding: 0 5px;'
            };
        trumbowyg.addBtnDef(freeColorButtonName, freeColorBtnDef);
        dropdown.push(freeColorButtonName);

        return dropdown;
    }
})(jQuery);

/* ===========================================================
 * trumbowyg.noembed.js v1.0
 * noEmbed plugin for Trumbowyg
 * http://alex-d.github.com/Trumbowyg
 * ===========================================================
 * Author : Jake Johns (jakejohns)
 */

(function ($) {
    'use strict';

    var defaultOptions = {
        proxy: 'https://noembed.com/embed?nowrap=on',
        urlFiled: 'url',
        data: [],
        success: undefined,
        error: undefined
    };

    $.extend(true, $.trumbowyg, {
        langs: {
            en: {
                noembed: 'Noembed',
                noembedError: 'Error'
            },
            sk: {
                noembedError: 'Chyba'
            },
            fr: {
                noembedError: 'Erreur'
            },
            cs: {
                noembedError: 'Chyba'
            },
            ru: {
                noembedError: 'Ошибка'
            },
            ja: {
                noembedError: 'エラー'
            }
        },

        plugins: {
            noembed: {
                init: function (trumbowyg) {
                    trumbowyg.o.plugins.noembed = $.extend(true, {}, defaultOptions, trumbowyg.o.plugins.noembed || {});

                    var btnDef = {
                        fn: function () {
                            var $modal = trumbowyg.openModalInsert(
                                // Title
                                trumbowyg.lang.noembed,

                                // Fields
                                {
                                    url: {
                                        label: 'URL',
                                        required: true
                                    }
                                },

                                // Callback
                                function (data) {
                                    $.ajax({
                                        url: trumbowyg.o.plugins.noembed.proxy,
                                        type: 'GET',
                                        data: data,
                                        cache: false,
                                        dataType: 'json',

                                        success: trumbowyg.o.plugins.noembed.success || function (data) {
                                            if (data.html) {
                                                trumbowyg.execCmd('insertHTML', data.html);
                                                setTimeout(function () {
                                                    trumbowyg.closeModal();
                                                }, 250);
                                            } else {
                                                trumbowyg.addErrorOnModalField(
                                                    $('input[type=text]', $modal),
                                                    data.error
                                                );
                                            }
                                        },
                                        error: trumbowyg.o.plugins.noembed.error || function () {
                                            trumbowyg.addErrorOnModalField(
                                                $('input[type=text]', $modal),
                                                trumbowyg.lang.noembedError
                                            );
                                        }
                                    });
                                }
                            );
                        }
                    };

                    trumbowyg.addBtnDef('noembed', btnDef);
                }
            }
        }
    });
})(jQuery);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRydW1ib3d5Zy5qcyIsImJhc2U2NC90cnVtYm93eWcuYmFzZTY0LmpzIiwiY29sb3JzL3RydW1ib3d5Zy5jb2xvcnMuanMiLCJub2VtYmVkL3RydW1ib3d5Zy5ub2VtYmVkLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFwREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6InRydW1ib3d5Zy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBUcnVtYm93eWcgdjIuOC4wXHJcbiAqL1xyXG5qUXVlcnkudHJ1bWJvd3lnID0ge1xuICAgIGxhbmdzOiB7XG4gICAgICAgIGVuOiB7XG4gICAgICAgICAgICB2aWV3SFRNTDogJ1ZpZXcgSFRNTCcsXG5cbiAgICAgICAgICAgIHVuZG86ICdVbmRvJyxcbiAgICAgICAgICAgIHJlZG86ICdSZWRvJyxcblxuICAgICAgICAgICAgZm9ybWF0dGluZzogJ0Zvcm1hdHRpbmcnLFxuICAgICAgICAgICAgcDogJ1BhcmFncmFwaCcsXG4gICAgICAgICAgICBibG9ja3F1b3RlOiAnUXVvdGUnLFxuICAgICAgICAgICAgY29kZTogJ0NvZGUnLFxuICAgICAgICAgICAgaGVhZGVyOiAnSGVhZGVyJyxcblxuICAgICAgICAgICAgYm9sZDogJ0JvbGQnLFxuICAgICAgICAgICAgaXRhbGljOiAnSXRhbGljJyxcbiAgICAgICAgICAgIHN0cmlrZXRocm91Z2g6ICdTdHJva2UnLFxuICAgICAgICAgICAgdW5kZXJsaW5lOiAnVW5kZXJsaW5lJyxcblxuICAgICAgICAgICAgc3Ryb25nOiAnU3Ryb25nJyxcbiAgICAgICAgICAgIGVtOiAnRW1waGFzaXMnLFxuICAgICAgICAgICAgZGVsOiAnRGVsZXRlZCcsXG5cbiAgICAgICAgICAgIHN1cGVyc2NyaXB0OiAnU3VwZXJzY3JpcHQnLFxuICAgICAgICAgICAgc3Vic2NyaXB0OiAnU3Vic2NyaXB0JyxcblxuICAgICAgICAgICAgdW5vcmRlcmVkTGlzdDogJ1Vub3JkZXJlZCBsaXN0JyxcbiAgICAgICAgICAgIG9yZGVyZWRMaXN0OiAnT3JkZXJlZCBsaXN0JyxcblxuICAgICAgICAgICAgaW5zZXJ0SW1hZ2U6ICdJbnNlcnQgSW1hZ2UnLFxuICAgICAgICAgICAgbGluazogJ0xpbmsnLFxuICAgICAgICAgICAgY3JlYXRlTGluazogJ0luc2VydCBsaW5rJyxcbiAgICAgICAgICAgIHVubGluazogJ1JlbW92ZSBsaW5rJyxcblxuICAgICAgICAgICAganVzdGlmeUxlZnQ6ICdBbGlnbiBMZWZ0JyxcbiAgICAgICAgICAgIGp1c3RpZnlDZW50ZXI6ICdBbGlnbiBDZW50ZXInLFxuICAgICAgICAgICAganVzdGlmeVJpZ2h0OiAnQWxpZ24gUmlnaHQnLFxuICAgICAgICAgICAganVzdGlmeUZ1bGw6ICdBbGlnbiBKdXN0aWZ5JyxcblxuICAgICAgICAgICAgaG9yaXpvbnRhbFJ1bGU6ICdJbnNlcnQgaG9yaXpvbnRhbCBydWxlJyxcbiAgICAgICAgICAgIHJlbW92ZWZvcm1hdDogJ1JlbW92ZSBmb3JtYXQnLFxuXG4gICAgICAgICAgICBmdWxsc2NyZWVuOiAnRnVsbHNjcmVlbicsXG5cbiAgICAgICAgICAgIGNsb3NlOiAnQ2xvc2UnLFxuXG4gICAgICAgICAgICBzdWJtaXQ6ICdDb25maXJtJyxcbiAgICAgICAgICAgIHJlc2V0OiAnQ2FuY2VsJyxcblxuICAgICAgICAgICAgcmVxdWlyZWQ6ICdSZXF1aXJlZCcsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0Rlc2NyaXB0aW9uJyxcbiAgICAgICAgICAgIHRpdGxlOiAnVGl0bGUnLFxuICAgICAgICAgICAgdGV4dDogJ1RleHQnLFxuICAgICAgICAgICAgdGFyZ2V0OiAnVGFyZ2V0J1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8vIFBsdWdpbnNcbiAgICBwbHVnaW5zOiB7fSxcblxuICAgIC8vIFNWRyBQYXRoIGdsb2JhbGx5XG4gICAgc3ZnUGF0aDogbnVsbCxcblxuICAgIGhpZGVCdXR0b25UZXh0czogbnVsbFxufTtcblxuLy8gTWFrZXMgZGVmYXVsdCBvcHRpb25zIHJlYWQtb25seVxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGpRdWVyeS50cnVtYm93eWcsICdkZWZhdWx0T3B0aW9ucycsIHtcbiAgICB2YWx1ZToge1xuICAgICAgICBsYW5nOiAnZW4nLFxuXG4gICAgICAgIGZpeGVkQnRuUGFuZTogZmFsc2UsXG4gICAgICAgIGZpeGVkRnVsbFdpZHRoOiBmYWxzZSxcbiAgICAgICAgYXV0b2dyb3c6IGZhbHNlLFxuICAgICAgICBhdXRvZ3Jvd09uRW50ZXI6IGZhbHNlLFxuXG4gICAgICAgIHByZWZpeDogJ3RydW1ib3d5Zy0nLFxuXG4gICAgICAgIHNlbWFudGljOiB0cnVlLFxuICAgICAgICByZXNldENzczogZmFsc2UsXG4gICAgICAgIHJlbW92ZWZvcm1hdFBhc3RlZDogZmFsc2UsXG4gICAgICAgIHRhZ3NUb1JlbW92ZTogW10sXG4gICAgICAgIGJ0bnM6IFtcbiAgICAgICAgICAgIFsndmlld0hUTUwnXSxcbiAgICAgICAgICAgIFsndW5kbycsICdyZWRvJ10sIC8vIE9ubHkgc3VwcG9ydGVkIGluIEJsaW5rIGJyb3dzZXJzXG4gICAgICAgICAgICBbJ2Zvcm1hdHRpbmcnXSxcbiAgICAgICAgICAgIFsnc3Ryb25nJywgJ2VtJywgJ2RlbCddLFxyXG4gICAgICAgICAgICBbJ2ZvcmVDb2xvcicsICdiYWNrQ29sb3InXSxcbiAgICAgICAgICAgIFsnc3VwZXJzY3JpcHQnLCAnc3Vic2NyaXB0J10sXG4gICAgICAgICAgICBbJ2xpbmsnXSwgICAgICAgICAgICBcclxuICAgICAgICAgICAgWydpbWFnZSddLFxyXG4gICAgICAgICAgICBbJ2FsaWduJ10sXG4gICAgICAgICAgICBbJ3Vub3JkZXJlZExpc3QnLCAnb3JkZXJlZExpc3QnXSxcbiAgICAgICAgICAgIFsnaG9yaXpvbnRhbFJ1bGUnXSxcbiAgICAgICAgICAgIFsncmVtb3ZlZm9ybWF0J10sXG4gICAgICAgICAgICBbJ2Z1bGxzY3JlZW4nXVxuICAgICAgICBdLFxuICAgICAgICAvLyBGb3IgY3VzdG9tIGJ1dHRvbiBkZWZpbml0aW9uc1xuICAgICAgICBidG5zRGVmOiB7XHJcbiAgICAgICAgICAgICAgICBhbGlnbjoge1xyXG4gICAgICAgICAgICAgICAgICAgIGRyb3Bkb3duOiBbJ2p1c3RpZnlMZWZ0JywgJ2p1c3RpZnlDZW50ZXInLCAnanVzdGlmeVJpZ2h0JywgJ2p1c3RpZnlGdWxsJ10sXHJcbiAgICAgICAgICAgICAgICAgICAgaWNvOiAnanVzdGlmeUxlZnQnXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgaW1hZ2U6IHtcclxuICAgICAgICAgICAgICAgICAgICBkcm9wZG93bjogWydpbnNlcnRJbWFnZScsICdiYXNlNjQnLCAnbm9lbWJlZCddLFxyXG4gICAgICAgICAgICAgICAgICAgIGljbzogJ2luc2VydEltYWdlJ1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5saW5lRWxlbWVudHNTZWxlY3RvcjogJ2EsYWJicixhY3JvbnltLGIsY2FwdGlvbixjaXRlLGNvZGUsY29sLGRmbixkaXIsZHQsZGQsZW0sZm9udCxocixpLGtiZCxsaSxxLHNwYW4sc3RyaWtlb3V0LHN0cm9uZyxzdWIsc3VwLHUnLFxuXG4gICAgICAgIHBhc3RlSGFuZGxlcnM6IFtdLFxuXG4gICAgICAgIC8vIGltZ0RibENsaWNrSGFuZGxlcjogZGVmYXVsdCBpcyBkZWZpbmVkIGluIGNvbnN0cnVjdG9yXG5cbiAgICAgICAgcGx1Z2luczoge31cbiAgICB9LFxuICAgIHdyaXRhYmxlOiBmYWxzZSxcbiAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgIGNvbmZpZ3VyYWJsZTogZmFsc2Vcbn0pO1xuXG5cbihmdW5jdGlvbiAobmF2aWdhdG9yLCB3aW5kb3csIGRvY3VtZW50LCAkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIENPTkZJUk1fRVZFTlQgPSAndGJ3Y29uZmlybScsXG4gICAgICAgIENBTkNFTF9FVkVOVCA9ICd0YndjYW5jZWwnO1xuXG4gICAgJC5mbi50cnVtYm93eWcgPSBmdW5jdGlvbiAob3B0aW9ucywgcGFyYW1zKSB7XG4gICAgICAgIHZhciB0cnVtYm93eWdEYXRhTmFtZSA9ICd0cnVtYm93eWcnO1xuICAgICAgICBpZiAob3B0aW9ucyA9PT0gT2JqZWN0KG9wdGlvbnMpIHx8ICFvcHRpb25zKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoISQodGhpcykuZGF0YSh0cnVtYm93eWdEYXRhTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5kYXRhKHRydW1ib3d5Z0RhdGFOYW1lLCBuZXcgVHJ1bWJvd3lnKHRoaXMsIG9wdGlvbnMpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdmFyIHQgPSAkKHRoaXMpLmRhdGEodHJ1bWJvd3lnRGF0YU5hbWUpO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAob3B0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICAvLyBFeGVjIGNvbW1hbmRcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZXhlY0NtZCc6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5leGVjQ21kKHBhcmFtcy5jbWQsIHBhcmFtcy5wYXJhbSwgcGFyYW1zLmZvcmNlQ3NzKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBNb2RhbCBib3hcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnb3Blbk1vZGFsJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0Lm9wZW5Nb2RhbChwYXJhbXMudGl0bGUsIHBhcmFtcy5jb250ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnY2xvc2VNb2RhbCc6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5jbG9zZU1vZGFsKCk7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ29wZW5Nb2RhbEluc2VydCc6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5vcGVuTW9kYWxJbnNlcnQocGFyYW1zLnRpdGxlLCBwYXJhbXMuZmllbGRzLCBwYXJhbXMuY2FsbGJhY2spO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFJhbmdlXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3NhdmVSYW5nZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5zYXZlUmFuZ2UoKTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZ2V0UmFuZ2UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQucmFuZ2U7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2dldFJhbmdlVGV4dCc6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5nZXRSYW5nZVRleHQoKTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncmVzdG9yZVJhbmdlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0LnJlc3RvcmVSYW5nZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEVuYWJsZS9kaXNhYmxlXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2VuYWJsZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5zZXREaXNhYmxlZChmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Rpc2FibGUnOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuc2V0RGlzYWJsZWQodHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gRGVzdHJveVxuICAgICAgICAgICAgICAgICAgICBjYXNlICdkZXN0cm95JzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmRlc3Ryb3koKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBFbXB0eVxuICAgICAgICAgICAgICAgICAgICBjYXNlICdlbXB0eSc6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5lbXB0eSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEhUTUxcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnaHRtbCc6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5odG1sKHBhcmFtcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBjYXRjaCAoYykge1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbiAgICAvLyBAcGFyYW06IGVkaXRvckVsZW0gaXMgdGhlIERPTSBlbGVtZW50XG4gICAgdmFyIFRydW1ib3d5ZyA9IGZ1bmN0aW9uIChlZGl0b3JFbGVtLCBvcHRpb25zKSB7XG4gICAgICAgIHZhciB0ID0gdGhpcyxcbiAgICAgICAgICAgIHRydW1ib3d5Z0ljb25zSWQgPSAndHJ1bWJvd3lnLWljb25zJyxcbiAgICAgICAgICAgICR0cnVtYm93eWcgPSAkLnRydW1ib3d5ZztcblxuICAgICAgICAvLyBHZXQgdGhlIGRvY3VtZW50IG9mIHRoZSBlbGVtZW50LiBJdCB1c2UgdG8gbWFrZXMgdGhlIHBsdWdpblxuICAgICAgICAvLyBjb21wYXRpYmxlIG9uIGlmcmFtZXMuXG4gICAgICAgIHQuZG9jID0gZWRpdG9yRWxlbS5vd25lckRvY3VtZW50IHx8IGRvY3VtZW50O1xuXG4gICAgICAgIC8vIGpRdWVyeSBvYmplY3Qgb2YgdGhlIGVkaXRvclxuICAgICAgICB0LiR0YSA9ICQoZWRpdG9yRWxlbSk7IC8vICR0YSA6IFRleHRhcmVhXG4gICAgICAgIHQuJGMgPSAkKGVkaXRvckVsZW0pOyAvLyAkYyA6IGNyZWF0b3JcblxuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgICAgICAvLyBMb2NhbGl6YXRpb24gbWFuYWdlbWVudFxuICAgICAgICBpZiAob3B0aW9ucy5sYW5nICE9IG51bGwgfHwgJHRydW1ib3d5Zy5sYW5nc1tvcHRpb25zLmxhbmddICE9IG51bGwpIHtcbiAgICAgICAgICAgIHQubGFuZyA9ICQuZXh0ZW5kKHRydWUsIHt9LCAkdHJ1bWJvd3lnLmxhbmdzLmVuLCAkdHJ1bWJvd3lnLmxhbmdzW29wdGlvbnMubGFuZ10pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdC5sYW5nID0gJHRydW1ib3d5Zy5sYW5ncy5lbjtcbiAgICAgICAgfVxuXG4gICAgICAgIHQuaGlkZUJ1dHRvblRleHRzID0gJHRydW1ib3d5Zy5oaWRlQnV0dG9uVGV4dHMgIT0gbnVsbCA/ICR0cnVtYm93eWcuaGlkZUJ1dHRvblRleHRzIDogb3B0aW9ucy5oaWRlQnV0dG9uVGV4dHM7XG5cbiAgICAgICAgLy8gU1ZHIHBhdGhcbiAgICAgICAgdmFyIHN2Z1BhdGhPcHRpb24gPSAkdHJ1bWJvd3lnLnN2Z1BhdGggIT0gbnVsbCA/ICR0cnVtYm93eWcuc3ZnUGF0aCA6IG9wdGlvbnMuc3ZnUGF0aDtcbiAgICAgICAgdC5oYXNTdmcgPSBzdmdQYXRoT3B0aW9uICE9PSBmYWxzZTtcbiAgICAgICAgdC5zdmdQYXRoID0gISF0LmRvYy5xdWVyeVNlbGVjdG9yKCdiYXNlJykgPyB3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCgnIycpWzBdIDogJyc7XG4gICAgICAgIGlmICgkKCcjJyArIHRydW1ib3d5Z0ljb25zSWQsIHQuZG9jKS5sZW5ndGggPT09IDAgJiYgc3ZnUGF0aE9wdGlvbiAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGlmIChzdmdQYXRoT3B0aW9uID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAvLyBIYWNrIHRvIGdldCBzdmdQYXRoT3B0aW9uIGJhc2VkIG9uIHRydW1ib3d5Zy5qcyBwYXRoXG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWUuaGFzT3duUHJvcGVydHkoJ3N0YWNrJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignWW91IG11c3QgZGVmaW5lIHN2Z1BhdGg6IGh0dHBzOi8vZ29vLmdsL0NmVFk5VScpOyAvLyBqc2hpbnQgaWdub3JlOmxpbmVcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGFja0xpbmVzID0gZS5zdGFjay5zcGxpdCgnXFxuJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gc3RhY2tMaW5lcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3RhY2tMaW5lc1tpXS5tYXRjaCgvaHR0cHM/OlxcL1xcLy8pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdmdQYXRoT3B0aW9uID0gc3RhY2tMaW5lc1tOdW1iZXIoaSldLm1hdGNoKC8oKGh0dHBzPzpcXC9cXC8uK1xcLykoW15cXC9dK1xcLmpzKSkoXFw/LiopPzovKVsxXS5zcGxpdCgnLycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN2Z1BhdGhPcHRpb24ucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ZnUGF0aE9wdGlvbiA9IHN2Z1BhdGhPcHRpb24uam9pbignLycpICsgJy91aS9pY29ucy5zdmcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgZGl2ID0gdC5kb2MuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBkaXYuaWQgPSB0cnVtYm93eWdJY29uc0lkO1xuICAgICAgICAgICAgdC5kb2MuYm9keS5pbnNlcnRCZWZvcmUoZGl2LCB0LmRvYy5ib2R5LmNoaWxkTm9kZXNbMF0pO1xuICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICBhc3luYzogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJyxcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCcsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICd4bWwnLFxuICAgICAgICAgICAgICAgIGNyb3NzRG9tYWluOiB0cnVlLFxuICAgICAgICAgICAgICAgIHVybDogc3ZnUGF0aE9wdGlvbixcbiAgICAgICAgICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICAgICAgICAgIGJlZm9yZVNlbmQ6IG51bGwsXG4gICAgICAgICAgICAgICAgY29tcGxldGU6IG51bGwsXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZGl2LmlubmVySFRNTCA9IG5ldyBYTUxTZXJpYWxpemVyKCkuc2VyaWFsaXplVG9TdHJpbmcoZGF0YS5kb2N1bWVudEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hlbiB0aGUgYnV0dG9uIGlzIGFzc29jaWF0ZWQgdG8gYSBlbXB0eSBvYmplY3RcbiAgICAgICAgICogZm4gYW5kIHRpdGxlIGF0dHJpYnV0cyBhcmUgZGVmaW5lZCBmcm9tIHRoZSBidXR0b24ga2V5IHZhbHVlXG4gICAgICAgICAqXG4gICAgICAgICAqIEZvciBleGFtcGxlXG4gICAgICAgICAqICAgICAgZm9vOiB7fVxuICAgICAgICAgKiBpcyBlcXVpdmFsZW50IHRvIDpcbiAgICAgICAgICogICAgICBmb286IHtcbiAgICAgICAgICogICAgICAgICAgZm46ICdmb28nLFxuICAgICAgICAgKiAgICAgICAgICB0aXRsZTogdGhpcy5sYW5nLmZvb1xuICAgICAgICAgKiAgICAgIH1cbiAgICAgICAgICovXG4gICAgICAgIHZhciBoID0gdC5sYW5nLmhlYWRlciwgLy8gSGVhZGVyIHRyYW5zbGF0aW9uXG4gICAgICAgICAgICBpc0JsaW5rRnVuY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICh3aW5kb3cuY2hyb21lIHx8ICh3aW5kb3cuSW50bCAmJiBJbnRsLnY4QnJlYWtJdGVyYXRvcikpICYmICdDU1MnIGluIHdpbmRvdztcbiAgICAgICAgICAgIH07XG4gICAgICAgIHQuYnRuc0RlZiA9IHtcbiAgICAgICAgICAgIHZpZXdIVE1MOiB7XG4gICAgICAgICAgICAgICAgZm46ICd0b2dnbGUnXG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICB1bmRvOiB7XG4gICAgICAgICAgICAgICAgaXNTdXBwb3J0ZWQ6IGlzQmxpbmtGdW5jdGlvbixcbiAgICAgICAgICAgICAgICBrZXk6ICdaJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlZG86IHtcbiAgICAgICAgICAgICAgICBpc1N1cHBvcnRlZDogaXNCbGlua0Z1bmN0aW9uLFxuICAgICAgICAgICAgICAgIGtleTogJ1knXG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBwOiB7XG4gICAgICAgICAgICAgICAgZm46ICdmb3JtYXRCbG9jaydcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBibG9ja3F1b3RlOiB7XG4gICAgICAgICAgICAgICAgZm46ICdmb3JtYXRCbG9jaydcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoMToge1xuICAgICAgICAgICAgICAgIGZuOiAnZm9ybWF0QmxvY2snLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBoICsgJyAxJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGgyOiB7XG4gICAgICAgICAgICAgICAgZm46ICdmb3JtYXRCbG9jaycsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGggKyAnIDInXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaDM6IHtcbiAgICAgICAgICAgICAgICBmbjogJ2Zvcm1hdEJsb2NrJyxcbiAgICAgICAgICAgICAgICB0aXRsZTogaCArICcgMydcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoNDoge1xuICAgICAgICAgICAgICAgIGZuOiAnZm9ybWF0QmxvY2snLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBoICsgJyA0J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN1YnNjcmlwdDoge1xuICAgICAgICAgICAgICAgIHRhZzogJ3N1YidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdXBlcnNjcmlwdDoge1xuICAgICAgICAgICAgICAgIHRhZzogJ3N1cCdcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGJvbGQ6IHtcbiAgICAgICAgICAgICAgICBrZXk6ICdCJyxcbiAgICAgICAgICAgICAgICB0YWc6ICdiJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGl0YWxpYzoge1xuICAgICAgICAgICAgICAgIGtleTogJ0knLFxuICAgICAgICAgICAgICAgIHRhZzogJ2knXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdW5kZXJsaW5lOiB7XG4gICAgICAgICAgICAgICAgdGFnOiAndSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdHJpa2V0aHJvdWdoOiB7XG4gICAgICAgICAgICAgICAgdGFnOiAnc3RyaWtlJ1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgc3Ryb25nOiB7XG4gICAgICAgICAgICAgICAgZm46ICdib2xkJyxcbiAgICAgICAgICAgICAgICBrZXk6ICdCJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVtOiB7XG4gICAgICAgICAgICAgICAgZm46ICdpdGFsaWMnLFxuICAgICAgICAgICAgICAgIGtleTogJ0knXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGVsOiB7XG4gICAgICAgICAgICAgICAgZm46ICdzdHJpa2V0aHJvdWdoJ1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgY3JlYXRlTGluazoge1xuICAgICAgICAgICAgICAgIGtleTogJ0snLFxuICAgICAgICAgICAgICAgIHRhZzogJ2EnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdW5saW5rOiB7fSxcblxuICAgICAgICAgICAgaW5zZXJ0SW1hZ2U6IHt9LFxuXG4gICAgICAgICAgICBqdXN0aWZ5TGVmdDoge1xuICAgICAgICAgICAgICAgIHRhZzogJ2xlZnQnLFxuICAgICAgICAgICAgICAgIGZvcmNlQ3NzOiB0cnVlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAganVzdGlmeUNlbnRlcjoge1xuICAgICAgICAgICAgICAgIHRhZzogJ2NlbnRlcicsXG4gICAgICAgICAgICAgICAgZm9yY2VDc3M6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBqdXN0aWZ5UmlnaHQ6IHtcbiAgICAgICAgICAgICAgICB0YWc6ICdyaWdodCcsXG4gICAgICAgICAgICAgICAgZm9yY2VDc3M6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBqdXN0aWZ5RnVsbDoge1xuICAgICAgICAgICAgICAgIHRhZzogJ2p1c3RpZnknLFxuICAgICAgICAgICAgICAgIGZvcmNlQ3NzOiB0cnVlXG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICB1bm9yZGVyZWRMaXN0OiB7XG4gICAgICAgICAgICAgICAgZm46ICdpbnNlcnRVbm9yZGVyZWRMaXN0JyxcbiAgICAgICAgICAgICAgICB0YWc6ICd1bCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvcmRlcmVkTGlzdDoge1xuICAgICAgICAgICAgICAgIGZuOiAnaW5zZXJ0T3JkZXJlZExpc3QnLFxuICAgICAgICAgICAgICAgIHRhZzogJ29sJ1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgaG9yaXpvbnRhbFJ1bGU6IHtcbiAgICAgICAgICAgICAgICBmbjogJ2luc2VydEhvcml6b250YWxSdWxlJ1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgcmVtb3ZlZm9ybWF0OiB7fSxcblxuICAgICAgICAgICAgZnVsbHNjcmVlbjoge1xuICAgICAgICAgICAgICAgIGNsYXNzOiAndHJ1bWJvd3lnLW5vdC1kaXNhYmxlJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNsb3NlOiB7XG4gICAgICAgICAgICAgICAgZm46ICdkZXN0cm95JyxcbiAgICAgICAgICAgICAgICBjbGFzczogJ3RydW1ib3d5Zy1ub3QtZGlzYWJsZSdcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIC8vIERyb3Bkb3duc1xuICAgICAgICAgICAgZm9ybWF0dGluZzoge1xuICAgICAgICAgICAgICAgIGRyb3Bkb3duOiBbJ3AnLCAnYmxvY2txdW90ZScsICdoMScsICdoMicsICdoMycsICdoNCddLFxuICAgICAgICAgICAgICAgIGljbzogJ3AnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGluazoge1xuICAgICAgICAgICAgICAgIGRyb3Bkb3duOiBbJ2NyZWF0ZUxpbmsnLCAndW5saW5rJ11cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBEZWZhdWx0cyBPcHRpb25zXG4gICAgICAgIHQubyA9ICQuZXh0ZW5kKHRydWUsIHt9LCAkdHJ1bWJvd3lnLmRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcbiAgICAgICAgaWYgKCF0Lm8uaGFzT3duUHJvcGVydHkoJ2ltZ0RibENsaWNrSGFuZGxlcicpKSB7XG4gICAgICAgICAgICB0Lm8uaW1nRGJsQ2xpY2tIYW5kbGVyID0gdC5nZXREZWZhdWx0SW1nRGJsQ2xpY2tIYW5kbGVyKCk7XG4gICAgICAgIH1cblxuICAgICAgICB0LmRpc2FibGVkID0gdC5vLmRpc2FibGVkIHx8IChlZGl0b3JFbGVtLm5vZGVOYW1lID09PSAnVEVYVEFSRUEnICYmIGVkaXRvckVsZW0uZGlzYWJsZWQpO1xuXG4gICAgICAgIGlmIChvcHRpb25zLmJ0bnMpIHtcbiAgICAgICAgICAgIHQuby5idG5zID0gb3B0aW9ucy5idG5zO1xuICAgICAgICB9IGVsc2UgaWYgKCF0Lm8uc2VtYW50aWMpIHtcbiAgICAgICAgICAgIHQuby5idG5zWzNdID0gWydib2xkJywgJ2l0YWxpYycsICd1bmRlcmxpbmUnLCAnc3RyaWtldGhyb3VnaCddO1xuICAgICAgICB9XG5cbiAgICAgICAgJC5lYWNoKHQuby5idG5zRGVmLCBmdW5jdGlvbiAoYnRuTmFtZSwgYnRuRGVmKSB7XG4gICAgICAgICAgICB0LmFkZEJ0bkRlZihidG5OYW1lLCBidG5EZWYpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBwdXQgdGhpcyBoZXJlIGluIHRoZSBldmVudCBpdCB3b3VsZCBiZSBtZXJnZWQgaW4gd2l0aCBvcHRpb25zXG4gICAgICAgIHQuZXZlbnROYW1lc3BhY2UgPSAndHJ1bWJvd3lnLWV2ZW50JztcblxuICAgICAgICAvLyBLZXlib2FyZCBzaG9ydGN1dHMgYXJlIGxvYWQgaW4gdGhpcyBhcnJheVxuICAgICAgICB0LmtleXMgPSBbXTtcblxuICAgICAgICAvLyBUYWcgdG8gYnV0dG9uIGR5bmFtaWNhbGx5IGh5ZHJhdGVkXG4gICAgICAgIHQudGFnVG9CdXR0b24gPSB7fTtcbiAgICAgICAgdC50YWdIYW5kbGVycyA9IFtdO1xuXG4gICAgICAgIC8vIEFkbWl0IG11bHRpcGxlIHBhc3RlIGhhbmRsZXJzXG4gICAgICAgIHQucGFzdGVIYW5kbGVycyA9IFtdLmNvbmNhdCh0Lm8ucGFzdGVIYW5kbGVycyk7XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgYnJvd3NlciBpcyBJRVxuICAgICAgICB0LmlzSUUgPSAobmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdNU0lFJykgIT09IC0xIHx8IG5hdmlnYXRvci5hcHBWZXJzaW9uLmluZGV4T2YoJ1RyaWRlbnQvJykgIT09IC0xKTtcblxuICAgICAgICB0LmluaXQoKTtcbiAgICB9O1xuXG4gICAgVHJ1bWJvd3lnLnByb3RvdHlwZSA9IHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzO1xuICAgICAgICAgICAgdC5oZWlnaHQgPSB0LiR0YS5oZWlnaHQoKTtcblxuICAgICAgICAgICAgdC5pbml0UGx1Z2lucygpO1xuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIC8vIERpc2FibGUgaW1hZ2UgcmVzaXplLCB0cnktY2F0Y2ggZm9yIG9sZCBJRVxuICAgICAgICAgICAgICAgIHQuZG9jLmV4ZWNDb21tYW5kKCdlbmFibGVPYmplY3RSZXNpemluZycsIGZhbHNlLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgdC5kb2MuZXhlY0NvbW1hbmQoJ2RlZmF1bHRQYXJhZ3JhcGhTZXBhcmF0b3InLCBmYWxzZSwgJ3AnKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdC5idWlsZEVkaXRvcigpO1xuICAgICAgICAgICAgdC5idWlsZEJ0blBhbmUoKTtcblxuICAgICAgICAgICAgdC5maXhlZEJ0blBhbmVFdmVudHMoKTtcblxuICAgICAgICAgICAgdC5idWlsZE92ZXJsYXkoKTtcblxuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHQuZGlzYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdC5zZXREaXNhYmxlZCh0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0Yndpbml0Jyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBhZGRCdG5EZWY6IGZ1bmN0aW9uIChidG5OYW1lLCBidG5EZWYpIHtcbiAgICAgICAgICAgIHRoaXMuYnRuc0RlZltidG5OYW1lXSA9IGJ0bkRlZjtcbiAgICAgICAgfSxcblxuICAgICAgICBidWlsZEVkaXRvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLFxuICAgICAgICAgICAgICAgIHByZWZpeCA9IHQuby5wcmVmaXgsXG4gICAgICAgICAgICAgICAgaHRtbCA9ICcnO1xuXG4gICAgICAgICAgICB0LiRib3ggPSAkKCc8ZGl2Lz4nLCB7XG4gICAgICAgICAgICAgICAgY2xhc3M6IHByZWZpeCArICdib3ggJyArIHByZWZpeCArICdlZGl0b3ItdmlzaWJsZSAnICsgcHJlZml4ICsgdC5vLmxhbmcgKyAnIHRydW1ib3d5ZydcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyAkdGEgPSBUZXh0YXJlYVxuICAgICAgICAgICAgLy8gJGVkID0gRWRpdG9yXG4gICAgICAgICAgICB0LmlzVGV4dGFyZWEgPSB0LiR0YS5pcygndGV4dGFyZWEnKTtcbiAgICAgICAgICAgIGlmICh0LmlzVGV4dGFyZWEpIHtcbiAgICAgICAgICAgICAgICBodG1sID0gdC4kdGEudmFsKCk7XG4gICAgICAgICAgICAgICAgdC4kZWQgPSAkKCc8ZGl2Lz4nKTtcbiAgICAgICAgICAgICAgICB0LiRib3hcbiAgICAgICAgICAgICAgICAgICAgLmluc2VydEFmdGVyKHQuJHRhKVxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKHQuJGVkLCB0LiR0YSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHQuJGVkID0gdC4kdGE7XG4gICAgICAgICAgICAgICAgaHRtbCA9IHQuJGVkLmh0bWwoKTtcblxuICAgICAgICAgICAgICAgIHQuJHRhID0gJCgnPHRleHRhcmVhLz4nLCB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHQuJHRhLmF0dHIoJ2lkJyksXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogdC5oZWlnaHRcbiAgICAgICAgICAgICAgICB9KS52YWwoaHRtbCk7XG5cbiAgICAgICAgICAgICAgICB0LiRib3hcbiAgICAgICAgICAgICAgICAgICAgLmluc2VydEFmdGVyKHQuJGVkKVxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKHQuJHRhLCB0LiRlZCk7XG4gICAgICAgICAgICAgICAgdC5zeW5jQ29kZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0LiR0YVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhwcmVmaXggKyAndGV4dGFyZWEnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0YWJpbmRleCcsIC0xKVxuICAgICAgICAgICAgO1xuXG4gICAgICAgICAgICB0LiRlZFxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhwcmVmaXggKyAnZWRpdG9yJylcbiAgICAgICAgICAgICAgICAuYXR0cih7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnRlZGl0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgZGlyOiB0LmxhbmcuX2RpciB8fCAnbHRyJ1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmh0bWwoaHRtbClcbiAgICAgICAgICAgIDtcblxuICAgICAgICAgICAgaWYgKHQuby50YWJpbmRleCkge1xuICAgICAgICAgICAgICAgIHQuJGVkLmF0dHIoJ3RhYmluZGV4JywgdC5vLnRhYmluZGV4KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHQuJGMuaXMoJ1twbGFjZWhvbGRlcl0nKSkge1xuICAgICAgICAgICAgICAgIHQuJGVkLmF0dHIoJ3BsYWNlaG9sZGVyJywgdC4kYy5hdHRyKCdwbGFjZWhvbGRlcicpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHQuJGMuaXMoJ1tzcGVsbGNoZWNrXScpKSB7XG4gICAgICAgICAgICAgICAgdC4kZWQuYXR0cignc3BlbGxjaGVjaycsIHQuJGMuYXR0cignc3BlbGxjaGVjaycpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHQuby5yZXNldENzcykge1xuICAgICAgICAgICAgICAgIHQuJGVkLmFkZENsYXNzKHByZWZpeCArICdyZXNldC1jc3MnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCF0Lm8uYXV0b2dyb3cpIHtcbiAgICAgICAgICAgICAgICB0LiR0YS5hZGQodC4kZWQpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogdC5oZWlnaHRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdC5zZW1hbnRpY0NvZGUoKTtcblxuICAgICAgICAgICAgaWYgKHQuby5hdXRvZ3Jvd09uRW50ZXIpIHtcbiAgICAgICAgICAgICAgICB0LiRlZC5hZGRDbGFzcyhwcmVmaXggKyAnYXV0b2dyb3ctb24tZW50ZXInKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGN0cmwgPSBmYWxzZSxcbiAgICAgICAgICAgICAgICBjb21wb3NpdGlvbiA9IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRlYm91bmNlQnV0dG9uUGFuZVN0YXR1cyxcbiAgICAgICAgICAgICAgICB1cGRhdGVFdmVudE5hbWUgPSB0LmlzSUUgPyAna2V5dXAnIDogJ2lucHV0JztcblxuICAgICAgICAgICAgdC4kZWRcbiAgICAgICAgICAgICAgICAub24oJ2RibGNsaWNrJywgJ2ltZycsIHQuby5pbWdEYmxDbGlja0hhbmRsZXIpXG4gICAgICAgICAgICAgICAgLm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSAmJiAhZS5hbHRLZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IHQua2V5c1tTdHJpbmcuZnJvbUNoYXJDb2RlKGUud2hpY2gpLnRvVXBwZXJDYXNlKCldO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuZXhlY0NtZChrZXkuZm4sIGtleS5wYXJhbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoYykge1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAub24oJ2NvbXBvc2l0aW9uc3RhcnQgY29tcG9zaXRpb251cGRhdGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBvc2l0aW9uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5vbih1cGRhdGVFdmVudE5hbWUgKyAnIGNvbXBvc2l0aW9uZW5kJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUudHlwZSA9PT0gJ2NvbXBvc2l0aW9uZW5kJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tcG9zaXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb21wb3NpdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleUNvZGUgPSBlLndoaWNoO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXlDb2RlID49IDM3ICYmIGtleUNvZGUgPD0gNDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICgoZS5jdHJsS2V5IHx8IGUubWV0YUtleSkgJiYgKGtleUNvZGUgPT09IDg5IHx8IGtleUNvZGUgPT09IDkwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndjaGFuZ2UnKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghY3RybCAmJiBrZXlDb2RlICE9PSAxNykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdC5zZW1hbnRpY0NvZGUoZmFsc2UsIGUudHlwZSA9PT0gJ2NvbXBvc2l0aW9uZW5kJyAmJiBrZXlDb2RlID09PSAxMyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0LiRjLnRyaWdnZXIoJ3Rid2NoYW5nZScpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBlLndoaWNoID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdC5zZW1hbnRpY0NvZGUoZmFsc2UsIGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3RybCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9LCAyMDApO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm9uKCdtb3VzZXVwIGtleWRvd24ga2V5dXAnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChkZWJvdW5jZUJ1dHRvblBhbmVTdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICBkZWJvdW5jZUJ1dHRvblBhbmVTdGF0dXMgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHQudXBkYXRlQnV0dG9uUGFuZVN0YXR1cygpO1xuICAgICAgICAgICAgICAgICAgICB9LCA1MCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAub24oJ2ZvY3VzIGJsdXInLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICB0LiRjLnRyaWdnZXIoJ3RidycgKyBlLnR5cGUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZS50eXBlID09PSAnYmx1cicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy4nICsgcHJlZml4ICsgJ2FjdGl2ZS1idXR0b24nLCB0LiRidG5QYW5lKS5yZW1vdmVDbGFzcyhwcmVmaXggKyAnYWN0aXZlLWJ1dHRvbiAnICsgcHJlZml4ICsgJ2FjdGl2ZScpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0Lm8uYXV0b2dyb3dPbkVudGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodC5hdXRvZ3Jvd09uRW50ZXJEb250Q2xvc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS50eXBlID09PSAnZm9jdXMnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5hdXRvZ3Jvd09uRW50ZXJXYXNGb2N1c2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmF1dG9ncm93RWRpdG9yT25FbnRlcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoIXQuby5hdXRvZ3Jvdykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuJGVkLmNzcyh7aGVpZ2h0OiB0LiRlZC5jc3MoJ21pbi1oZWlnaHQnKX0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuJGMudHJpZ2dlcigndGJ3cmVzaXplJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5vbignY3V0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHQuc2VtYW50aWNDb2RlKGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHQuJGMudHJpZ2dlcigndGJ3Y2hhbmdlJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm9uKCdwYXN0ZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0Lm8ucmVtb3ZlZm9ybWF0UGFzdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uICYmIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5kZWxldGVGcm9tRG9jdW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZGVsZXRlRnJvbURvY3VtZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSUVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGV4dCA9IHdpbmRvdy5jbGlwYm9hcmREYXRhLmdldERhdGEoJ1RleHQnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDw9IElFMTBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5kb2Muc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCkucGFzdGVIVE1MKHRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSUUgMTFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5kb2MuZ2V0U2VsZWN0aW9uKCkuZ2V0UmFuZ2VBdCgwKS5pbnNlcnROb2RlKHQuZG9jLmNyZWF0ZVRleHROb2RlKHRleHQpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndjaGFuZ2UnLCBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3QgSUVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmV4ZWNDbWQoJ2luc2VydFRleHQnLCAoZS5vcmlnaW5hbEV2ZW50IHx8IGUpLmNsaXBib2FyZERhdGEuZ2V0RGF0YSgndGV4dC9wbGFpbicpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIENhbGwgcGFzdGVIYW5kbGVyc1xuICAgICAgICAgICAgICAgICAgICAkLmVhY2godC5wYXN0ZUhhbmRsZXJzLCBmdW5jdGlvbiAoaSwgcGFzdGVIYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXN0ZUhhbmRsZXIoZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdC5zZW1hbnRpY0NvZGUoZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndwYXN0ZScsIGUpO1xuICAgICAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdC4kdGFcbiAgICAgICAgICAgICAgICAub24oJ2tleXVwJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB0LiRjLnRyaWdnZXIoJ3Rid2NoYW5nZScpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm9uKCdwYXN0ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0LiRjLnRyaWdnZXIoJ3Rid2NoYW5nZScpO1xuICAgICAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdC4kYm94Lm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZS53aGljaCA9PT0gMjcgJiYgJCgnLicgKyBwcmVmaXggKyAnbW9kYWwtYm94JywgdC4kYm94KS5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgdC5jbG9zZU1vZGFsKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvL2F1dG9ncm93IHdoZW4gZW50ZXJpbmcgbG9naWNcbiAgICAgICAgYXV0b2dyb3dFZGl0b3JPbkVudGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXM7XG4gICAgICAgICAgICB0LiRlZC5yZW1vdmVDbGFzcygnYXV0b2dyb3ctb24tZW50ZXInKTtcbiAgICAgICAgICAgIHZhciBvbGRIZWlnaHQgPSB0LiRlZFswXS5jbGllbnRIZWlnaHQ7XG4gICAgICAgICAgICB0LiRlZC5oZWlnaHQoJ2F1dG8nKTtcbiAgICAgICAgICAgIHZhciB0b3RhbEhlaWdodCA9IHQuJGVkWzBdLnNjcm9sbEhlaWdodDtcbiAgICAgICAgICAgIHQuJGVkLmFkZENsYXNzKCdhdXRvZ3Jvdy1vbi1lbnRlcicpO1xuICAgICAgICAgICAgaWYgKG9sZEhlaWdodCAhPT0gdG90YWxIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICB0LiRlZC5oZWlnaHQob2xkSGVpZ2h0KTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdC4kZWQuY3NzKHtoZWlnaHQ6IHRvdGFsSGVpZ2h0fSk7XG4gICAgICAgICAgICAgICAgICAgIHQuJGMudHJpZ2dlcigndGJ3cmVzaXplJyk7XG4gICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cblxuICAgICAgICAvLyBCdWlsZCBidXR0b24gcGFuZSwgdXNlIG8uYnRucyBvcHRpb25cbiAgICAgICAgYnVpbGRCdG5QYW5lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMsXG4gICAgICAgICAgICAgICAgcHJlZml4ID0gdC5vLnByZWZpeDtcblxuICAgICAgICAgICAgdmFyICRidG5QYW5lID0gdC4kYnRuUGFuZSA9ICQoJzxkaXYvPicsIHtcbiAgICAgICAgICAgICAgICBjbGFzczogcHJlZml4ICsgJ2J1dHRvbi1wYW5lJ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQuZWFjaCh0Lm8uYnRucywgZnVuY3Rpb24gKGksIGJ0bkdycCkge1xuICAgICAgICAgICAgICAgIGlmICghJC5pc0FycmF5KGJ0bkdycCkpIHtcbiAgICAgICAgICAgICAgICAgICAgYnRuR3JwID0gW2J0bkdycF07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyICRidG5Hcm91cCA9ICQoJzxkaXYvPicsIHtcbiAgICAgICAgICAgICAgICAgICAgY2xhc3M6IHByZWZpeCArICdidXR0b24tZ3JvdXAgJyArICgoYnRuR3JwLmluZGV4T2YoJ2Z1bGxzY3JlZW4nKSA+PSAwKSA/IHByZWZpeCArICdyaWdodCcgOiAnJylcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAkLmVhY2goYnRuR3JwLCBmdW5jdGlvbiAoaSwgYnRuKSB7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7IC8vIFByZXZlbnQgYnVpbGRCdG4gZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0LmlzU3VwcG9ydGVkQnRuKGJ0bikpIHsgLy8gSXQncyBhIHN1cHBvcnRlZCBidXR0b25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYnRuR3JvdXAuYXBwZW5kKHQuYnVpbGRCdG4oYnRuKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGMpIHtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICRidG5QYW5lLmFwcGVuZCgkYnRuR3JvdXApO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHQuJGJveC5wcmVwZW5kKCRidG5QYW5lKTtcbiAgICAgICAgfSxcblxuXG4gICAgICAgIC8vIEJ1aWxkIGEgYnV0dG9uIGFuZCBoaXMgYWN0aW9uXG4gICAgICAgIGJ1aWxkQnRuOiBmdW5jdGlvbiAoYnRuTmFtZSkgeyAvLyBidG5OYW1lIGlzIG5hbWUgb2YgdGhlIGJ1dHRvblxuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLFxuICAgICAgICAgICAgICAgIHByZWZpeCA9IHQuby5wcmVmaXgsXG4gICAgICAgICAgICAgICAgYnRuID0gdC5idG5zRGVmW2J0bk5hbWVdLFxuICAgICAgICAgICAgICAgIGlzRHJvcGRvd24gPSBidG4uZHJvcGRvd24sXG4gICAgICAgICAgICAgICAgaGFzSWNvbiA9IGJ0bi5oYXNJY29uICE9IG51bGwgPyBidG4uaGFzSWNvbiA6IHRydWUsXG4gICAgICAgICAgICAgICAgdGV4dERlZiA9IHQubGFuZ1tidG5OYW1lXSB8fCBidG5OYW1lLFxuXG4gICAgICAgICAgICAgICAgJGJ0biA9ICQoJzxidXR0b24vPicsIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2J1dHRvbicsXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzOiBwcmVmaXggKyBidG5OYW1lICsgJy1idXR0b24gJyArIChidG4uY2xhc3MgfHwgJycpICsgKCFoYXNJY29uID8gJyAnICsgcHJlZml4ICsgJ3RleHR1YWwtYnV0dG9uJyA6ICcnKSxcbiAgICAgICAgICAgICAgICAgICAgaHRtbDogdC5oYXNTdmcgJiYgaGFzSWNvbiA/XG4gICAgICAgICAgICAgICAgICAgICAgICAnPHN2Zz48dXNlIHhsaW5rOmhyZWY9XCInICsgdC5zdmdQYXRoICsgJyMnICsgcHJlZml4ICsgKGJ0bi5pY28gfHwgYnRuTmFtZSkucmVwbGFjZSgvKFtBLVpdKykvZywgJy0kMScpLnRvTG93ZXJDYXNlKCkgKyAnXCIvPjwvc3ZnPicgOlxuICAgICAgICAgICAgICAgICAgICAgICAgdC5oaWRlQnV0dG9uVGV4dHMgPyAnJyA6IChidG4udGV4dCB8fCBidG4udGl0bGUgfHwgdC5sYW5nW2J0bk5hbWVdIHx8IGJ0bk5hbWUpLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogKGJ0bi50aXRsZSB8fCBidG4udGV4dCB8fCB0ZXh0RGVmKSArICgoYnRuLmtleSkgPyAnIChDdHJsICsgJyArIGJ0bi5rZXkgKyAnKScgOiAnJyksXG4gICAgICAgICAgICAgICAgICAgIHRhYmluZGV4OiAtMSxcbiAgICAgICAgICAgICAgICAgICAgbW91c2Vkb3duOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzRHJvcGRvd24gfHwgJCgnLicgKyBidG5OYW1lICsgJy0nICsgcHJlZml4ICsgJ2Ryb3Bkb3duJywgdC4kYm94KS5pcygnOmhpZGRlbicpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnYm9keScsIHQuZG9jKS50cmlnZ2VyKCdtb3VzZWRvd24nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQuJGJ0blBhbmUuaGFzQ2xhc3MocHJlZml4ICsgJ2Rpc2FibGUnKSAmJiAhJCh0aGlzKS5oYXNDbGFzcyhwcmVmaXggKyAnYWN0aXZlJykgJiYgISQodGhpcykuaGFzQ2xhc3MocHJlZml4ICsgJ25vdC1kaXNhYmxlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHQuZXhlY0NtZCgoaXNEcm9wZG93biA/ICdkcm9wZG93bicgOiBmYWxzZSkgfHwgYnRuLmZuIHx8IGJ0bk5hbWUsIGJ0bi5wYXJhbSB8fCBidG5OYW1lLCBidG4uZm9yY2VDc3MpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGlzRHJvcGRvd24pIHtcbiAgICAgICAgICAgICAgICAkYnRuLmFkZENsYXNzKHByZWZpeCArICdvcGVuLWRyb3Bkb3duJyk7XG4gICAgICAgICAgICAgICAgdmFyIGRyb3Bkb3duUHJlZml4ID0gcHJlZml4ICsgJ2Ryb3Bkb3duJyxcbiAgICAgICAgICAgICAgICAgICAgJGRyb3Bkb3duID0gJCgnPGRpdi8+JywgeyAvLyB0aGUgZHJvcGRvd25cbiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzOiBkcm9wZG93blByZWZpeCArICctJyArIGJ0bk5hbWUgKyAnICcgKyBkcm9wZG93blByZWZpeCArICcgJyArIHByZWZpeCArICdmaXhlZC10b3AnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGEtZHJvcGRvd24nOiBidG5OYW1lXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICQuZWFjaChpc0Ryb3Bkb3duLCBmdW5jdGlvbiAoaSwgZGVmKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0LmJ0bnNEZWZbZGVmXSAmJiB0LmlzU3VwcG9ydGVkQnRuKGRlZikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRkcm9wZG93bi5hcHBlbmQodC5idWlsZFN1YkJ0bihkZWYpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHQuJGJveC5hcHBlbmQoJGRyb3Bkb3duLmhpZGUoKSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGJ0bi5rZXkpIHtcbiAgICAgICAgICAgICAgICB0LmtleXNbYnRuLmtleV0gPSB7XG4gICAgICAgICAgICAgICAgICAgIGZuOiBidG4uZm4gfHwgYnRuTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW06IGJ0bi5wYXJhbSB8fCBidG5OYW1lXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFpc0Ryb3Bkb3duKSB7XG4gICAgICAgICAgICAgICAgdC50YWdUb0J1dHRvblsoYnRuLnRhZyB8fCBidG5OYW1lKS50b0xvd2VyQ2FzZSgpXSA9IGJ0bk5hbWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiAkYnRuO1xuICAgICAgICB9LFxuICAgICAgICAvLyBCdWlsZCBhIGJ1dHRvbiBmb3IgZHJvcGRvd24gbWVudVxuICAgICAgICAvLyBAcGFyYW0gbiA6IG5hbWUgb2YgdGhlIHN1YmJ1dHRvblxuICAgICAgICBidWlsZFN1YkJ0bjogZnVuY3Rpb24gKGJ0bk5hbWUpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcyxcbiAgICAgICAgICAgICAgICBwcmVmaXggPSB0Lm8ucHJlZml4LFxuICAgICAgICAgICAgICAgIGJ0biA9IHQuYnRuc0RlZltidG5OYW1lXSxcbiAgICAgICAgICAgICAgICBoYXNJY29uID0gYnRuLmhhc0ljb24gIT0gbnVsbCA/IGJ0bi5oYXNJY29uIDogdHJ1ZTtcblxuICAgICAgICAgICAgaWYgKGJ0bi5rZXkpIHtcbiAgICAgICAgICAgICAgICB0LmtleXNbYnRuLmtleV0gPSB7XG4gICAgICAgICAgICAgICAgICAgIGZuOiBidG4uZm4gfHwgYnRuTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW06IGJ0bi5wYXJhbSB8fCBidG5OYW1lXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdC50YWdUb0J1dHRvblsoYnRuLnRhZyB8fCBidG5OYW1lKS50b0xvd2VyQ2FzZSgpXSA9IGJ0bk5hbWU7XG5cbiAgICAgICAgICAgIHJldHVybiAkKCc8YnV0dG9uLz4nLCB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2J1dHRvbicsXG4gICAgICAgICAgICAgICAgY2xhc3M6IHByZWZpeCArIGJ0bk5hbWUgKyAnLWRyb3Bkb3duLWJ1dHRvbicgKyAoYnRuLmljbyA/ICcgJyArIHByZWZpeCArIGJ0bi5pY28gKyAnLWJ1dHRvbicgOiAnJyksXG4gICAgICAgICAgICAgICAgaHRtbDogdC5oYXNTdmcgJiYgaGFzSWNvbiA/ICc8c3ZnPjx1c2UgeGxpbms6aHJlZj1cIicgKyB0LnN2Z1BhdGggKyAnIycgKyBwcmVmaXggKyAoYnRuLmljbyB8fCBidG5OYW1lKS5yZXBsYWNlKC8oW0EtWl0rKS9nLCAnLSQxJykudG9Mb3dlckNhc2UoKSArICdcIi8+PC9zdmc+JyArIChidG4udGV4dCB8fCBidG4udGl0bGUgfHwgdC5sYW5nW2J0bk5hbWVdIHx8IGJ0bk5hbWUpIDogKGJ0bi50ZXh0IHx8IGJ0bi50aXRsZSB8fCB0LmxhbmdbYnRuTmFtZV0gfHwgYnRuTmFtZSksXG4gICAgICAgICAgICAgICAgdGl0bGU6ICgoYnRuLmtleSkgPyAnIChDdHJsICsgJyArIGJ0bi5rZXkgKyAnKScgOiBudWxsKSxcbiAgICAgICAgICAgICAgICBzdHlsZTogYnRuLnN0eWxlIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgbW91c2Vkb3duOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJ2JvZHknLCB0LmRvYykudHJpZ2dlcignbW91c2Vkb3duJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgdC5leGVjQ21kKGJ0bi5mbiB8fCBidG5OYW1lLCBidG4ucGFyYW0gfHwgYnRuTmFtZSwgYnRuLmZvcmNlQ3NzKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vIENoZWNrIGlmIGJ1dHRvbiBpcyBzdXBwb3J0ZWRcbiAgICAgICAgaXNTdXBwb3J0ZWRCdG46IGZ1bmN0aW9uIChiKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJ0bnNEZWZbYl0uaXNTdXBwb3J0ZWQoKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGMpIHtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vIEJ1aWxkIG92ZXJsYXkgZm9yIG1vZGFsIGJveFxuICAgICAgICBidWlsZE92ZXJsYXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgICAgICAgIHQuJG92ZXJsYXkgPSAkKCc8ZGl2Lz4nLCB7XG4gICAgICAgICAgICAgICAgY2xhc3M6IHQuby5wcmVmaXggKyAnb3ZlcmxheSdcbiAgICAgICAgICAgIH0pLmFwcGVuZFRvKHQuJGJveCk7XG4gICAgICAgICAgICByZXR1cm4gdC4kb3ZlcmxheTtcbiAgICAgICAgfSxcbiAgICAgICAgc2hvd092ZXJsYXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgICAgICAgICQod2luZG93KS50cmlnZ2VyKCdzY3JvbGwnKTtcbiAgICAgICAgICAgIHQuJG92ZXJsYXkuZmFkZUluKDIwMCk7XG4gICAgICAgICAgICB0LiRib3guYWRkQ2xhc3ModC5vLnByZWZpeCArICdib3gtYmx1cicpO1xuICAgICAgICB9LFxuICAgICAgICBoaWRlT3ZlcmxheTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzO1xuICAgICAgICAgICAgdC4kb3ZlcmxheS5mYWRlT3V0KDUwKTtcbiAgICAgICAgICAgIHQuJGJveC5yZW1vdmVDbGFzcyh0Lm8ucHJlZml4ICsgJ2JveC1ibHVyJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gTWFuYWdlbWVudCBvZiBmaXhlZCBidXR0b24gcGFuZVxuICAgICAgICBmaXhlZEJ0blBhbmVFdmVudHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcyxcbiAgICAgICAgICAgICAgICBmaXhlZEZ1bGxXaWR0aCA9IHQuby5maXhlZEZ1bGxXaWR0aCxcbiAgICAgICAgICAgICAgICAkYm94ID0gdC4kYm94O1xuXG4gICAgICAgICAgICBpZiAoIXQuby5maXhlZEJ0blBhbmUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHQuaXNGaXhlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAkKHdpbmRvdylcbiAgICAgICAgICAgICAgICAub24oJ3Njcm9sbC4nICsgdC5ldmVudE5hbWVzcGFjZSArICcgcmVzaXplLicgKyB0LmV2ZW50TmFtZXNwYWNlLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghJGJveCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdC5zeW5jQ29kZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBzY3JvbGxUb3AgPSAkKHdpbmRvdykuc2Nyb2xsVG9wKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSAkYm94Lm9mZnNldCgpLnRvcCArIDEsXG4gICAgICAgICAgICAgICAgICAgICAgICBicCA9IHQuJGJ0blBhbmUsXG4gICAgICAgICAgICAgICAgICAgICAgICBvaCA9IGJwLm91dGVySGVpZ2h0KCkgLSAyO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICgoc2Nyb2xsVG9wIC0gb2Zmc2V0ID4gMCkgJiYgKChzY3JvbGxUb3AgLSBvZmZzZXQgLSB0LmhlaWdodCkgPCAwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0LmlzRml4ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmlzRml4ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJwLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGZpeGVkRnVsbFdpZHRoID8gJzAnIDogJ2F1dG8nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB6SW5kZXg6IDdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFt0LiR0YSwgdC4kZWRdKS5jc3Moe21hcmdpblRvcDogYnAuaGVpZ2h0KCl9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJwLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGZpeGVkRnVsbFdpZHRoID8gJzEwMCUnIDogKCgkYm94LndpZHRoKCkgLSAxKSArICdweCcpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLicgKyB0Lm8ucHJlZml4ICsgJ2ZpeGVkLXRvcCcsICRib3gpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGZpeGVkRnVsbFdpZHRoID8gJ2ZpeGVkJyA6ICdhYnNvbHV0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBmaXhlZEZ1bGxXaWR0aCA/IG9oIDogb2ggKyAoc2Nyb2xsVG9wIC0gb2Zmc2V0KSArICdweCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgekluZGV4OiAxNVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodC5pc0ZpeGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0LmlzRml4ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJwLnJlbW92ZUF0dHIoJ3N0eWxlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKFt0LiR0YSwgdC4kZWRdKS5jc3Moe21hcmdpblRvcDogMH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLicgKyB0Lm8ucHJlZml4ICsgJ2ZpeGVkLXRvcCcsICRib3gpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBvaFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvLyBEaXNhYmxlIGVkaXRvclxuICAgICAgICBzZXREaXNhYmxlZDogZnVuY3Rpb24gKGRpc2FibGUpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcyxcbiAgICAgICAgICAgICAgICBwcmVmaXggPSB0Lm8ucHJlZml4O1xuXG4gICAgICAgICAgICB0LmRpc2FibGVkID0gZGlzYWJsZTtcblxuICAgICAgICAgICAgaWYgKGRpc2FibGUpIHtcbiAgICAgICAgICAgICAgICB0LiR0YS5hdHRyKCdkaXNhYmxlZCcsIHRydWUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0LiR0YS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdC4kYm94LnRvZ2dsZUNsYXNzKHByZWZpeCArICdkaXNhYmxlZCcsIGRpc2FibGUpO1xuICAgICAgICAgICAgdC4kZWQuYXR0cignY29udGVudGVkaXRhYmxlJywgIWRpc2FibGUpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vIERlc3Ryb3kgdGhlIGVkaXRvclxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMsXG4gICAgICAgICAgICAgICAgcHJlZml4ID0gdC5vLnByZWZpeDtcblxuICAgICAgICAgICAgaWYgKHQuaXNUZXh0YXJlYSkge1xuICAgICAgICAgICAgICAgIHQuJGJveC5hZnRlcihcbiAgICAgICAgICAgICAgICAgICAgdC4kdGFcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jc3Moe2hlaWdodDogJyd9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLnZhbCh0Lmh0bWwoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhwcmVmaXggKyAndGV4dGFyZWEnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNob3coKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHQuJGJveC5hZnRlcihcbiAgICAgICAgICAgICAgICAgICAgdC4kZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jc3Moe2hlaWdodDogJyd9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKHByZWZpeCArICdlZGl0b3InKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUF0dHIoJ2NvbnRlbnRlZGl0YWJsZScpXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQXR0cignZGlyJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5odG1sKHQuaHRtbCgpKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNob3coKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHQuJGVkLm9mZignZGJsY2xpY2snLCAnaW1nJyk7XG5cbiAgICAgICAgICAgIHQuZGVzdHJveVBsdWdpbnMoKTtcblxuICAgICAgICAgICAgdC4kYm94LnJlbW92ZSgpO1xuICAgICAgICAgICAgdC4kYy5yZW1vdmVEYXRhKCd0cnVtYm93eWcnKTtcbiAgICAgICAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcyhwcmVmaXggKyAnYm9keS1mdWxsc2NyZWVuJyk7XG4gICAgICAgICAgICB0LiRjLnRyaWdnZXIoJ3Rid2Nsb3NlJyk7XG4gICAgICAgICAgICAkKHdpbmRvdykub2ZmKCdzY3JvbGwuJyArIHQuZXZlbnROYW1lc3BhY2UgKyAnIHJlc2l6ZS4nICsgdC5ldmVudE5hbWVzcGFjZSk7XG4gICAgICAgIH0sXG5cblxuICAgICAgICAvLyBFbXB0eSB0aGUgZWRpdG9yXG4gICAgICAgIGVtcHR5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLiR0YS52YWwoJycpO1xuICAgICAgICAgICAgdGhpcy5zeW5jQ29kZSh0cnVlKTtcbiAgICAgICAgfSxcblxuXG4gICAgICAgIC8vIEZ1bmN0aW9uIGNhbGwgd2hlbiBjbGljayBvbiB2aWV3SFRNTCBidXR0b25cbiAgICAgICAgdG9nZ2xlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMsXG4gICAgICAgICAgICAgICAgcHJlZml4ID0gdC5vLnByZWZpeDtcblxuICAgICAgICAgICAgaWYgKHQuby5hdXRvZ3Jvd09uRW50ZXIpIHtcbiAgICAgICAgICAgICAgICB0LmF1dG9ncm93T25FbnRlckRvbnRDbG9zZSA9ICF0LiRib3guaGFzQ2xhc3MocHJlZml4ICsgJ2VkaXRvci1oaWRkZW4nKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdC5zZW1hbnRpY0NvZGUoZmFsc2UsIHRydWUpO1xuXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0LmRvYy5hY3RpdmVFbGVtZW50LmJsdXIoKTtcbiAgICAgICAgICAgICAgICB0LiRib3gudG9nZ2xlQ2xhc3MocHJlZml4ICsgJ2VkaXRvci1oaWRkZW4gJyArIHByZWZpeCArICdlZGl0b3ItdmlzaWJsZScpO1xuICAgICAgICAgICAgICAgIHQuJGJ0blBhbmUudG9nZ2xlQ2xhc3MocHJlZml4ICsgJ2Rpc2FibGUnKTtcbiAgICAgICAgICAgICAgICAkKCcuJyArIHByZWZpeCArICd2aWV3SFRNTC1idXR0b24nLCB0LiRidG5QYW5lKS50b2dnbGVDbGFzcyhwcmVmaXggKyAnYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgaWYgKHQuJGJveC5oYXNDbGFzcyhwcmVmaXggKyAnZWRpdG9yLXZpc2libGUnKSkge1xuICAgICAgICAgICAgICAgICAgICB0LiR0YS5hdHRyKCd0YWJpbmRleCcsIC0xKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0LiR0YS5yZW1vdmVBdHRyKCd0YWJpbmRleCcpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh0Lm8uYXV0b2dyb3dPbkVudGVyICYmICF0LmF1dG9ncm93T25FbnRlckRvbnRDbG9zZSkge1xuICAgICAgICAgICAgICAgICAgICB0LmF1dG9ncm93RWRpdG9yT25FbnRlcigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIDApO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vIE9wZW4gZHJvcGRvd24gd2hlbiBjbGljayBvbiBhIGJ1dHRvbiB3aGljaCBvcGVuIHRoYXRcbiAgICAgICAgZHJvcGRvd246IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMsXG4gICAgICAgICAgICAgICAgZCA9IHQuZG9jLFxuICAgICAgICAgICAgICAgIHByZWZpeCA9IHQuby5wcmVmaXgsXG4gICAgICAgICAgICAgICAgJGRyb3Bkb3duID0gJCgnW2RhdGEtZHJvcGRvd249JyArIG5hbWUgKyAnXScsIHQuJGJveCksXG4gICAgICAgICAgICAgICAgJGJ0biA9ICQoJy4nICsgcHJlZml4ICsgbmFtZSArICctYnV0dG9uJywgdC4kYnRuUGFuZSksXG4gICAgICAgICAgICAgICAgc2hvdyA9ICRkcm9wZG93bi5pcygnOmhpZGRlbicpO1xuXG4gICAgICAgICAgICAkKCdib2R5JywgZCkudHJpZ2dlcignbW91c2Vkb3duJyk7XG5cbiAgICAgICAgICAgIGlmIChzaG93KSB7XG4gICAgICAgICAgICAgICAgdmFyIG8gPSAkYnRuLm9mZnNldCgpLmxlZnQ7XG4gICAgICAgICAgICAgICAgJGJ0bi5hZGRDbGFzcyhwcmVmaXggKyAnYWN0aXZlJyk7XG5cbiAgICAgICAgICAgICAgICAkZHJvcGRvd24uY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgICAgICAgICAgICAgICAgIHRvcDogJGJ0bi5vZmZzZXQoKS50b3AgLSB0LiRidG5QYW5lLm9mZnNldCgpLnRvcCArICRidG4ub3V0ZXJIZWlnaHQoKSxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogKHQuby5maXhlZEZ1bGxXaWR0aCAmJiB0LmlzRml4ZWQpID8gbyArICdweCcgOiAobyAtIHQuJGJ0blBhbmUub2Zmc2V0KCkubGVmdCkgKyAncHgnXG4gICAgICAgICAgICAgICAgfSkuc2hvdygpO1xuXG4gICAgICAgICAgICAgICAgJCh3aW5kb3cpLnRyaWdnZXIoJ3Njcm9sbCcpO1xuXG4gICAgICAgICAgICAgICAgJCgnYm9keScsIGQpLm9uKCdtb3VzZWRvd24uJyArIHQuZXZlbnROYW1lc3BhY2UsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghJGRyb3Bkb3duLmlzKGUudGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLicgKyBwcmVmaXggKyAnZHJvcGRvd24nLCBkKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuJyArIHByZWZpeCArICdhY3RpdmUnLCBkKS5yZW1vdmVDbGFzcyhwcmVmaXggKyAnYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCdib2R5JywgZCkub2ZmKCdtb3VzZWRvd24uJyArIHQuZXZlbnROYW1lc3BhY2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cblxuICAgICAgICAvLyBIVE1MIENvZGUgbWFuYWdlbWVudFxuICAgICAgICBodG1sOiBmdW5jdGlvbiAoaHRtbCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzO1xuICAgICAgICAgICAgaWYgKGh0bWwgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHQuJHRhLnZhbChodG1sKTtcbiAgICAgICAgICAgICAgICB0LnN5bmNDb2RlKHRydWUpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHQuJHRhLnZhbCgpO1xuICAgICAgICB9LFxuICAgICAgICBzeW5jVGV4dGFyZWE6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgICAgICAgIHQuJHRhLnZhbCh0LiRlZC50ZXh0KCkudHJpbSgpLmxlbmd0aCA+IDAgfHwgdC4kZWQuZmluZCgnaHIsaW1nLGVtYmVkLGlmcmFtZSxpbnB1dCcpLmxlbmd0aCA+IDAgPyB0LiRlZC5odG1sKCkgOiAnJyk7XG4gICAgICAgIH0sXG4gICAgICAgIHN5bmNDb2RlOiBmdW5jdGlvbiAoZm9yY2UpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgICAgICAgIGlmICghZm9yY2UgJiYgdC4kZWQuaXMoJzp2aXNpYmxlJykpIHtcbiAgICAgICAgICAgICAgICB0LnN5bmNUZXh0YXJlYSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyB3cmFwIHRoZSBjb250ZW50IGluIGEgZGl2IGl0J3MgZWFzaWVyIHRvIGdldCB0aGUgaW5uZXJodG1sXG4gICAgICAgICAgICAgICAgdmFyIGh0bWwgPSAkKCc8ZGl2PicpLmh0bWwodC4kdGEudmFsKCkpO1xuICAgICAgICAgICAgICAgIC8vc2NydWIgdGhlIGh0bWwgYmVmb3JlIGxvYWRpbmcgaW50byB0aGUgZG9jXG4gICAgICAgICAgICAgICAgdmFyIHNhZmUgPSAkKCc8ZGl2PicpLmFwcGVuZChodG1sKTtcbiAgICAgICAgICAgICAgICAkKHQuby50YWdzVG9SZW1vdmUuam9pbignLCcpLCBzYWZlKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB0LiRlZC5odG1sKHNhZmUuY29udGVudHMoKS5odG1sKCkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodC5vLmF1dG9ncm93KSB7XG4gICAgICAgICAgICAgICAgdC5oZWlnaHQgPSB0LiRlZC5oZWlnaHQoKTtcbiAgICAgICAgICAgICAgICBpZiAodC5oZWlnaHQgIT09IHQuJHRhLmNzcygnaGVpZ2h0JykpIHtcbiAgICAgICAgICAgICAgICAgICAgdC4kdGEuY3NzKHtoZWlnaHQ6IHQuaGVpZ2h0fSk7XG4gICAgICAgICAgICAgICAgICAgIHQuJGMudHJpZ2dlcigndGJ3cmVzaXplJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHQuby5hdXRvZ3Jvd09uRW50ZXIpIHtcbiAgICAgICAgICAgICAgICAvLyB0LmF1dG9ncm93RWRpdG9yT25FbnRlcigpO1xuICAgICAgICAgICAgICAgIHQuJGVkLmhlaWdodCgnYXV0bycpO1xuICAgICAgICAgICAgICAgIHZhciB0b3RhbGhlaWdodCA9IHQuYXV0b2dyb3dPbkVudGVyV2FzRm9jdXNlZCA/IHQuJGVkWzBdLnNjcm9sbEhlaWdodCA6IHQuJGVkLmNzcygnbWluLWhlaWdodCcpO1xuICAgICAgICAgICAgICAgIGlmICh0b3RhbGhlaWdodCAhPT0gdC4kdGEuY3NzKCdoZWlnaHQnKSkge1xuICAgICAgICAgICAgICAgICAgICB0LiRlZC5jc3Moe2hlaWdodDogdG90YWxoZWlnaHR9KTtcbiAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndyZXNpemUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gQW5hbHlzZSBhbmQgdXBkYXRlIHRvIHNlbWFudGljIGNvZGVcbiAgICAgICAgLy8gQHBhcmFtIGZvcmNlIDogZm9yY2UgdG8gc3luYyBjb2RlIGZyb20gdGV4dGFyZWFcbiAgICAgICAgLy8gQHBhcmFtIGZ1bGwgIDogd3JhcCB0ZXh0IG5vZGVzIGluIDxwPlxuICAgICAgICAvLyBAcGFyYW0ga2VlcFJhbmdlICA6IGxlYXZlIHNlbGVjdGlvbiByYW5nZSBhcyBpdCBpc1xuICAgICAgICBzZW1hbnRpY0NvZGU6IGZ1bmN0aW9uIChmb3JjZSwgZnVsbCwga2VlcFJhbmdlKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXM7XG4gICAgICAgICAgICB0LnNhdmVSYW5nZSgpO1xuICAgICAgICAgICAgdC5zeW5jQ29kZShmb3JjZSk7XG5cbiAgICAgICAgICAgIGlmICh0Lm8uc2VtYW50aWMpIHtcbiAgICAgICAgICAgICAgICB0LnNlbWFudGljVGFnKCdiJywgJ3N0cm9uZycpO1xuICAgICAgICAgICAgICAgIHQuc2VtYW50aWNUYWcoJ2knLCAnZW0nKTtcbiAgICAgICAgICAgICAgICB0LnNlbWFudGljVGFnKCdzdHJpa2UnLCAnZGVsJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZnVsbCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW5saW5lRWxlbWVudHNTZWxlY3RvciA9IHQuby5pbmxpbmVFbGVtZW50c1NlbGVjdG9yLFxuICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tFbGVtZW50c1NlbGVjdG9yID0gJzpub3QoJyArIGlubGluZUVsZW1lbnRzU2VsZWN0b3IgKyAnKSc7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gV3JhcCB0ZXh0IG5vZGVzIGluIHNwYW4gZm9yIGVhc2llciBwcm9jZXNzaW5nXG4gICAgICAgICAgICAgICAgICAgIHQuJGVkLmNvbnRlbnRzKCkuZmlsdGVyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5vZGVUeXBlID09PSAzICYmIHRoaXMubm9kZVZhbHVlLnRyaW0oKS5sZW5ndGggPiAwO1xuICAgICAgICAgICAgICAgICAgICB9KS53cmFwKCc8c3BhbiBkYXRhLXRidy8+Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gV3JhcCBncm91cHMgb2YgaW5saW5lIGVsZW1lbnRzIGluIHBhcmFncmFwaHMgKHJlY3Vyc2l2ZSlcbiAgICAgICAgICAgICAgICAgICAgdmFyIHdyYXBJbmxpbmVzSW5QYXJhZ3JhcGhzRnJvbSA9IGZ1bmN0aW9uICgkZnJvbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRmcm9tLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkZmluYWxQYXJhZ3JhcGggPSAkZnJvbS5uZXh0VW50aWwoYmxvY2tFbGVtZW50c1NlbGVjdG9yKS5hZGRCYWNrKCkud3JhcEFsbCgnPHAvPicpLnBhcmVudCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbmV4dEVsZW1lbnQgPSAkZmluYWxQYXJhZ3JhcGgubmV4dEFsbChpbmxpbmVFbGVtZW50c1NlbGVjdG9yKS5maXJzdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmaW5hbFBhcmFncmFwaC5uZXh0KCdicicpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyYXBJbmxpbmVzSW5QYXJhZ3JhcGhzRnJvbSgkbmV4dEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB3cmFwSW5saW5lc0luUGFyYWdyYXBoc0Zyb20odC4kZWQuY2hpbGRyZW4oaW5saW5lRWxlbWVudHNTZWxlY3RvcikuZmlyc3QoKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdC5zZW1hbnRpY1RhZygnZGl2JywgJ3AnLCB0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBVbndyYXAgcGFyYWdyYXBocyBjb250ZW50LCBjb250YWluaW5nIG5vdGhpbmcgdXNlZnVsbFxuICAgICAgICAgICAgICAgICAgICB0LiRlZC5maW5kKCdwJykuZmlsdGVyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvbid0IHJlbW92ZSBjdXJyZW50bHkgYmVpbmcgZWRpdGVkIGVsZW1lbnRcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0LnJhbmdlICYmIHRoaXMgPT09IHQucmFuZ2Uuc3RhcnRDb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJCh0aGlzKS50ZXh0KCkudHJpbSgpLmxlbmd0aCA9PT0gMCAmJiAkKHRoaXMpLmNoaWxkcmVuKCkubm90KCdicixzcGFuJykubGVuZ3RoID09PSAwO1xuICAgICAgICAgICAgICAgICAgICB9KS5jb250ZW50cygpLnVud3JhcCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEdldCByaWQgb2YgdGVtcG9yaWFsIHNwYW4nc1xuICAgICAgICAgICAgICAgICAgICAkKCdbZGF0YS10YnddJywgdC4kZWQpLmNvbnRlbnRzKCkudW53cmFwKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGVtcHR5IDxwPlxuICAgICAgICAgICAgICAgICAgICB0LiRlZC5maW5kKCdwOmVtcHR5JykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCFrZWVwUmFuZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdC5yZXN0b3JlUmFuZ2UoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0LnN5bmNUZXh0YXJlYSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNlbWFudGljVGFnOiBmdW5jdGlvbiAob2xkVGFnLCBuZXdUYWcsIGNvcHlBdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICAkKG9sZFRhZywgdGhpcy4kZWQpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciAkb2xkVGFnID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICAkb2xkVGFnLndyYXAoJzwnICsgbmV3VGFnICsgJy8+Jyk7XG4gICAgICAgICAgICAgICAgaWYgKGNvcHlBdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICQuZWFjaCgkb2xkVGFnLnByb3AoJ2F0dHJpYnV0ZXMnKSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJG9sZFRhZy5wYXJlbnQoKS5hdHRyKHRoaXMubmFtZSwgdGhpcy52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAkb2xkVGFnLmNvbnRlbnRzKCkudW53cmFwKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvLyBGdW5jdGlvbiBjYWxsIHdoZW4gdXNlciBjbGljayBvbiBcIkluc2VydCBMaW5rXCJcbiAgICAgICAgY3JlYXRlTGluazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50U2VsZWN0aW9uID0gdC5kb2MuZ2V0U2VsZWN0aW9uKCksXG4gICAgICAgICAgICAgICAgbm9kZSA9IGRvY3VtZW50U2VsZWN0aW9uLmZvY3VzTm9kZSxcbiAgICAgICAgICAgICAgICB1cmwsXG4gICAgICAgICAgICAgICAgdGl0bGUsXG4gICAgICAgICAgICAgICAgdGFyZ2V0O1xuXG4gICAgICAgICAgICB3aGlsZSAoWydBJywgJ0RJViddLmluZGV4T2Yobm9kZS5ub2RlTmFtZSkgPCAwKSB7XG4gICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5ub2RlTmFtZSA9PT0gJ0EnKSB7XG4gICAgICAgICAgICAgICAgdmFyICRhID0gJChub2RlKTtcbiAgICAgICAgICAgICAgICB1cmwgPSAkYS5hdHRyKCdocmVmJyk7XG4gICAgICAgICAgICAgICAgdGl0bGUgPSAkYS5hdHRyKCd0aXRsZScpO1xuICAgICAgICAgICAgICAgIHRhcmdldCA9ICRhLmF0dHIoJ3RhcmdldCcpO1xuICAgICAgICAgICAgICAgIHZhciByYW5nZSA9IHQuZG9jLmNyZWF0ZVJhbmdlKCk7XG4gICAgICAgICAgICAgICAgcmFuZ2Uuc2VsZWN0Tm9kZShub2RlKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudFNlbGVjdGlvbi5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudFNlbGVjdGlvbi5hZGRSYW5nZShyYW5nZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHQuc2F2ZVJhbmdlKCk7XG5cbiAgICAgICAgICAgIHQub3Blbk1vZGFsSW5zZXJ0KHQubGFuZy5jcmVhdGVMaW5rLCB7XG4gICAgICAgICAgICAgICAgdXJsOiB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnVVJMJyxcbiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB1cmxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiB0LmxhbmcudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aXRsZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdGV4dDoge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogdC5sYW5nLnRleHQsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0LmdldFJhbmdlVGV4dCgpXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0YXJnZXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHQubGFuZy50YXJnZXQsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0YXJnZXRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAodikgeyAvLyB2IGlzIHZhbHVlXG4gICAgICAgICAgICAgICAgdmFyIGxpbmsgPSAkKFsnPGEgaHJlZj1cIicsIHYudXJsLCAnXCI+Jywgdi50ZXh0LCAnPC9hPiddLmpvaW4oJycpKTtcbiAgICAgICAgICAgICAgICBpZiAodi50aXRsZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGxpbmsuYXR0cigndGl0bGUnLCB2LnRpdGxlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHYudGFyZ2V0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgbGluay5hdHRyKCd0YXJnZXQnLCB2LnRhcmdldCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHQucmFuZ2UuZGVsZXRlQ29udGVudHMoKTtcbiAgICAgICAgICAgICAgICB0LnJhbmdlLmluc2VydE5vZGUobGlua1swXSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgdW5saW5rOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMsXG4gICAgICAgICAgICAgICAgZG9jdW1lbnRTZWxlY3Rpb24gPSB0LmRvYy5nZXRTZWxlY3Rpb24oKSxcbiAgICAgICAgICAgICAgICBub2RlID0gZG9jdW1lbnRTZWxlY3Rpb24uZm9jdXNOb2RlO1xuXG4gICAgICAgICAgICBpZiAoZG9jdW1lbnRTZWxlY3Rpb24uaXNDb2xsYXBzZWQpIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAoWydBJywgJ0RJViddLmluZGV4T2Yobm9kZS5ub2RlTmFtZSkgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5ub2RlTmFtZSA9PT0gJ0EnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByYW5nZSA9IHQuZG9jLmNyZWF0ZVJhbmdlKCk7XG4gICAgICAgICAgICAgICAgICAgIHJhbmdlLnNlbGVjdE5vZGUobm9kZSk7XG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50U2VsZWN0aW9uLnJlbW92ZUFsbFJhbmdlcygpO1xuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudFNlbGVjdGlvbi5hZGRSYW5nZShyYW5nZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdC5leGVjQ21kKCd1bmxpbmsnLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdHJ1ZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGluc2VydEltYWdlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXM7XG4gICAgICAgICAgICB0LnNhdmVSYW5nZSgpO1xuICAgICAgICAgICAgdC5vcGVuTW9kYWxJbnNlcnQodC5sYW5nLmluc2VydEltYWdlLCB7XG4gICAgICAgICAgICAgICAgdXJsOiB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnVVJMJyxcbiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGFsdDoge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogdC5sYW5nLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdC5nZXRSYW5nZVRleHQoKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uICh2KSB7IC8vIHYgYXJlIHZhbHVlc1xuICAgICAgICAgICAgICAgIHQuZXhlY0NtZCgnaW5zZXJ0SW1hZ2UnLCB2LnVybCk7XG4gICAgICAgICAgICAgICAgJCgnaW1nW3NyYz1cIicgKyB2LnVybCArICdcIl06bm90KFthbHRdKScsIHQuJGJveCkuYXR0cignYWx0Jywgdi5hbHQpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bGxzY3JlZW46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcyxcbiAgICAgICAgICAgICAgICBwcmVmaXggPSB0Lm8ucHJlZml4LFxuICAgICAgICAgICAgICAgIGZ1bGxzY3JlZW5Dc3NDbGFzcyA9IHByZWZpeCArICdmdWxsc2NyZWVuJyxcbiAgICAgICAgICAgICAgICBpc0Z1bGxzY3JlZW47XG5cbiAgICAgICAgICAgIHQuJGJveC50b2dnbGVDbGFzcyhmdWxsc2NyZWVuQ3NzQ2xhc3MpO1xuICAgICAgICAgICAgaXNGdWxsc2NyZWVuID0gdC4kYm94Lmhhc0NsYXNzKGZ1bGxzY3JlZW5Dc3NDbGFzcyk7XG4gICAgICAgICAgICAkKCdib2R5JykudG9nZ2xlQ2xhc3MocHJlZml4ICsgJ2JvZHktZnVsbHNjcmVlbicsIGlzRnVsbHNjcmVlbik7XG4gICAgICAgICAgICAkKHdpbmRvdykudHJpZ2dlcignc2Nyb2xsJyk7XG4gICAgICAgICAgICB0LiRjLnRyaWdnZXIoJ3RidycgKyAoaXNGdWxsc2NyZWVuID8gJ29wZW4nIDogJ2Nsb3NlJykgKyAnZnVsbHNjcmVlbicpO1xuICAgICAgICB9LFxuXG5cbiAgICAgICAgLypcbiAgICAgICAgICogQ2FsbCBtZXRob2Qgb2YgdHJ1bWJvd3lnIGlmIGV4aXN0XG4gICAgICAgICAqIGVsc2UgdHJ5IHRvIGNhbGwgYW5vbnltb3VzIGZ1bmN0aW9uXG4gICAgICAgICAqIGFuZCBmaW5hbHkgbmF0aXZlIGV4ZWNDb21tYW5kXG4gICAgICAgICAqL1xuICAgICAgICBleGVjQ21kOiBmdW5jdGlvbiAoY21kLCBwYXJhbSwgZm9yY2VDc3MsIHNraXBUcnVtYm93eWcpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgICAgICAgIHNraXBUcnVtYm93eWcgPSAhIXNraXBUcnVtYm93eWcgfHwgJyc7XG5cbiAgICAgICAgICAgIGlmIChjbWQgIT09ICdkcm9wZG93bicpIHtcbiAgICAgICAgICAgICAgICB0LiRlZC5mb2N1cygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHQuZG9jLmV4ZWNDb21tYW5kKCdzdHlsZVdpdGhDU1MnLCBmYWxzZSwgZm9yY2VDc3MgfHwgZmFsc2UpO1xuICAgICAgICAgICAgfSBjYXRjaCAoYykge1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHRbY21kICsgc2tpcFRydW1ib3d5Z10ocGFyYW0pO1xuICAgICAgICAgICAgfSBjYXRjaCAoYykge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNtZChwYXJhbSk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZTIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNtZCA9PT0gJ2luc2VydEhvcml6b250YWxSdWxlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW0gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY21kID09PSAnZm9ybWF0QmxvY2snICYmIHQuaXNJRSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW0gPSAnPCcgKyBwYXJhbSArICc+JztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHQuZG9jLmV4ZWNDb21tYW5kKGNtZCwgZmFsc2UsIHBhcmFtKTtcblxuICAgICAgICAgICAgICAgICAgICB0LnN5bmNDb2RlKCk7XG4gICAgICAgICAgICAgICAgICAgIHQuc2VtYW50aWNDb2RlKGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoY21kICE9PSAnZHJvcGRvd24nKSB7XG4gICAgICAgICAgICAgICAgICAgIHQudXBkYXRlQnV0dG9uUGFuZVN0YXR1cygpO1xuICAgICAgICAgICAgICAgICAgICB0LiRjLnRyaWdnZXIoJ3Rid2NoYW5nZScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuXG4gICAgICAgIC8vIE9wZW4gYSBtb2RhbCBib3hcbiAgICAgICAgb3Blbk1vZGFsOiBmdW5jdGlvbiAodGl0bGUsIGNvbnRlbnQpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcyxcbiAgICAgICAgICAgICAgICBwcmVmaXggPSB0Lm8ucHJlZml4O1xuXG4gICAgICAgICAgICAvLyBObyBvcGVuIGEgbW9kYWwgYm94IHdoZW4gZXhpc3Qgb3RoZXIgbW9kYWwgYm94XG4gICAgICAgICAgICBpZiAoJCgnLicgKyBwcmVmaXggKyAnbW9kYWwtYm94JywgdC4kYm94KS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHQuby5hdXRvZ3Jvd09uRW50ZXIpIHtcbiAgICAgICAgICAgICAgICB0LmF1dG9ncm93T25FbnRlckRvbnRDbG9zZSA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHQuc2F2ZVJhbmdlKCk7XG4gICAgICAgICAgICB0LnNob3dPdmVybGF5KCk7XG5cbiAgICAgICAgICAgIC8vIERpc2FibGUgYWxsIGJ0blBhbmUgYnRuc1xuICAgICAgICAgICAgdC4kYnRuUGFuZS5hZGRDbGFzcyhwcmVmaXggKyAnZGlzYWJsZScpO1xuXG4gICAgICAgICAgICAvLyBCdWlsZCBvdXQgb2YgTW9kYWxCb3gsIGl0J3MgdGhlIG1hc2sgZm9yIGFuaW1hdGlvbnNcbiAgICAgICAgICAgIHZhciAkbW9kYWwgPSAkKCc8ZGl2Lz4nLCB7XG4gICAgICAgICAgICAgICAgY2xhc3M6IHByZWZpeCArICdtb2RhbCAnICsgcHJlZml4ICsgJ2ZpeGVkLXRvcCdcbiAgICAgICAgICAgIH0pLmNzcyh7XG4gICAgICAgICAgICAgICAgdG9wOiB0LiRidG5QYW5lLmhlaWdodCgpXG4gICAgICAgICAgICB9KS5hcHBlbmRUbyh0LiRib3gpO1xuXG4gICAgICAgICAgICAvLyBDbGljayBvbiBvdmVybGF5IGNsb3NlIG1vZGFsIGJ5IGNhbmNlbGxpbmcgdGhlbVxuICAgICAgICAgICAgdC4kb3ZlcmxheS5vbmUoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICRtb2RhbC50cmlnZ2VyKENBTkNFTF9FVkVOVCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIEJ1aWxkIHRoZSBmb3JtXG4gICAgICAgICAgICB2YXIgJGZvcm0gPSAkKCc8Zm9ybS8+Jywge1xuICAgICAgICAgICAgICAgIGFjdGlvbjogJycsXG4gICAgICAgICAgICAgICAgaHRtbDogY29udGVudFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAub24oJ3N1Ym1pdCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgJG1vZGFsLnRyaWdnZXIoQ09ORklSTV9FVkVOVCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5vbigncmVzZXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICRtb2RhbC50cmlnZ2VyKENBTkNFTF9FVkVOVCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5vbignc3VibWl0IHJlc2V0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodC5vLmF1dG9ncm93T25FbnRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdC5hdXRvZ3Jvd09uRW50ZXJEb250Q2xvc2UgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG5cbiAgICAgICAgICAgIC8vIEJ1aWxkIE1vZGFsQm94IGFuZCBhbmltYXRlIHRvIHNob3cgdGhlbVxuICAgICAgICAgICAgdmFyICRib3ggPSAkKCc8ZGl2Lz4nLCB7XG4gICAgICAgICAgICAgICAgY2xhc3M6IHByZWZpeCArICdtb2RhbC1ib3gnLFxuICAgICAgICAgICAgICAgIGh0bWw6ICRmb3JtXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB0b3A6ICctJyArIHQuJGJ0blBhbmUub3V0ZXJIZWlnaHQoKSArICdweCcsXG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDBcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hcHBlbmRUbygkbW9kYWwpXG4gICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDFcbiAgICAgICAgICAgICAgICB9LCAxMDApO1xuXG5cbiAgICAgICAgICAgIC8vIEFwcGVuZCB0aXRsZVxuICAgICAgICAgICAgJCgnPHNwYW4vPicsIHtcbiAgICAgICAgICAgICAgICB0ZXh0OiB0aXRsZSxcbiAgICAgICAgICAgICAgICBjbGFzczogcHJlZml4ICsgJ21vZGFsLXRpdGxlJ1xuICAgICAgICAgICAgfSkucHJlcGVuZFRvKCRib3gpO1xuXG4gICAgICAgICAgICAkbW9kYWwuaGVpZ2h0KCRib3gub3V0ZXJIZWlnaHQoKSArIDEwKTtcblxuXG4gICAgICAgICAgICAvLyBGb2N1cyBpbiBtb2RhbCBib3hcbiAgICAgICAgICAgICQoJ2lucHV0OmZpcnN0JywgJGJveCkuZm9jdXMoKTtcblxuXG4gICAgICAgICAgICAvLyBBcHBlbmQgQ29uZmlybSBhbmQgQ2FuY2VsIGJ1dHRvbnNcbiAgICAgICAgICAgIHQuYnVpbGRNb2RhbEJ0bignc3VibWl0JywgJGJveCk7XG4gICAgICAgICAgICB0LmJ1aWxkTW9kYWxCdG4oJ3Jlc2V0JywgJGJveCk7XG5cblxuICAgICAgICAgICAgJCh3aW5kb3cpLnRyaWdnZXIoJ3Njcm9sbCcpO1xuXG4gICAgICAgICAgICByZXR1cm4gJG1vZGFsO1xuICAgICAgICB9LFxuICAgICAgICAvLyBAcGFyYW0gbiBpcyBuYW1lIG9mIG1vZGFsXG4gICAgICAgIGJ1aWxkTW9kYWxCdG46IGZ1bmN0aW9uIChuLCAkbW9kYWwpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcyxcbiAgICAgICAgICAgICAgICBwcmVmaXggPSB0Lm8ucHJlZml4O1xuXG4gICAgICAgICAgICByZXR1cm4gJCgnPGJ1dHRvbi8+Jywge1xuICAgICAgICAgICAgICAgIGNsYXNzOiBwcmVmaXggKyAnbW9kYWwtYnV0dG9uICcgKyBwcmVmaXggKyAnbW9kYWwtJyArIG4sXG4gICAgICAgICAgICAgICAgdHlwZTogbixcbiAgICAgICAgICAgICAgICB0ZXh0OiB0Lmxhbmdbbl0gfHwgblxuICAgICAgICAgICAgfSkuYXBwZW5kVG8oJCgnZm9ybScsICRtb2RhbCkpO1xuICAgICAgICB9LFxuICAgICAgICAvLyBjbG9zZSBjdXJyZW50IG1vZGFsIGJveFxuICAgICAgICBjbG9zZU1vZGFsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMsXG4gICAgICAgICAgICAgICAgcHJlZml4ID0gdC5vLnByZWZpeDtcblxuICAgICAgICAgICAgdC4kYnRuUGFuZS5yZW1vdmVDbGFzcyhwcmVmaXggKyAnZGlzYWJsZScpO1xuICAgICAgICAgICAgdC4kb3ZlcmxheS5vZmYoKTtcblxuICAgICAgICAgICAgLy8gRmluZCB0aGUgbW9kYWwgYm94XG4gICAgICAgICAgICB2YXIgJG1vZGFsQm94ID0gJCgnLicgKyBwcmVmaXggKyAnbW9kYWwtYm94JywgdC4kYm94KTtcblxuICAgICAgICAgICAgJG1vZGFsQm94LmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIHRvcDogJy0nICsgJG1vZGFsQm94LmhlaWdodCgpXG4gICAgICAgICAgICB9LCAxMDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkbW9kYWxCb3gucGFyZW50KCkucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgdC5oaWRlT3ZlcmxheSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHQucmVzdG9yZVJhbmdlKCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vIFByZWZvcm1hdGVkIGJ1aWxkIGFuZCBtYW5hZ2VtZW50IG1vZGFsXG4gICAgICAgIG9wZW5Nb2RhbEluc2VydDogZnVuY3Rpb24gKHRpdGxlLCBmaWVsZHMsIGNtZCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLFxuICAgICAgICAgICAgICAgIHByZWZpeCA9IHQuby5wcmVmaXgsXG4gICAgICAgICAgICAgICAgbGcgPSB0LmxhbmcsXG4gICAgICAgICAgICAgICAgaHRtbCA9ICcnO1xuXG4gICAgICAgICAgICAkLmVhY2goZmllbGRzLCBmdW5jdGlvbiAoZmllbGROYW1lLCBmaWVsZCkge1xuICAgICAgICAgICAgICAgIHZhciBsID0gZmllbGQubGFiZWwsXG4gICAgICAgICAgICAgICAgICAgIG4gPSBmaWVsZC5uYW1lIHx8IGZpZWxkTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgYSA9IGZpZWxkLmF0dHJpYnV0ZXMgfHwge307XG5cbiAgICAgICAgICAgICAgICB2YXIgYXR0ciA9IE9iamVjdC5rZXlzKGEpLm1hcChmdW5jdGlvbiAocHJvcCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvcCArICc9XCInICsgYVtwcm9wXSArICdcIic7XG4gICAgICAgICAgICAgICAgfSkuam9pbignICcpO1xuXG4gICAgICAgICAgICAgICAgaHRtbCArPSAnPGxhYmVsPjxpbnB1dCB0eXBlPVwiJyArIChmaWVsZC50eXBlIHx8ICd0ZXh0JykgKyAnXCIgbmFtZT1cIicgKyBuICsgJ1wiIHZhbHVlPVwiJyArIChmaWVsZC52YWx1ZSB8fCAnJykucmVwbGFjZSgvXCIvZywgJyZxdW90OycpICsgJ1wiJyArIGF0dHIgKyAnPjxzcGFuIGNsYXNzPVwiJyArIHByZWZpeCArICdpbnB1dC1pbmZvc1wiPjxzcGFuPicgK1xuICAgICAgICAgICAgICAgICAgICAoKCFsKSA/IChsZ1tmaWVsZE5hbWVdID8gbGdbZmllbGROYW1lXSA6IGZpZWxkTmFtZSkgOiAobGdbbF0gPyBsZ1tsXSA6IGwpKSArXG4gICAgICAgICAgICAgICAgICAgICc8L3NwYW4+PC9zcGFuPjwvbGFiZWw+JztcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdC5vcGVuTW9kYWwodGl0bGUsIGh0bWwpXG4gICAgICAgICAgICAgICAgLm9uKENPTkZJUk1fRVZFTlQsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyICRmb3JtID0gJCgnZm9ybScsICQodGhpcykpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWQgPSB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0ge307XG5cbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGZpZWxkcywgZnVuY3Rpb24gKGZpZWxkTmFtZSwgZmllbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkZmllbGQgPSAkKCdpbnB1dFtuYW1lPVwiJyArIGZpZWxkTmFtZSArICdcIl0nLCAkZm9ybSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRUeXBlID0gJGZpZWxkLmF0dHIoJ3R5cGUnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0VHlwZS50b0xvd2VyQ2FzZSgpID09PSAnY2hlY2tib3gnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzW2ZpZWxkTmFtZV0gPSAkZmllbGQuaXMoJzpjaGVja2VkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1tmaWVsZE5hbWVdID0gJC50cmltKCRmaWVsZC52YWwoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBWYWxpZGF0ZSB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkLnJlcXVpcmVkICYmIHZhbHVlc1tmaWVsZE5hbWVdID09PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5hZGRFcnJvck9uTW9kYWxGaWVsZCgkZmllbGQsIHQubGFuZy5yZXF1aXJlZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZpZWxkLnBhdHRlcm4gJiYgIWZpZWxkLnBhdHRlcm4udGVzdCh2YWx1ZXNbZmllbGROYW1lXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuYWRkRXJyb3JPbk1vZGFsRmllbGQoJGZpZWxkLCBmaWVsZC5wYXR0ZXJuRXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHQucmVzdG9yZVJhbmdlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbWQodmFsdWVzLCBmaWVsZHMpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5zeW5jQ29kZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuJGMudHJpZ2dlcigndGJ3Y2hhbmdlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5jbG9zZU1vZGFsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5vZmYoQ09ORklSTV9FVkVOVCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5vbmUoQ0FOQ0VMX0VWRU5ULCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykub2ZmKENPTkZJUk1fRVZFTlQpO1xuICAgICAgICAgICAgICAgICAgICB0LmNsb3NlTW9kYWwoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgYWRkRXJyb3JPbk1vZGFsRmllbGQ6IGZ1bmN0aW9uICgkZmllbGQsIGVycikge1xuICAgICAgICAgICAgdmFyIHByZWZpeCA9IHRoaXMuby5wcmVmaXgsXG4gICAgICAgICAgICAgICAgJGxhYmVsID0gJGZpZWxkLnBhcmVudCgpO1xuXG4gICAgICAgICAgICAkZmllbGRcbiAgICAgICAgICAgICAgICAub24oJ2NoYW5nZSBrZXl1cCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgJGxhYmVsLnJlbW92ZUNsYXNzKHByZWZpeCArICdpbnB1dC1lcnJvcicpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkbGFiZWxcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MocHJlZml4ICsgJ2lucHV0LWVycm9yJylcbiAgICAgICAgICAgICAgICAuZmluZCgnaW5wdXQrc3BhbicpXG4gICAgICAgICAgICAgICAgLmFwcGVuZChcbiAgICAgICAgICAgICAgICAgICAgJCgnPHNwYW4vPicsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzOiBwcmVmaXggKyAnbXNnLWVycm9yJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGVyclxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0RGVmYXVsdEltZ0RibENsaWNrSGFuZGxlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzO1xuXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciAkaW1nID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgc3JjID0gJGltZy5hdHRyKCdzcmMnKSxcbiAgICAgICAgICAgICAgICAgICAgYmFzZTY0ID0gJyhCYXNlNjQpJztcblxuICAgICAgICAgICAgICAgIGlmIChzcmMuaW5kZXhPZignZGF0YTppbWFnZScpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHNyYyA9IGJhc2U2NDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0Lm9wZW5Nb2RhbEluc2VydCh0LmxhbmcuaW5zZXJ0SW1hZ2UsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ1VSTCcsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogc3JjLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgYWx0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogdC5sYW5nLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICRpbWcuYXR0cignYWx0JylcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2LnNyYyAhPT0gYmFzZTY0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkaW1nLmF0dHIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyYzogdi5zcmNcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICRpbWcuYXR0cih7XG4gICAgICAgICAgICAgICAgICAgICAgICBhbHQ6IHYuYWx0XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vIFJhbmdlIG1hbmFnZW1lbnRcbiAgICAgICAgc2F2ZVJhbmdlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMsXG4gICAgICAgICAgICAgICAgZG9jdW1lbnRTZWxlY3Rpb24gPSB0LmRvYy5nZXRTZWxlY3Rpb24oKTtcblxuICAgICAgICAgICAgdC5yYW5nZSA9IG51bGw7XG5cbiAgICAgICAgICAgIGlmIChkb2N1bWVudFNlbGVjdGlvbi5yYW5nZUNvdW50KSB7XG4gICAgICAgICAgICAgICAgdmFyIHNhdmVkUmFuZ2UgPSB0LnJhbmdlID0gZG9jdW1lbnRTZWxlY3Rpb24uZ2V0UmFuZ2VBdCgwKSxcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2UgPSB0LmRvYy5jcmVhdGVSYW5nZSgpLFxuICAgICAgICAgICAgICAgICAgICByYW5nZVN0YXJ0O1xuICAgICAgICAgICAgICAgIHJhbmdlLnNlbGVjdE5vZGVDb250ZW50cyh0LiRlZFswXSk7XG4gICAgICAgICAgICAgICAgcmFuZ2Uuc2V0RW5kKHNhdmVkUmFuZ2Uuc3RhcnRDb250YWluZXIsIHNhdmVkUmFuZ2Uuc3RhcnRPZmZzZXQpO1xuICAgICAgICAgICAgICAgIHJhbmdlU3RhcnQgPSAocmFuZ2UgKyAnJykubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHQubWV0YVJhbmdlID0ge1xuICAgICAgICAgICAgICAgICAgICBzdGFydDogcmFuZ2VTdGFydCxcbiAgICAgICAgICAgICAgICAgICAgZW5kOiByYW5nZVN0YXJ0ICsgKHNhdmVkUmFuZ2UgKyAnJykubGVuZ3RoXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcmVzdG9yZVJhbmdlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMsXG4gICAgICAgICAgICAgICAgbWV0YVJhbmdlID0gdC5tZXRhUmFuZ2UsXG4gICAgICAgICAgICAgICAgc2F2ZWRSYW5nZSA9IHQucmFuZ2UsXG4gICAgICAgICAgICAgICAgZG9jdW1lbnRTZWxlY3Rpb24gPSB0LmRvYy5nZXRTZWxlY3Rpb24oKSxcbiAgICAgICAgICAgICAgICByYW5nZTtcblxuICAgICAgICAgICAgaWYgKCFzYXZlZFJhbmdlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobWV0YVJhbmdlICYmIG1ldGFSYW5nZS5zdGFydCAhPT0gbWV0YVJhbmdlLmVuZCkgeyAvLyBBbGdvcml0aG0gZnJvbSBodHRwOi8vanNmaWRkbGUubmV0L1dlV3k3LzMvXG4gICAgICAgICAgICAgICAgdmFyIGNoYXJJbmRleCA9IDAsXG4gICAgICAgICAgICAgICAgICAgIG5vZGVTdGFjayA9IFt0LiRlZFswXV0sXG4gICAgICAgICAgICAgICAgICAgIG5vZGUsXG4gICAgICAgICAgICAgICAgICAgIGZvdW5kU3RhcnQgPSBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgc3RvcCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgcmFuZ2UgPSB0LmRvYy5jcmVhdGVSYW5nZSgpO1xuXG4gICAgICAgICAgICAgICAgd2hpbGUgKCFzdG9wICYmIChub2RlID0gbm9kZVN0YWNrLnBvcCgpKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5leHRDaGFySW5kZXggPSBjaGFySW5kZXggKyBub2RlLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZm91bmRTdGFydCAmJiBtZXRhUmFuZ2Uuc3RhcnQgPj0gY2hhckluZGV4ICYmIG1ldGFSYW5nZS5zdGFydCA8PSBuZXh0Q2hhckluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZ2Uuc2V0U3RhcnQobm9kZSwgbWV0YVJhbmdlLnN0YXJ0IC0gY2hhckluZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZFN0YXJ0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmb3VuZFN0YXJ0ICYmIG1ldGFSYW5nZS5lbmQgPj0gY2hhckluZGV4ICYmIG1ldGFSYW5nZS5lbmQgPD0gbmV4dENoYXJJbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlLnNldEVuZChub2RlLCBtZXRhUmFuZ2UuZW5kIC0gY2hhckluZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJJbmRleCA9IG5leHRDaGFySW5kZXg7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY24gPSBub2RlLmNoaWxkTm9kZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaSA9IGNuLmxlbmd0aDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGkgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaSAtPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVTdGFjay5wdXNoKGNuW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZG9jdW1lbnRTZWxlY3Rpb24ucmVtb3ZlQWxsUmFuZ2VzKCk7XG4gICAgICAgICAgICBkb2N1bWVudFNlbGVjdGlvbi5hZGRSYW5nZShyYW5nZSB8fCBzYXZlZFJhbmdlKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0UmFuZ2VUZXh0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yYW5nZSArICcnO1xuICAgICAgICB9LFxuXG4gICAgICAgIHVwZGF0ZUJ1dHRvblBhbmVTdGF0dXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcyxcbiAgICAgICAgICAgICAgICBwcmVmaXggPSB0Lm8ucHJlZml4LFxuICAgICAgICAgICAgICAgIHRhZ3MgPSB0LmdldFRhZ3NSZWN1cnNpdmUodC5kb2MuZ2V0U2VsZWN0aW9uKCkuZm9jdXNOb2RlKSxcbiAgICAgICAgICAgICAgICBhY3RpdmVDbGFzc2VzID0gcHJlZml4ICsgJ2FjdGl2ZS1idXR0b24gJyArIHByZWZpeCArICdhY3RpdmUnO1xuXG4gICAgICAgICAgICAkKCcuJyArIHByZWZpeCArICdhY3RpdmUtYnV0dG9uJywgdC4kYnRuUGFuZSkucmVtb3ZlQ2xhc3MoYWN0aXZlQ2xhc3Nlcyk7XG4gICAgICAgICAgICAkLmVhY2godGFncywgZnVuY3Rpb24gKGksIHRhZykge1xuICAgICAgICAgICAgICAgIHZhciBidG5OYW1lID0gdC50YWdUb0J1dHRvblt0YWcudG9Mb3dlckNhc2UoKV0sXG4gICAgICAgICAgICAgICAgICAgICRidG4gPSAkKCcuJyArIHByZWZpeCArIGJ0bk5hbWUgKyAnLWJ1dHRvbicsIHQuJGJ0blBhbmUpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCRidG4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAkYnRuLmFkZENsYXNzKGFjdGl2ZUNsYXNzZXMpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkYnRuID0gJCgnLicgKyBwcmVmaXggKyAnZHJvcGRvd24gLicgKyBwcmVmaXggKyBidG5OYW1lICsgJy1kcm9wZG93bi1idXR0b24nLCB0LiRib3gpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRyb3Bkb3duQnRuTmFtZSA9ICRidG4ucGFyZW50KCkuZGF0YSgnZHJvcGRvd24nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy4nICsgcHJlZml4ICsgZHJvcGRvd25CdG5OYW1lICsgJy1idXR0b24nLCB0LiRib3gpLmFkZENsYXNzKGFjdGl2ZUNsYXNzZXMpO1xuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0VGFnc1JlY3Vyc2l2ZTogZnVuY3Rpb24gKGVsZW1lbnQsIHRhZ3MpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgICAgICAgIHRhZ3MgPSB0YWdzIHx8IChlbGVtZW50ICYmIGVsZW1lbnQudGFnTmFtZSA/IFtlbGVtZW50LnRhZ05hbWVdIDogW10pO1xuXG4gICAgICAgICAgICBpZiAoZWxlbWVudCAmJiBlbGVtZW50LnBhcmVudE5vZGUpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5wYXJlbnROb2RlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGFncztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHRhZyA9IGVsZW1lbnQudGFnTmFtZTtcbiAgICAgICAgICAgIGlmICh0YWcgPT09ICdESVYnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRhZ3M7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGFnID09PSAnUCcgJiYgZWxlbWVudC5zdHlsZS50ZXh0QWxpZ24gIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgdGFncy5wdXNoKGVsZW1lbnQuc3R5bGUudGV4dEFsaWduKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJC5lYWNoKHQudGFnSGFuZGxlcnMsIGZ1bmN0aW9uIChpLCB0YWdIYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgdGFncyA9IHRhZ3MuY29uY2F0KHRhZ0hhbmRsZXIoZWxlbWVudCwgdCkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRhZ3MucHVzaCh0YWcpO1xuXG4gICAgICAgICAgICByZXR1cm4gdC5nZXRUYWdzUmVjdXJzaXZlKGVsZW1lbnQsIHRhZ3MpLmZpbHRlcihmdW5jdGlvbih0YWcpIHsgcmV0dXJuIHRhZyAhPSBudWxsOyB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvLyBQbHVnaW5zXG4gICAgICAgIGluaXRQbHVnaW5zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXM7XG4gICAgICAgICAgICB0LmxvYWRlZFBsdWdpbnMgPSBbXTtcbiAgICAgICAgICAgICQuZWFjaCgkLnRydW1ib3d5Zy5wbHVnaW5zLCBmdW5jdGlvbiAobmFtZSwgcGx1Z2luKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFwbHVnaW4uc2hvdWxkSW5pdCB8fCBwbHVnaW4uc2hvdWxkSW5pdCh0KSkge1xuICAgICAgICAgICAgICAgICAgICBwbHVnaW4uaW5pdCh0KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBsdWdpbi50YWdIYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0LnRhZ0hhbmRsZXJzLnB1c2gocGx1Z2luLnRhZ0hhbmRsZXIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHQubG9hZGVkUGx1Z2lucy5wdXNoKHBsdWdpbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGRlc3Ryb3lQbHVnaW5zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkLmVhY2godGhpcy5sb2FkZWRQbHVnaW5zLCBmdW5jdGlvbiAoaSwgcGx1Z2luKSB7XG4gICAgICAgICAgICAgICAgaWYgKHBsdWdpbi5kZXN0cm95KSB7XG4gICAgICAgICAgICAgICAgICAgIHBsdWdpbi5kZXN0cm95KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xufSkobmF2aWdhdG9yLCB3aW5kb3csIGRvY3VtZW50LCBqUXVlcnkpO1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIHRydW1ib3d5Zy5iYXNlNjQuanMgdjEuMFxuICogQmFzZTY0IHBsdWdpbiBmb3IgVHJ1bWJvd3lnXG4gKiBodHRwOi8vYWxleC1kLmdpdGh1Yi5jb20vVHJ1bWJvd3lnXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQXV0aG9yIDogQ3lyaWwgQmllbmNvdXJ0IChsaXphcmRLKVxuICovXG5cbihmdW5jdGlvbiAoJCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBpc1N1cHBvcnRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHR5cGVvZiBGaWxlUmVhZGVyICE9PSAndW5kZWZpbmVkJztcbiAgICB9O1xuXG4gICAgdmFyIGlzVmFsaWRJbWFnZSA9IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICAgIHJldHVybiAvXmRhdGE6aW1hZ2VcXC9bYS16XT8vaS50ZXN0KHR5cGUpO1xuICAgIH07XG5cbiAgICAkLmV4dGVuZCh0cnVlLCAkLnRydW1ib3d5Zywge1xuICAgICAgICBsYW5nczoge1xuICAgICAgICAgICAgLy8ganNoaW50IGNhbWVsY2FzZTpmYWxzZVxuICAgICAgICAgICAgZW46IHtcbiAgICAgICAgICAgICAgICBiYXNlNjQ6ICdJbWFnZSBhcyBiYXNlNjQnLFxuICAgICAgICAgICAgICAgIGZpbGU6ICdGaWxlJyxcbiAgICAgICAgICAgICAgICBlcnJGaWxlUmVhZGVyTm90U3VwcG9ydGVkOiAnRmlsZVJlYWRlciBpcyBub3Qgc3VwcG9ydGVkIGJ5IHlvdXIgYnJvd3Nlci4nLFxuICAgICAgICAgICAgICAgIGVyckludmFsaWRJbWFnZTogJ0ludmFsaWQgaW1hZ2UgZmlsZS4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZnI6IHtcbiAgICAgICAgICAgICAgICBiYXNlNjQ6ICdJbWFnZSBlbiBiYXNlNjQnLFxuICAgICAgICAgICAgICAgIGZpbGU6ICdGaWNoaWVyJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNzOiB7XG4gICAgICAgICAgICAgICAgYmFzZTY0OiAnVmxvxb5pdCBvYnLDoXplaycsXG4gICAgICAgICAgICAgICAgZmlsZTogJ1NvdWJvcidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB6aF9jbjoge1xuICAgICAgICAgICAgICAgIGJhc2U2NDogJ+WbvueJh++8iEJhc2U2NOe8luegge+8iScsXG4gICAgICAgICAgICAgICAgZmlsZTogJ+aWh+S7tidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBubDoge1xuICAgICAgICAgICAgICAgIGVyckZpbGVSZWFkZXJOb3RTdXBwb3J0ZWQ6ICdVdyBicm93c2VyIG9uZGVyc3RldW50IGRlemUgZnVuY3Rpb25hbGl0ZWl0IG5pZXQuJyxcbiAgICAgICAgICAgICAgICBlcnJJbnZhbGlkSW1hZ2U6ICdEZSBnZWtvemVuIGFmYmVlbGRpbmcgaXMgb25nZWxkaWcuJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJ1OiB7XG4gICAgICAgICAgICAgICAgYmFzZTY0OiAn0JjQt9C+0LHRgNCw0LbQtdC90LjQtSDQutCw0Log0LrQvtC0INCyIGJhc2U2NCcsXG4gICAgICAgICAgICAgICAgZmlsZTogJ9Ck0LDQudC7JyxcbiAgICAgICAgICAgICAgICBlcnJGaWxlUmVhZGVyTm90U3VwcG9ydGVkOiAnRmlsZVJlYWRlciDQvdC1INC/0L7QtNC00LXRgNC20LjQstCw0LXRgtGB0Y8g0LLQsNGI0LjQvCDQsdGA0LDRg9C30LXRgNC+0LwuJyxcbiAgICAgICAgICAgICAgICBlcnJJbnZhbGlkSW1hZ2U6ICfQndC10LTQvtC/0YPRgdGC0LjQvNGL0Lkg0YTQsNC50Lsg0LjQt9C+0LHRgNCw0LbQtdC90LjRjy4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgamE6IHtcbiAgICAgICAgICAgICAgICBiYXNlNjQ6ICfnlLvlg48gKEJhc2U2NOW9ouW8jyknLFxuICAgICAgICAgICAgICAgIGZpbGU6ICfjg5XjgqHjgqTjg6snLFxuICAgICAgICAgICAgICAgIGVyckZpbGVSZWFkZXJOb3RTdXBwb3J0ZWQ6ICfjgYLjgarjgZ/jga7jg5bjg6njgqbjgrbjg7zjga9GaWxlUmVhZGVy44KS44K144Od44O844OI44GX44Gm44GE44G+44Gb44KTJyxcbiAgICAgICAgICAgICAgICBlcnJJbnZhbGlkSW1hZ2U6ICfnlLvlg4/lvaLlvI/jgYzmraPjgZfjgY/jgYLjgorjgb7jgZvjgpMnXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIC8vIGpzaGludCBjYW1lbGNhc2U6dHJ1ZVxuXG4gICAgICAgIHBsdWdpbnM6IHtcbiAgICAgICAgICAgIGJhc2U2NDoge1xuICAgICAgICAgICAgICAgIHNob3VsZEluaXQ6IGlzU3VwcG9ydGVkLFxuICAgICAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uICh0cnVtYm93eWcpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJ0bkRlZiA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzU3VwcG9ydGVkOiBpc1N1cHBvcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLnNhdmVSYW5nZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRtb2RhbCA9IHRydW1ib3d5Zy5vcGVuTW9kYWxJbnNlcnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRpdGxlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5sYW5nLmJhc2U2NCxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGaWVsZHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdmaWxlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY2VwdDogJ2ltYWdlLyonXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnZGVzY3JpcHRpb24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0cnVtYm93eWcuZ2V0UmFuZ2VUZXh0KClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDYWxsYmFja1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAodmFsdWVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZlJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZSZWFkZXIub25sb2FkZW5kID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNWYWxpZEltYWdlKGUudGFyZ2V0LnJlc3VsdCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLmV4ZWNDbWQoJ2luc2VydEltYWdlJywgZlJlYWRlci5yZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFsnaW1nW3NyYz1cIicsIGZSZWFkZXIucmVzdWx0LCAnXCJdOm5vdChbYWx0XSknXS5qb2luKCcnKSwgdHJ1bWJvd3lnLiRib3gpLmF0dHIoJ2FsdCcsIHZhbHVlcy5hbHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVtYm93eWcuY2xvc2VNb2RhbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5hZGRFcnJvck9uTW9kYWxGaWVsZChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJ2lucHV0W3R5cGU9ZmlsZV0nLCAkbW9kYWwpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLmxhbmcuZXJySW52YWxpZEltYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZlJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJ2lucHV0W3R5cGU9ZmlsZV0nKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZSA9IGUudGFyZ2V0LmZpbGVzWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5hZGRCdG5EZWYoJ2Jhc2U2NCcsIGJ0bkRlZik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KShqUXVlcnkpO1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIHRydW1ib3d5Zy5jb2xvcnMuanMgdjEuMlxuICogQ29sb3JzIHBpY2tlciBwbHVnaW4gZm9yIFRydW1ib3d5Z1xuICogaHR0cDovL2FsZXgtZC5naXRodWIuY29tL1RydW1ib3d5Z1xuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIEF1dGhvciA6IEFsZXhhbmRyZSBEZW1vZGUgKEFsZXgtRClcbiAqICAgICAgICAgIFR3aXR0ZXIgOiBAQWxleGFuZHJlRGVtb2RlXG4gKiAgICAgICAgICBXZWJzaXRlIDogYWxleC1kLmZyXG4gKi9cblxuKGZ1bmN0aW9uICgkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgJC5leHRlbmQodHJ1ZSwgJC50cnVtYm93eWcsIHtcbiAgICAgICAgbGFuZ3M6IHtcbiAgICAgICAgICAgIC8vIGpzaGludCBjYW1lbGNhc2U6ZmFsc2VcbiAgICAgICAgICAgIGNzOiB7XG4gICAgICAgICAgICAgICAgZm9yZUNvbG9yOiAnQmFydmEgdGV4dHUnLFxuICAgICAgICAgICAgICAgIGJhY2tDb2xvcjogJ0JhcnZhIHBvemFkw60nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW46IHtcbiAgICAgICAgICAgICAgICBmb3JlQ29sb3I6ICdUZXh0IGNvbG9yJyxcbiAgICAgICAgICAgICAgICBiYWNrQ29sb3I6ICdCYWNrZ3JvdW5kIGNvbG9yJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZyOiB7XG4gICAgICAgICAgICAgICAgZm9yZUNvbG9yOiAnQ291bGV1ciBkdSB0ZXh0ZScsXG4gICAgICAgICAgICAgICAgYmFja0NvbG9yOiAnQ291bGV1ciBkZSBmb25kJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNrOiB7XG4gICAgICAgICAgICAgICAgZm9yZUNvbG9yOiAnRmFyYmEgdGV4dHUnLFxuICAgICAgICAgICAgICAgIGJhY2tDb2xvcjogJ0ZhcmJhIHBvemFkaWEnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgemhfY246IHtcbiAgICAgICAgICAgICAgICBmb3JlQ29sb3I6ICfmloflrZfpopzoibInLFxuICAgICAgICAgICAgICAgIGJhY2tDb2xvcjogJ+iDjOaZr+minOiJsidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBydToge1xuICAgICAgICAgICAgICAgIGZvcmVDb2xvcjogJ9Cm0LLQtdGCINGC0LXQutGB0YLQsCcsXG4gICAgICAgICAgICAgICAgYmFja0NvbG9yOiAn0KbQstC10YIg0LLRi9C00LXQu9C10L3QuNGPINGC0LXQutGB0YLQsCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBqYToge1xuICAgICAgICAgICAgICAgIGZvcmVDb2xvcjogJ+aWh+Wtl+iJsicsXG4gICAgICAgICAgICAgICAgYmFja0NvbG9yOiAn6IOM5pmv6ImyJ1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG4gICAgLy8ganNoaW50IGNhbWVsY2FzZTp0cnVlXG5cblxuICAgIGZ1bmN0aW9uIGhleCh4KSB7XG4gICAgICAgIHJldHVybiAoJzAnICsgcGFyc2VJbnQoeCkudG9TdHJpbmcoMTYpKS5zbGljZSgtMik7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY29sb3JUb0hleChyZ2IpIHtcbiAgICAgICAgaWYgKHJnYi5zZWFyY2goJ3JnYicpID09PSAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIHJnYi5yZXBsYWNlKCcjJywgJycpO1xuICAgICAgICB9IGVsc2UgaWYgKHJnYiA9PT0gJ3JnYmEoMCwgMCwgMCwgMCknKSB7XG4gICAgICAgICAgICByZXR1cm4gJ3RyYW5zcGFyZW50JztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJnYiA9IHJnYi5tYXRjaCgvXnJnYmE/XFwoKFxcZCspLFxccyooXFxkKyksXFxzKihcXGQrKSg/OixcXHMqKFxcZCspKT9cXCkkLyk7XG4gICAgICAgICAgICByZXR1cm4gaGV4KHJnYlsxXSkgKyBoZXgocmdiWzJdKSArIGhleChyZ2JbM10pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY29sb3JUYWdIYW5kbGVyKGVsZW1lbnQsIHRydW1ib3d5Zykge1xuICAgICAgICB2YXIgdGFncyA9IFtdO1xuXG4gICAgICAgIGlmKCFlbGVtZW50LnN0eWxlKXtcbiAgICAgICAgICAgIHJldHVybiB0YWdzO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gYmFja2dyb3VuZCBjb2xvclxuICAgICAgICBpZiAoZWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgIT09ICcnKSB7XG4gICAgICAgICAgICB2YXIgYmFja0NvbG9yID0gY29sb3JUb0hleChlbGVtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvcik7XG4gICAgICAgICAgICBpZiAodHJ1bWJvd3lnLm8ucGx1Z2lucy5jb2xvcnMuY29sb3JMaXN0LmluZGV4T2YoYmFja0NvbG9yKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgdGFncy5wdXNoKCdiYWNrQ29sb3InICsgYmFja0NvbG9yKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGFncy5wdXNoKCdiYWNrQ29sb3JGcmVlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyB0ZXh0IGNvbG9yXG4gICAgICAgIHZhciBmb3JlQ29sb3I7XG4gICAgICAgIGlmIChlbGVtZW50LnN0eWxlLmNvbG9yICE9PSAnJykge1xuICAgICAgICAgICAgZm9yZUNvbG9yID0gY29sb3JUb0hleChlbGVtZW50LnN0eWxlLmNvbG9yKTtcbiAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50Lmhhc0F0dHJpYnV0ZSgnY29sb3InKSkge1xuICAgICAgICAgICAgZm9yZUNvbG9yID0gY29sb3JUb0hleChlbGVtZW50LmdldEF0dHJpYnV0ZSgnY29sb3InKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZvcmVDb2xvcikge1xuICAgICAgICAgICAgaWYgKHRydW1ib3d5Zy5vLnBsdWdpbnMuY29sb3JzLmNvbG9yTGlzdC5pbmRleE9mKGZvcmVDb2xvcikgPj0gMCkge1xuICAgICAgICAgICAgICAgIHRhZ3MucHVzaCgnZm9yZUNvbG9yJyArIGZvcmVDb2xvcik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRhZ3MucHVzaCgnZm9yZUNvbG9yRnJlZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRhZ3M7XG4gICAgfVxuXG4gICAgdmFyIGRlZmF1bHRPcHRpb25zID0ge1xuICAgICAgICBjb2xvckxpc3Q6IFsnZmZmZmZmJywgJzAwMDAwMCcsICdlZWVjZTEnLCAnMWY0OTdkJywgJzRmODFiZCcsICdjMDUwNGQnLCAnOWJiYjU5JywgJzgwNjRhMicsICc0YmFjYzYnLCAnZjc5NjQ2JywgJ2ZmZmYwMCcsICdmMmYyZjInLCAnN2Y3ZjdmJywgJ2RkZDljMycsICdjNmQ5ZjAnLCAnZGJlNWYxJywgJ2YyZGNkYicsICdlYmYxZGQnLCAnZTVlMGVjJywgJ2RiZWVmMycsICdmZGVhZGEnLCAnZmZmMmNhJywgJ2Q4ZDhkOCcsICc1OTU5NTknLCAnYzRiZDk3JywgJzhkYjNlMicsICdiOGNjZTQnLCAnZTViOWI3JywgJ2Q3ZTNiYycsICdjY2MxZDknLCAnYjdkZGU4JywgJ2ZiZDViNScsICdmZmU2OTQnLCAnYmZiZmJmJywgJzNmM2YzZicsICc5Mzg5NTMnLCAnNTQ4ZGQ0JywgJzk1YjNkNycsICdkOTk2OTQnLCAnYzNkNjliJywgJ2IyYTJjNycsICdiN2RkZTgnLCAnZmFjMDhmJywgJ2YyYzMxNCcsICdhNWE1YTUnLCAnMjYyNjI2JywgJzQ5NDQyOScsICcxNzM2NWQnLCAnMzY2MDkyJywgJzk1MzczNCcsICc3NjkyM2MnLCAnNWY0OTdhJywgJzkyY2RkYycsICdlMzZjMDknLCAnYzA5MTAwJywgJzdmN2Y3ZicsICcwYzBjMGMnLCAnMWQxYjEwJywgJzBmMjQzZScsICcyNDQwNjEnLCAnNjMyNDIzJywgJzRmNjEyOCcsICczZjMxNTEnLCAnMzE4NTliJywgJzk3NDgwNicsICc3ZjYwMDAnXVxuICAgIH07XG5cbiAgICAvLyBBZGQgYWxsIGNvbG9ycyBpbiB0d28gZHJvcGRvd25zXG4gICAgJC5leHRlbmQodHJ1ZSwgJC50cnVtYm93eWcsIHtcbiAgICAgICAgcGx1Z2luczoge1xuICAgICAgICAgICAgY29sb3I6IHtcbiAgICAgICAgICAgICAgICBpbml0OiBmdW5jdGlvbiAodHJ1bWJvd3lnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5vLnBsdWdpbnMuY29sb3JzID0gdHJ1bWJvd3lnLm8ucGx1Z2lucy5jb2xvcnMgfHwgZGVmYXVsdE9wdGlvbnM7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmb3JlQ29sb3JCdG5EZWYgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJvcGRvd246IGJ1aWxkRHJvcGRvd24oJ2ZvcmVDb2xvcicsIHRydW1ib3d5ZylcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrQ29sb3JCdG5EZWYgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJvcGRvd246IGJ1aWxkRHJvcGRvd24oJ2JhY2tDb2xvcicsIHRydW1ib3d5ZylcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLmFkZEJ0bkRlZignZm9yZUNvbG9yJywgZm9yZUNvbG9yQnRuRGVmKTtcbiAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLmFkZEJ0bkRlZignYmFja0NvbG9yJywgYmFja0NvbG9yQnRuRGVmKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRhZ0hhbmRsZXI6IGNvbG9yVGFnSGFuZGxlclxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBidWlsZERyb3Bkb3duKGZuLCB0cnVtYm93eWcpIHtcbiAgICAgICAgdmFyIGRyb3Bkb3duID0gW107XG5cbiAgICAgICAgJC5lYWNoKHRydW1ib3d5Zy5vLnBsdWdpbnMuY29sb3JzLmNvbG9yTGlzdCwgZnVuY3Rpb24gKGksIGNvbG9yKSB7XG4gICAgICAgICAgICB2YXIgYnRuID0gZm4gKyBjb2xvcixcbiAgICAgICAgICAgICAgICBidG5EZWYgPSB7XG4gICAgICAgICAgICAgICAgICAgIGZuOiBmbixcbiAgICAgICAgICAgICAgICAgICAgZm9yY2VDc3M6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtOiAnIycgKyBjb2xvcixcbiAgICAgICAgICAgICAgICAgICAgc3R5bGU6ICdiYWNrZ3JvdW5kLWNvbG9yOiAjJyArIGNvbG9yICsgJzsnXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRydW1ib3d5Zy5hZGRCdG5EZWYoYnRuLCBidG5EZWYpO1xuICAgICAgICAgICAgZHJvcGRvd24ucHVzaChidG4pO1xuICAgICAgICB9KTtcblxuICAgICAgICB2YXIgcmVtb3ZlQ29sb3JCdXR0b25OYW1lID0gZm4gKyAnUmVtb3ZlJyxcbiAgICAgICAgICAgIHJlbW92ZUNvbG9yQnRuRGVmID0ge1xuICAgICAgICAgICAgICAgIGZuOiAncmVtb3ZlRm9ybWF0JyxcbiAgICAgICAgICAgICAgICBwYXJhbTogZm4sXG4gICAgICAgICAgICAgICAgc3R5bGU6ICdiYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFBUUFBQUFFQ0FZQUFBQ3A4WjUrQUFBQUcwbEVRVlFJVzJOa1FBQWZFSk1SbXdCWWhvR0JZUXRNQllvQUFEemlBcDBqdEpUZ0FBQUFBRWxGVGtTdVFtQ0MpOydcbiAgICAgICAgICAgIH07XG4gICAgICAgIHRydW1ib3d5Zy5hZGRCdG5EZWYocmVtb3ZlQ29sb3JCdXR0b25OYW1lLCByZW1vdmVDb2xvckJ0bkRlZik7XG4gICAgICAgIGRyb3Bkb3duLnB1c2gocmVtb3ZlQ29sb3JCdXR0b25OYW1lKTtcblxuICAgICAgICAvLyBhZGQgZnJlZSBjb2xvciBidG5cbiAgICAgICAgdmFyIGZyZWVDb2xvckJ1dHRvbk5hbWUgPSBmbiArICdGcmVlJyxcbiAgICAgICAgICAgIGZyZWVDb2xvckJ0bkRlZiA9IHtcbiAgICAgICAgICAgICAgICBmbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB0cnVtYm93eWcub3Blbk1vZGFsSW5zZXJ0KHRydW1ib3d5Zy5sYW5nW2ZuXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogZm4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnI0ZGRkZGRidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2FsbGJhY2tcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICh2YWx1ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVtYm93eWcuZXhlY0NtZChmbiwgdmFsdWVzLmNvbG9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRleHQ6ICcjJyxcbiAgICAgICAgICAgICAgICAvLyBzdHlsZSBhZGp1c3QgZm9yIGRpc3BsYXlpbmcgdGhlIHRleHRcbiAgICAgICAgICAgICAgICBzdHlsZTogJ3RleHQtaW5kZW50OiAwO2xpbmUtaGVpZ2h0OiAyMHB4O3BhZGRpbmc6IDAgNXB4OydcbiAgICAgICAgICAgIH07XG4gICAgICAgIHRydW1ib3d5Zy5hZGRCdG5EZWYoZnJlZUNvbG9yQnV0dG9uTmFtZSwgZnJlZUNvbG9yQnRuRGVmKTtcbiAgICAgICAgZHJvcGRvd24ucHVzaChmcmVlQ29sb3JCdXR0b25OYW1lKTtcblxuICAgICAgICByZXR1cm4gZHJvcGRvd247XG4gICAgfVxufSkoalF1ZXJ5KTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiB0cnVtYm93eWcubm9lbWJlZC5qcyB2MS4wXG4gKiBub0VtYmVkIHBsdWdpbiBmb3IgVHJ1bWJvd3lnXG4gKiBodHRwOi8vYWxleC1kLmdpdGh1Yi5jb20vVHJ1bWJvd3lnXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQXV0aG9yIDogSmFrZSBKb2hucyAoamFrZWpvaG5zKVxuICovXG5cbihmdW5jdGlvbiAoJCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBkZWZhdWx0T3B0aW9ucyA9IHtcbiAgICAgICAgcHJveHk6ICdodHRwczovL25vZW1iZWQuY29tL2VtYmVkP25vd3JhcD1vbicsXG4gICAgICAgIHVybEZpbGVkOiAndXJsJyxcbiAgICAgICAgZGF0YTogW10sXG4gICAgICAgIHN1Y2Nlc3M6IHVuZGVmaW5lZCxcbiAgICAgICAgZXJyb3I6IHVuZGVmaW5lZFxuICAgIH07XG5cbiAgICAkLmV4dGVuZCh0cnVlLCAkLnRydW1ib3d5Zywge1xuICAgICAgICBsYW5nczoge1xuICAgICAgICAgICAgZW46IHtcbiAgICAgICAgICAgICAgICBub2VtYmVkOiAnTm9lbWJlZCcsXG4gICAgICAgICAgICAgICAgbm9lbWJlZEVycm9yOiAnRXJyb3InXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2s6IHtcbiAgICAgICAgICAgICAgICBub2VtYmVkRXJyb3I6ICdDaHliYSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmcjoge1xuICAgICAgICAgICAgICAgIG5vZW1iZWRFcnJvcjogJ0VycmV1cidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjczoge1xuICAgICAgICAgICAgICAgIG5vZW1iZWRFcnJvcjogJ0NoeWJhJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJ1OiB7XG4gICAgICAgICAgICAgICAgbm9lbWJlZEVycm9yOiAn0J7RiNC40LHQutCwJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGphOiB7XG4gICAgICAgICAgICAgICAgbm9lbWJlZEVycm9yOiAn44Ko44Op44O8J1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHBsdWdpbnM6IHtcbiAgICAgICAgICAgIG5vZW1iZWQ6IHtcbiAgICAgICAgICAgICAgICBpbml0OiBmdW5jdGlvbiAodHJ1bWJvd3lnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5vLnBsdWdpbnMubm9lbWJlZCA9ICQuZXh0ZW5kKHRydWUsIHt9LCBkZWZhdWx0T3B0aW9ucywgdHJ1bWJvd3lnLm8ucGx1Z2lucy5ub2VtYmVkIHx8IHt9KTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgYnRuRGVmID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJG1vZGFsID0gdHJ1bWJvd3lnLm9wZW5Nb2RhbEluc2VydChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGl0bGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLmxhbmcubm9lbWJlZCxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGaWVsZHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdVUkwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2FsbGJhY2tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB0cnVtYm93eWcuby5wbHVnaW5zLm5vZW1iZWQucHJveHksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydW1ib3d5Zy5vLnBsdWdpbnMubm9lbWJlZC5zdWNjZXNzIHx8IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmh0bWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5leGVjQ21kKCdpbnNlcnRIVE1MJywgZGF0YS5odG1sKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5jbG9zZU1vZGFsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAyNTApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLmFkZEVycm9yT25Nb2RhbEZpZWxkKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJ2lucHV0W3R5cGU9dGV4dF0nLCAkbW9kYWwpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiB0cnVtYm93eWcuby5wbHVnaW5zLm5vZW1iZWQuZXJyb3IgfHwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVtYm93eWcuYWRkRXJyb3JPbk1vZGFsRmllbGQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCdpbnB1dFt0eXBlPXRleHRdJywgJG1vZGFsKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5sYW5nLm5vZW1iZWRFcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICB0cnVtYm93eWcuYWRkQnRuRGVmKCdub2VtYmVkJywgYnRuRGVmKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKGpRdWVyeSk7XG4iXX0=
