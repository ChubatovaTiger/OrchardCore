/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

/**
 * Trumbowyg v2.19.1 - A lightweight WYSIWYG editor
 * Trumbowyg core file
 * ------------------------
 * @link http://alex-d.github.io/Trumbowyg
 * @license MIT
 * @author Alexandre Demode (Alex-D)
 *         Twitter : @AlexandreDemode
 *         Website : alex-d.fr
 */

jQuery.trumbowyg = {
    langs: {
        en: {
            viewHTML: 'View HTML',

            undo: 'Undo',
            redo: 'Redo',

            formatting: 'Formatting',
            p: 'Paragraph',
            blockquote: 'Quote',
            code: 'Code',
            header: 'Header',

            bold: 'Bold',
            italic: 'Italic',
            strikethrough: 'Strikethrough',
            underline: 'Underline',

            strong: 'Strong',
            em: 'Emphasis',
            del: 'Deleted',

            superscript: 'Superscript',
            subscript: 'Subscript',

            unorderedList: 'Unordered list',
            orderedList: 'Ordered list',

            insertImage: 'Insert Image',
            link: 'Link',
            createLink: 'Insert link',
            unlink: 'Remove link',

            justifyLeft: 'Align Left',
            justifyCenter: 'Align Center',
            justifyRight: 'Align Right',
            justifyFull: 'Align Justify',

            horizontalRule: 'Insert horizontal rule',
            removeformat: 'Remove format',

            fullscreen: 'Fullscreen',

            close: 'Close',

            submit: 'Confirm',
            reset: 'Cancel',

            required: 'Required',
            description: 'Description',
            title: 'Title',
            text: 'Text',
            target: 'Target',
            width: 'Width'
        }
    },

    // Plugins
    plugins: {},

    // SVG Path globally
    svgPath: null,

    hideButtonTexts: null
};

// Makes default options read-only
Object.defineProperty(jQuery.trumbowyg, 'defaultOptions', {
    value: {
        lang: 'en',

        fixedBtnPane: false,
        fixedFullWidth: false,
        autogrow: false,
        autogrowOnEnter: false,
        imageWidthModalEdit: false,

        prefix: 'trumbowyg-',

        semantic: true,
        semanticKeepAttributes: false,
        resetCss: false,
        removeformatPasted: false,
        tabToIndent: false,
        tagsToRemove: [],
        tagsToKeep: ['hr', 'img', 'embed', 'iframe', 'input'],
        btns: [
            ['viewHTML'],
            ['undo', 'redo'], // Only supported in Blink browsers
            ['formatting'],
            ['strong', 'em', 'del'],
            ['superscript', 'subscript'],
            ['link'],
            ['insertImage'],
            ['justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull'],
            ['unorderedList', 'orderedList'],
            ['horizontalRule'],
            ['removeformat'],
            ['fullscreen']
        ],
        // For custom button definitions
        btnsDef: {},
        changeActiveDropdownIcon: false,

        inlineElementsSelector: 'a,abbr,acronym,b,caption,cite,code,col,dfn,dir,dt,dd,em,font,hr,i,kbd,li,q,span,strikeout,strong,sub,sup,u',

        pasteHandlers: [],

        // imgDblClickHandler: default is defined in constructor

        plugins: {},
        urlProtocol: false,
        minimalLinks: false
    },
    writable: false,
    enumerable: true,
    configurable: false
});


(function (navigator, window, document, $) {
    'use strict';

    var CONFIRM_EVENT = 'tbwconfirm',
        CANCEL_EVENT = 'tbwcancel';

    $.fn.trumbowyg = function (options, params) {
        var trumbowygDataName = 'trumbowyg';
        if (options === Object(options) || !options) {
            return this.each(function () {
                if (!$(this).data(trumbowygDataName)) {
                    $(this).data(trumbowygDataName, new Trumbowyg(this, options));
                }
            });
        }
        if (this.length === 1) {
            try {
                var t = $(this).data(trumbowygDataName);
                switch (options) {
                    // Exec command
                    case 'execCmd':
                        return t.execCmd(params.cmd, params.param, params.forceCss, params.skipTrumbowyg);

                    // Modal box
                    case 'openModal':
                        return t.openModal(params.title, params.content);
                    case 'closeModal':
                        return t.closeModal();
                    case 'openModalInsert':
                        return t.openModalInsert(params.title, params.fields, params.callback);

                    // Range
                    case 'saveRange':
                        return t.saveRange();
                    case 'getRange':
                        return t.range;
                    case 'getRangeText':
                        return t.getRangeText();
                    case 'restoreRange':
                        return t.restoreRange();

                    // Enable/disable
                    case 'enable':
                        return t.setDisabled(false);
                    case 'disable':
                        return t.setDisabled(true);

                    // Toggle
                    case 'toggle':
                        return t.toggle();

                    // Destroy
                    case 'destroy':
                        return t.destroy();

                    // Empty
                    case 'empty':
                        return t.empty();

                    // HTML
                    case 'html':
                        return t.html(params);
                }
            } catch (c) {
            }
        }

        return false;
    };

    // @param: editorElem is the DOM element
    var Trumbowyg = function (editorElem, options) {
        var t = this,
            trumbowygIconsId = 'trumbowyg-icons',
            $trumbowyg = $.trumbowyg;

        // Get the document of the element. It use to makes the plugin
        // compatible on iframes.
        t.doc = editorElem.ownerDocument || document;

        // jQuery object of the editor
        t.$ta = $(editorElem); // $ta : Textarea
        t.$c = $(editorElem); // $c : creator

        options = options || {};

        // Localization management
        if (options.lang != null || $trumbowyg.langs[options.lang] != null) {
            t.lang = $.extend(true, {}, $trumbowyg.langs.en, $trumbowyg.langs[options.lang]);
        } else {
            t.lang = $trumbowyg.langs.en;
        }

        t.hideButtonTexts = $trumbowyg.hideButtonTexts != null ? $trumbowyg.hideButtonTexts : options.hideButtonTexts;

        // SVG path
        var svgPathOption = $trumbowyg.svgPath != null ? $trumbowyg.svgPath : options.svgPath;
        t.hasSvg = svgPathOption !== false;
        t.svgPath = !!t.doc.querySelector('base') ? window.location.href.split('#')[0] : '';
        if ($('#' + trumbowygIconsId, t.doc).length === 0 && svgPathOption !== false) {
            if (svgPathOption == null) {
                // Hack to get svgPathOption based on trumbowyg.js path
                var scriptElements = document.getElementsByTagName('script');
                for (var i = 0; i < scriptElements.length; i += 1) {
                    var source = scriptElements[i].src;
                    var matches = source.match('trumbowyg(\.min)?\.js');
                    if (matches != null) {
                        svgPathOption = source.substring(0, source.indexOf(matches[0])) + 'ui/icons.svg';
                    }
                }
                if (svgPathOption == null) {
                    console.warn('You must define svgPath: https://goo.gl/CfTY9U'); // jshint ignore:line
                }
            }

            var div = t.doc.createElement('div');
            div.id = trumbowygIconsId;
            t.doc.body.insertBefore(div, t.doc.body.childNodes[0]);
            $.ajax({
                async: true,
                type: 'GET',
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                dataType: 'xml',
                crossDomain: true,
                url: svgPathOption,
                data: null,
                beforeSend: null,
                complete: null,
                success: function (data) {
                    div.innerHTML = new XMLSerializer().serializeToString(data.documentElement);
                }
            });
        }


        /**
         * When the button is associated to a empty object
         * fn and title attributes are defined from the button key value
         *
         * For example
         *      foo: {}
         * is equivalent to :
         *      foo: {
         *          fn: 'foo',
         *          title: this.lang.foo
         *      }
         */
        var h = t.lang.header, // Header translation
            isBlinkFunction = function () {
                return (window.chrome || (window.Intl && Intl.v8BreakIterator)) && 'CSS' in window;
            };
        t.btnsDef = {
            viewHTML: {
                fn: 'toggle',
                class: 'trumbowyg-not-disable',
            },

            undo: {
                isSupported: isBlinkFunction,
                key: 'Z'
            },
            redo: {
                isSupported: isBlinkFunction,
                key: 'Y'
            },

            p: {
                fn: 'formatBlock'
            },
            blockquote: {
                fn: 'formatBlock'
            },
            h1: {
                fn: 'formatBlock',
                title: h + ' 1'
            },
            h2: {
                fn: 'formatBlock',
                title: h + ' 2'
            },
            h3: {
                fn: 'formatBlock',
                title: h + ' 3'
            },
            h4: {
                fn: 'formatBlock',
                title: h + ' 4'
            },
            h5: {
                fn: 'formatBlock',
                title: h + ' 5'
            },
            h6: {
                fn: 'formatBlock',
                title: h + ' 6'
            },
            subscript: {
                tag: 'sub'
            },
            superscript: {
                tag: 'sup'
            },

            bold: {
                key: 'B',
                tag: 'b'
            },
            italic: {
                key: 'I',
                tag: 'i'
            },
            underline: {
                tag: 'u'
            },
            strikethrough: {
                tag: 'strike'
            },

            strong: {
                fn: 'bold',
                key: 'B'
            },
            em: {
                fn: 'italic',
                key: 'I'
            },
            del: {
                fn: 'strikethrough'
            },

            createLink: {
                key: 'K',
                tag: 'a'
            },
            unlink: {},

            insertImage: {},

            justifyLeft: {
                tag: 'left',
                forceCss: true
            },
            justifyCenter: {
                tag: 'center',
                forceCss: true
            },
            justifyRight: {
                tag: 'right',
                forceCss: true
            },
            justifyFull: {
                tag: 'justify',
                forceCss: true
            },

            unorderedList: {
                fn: 'insertUnorderedList',
                tag: 'ul'
            },
            orderedList: {
                fn: 'insertOrderedList',
                tag: 'ol'
            },

            horizontalRule: {
                fn: 'insertHorizontalRule'
            },

            removeformat: {},

            fullscreen: {
                class: 'trumbowyg-not-disable'
            },
            close: {
                fn: 'destroy',
                class: 'trumbowyg-not-disable'
            },

            // Dropdowns
            formatting: {
                dropdown: ['p', 'blockquote', 'h1', 'h2', 'h3', 'h4'],
                ico: 'p'
            },
            link: {
                dropdown: ['createLink', 'unlink']
            }
        };

        // Defaults Options
        t.o = $.extend(true, {}, $trumbowyg.defaultOptions, options);
        if (!t.o.hasOwnProperty('imgDblClickHandler')) {
            t.o.imgDblClickHandler = t.getDefaultImgDblClickHandler();
        }

        t.urlPrefix = t.setupUrlPrefix();

        t.disabled = t.o.disabled || (editorElem.nodeName === 'TEXTAREA' && editorElem.disabled);

        if (options.btns) {
            t.o.btns = options.btns;
        } else if (!t.o.semantic) {
            t.o.btns[3] = ['bold', 'italic', 'underline', 'strikethrough'];
        }

        $.each(t.o.btnsDef, function (btnName, btnDef) {
            t.addBtnDef(btnName, btnDef);
        });

        // put this here in the event it would be merged in with options
        t.eventNamespace = 'trumbowyg-event';

        // Keyboard shortcuts are load in this array
        t.keys = [];

        // Tag to button dynamically hydrated
        t.tagToButton = {};
        t.tagHandlers = [];

        // Admit multiple paste handlers
        t.pasteHandlers = [].concat(t.o.pasteHandlers);

        // Check if browser is IE
        t.isIE = navigator.userAgent.indexOf('MSIE') !== -1 || navigator.appVersion.indexOf('Trident/') !== -1;

        // Check if we are on macOs
        t.isMac = navigator.platform.toUpperCase().indexOf('MAC') !== -1;

        t.init();
    };

    Trumbowyg.prototype = {
        DEFAULT_SEMANTIC_MAP: {
            'b': 'strong',
            'i': 'em',
            's': 'del',
            'strike': 'del',
            'div': 'p'
        },

        init: function () {
            var t = this;
            t.height = t.$ta.height();

            t.initPlugins();

            try {
                // Disable image resize, try-catch for old IE
                t.doc.execCommand('enableObjectResizing', false, false);
                t.doc.execCommand('defaultParagraphSeparator', false, 'p');
            } catch (e) {
            }

            t.buildEditor();
            t.buildBtnPane();

            t.fixedBtnPaneEvents();

            t.buildOverlay();

            setTimeout(function () {
                if (t.disabled) {
                    t.setDisabled(true);
                }
                t.$c.trigger('tbwinit');
            });
        },

        addBtnDef: function (btnName, btnDef) {
            this.btnsDef[btnName] = $.extend(btnDef, this.btnsDef[btnName] || {});
        },

        setupUrlPrefix: function () {
            var protocol = this.o.urlProtocol;
            if (!protocol) {
                return;
            }

            if (typeof(protocol) !== 'string') {
                return 'https://';
            }
            return protocol.replace('://', '') + '://';
        },

        buildEditor: function () {
            var t = this,
                prefix = t.o.prefix,
                html = '';

            t.$box = $('<div/>', {
                class: prefix + 'box ' + prefix + 'editor-visible ' + prefix + t.o.lang + ' trumbowyg'
            });

            // $ta = Textarea
            // $ed = Editor
            t.isTextarea = t.$ta.is('textarea');
            if (t.isTextarea) {
                html = t.$ta.val();
                t.$ed = $('<div/>');
                t.$box
                    .insertAfter(t.$ta)
                    .append(t.$ed, t.$ta);
            } else {
                t.$ed = t.$ta;
                html = t.$ed.html();

                t.$ta = $('<textarea/>', {
                    name: t.$ta.attr('id'),
                    height: t.height
                }).val(html);

                t.$box
                    .insertAfter(t.$ed)
                    .append(t.$ta, t.$ed);
                t.syncCode();
            }

            t.$ta
                .addClass(prefix + 'textarea')
                .attr('tabindex', -1)
            ;

            t.$ed
                .addClass(prefix + 'editor')
                .attr({
                    contenteditable: true,
                    dir: t.lang._dir || 'ltr'
                })
                .html(html)
            ;

            if (t.o.tabindex) {
                t.$ed.attr('tabindex', t.o.tabindex);
            }

            if (t.$c.is('[placeholder]')) {
                t.$ed.attr('placeholder', t.$c.attr('placeholder'));
            }

            if (t.$c.is('[spellcheck]')) {
                t.$ed.attr('spellcheck', t.$c.attr('spellcheck'));
            }

            if (t.o.resetCss) {
                t.$ed.addClass(prefix + 'reset-css');
            }

            if (!t.o.autogrow) {
                t.$ta.add(t.$ed).css({
                    height: t.height
                });
            }

            t.semanticCode();

            if (t.o.autogrowOnEnter) {
                t.$ed.addClass(prefix + 'autogrow-on-enter');
            }

            var ctrl = false,
                composition = false,
                debounceButtonPaneStatus,
                updateEventName = 'keyup';

            t.$ed
                .on('dblclick', 'img', t.o.imgDblClickHandler)
                .on('keydown', function (e) {
                    if ((e.ctrlKey || e.metaKey) && !e.altKey) {
                        ctrl = true;
                        var key = t.keys[String.fromCharCode(e.which).toUpperCase()];

                        try {
                            t.execCmd(key.fn, key.param);
                            return false;
                        } catch (c) {}
                    } else {
                        if (t.o.tabToIndent && e.key === 'Tab') {
                            try {
                                if (e.shiftKey) {
                                    t.execCmd('outdent', true, null);
                                } else {
                                    t.execCmd('indent', true, null);
                                }
                                return false;
                            } catch (c) {}
                        }
                    }
                })
                .on('compositionstart compositionupdate', function () {
                    composition = true;
                })
                .on(updateEventName + ' compositionend', function (e) {
                    if (e.type === 'compositionend') {
                        composition = false;
                    } else if (composition) {
                        return;
                    }

                    var keyCode = e.which;

                    if (keyCode >= 37 && keyCode <= 40) {
                        return;
                    }

                    if ((e.ctrlKey || e.metaKey) && (keyCode === 89 || keyCode === 90)) {
                        t.semanticCode(false, true);
                        t.$c.trigger('tbwchange');
                    } else if (!ctrl && keyCode !== 17) {
                        var compositionEndIE = t.isIE ? e.type === 'compositionend' : true;
                        t.semanticCode(false, compositionEndIE && keyCode === 13);
                        t.$c.trigger('tbwchange');
                    } else if (typeof e.which === 'undefined') {
                        t.semanticCode(false, false, true);
                    }

                    setTimeout(function () {
                        ctrl = false;
                    }, 50);
                })
                .on('mouseup keydown keyup', function (e) {
                    if ((!e.ctrlKey && !e.metaKey) || e.altKey) {
                        setTimeout(function () { // "hold on" to the ctrl key for 50ms
                            ctrl = false;
                        }, 50);
                    }
                    clearTimeout(debounceButtonPaneStatus);
                    debounceButtonPaneStatus = setTimeout(function () {
                        t.updateButtonPaneStatus();
                    }, 50);
                })
                .on('focus blur', function (e) {
                    t.$c.trigger('tbw' + e.type);
                    if (e.type === 'blur') {
                        t.clearButtonPaneStatus();
                    }
                    if (t.o.autogrowOnEnter) {
                        if (t.autogrowOnEnterDontClose) {
                            return;
                        }
                        if (e.type === 'focus') {
                            t.autogrowOnEnterWasFocused = true;
                            t.autogrowEditorOnEnter();
                        }
                        else if (!t.o.autogrow) {
                            t.$ed.css({height: t.$ed.css('min-height')});
                            t.$c.trigger('tbwresize');
                        }
                    }
                })
                .on('cut drop', function () {
                    setTimeout(function () {
                        t.semanticCode(false, true);
                        t.$c.trigger('tbwchange');
                    }, 0);
                })
                .on('paste', function (e) {
                    if (t.o.removeformatPasted) {
                        e.preventDefault();

                        if (window.getSelection && window.getSelection().deleteFromDocument) {
                            window.getSelection().deleteFromDocument();
                        }

                        try {
                            // IE
                            var text = window.clipboardData.getData('Text');

                            try {
                                // <= IE10
                                t.doc.selection.createRange().pasteHTML(text);
                            } catch (c) {
                                // IE 11
                                t.doc.getSelection().getRangeAt(0).insertNode(t.doc.createTextNode(text));
                            }
                            t.$c.trigger('tbwchange', e);
                        } catch (d) {
                            // Not IE
                            t.execCmd('insertText', (e.originalEvent || e).clipboardData.getData('text/plain'));
                        }
                    }

                    // Call pasteHandlers
                    $.each(t.pasteHandlers, function (i, pasteHandler) {
                        pasteHandler(e);
                    });

                    setTimeout(function () {
                        t.semanticCode(false, true);
                        t.$c.trigger('tbwpaste', e);
                        t.$c.trigger('tbwchange');
                    }, 0);
                });

            t.$ta
                .on('keyup', function () {
                    t.$c.trigger('tbwchange');
                })
                .on('paste', function () {
                    setTimeout(function () {
                        t.$c.trigger('tbwchange');
                    }, 0);
                });

            $(t.doc.body).on('keydown', function (e) {
                if (e.which === 27 && $('.' + prefix + 'modal-box').length >= 1) {
                    t.closeModal();
                    return false;
                }
            });
        },

        //autogrow when entering logic
        autogrowEditorOnEnter: function () {
            var t = this;
            t.$ed.removeClass('autogrow-on-enter');
            var oldHeight = t.$ed[0].clientHeight;
            t.$ed.height('auto');
            var totalHeight = t.$ed[0].scrollHeight;
            t.$ed.addClass('autogrow-on-enter');
            if (oldHeight !== totalHeight) {
                t.$ed.height(oldHeight);
                setTimeout(function () {
                    t.$ed.css({height: totalHeight});
                    t.$c.trigger('tbwresize');
                }, 0);
            }
        },


        // Build button pane, use o.btns option
        buildBtnPane: function () {
            var t = this,
                prefix = t.o.prefix;

            var $btnPane = t.$btnPane = $('<div/>', {
                class: prefix + 'button-pane'
            });

            $.each(t.o.btns, function (i, btnGrp) {
                if (!$.isArray(btnGrp)) {
                    btnGrp = [btnGrp];
                }

                var $btnGroup = $('<div/>', {
                    class: prefix + 'button-group ' + ((btnGrp.indexOf('fullscreen') >= 0) ? prefix + 'right' : '')
                });
                $.each(btnGrp, function (i, btn) {
                    try { // Prevent buildBtn error
                        if (t.isSupportedBtn(btn)) { // It's a supported button
                            $btnGroup.append(t.buildBtn(btn));
                        }
                    } catch (c) {
                    }
                });

                if ($btnGroup.html().trim().length > 0) {
                    $btnPane.append($btnGroup);
                }
            });

            t.$box.prepend($btnPane);
        },


        // Build a button and his action
        buildBtn: function (btnName) { // btnName is name of the button
            var t = this,
                prefix = t.o.prefix,
                btn = t.btnsDef[btnName],
                isDropdown = btn.dropdown,
                hasIcon = btn.hasIcon != null ? btn.hasIcon : true,
                textDef = t.lang[btnName] || btnName,

                $btn = $('<button/>', {
                    type: 'button',
                    class: prefix + btnName + '-button ' + (btn.class || '') + (!hasIcon ? ' ' + prefix + 'textual-button' : ''),
                    html: t.hasSvg && hasIcon ?
                        '<svg><use xlink:href="' + t.svgPath + '#' + prefix + (btn.ico || btnName).replace(/([A-Z]+)/g, '-$1').toLowerCase() + '"/></svg>' :
                        t.hideButtonTexts ? '' : (btn.text || btn.title || t.lang[btnName] || btnName),
                    title: (btn.title || btn.text || textDef) + (btn.key ? ' (' + (t.isMac ? 'Cmd' : 'Ctrl') + ' + ' + btn.key + ')' : ''),
                    tabindex: -1,
                    mousedown: function () {
                        if (!isDropdown || $('.' + btnName + '-' + prefix + 'dropdown', t.$box).is(':hidden')) {
                            $('body', t.doc).trigger('mousedown');
                        }

                        if ((t.$btnPane.hasClass(prefix + 'disable') || t.$box.hasClass(prefix + 'disabled')) &&
                            !$(this).hasClass(prefix + 'active') &&
                            !$(this).hasClass(prefix + 'not-disable')) {
                            return false;
                        }

                        t.execCmd((isDropdown ? 'dropdown' : false) || btn.fn || btnName, btn.param || btnName, btn.forceCss);

                        return false;
                    }
                });

            if (isDropdown) {
                $btn.addClass(prefix + 'open-dropdown');
                var dropdownPrefix = prefix + 'dropdown',
                    dropdownOptions = { // the dropdown
                        class: dropdownPrefix + '-' + btnName + ' ' + dropdownPrefix + ' ' + prefix + 'fixed-top ' + (btn.dropdownClass || '')
                    };
                dropdownOptions['data-' + dropdownPrefix] = btnName;
                var $dropdown = $('<div/>', dropdownOptions);
                $.each(isDropdown, function (i, def) {
                    if (t.btnsDef[def] && t.isSupportedBtn(def)) {
                        $dropdown.append(t.buildSubBtn(def));
                    }
                });
                t.$box.append($dropdown.hide());
            } else if (btn.key) {
                t.keys[btn.key] = {
                    fn: btn.fn || btnName,
                    param: btn.param || btnName
                };
            }

            if (!isDropdown) {
                t.tagToButton[(btn.tag || btnName).toLowerCase()] = btnName;
            }

            return $btn;
        },
        // Build a button for dropdown menu
        // @param n : name of the subbutton
        buildSubBtn: function (btnName) {
            var t = this,
                prefix = t.o.prefix,
                btn = t.btnsDef[btnName],
                hasIcon = btn.hasIcon != null ? btn.hasIcon : true;

            if (btn.key) {
                t.keys[btn.key] = {
                    fn: btn.fn || btnName,
                    param: btn.param || btnName
                };
            }

            t.tagToButton[(btn.tag || btnName).toLowerCase()] = btnName;

            return $('<button/>', {
                type: 'button',
                class: prefix + btnName + '-dropdown-button ' + (btn.class || '') + (btn.ico ? ' ' + prefix + btn.ico + '-button' : ''),
                html: t.hasSvg && hasIcon ?
                  '<svg><use xlink:href="' + t.svgPath + '#' + prefix + (btn.ico || btnName).replace(/([A-Z]+)/g, '-$1').toLowerCase() + '"/></svg>' + (btn.text || btn.title || t.lang[btnName] || btnName) :
                  (btn.text || btn.title || t.lang[btnName] || btnName),
                title: (btn.key ? '(' + (t.isMac ? 'Cmd' : 'Ctrl') + ' + ' + btn.key + ')' : null),
                style: btn.style || null,
                mousedown: function () {
                    $('body', t.doc).trigger('mousedown');

                    t.execCmd(btn.fn || btnName, btn.param || btnName, btn.forceCss);

                    return false;
                }
            });
        },
        // Check if button is supported
        isSupportedBtn: function (btnName) {
            try {
                return this.btnsDef[btnName].isSupported();
            } catch (e) {
            }
            return true;
        },

        // Build overlay for modal box
        buildOverlay: function () {
            var t = this;
            t.$overlay = $('<div/>', {
                class: t.o.prefix + 'overlay'
            }).appendTo(t.$box);
            return t.$overlay;
        },
        showOverlay: function () {
            var t = this;
            $(window).trigger('scroll');
            t.$overlay.fadeIn(200);
            t.$box.addClass(t.o.prefix + 'box-blur');
        },
        hideOverlay: function () {
            var t = this;
            t.$overlay.fadeOut(50);
            t.$box.removeClass(t.o.prefix + 'box-blur');
        },

        // Management of fixed button pane
        fixedBtnPaneEvents: function () {
            var t = this,
                fixedFullWidth = t.o.fixedFullWidth,
                $box = t.$box;

            if (!t.o.fixedBtnPane) {
                return;
            }

            t.isFixed = false;

            $(window)
                .on('scroll.' + t.eventNamespace + ' resize.' + t.eventNamespace, function () {
                    if (!$box) {
                        return;
                    }

                    t.syncCode();

                    var scrollTop = $(window).scrollTop(),
                        offset = $box.offset().top + 1,
                        $buttonPane = t.$btnPane,
                        buttonPaneOuterHeight = $buttonPane.outerHeight() - 2;

                    if ((scrollTop - offset > 0) && ((scrollTop - offset - t.height) < 0)) {
                        if (!t.isFixed) {
                            t.isFixed = true;
                            $buttonPane.css({
                                position: 'fixed',
                                top: 0,
                                left: fixedFullWidth ? 0 : 'auto',
                                zIndex: 7
                            });
                            t.$box.css({paddingTop: $buttonPane.height()});
                        }
                        $buttonPane.css({
                            width: fixedFullWidth ? '100%' : (($box.width() - 1))
                        });

                        $('.' + t.o.prefix + 'fixed-top', $box).css({
                            position: fixedFullWidth ? 'fixed' : 'absolute',
                            top: fixedFullWidth ? buttonPaneOuterHeight : buttonPaneOuterHeight + (scrollTop - offset),
                            zIndex: 15
                        });
                    } else if (t.isFixed) {
                        t.isFixed = false;
                        $buttonPane.removeAttr('style');
                        t.$box.css({paddingTop: 0});
                        $('.' + t.o.prefix + 'fixed-top', $box).css({
                            position: 'absolute',
                            top: buttonPaneOuterHeight
                        });
                    }
                });
        },

        // Disable editor
        setDisabled: function (disable) {
            var t = this,
                prefix = t.o.prefix;

            t.disabled = disable;

            if (disable) {
                t.$ta.attr('disabled', true);
            } else {
                t.$ta.removeAttr('disabled');
            }
            t.$box.toggleClass(prefix + 'disabled', disable);
            t.$ed.attr('contenteditable', !disable);
        },

        // Destroy the editor
        destroy: function () {
            var t = this,
                prefix = t.o.prefix;

            if (t.isTextarea) {
                t.$box.after(
                    t.$ta
                        .css({height: ''})
                        .val(t.html())
                        .removeClass(prefix + 'textarea')
                        .show()
                );
            } else {
                t.$box.after(
                    t.$ed
                        .css({height: ''})
                        .removeClass(prefix + 'editor')
                        .removeAttr('contenteditable')
                        .removeAttr('dir')
                        .html(t.html())
                        .show()
                );
            }

            t.$ed.off('dblclick', 'img');

            t.destroyPlugins();

            t.$box.remove();
            t.$c.removeData('trumbowyg');
            $('body').removeClass(prefix + 'body-fullscreen');
            t.$c.trigger('tbwclose');
            $(window).off('scroll.' + t.eventNamespace + ' resize.' + t.eventNamespace);
        },


        // Empty the editor
        empty: function () {
            this.$ta.val('');
            this.syncCode(true);
        },


        // Function call when click on viewHTML button
        toggle: function () {
            var t = this,
                prefix = t.o.prefix;

            if (t.o.autogrowOnEnter) {
                t.autogrowOnEnterDontClose = !t.$box.hasClass(prefix + 'editor-hidden');
            }

            t.semanticCode(false, true);
            t.$c.trigger('tbwchange');

            setTimeout(function () {
                t.doc.activeElement.blur();
                t.$box.toggleClass(prefix + 'editor-hidden ' + prefix + 'editor-visible');
                t.$btnPane.toggleClass(prefix + 'disable');
                $('.' + prefix + 'viewHTML-button', t.$btnPane).toggleClass(prefix + 'active');
                if (t.$box.hasClass(prefix + 'editor-visible')) {
                    t.$ta.attr('tabindex', -1);
                } else {
                    t.$ta.removeAttr('tabindex');
                }

                if (t.o.autogrowOnEnter && !t.autogrowOnEnterDontClose) {
                    t.autogrowEditorOnEnter();
                }
            }, 0);
        },

        // Open dropdown when click on a button which open that
        dropdown: function (name) {
            var t = this,
                $body = $('body', t.doc),
                prefix = t.o.prefix,
                $dropdown = $('[data-' + prefix + 'dropdown=' + name + ']', t.$box),
                $btn = $('.' + prefix + name + '-button', t.$btnPane),
                show = $dropdown.is(':hidden');

            $body.trigger('mousedown');

            if (show) {
                var btnOffsetLeft = $btn.offset().left;
                $btn.addClass(prefix + 'active');

                $dropdown.css({
                    position: 'absolute',
                    top: $btn.offset().top - t.$btnPane.offset().top + $btn.outerHeight(),
                    left: (t.o.fixedFullWidth && t.isFixed) ? btnOffsetLeft : (btnOffsetLeft - t.$btnPane.offset().left)
                }).show();

                $(window).trigger('scroll');

                $body.on('mousedown.' + t.eventNamespace, function (e) {
                    if (!$dropdown.is(e.target)) {
                        $('.' + prefix + 'dropdown', t.$box).hide();
                        $('.' + prefix + 'active', t.$btnPane).removeClass(prefix + 'active');
                        $body.off('mousedown.' + t.eventNamespace);
                    }
                });
            }
        },


        // HTML Code management
        html: function (html) {
            var t = this;

            if (html != null) {
                t.$ta.val(html);
                t.syncCode(true);
                t.$c.trigger('tbwchange');
                return t;
            }

            return t.$ta.val();
        },
        syncTextarea: function () {
            var t = this;
            t.$ta.val(t.$ed.text().trim().length > 0 || t.$ed.find(t.o.tagsToKeep.join(',')).length > 0 ? t.$ed.html() : '');
        },
        syncCode: function (force) {
            var t = this;
            if (!force && t.$ed.is(':visible')) {
                t.syncTextarea();
            } else {
                // wrap the content in a div it's easier to get the inner html
                var html = $('<div>').html(t.$ta.val());
                // scrub the html before loading into the doc
                var safe = $('<div>').append(html);
                $(t.o.tagsToRemove.join(','), safe).remove();
                t.$ed.html(safe.contents().html());
            }

            if (t.o.autogrow) {
                t.height = t.$ed.height();
                if (t.height !== t.$ta.css('height')) {
                    t.$ta.css({height: t.height});
                    t.$c.trigger('tbwresize');
                }
            }
            if (t.o.autogrowOnEnter) {
                t.$ed.height('auto');
                var totalHeight = t.autogrowOnEnterWasFocused ? t.$ed[0].scrollHeight : t.$ed.css('min-height');
                if (totalHeight !== t.$ta.css('height')) {
                    t.$ed.css({height: totalHeight});
                    t.$c.trigger('tbwresize');
                }
            }
        },

        // Analyse and update to semantic code
        // @param force : force to sync code from textarea
        // @param full  : wrap text nodes in <p>
        // @param keepRange  : leave selection range as it is
        semanticCode: function (force, full, keepRange) {
            var t = this;
            t.saveRange();
            t.syncCode(force);

            if (t.o.semantic) {
                t.semanticTag('b', t.o.semanticKeepAttributes);
                t.semanticTag('i', t.o.semanticKeepAttributes);
                t.semanticTag('s', t.o.semanticKeepAttributes);
                t.semanticTag('strike', t.o.semanticKeepAttributes);

                if (full) {
                    var inlineElementsSelector = t.o.inlineElementsSelector,
                        blockElementsSelector = ':not(' + inlineElementsSelector + ')';

                    // Wrap text nodes in span for easier processing
                    t.$ed.contents().filter(function () {
                        return this.nodeType === 3 && this.nodeValue.trim().length > 0;
                    }).wrap('<span data-tbw/>');

                    // Wrap groups of inline elements in paragraphs (recursive)
                    var wrapInlinesInParagraphsFrom = function ($from) {
                        if ($from.length !== 0) {
                            var $finalParagraph = $from.nextUntil(blockElementsSelector).addBack().wrapAll('<p/>').parent(),
                                $nextElement = $finalParagraph.nextAll(inlineElementsSelector).first();
                            $finalParagraph.next('br').remove();
                            wrapInlinesInParagraphsFrom($nextElement);
                        }
                    };
                    wrapInlinesInParagraphsFrom(t.$ed.children(inlineElementsSelector).first());

                    t.semanticTag('div', true);

                    // Get rid of temporary span's
                    $('[data-tbw]', t.$ed).contents().unwrap();

                    // Remove empty <p>
                    t.$ed.find('p:empty').remove();
                }

                if (!keepRange) {
                    t.restoreRange();
                }

                t.syncTextarea();
            }
        },

        semanticTag: function (oldTag, copyAttributes) {
            var newTag;

            if (this.o.semantic != null && typeof this.o.semantic === 'object' && this.o.semantic.hasOwnProperty(oldTag)) {
                newTag = this.o.semantic[oldTag];
            } else if (this.o.semantic === true && this.DEFAULT_SEMANTIC_MAP.hasOwnProperty(oldTag)) {
                newTag = this.DEFAULT_SEMANTIC_MAP[oldTag];
            } else {
                return;
            }

            $(oldTag, this.$ed).each(function () {
                var $oldTag = $(this);
                if($oldTag.contents().length === 0) {
                    return false;
                }

                $oldTag.wrap('<' + newTag + '/>');
                if (copyAttributes) {
                    $.each($oldTag.prop('attributes'), function () {
                        $oldTag.parent().attr(this.name, this.value);
                    });
                }
                $oldTag.contents().unwrap();
            });
        },

        // Function call when user click on "Insert Link"
        createLink: function () {
            var t = this,
                documentSelection = t.doc.getSelection(),
                selectedRange = documentSelection.getRangeAt(0),
                node = documentSelection.focusNode,
                text = new XMLSerializer().serializeToString(selectedRange.cloneContents()) || selectedRange + '',
                url,
                title,
                target;

            while (['A', 'DIV'].indexOf(node.nodeName) < 0) {
                node = node.parentNode;
            }

            if (node && node.nodeName === 'A') {
                var $a = $(node);
                text = $a.text();
                url = $a.attr('href');
                if (!t.o.minimalLinks) {
                    title = $a.attr('title');
                    target = $a.attr('target');
                }
                var range = t.doc.createRange();
                range.selectNode(node);
                documentSelection.removeAllRanges();
                documentSelection.addRange(range);
            }

            t.saveRange();

            var options = {
                url: {
                    label: 'URL',
                    required: true,
                    value: url
                },
                text: {
                    label: t.lang.text,
                    value: text
                }
            };
            if (!t.o.minimalLinks) {
                $.extend(options, {
                    title: {
                        label: t.lang.title,
                        value: title
                    },
                    target: {
                        label: t.lang.target,
                        value: target
                    }
                });
            }

            t.openModalInsert(t.lang.createLink, options, function (v) { // v is value
                var url = t.prependUrlPrefix(v.url);
                if (!url.length) {
                    return false;
                }

                var link = $(['<a href="', url, '">', v.text || v.url, '</a>'].join(''));

                if (!t.o.minimalLinks) {
                    if (v.title.length > 0) {
                        link.attr('title', v.title);
                    }
                    if (v.target.length > 0) {
                        link.attr('target', v.target);
                    }
                }
                t.range.deleteContents();
                t.range.insertNode(link[0]);
                t.syncCode();
                t.$c.trigger('tbwchange');
                return true;
            });
        },
        prependUrlPrefix: function (url) {
            var t = this;
            if (!t.urlPrefix) {
                return url;
            }

            var VALID_LINK_PREFIX = /^([a-z][-+.a-z0-9]*:|\/|#)/i;
            if (VALID_LINK_PREFIX.test(url)) {
                return url;
            }

            var SIMPLE_EMAIL_REGEX = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (SIMPLE_EMAIL_REGEX.test(url)) {
                return 'mailto:' + url;
            }

            return t.urlPrefix + url;
        },
        unlink: function () {
            var t = this,
                documentSelection = t.doc.getSelection(),
                node = documentSelection.focusNode;

            if (documentSelection.isCollapsed) {
                while (['A', 'DIV'].indexOf(node.nodeName) < 0) {
                    node = node.parentNode;
                }

                if (node && node.nodeName === 'A') {
                    var range = t.doc.createRange();
                    range.selectNode(node);
                    documentSelection.removeAllRanges();
                    documentSelection.addRange(range);
                }
            }
            t.execCmd('unlink', undefined, undefined, true);
        },
        insertImage: function () {
            var t = this;
            t.saveRange();

            var options = {
                url: {
                    label: 'URL',
                    required: true
                },
                alt: {
                    label: t.lang.description,
                    value: t.getRangeText()
                }
            };

            if (t.o.imageWidthModalEdit) {
                options.width = {};
            }

            t.openModalInsert(t.lang.insertImage, options, function (v) { // v are values
                t.execCmd('insertImage', v.url, false, true);
                var $img = $('img[src="' + v.url + '"]:not([alt])', t.$box);
                $img.attr('alt', v.alt);

                if (t.o.imageWidthModalEdit) {
                    $img.attr({
                        width: v.width
                    });
                }

                t.syncCode();
                t.$c.trigger('tbwchange');

                return true;
            });
        },
        fullscreen: function () {
            var t = this,
                prefix = t.o.prefix,
                fullscreenCssClass = prefix + 'fullscreen',
                fullscreenPlaceholderClass = fullscreenCssClass + '-placeholder',
                isFullscreen,
                editorHeight = t.$box.outerHeight();

            t.$box.toggleClass(fullscreenCssClass);
            isFullscreen = t.$box.hasClass(fullscreenCssClass);

            if (isFullscreen) {
                t.$box.before(
                    $('<div/>', {
                        class: fullscreenPlaceholderClass
                    }).css({
                        height: editorHeight
                    })
                );
            } else {
                $('.' + fullscreenPlaceholderClass).remove();
            }

            $('body').toggleClass(prefix + 'body-fullscreen', isFullscreen);
            $(window).trigger('scroll');
            t.$c.trigger('tbw' + (isFullscreen ? 'open' : 'close') + 'fullscreen');
        },


        /*
         * Call method of trumbowyg if exist
         * else try to call anonymous function
         * and finally native execCommand
         */
        execCmd: function (cmd, param, forceCss, skipTrumbowyg) {
            var t = this;
            skipTrumbowyg = !!skipTrumbowyg || '';

            if (cmd !== 'dropdown') {
                t.$ed.focus();
            }

            try {
                t.doc.execCommand('styleWithCSS', false, forceCss || false);
            } catch (c) {
            }

            try {
                t[cmd + skipTrumbowyg](param);
            } catch (c) {
                try {
                    cmd(param);
                } catch (e2) {
                    if (cmd === 'insertHorizontalRule') {
                        param = undefined;
                    } else if (cmd === 'formatBlock' && t.isIE) {
                        param = '<' + param + '>';
                    }

                    t.doc.execCommand(cmd, false, param);

                    t.syncCode();
                    t.semanticCode(false, true);
                }

                if (cmd !== 'dropdown') {
                    t.updateButtonPaneStatus();
                    t.$c.trigger('tbwchange');
                }
            }
        },


        // Open a modal box
        openModal: function (title, content, buildForm) {
            var t = this,
                prefix = t.o.prefix;

            buildForm = buildForm !== false;

            // No open a modal box when exist other modal box
            if ($('.' + prefix + 'modal-box', t.$box).length > 0) {
                return false;
            }
            if (t.o.autogrowOnEnter) {
                t.autogrowOnEnterDontClose = true;
            }

            t.saveRange();
            t.showOverlay();

            // Disable all btnPane btns
            t.$btnPane.addClass(prefix + 'disable');

            // Build out of ModalBox, it's the mask for animations
            var $modal = $('<div/>', {
                class: prefix + 'modal ' + prefix + 'fixed-top'
            }).css({
                top: t.$box.offset().top + t.$btnPane.height(),
                zIndex: 99999
            }).appendTo($(t.doc.body));

            // Click on overlay close modal by cancelling them
            t.$overlay.one('click', function () {
                $modal.trigger(CANCEL_EVENT);
                return false;
            });

            // Build the form
            var formOrContent;
            if (buildForm) {
                formOrContent = $('<form/>', {
                    action: '',
                    html: content
                })
                  .on('submit', function () {
                      $modal.trigger(CONFIRM_EVENT);
                      return false;
                  })
                  .on('reset', function () {
                      $modal.trigger(CANCEL_EVENT);
                      return false;
                  })
                  .on('submit reset', function () {
                      if (t.o.autogrowOnEnter) {
                          t.autogrowOnEnterDontClose = false;
                      }
                  });
            } else {
                formOrContent = content;
            }


            // Build ModalBox and animate to show them
            var $box = $('<div/>', {
                class: prefix + 'modal-box',
                html: formOrContent
            })
                .css({
                    top: '-' + t.$btnPane.outerHeight(),
                    opacity: 0,
                    paddingBottom: buildForm ? null : '5%',
                })
                .appendTo($modal)
                .animate({
                    top: 0,
                    opacity: 1
                }, 100);


            // Append title
            if (title) {
                $('<span/>', {
                    text: title,
                    class: prefix + 'modal-title'
                }).prependTo($box);
            }

            if (buildForm) {
                // Focus in modal box
                $('input:first', $box).focus();

                // Append Confirm and Cancel buttons
                t.buildModalBtn('submit', $box);
                t.buildModalBtn('reset', $box);

                $modal.height($box.outerHeight() + 10);
            }

            $(window).trigger('scroll');

            return $modal;
        },
        // @param n is name of modal
        buildModalBtn: function (n, $modal) {
            var t = this,
                prefix = t.o.prefix;

            return $('<button/>', {
                class: prefix + 'modal-button ' + prefix + 'modal-' + n,
                type: n,
                text: t.lang[n] || n
            }).appendTo($('form', $modal));
        },
        // close current modal box
        closeModal: function () {
            var t = this,
                prefix = t.o.prefix;

            t.$btnPane.removeClass(prefix + 'disable');
            t.$overlay.off();

            // Find the modal box
            var $modalBox = $('.' + prefix + 'modal-box', $(t.doc.body));

            $modalBox.animate({
                top: '-' + $modalBox.height()
            }, 100, function () {
                $modalBox.parent().remove();
                t.hideOverlay();
            });

            t.restoreRange();
        },
        // Pre-formatted build and management modal
        openModalInsert: function (title, fields, cmd) {
            var t = this,
                prefix = t.o.prefix,
                lg = t.lang,
                html = '';

            $.each(fields, function (fieldName, field) {
                var l = field.label || fieldName,
                    n = field.name || fieldName,
                    a = field.attributes || {};

                var attr = Object.keys(a).map(function (prop) {
                    return prop + '="' + a[prop] + '"';
                }).join(' ');

                html += '<label><input type="' + (field.type || 'text') + '" name="' + n + '"' +
                    (field.type === 'checkbox' && field.value ? ' checked="checked"' : ' value="' + (field.value || '').replace(/"/g, '&quot;')) +
                    '"' + attr + '><span class="' + prefix + 'input-infos"><span>' +
                    (lg[l] ? lg[l] : l) +
                    '</span></span></label>';
            });

            return t.openModal(title, html)
                .on(CONFIRM_EVENT, function () {
                    var $form = $('form', $(this)),
                        valid = true,
                        values = {};

                    $.each(fields, function (fieldName, field) {
                        var n = field.name || fieldName;

                        var $field = $('input[name="' + n + '"]', $form),
                            inputType = $field.attr('type');

                        switch (inputType.toLowerCase()) {
                            case 'checkbox':
                                values[n] = $field.is(':checked');
                                break;
                            case 'radio':
                                values[n] = $field.filter(':checked').val();
                                break;
                            default:
                                values[n] = $.trim($field.val());
                                break;
                        }
                        // Validate value
                        if (field.required && values[n] === '') {
                            valid = false;
                            t.addErrorOnModalField($field, t.lang.required);
                        } else if (field.pattern && !field.pattern.test(values[n])) {
                            valid = false;
                            t.addErrorOnModalField($field, field.patternError);
                        }
                    });

                    if (valid) {
                        t.restoreRange();

                        if (cmd(values, fields)) {
                            t.syncCode();
                            t.$c.trigger('tbwchange');
                            t.closeModal();
                            $(this).off(CONFIRM_EVENT);
                        }
                    }
                })
                .one(CANCEL_EVENT, function () {
                    $(this).off(CONFIRM_EVENT);
                    t.closeModal();
                });
        },
        addErrorOnModalField: function ($field, err) {
            var prefix = this.o.prefix,
                spanErrorClass = prefix + 'msg-error',
                $label = $field.parent();

            $field
                .on('change keyup', function () {
                    $label.removeClass(prefix + 'input-error');
                    setTimeout(function () {
                        $label.find('.' + spanErrorClass).remove();
                    }, 150);
                });

            $label
                .addClass(prefix + 'input-error')
                .find('input+span')
                .append(
                    $('<span/>', {
                        class: spanErrorClass,
                        text: err
                    })
                );
        },

        getDefaultImgDblClickHandler: function () {
            var t = this;

            return function () {
                var $img = $(this),
                    src = $img.attr('src'),
                    base64 = '(Base64)';

                if (src.indexOf('data:image') === 0) {
                    src = base64;
                }

                var options = {
                    url: {
                        label: 'URL',
                        value: src,
                        required: true
                    },
                    alt: {
                        label: t.lang.description,
                        value: $img.attr('alt')
                    }
                };

                if (t.o.imageWidthModalEdit) {
                    options.width = {
                        value: $img.attr('width') ? $img.attr('width') : ''
                    };
                }

                t.openModalInsert(t.lang.insertImage, options, function (v) {
                    if (v.url !== base64) {
                        $img.attr({
                            src: v.url
                        });
                    }
                    $img.attr({
                        alt: v.alt
                    });

                    if (t.o.imageWidthModalEdit) {
                        if (parseInt(v.width) > 0) {
                            $img.attr({
                                width: v.width
                            });
                        } else {
                            $img.removeAttr('width');
                        }
                    }

                    return true;
                });
                return false;
            };
        },

        // Range management
        saveRange: function () {
            var t = this,
                documentSelection = t.doc.getSelection();

            t.range = null;

            if (!documentSelection || !documentSelection.rangeCount) {
                return;
            }

            var savedRange = t.range = documentSelection.getRangeAt(0),
                range = t.doc.createRange(),
                rangeStart;
            range.selectNodeContents(t.$ed[0]);
            range.setEnd(savedRange.startContainer, savedRange.startOffset);
            rangeStart = (range + '').length;
            t.metaRange = {
                start: rangeStart,
                end: rangeStart + (savedRange + '').length
            };
        },
        restoreRange: function () {
            var t = this,
                metaRange = t.metaRange,
                savedRange = t.range,
                documentSelection = t.doc.getSelection(),
                range;

            if (!savedRange) {
                return;
            }

            if (metaRange && metaRange.start !== metaRange.end) { // Algorithm from http://jsfiddle.net/WeWy7/3/
                var charIndex = 0,
                    nodeStack = [t.$ed[0]],
                    node,
                    foundStart = false,
                    stop = false;

                range = t.doc.createRange();

                while (!stop && (node = nodeStack.pop())) {
                    if (node.nodeType === 3) {
                        var nextCharIndex = charIndex + node.length;
                        if (!foundStart && metaRange.start >= charIndex && metaRange.start <= nextCharIndex) {
                            range.setStart(node, metaRange.start - charIndex);
                            foundStart = true;
                        }
                        if (foundStart && metaRange.end >= charIndex && metaRange.end <= nextCharIndex) {
                            range.setEnd(node, metaRange.end - charIndex);
                            stop = true;
                        }
                        charIndex = nextCharIndex;
                    } else {
                        var cn = node.childNodes,
                            i = cn.length;

                        while (i > 0) {
                            i -= 1;
                            nodeStack.push(cn[i]);
                        }
                    }
                }
            }

            // Fix IE11 Error 'Could not complete the operation due to error 800a025e'.
            // https://stackoverflow.com/questions/16160996/could-not-complete-the-operation-due-to-error-800a025e
            try {
                documentSelection.removeAllRanges();
            } catch (e) {
            }

            documentSelection.addRange(range || savedRange);
        },
        getRangeText: function () {
            return this.range + '';
        },

        clearButtonPaneStatus: function () {
            var t = this,
              prefix = t.o.prefix,
              activeClasses = prefix + 'active-button ' + prefix + 'active',
              originalIconClass = prefix + 'original-icon';

            // Reset all buttons and dropdown state
            $('.' + prefix + 'active-button', t.$btnPane).removeClass(activeClasses);
            $('.' + originalIconClass, t.$btnPane).each(function () {
                $(this).find('svg use').attr('xlink:href', $(this).data(originalIconClass));
            });
        },
        updateButtonPaneStatus: function () {
            var t = this,
                prefix = t.o.prefix,
                activeClasses = prefix + 'active-button ' + prefix + 'active',
                originalIconClass = prefix + 'original-icon',
                tags = t.getTagsRecursive(t.doc.getSelection().focusNode);

            t.clearButtonPaneStatus();

            $.each(tags, function (i, tag) {
                var btnName = t.tagToButton[tag.toLowerCase()],
                    $btn = $('.' + prefix + btnName + '-button', t.$btnPane);

                if ($btn.length > 0) {
                    $btn.addClass(activeClasses);
                } else {
                    try {
                        $btn = $('.' + prefix + 'dropdown .' + prefix + btnName + '-dropdown-button', t.$box);
                        var $btnSvgUse = $btn.find('svg use'),
                            dropdownBtnName = $btn.parent().data(prefix + 'dropdown'),
                            $dropdownBtn = $('.' + prefix + dropdownBtnName + '-button', t.$box),
                            $dropdownBtnSvgUse = $dropdownBtn.find('svg use');

                        // Highlight the dropdown button
                        $dropdownBtn.addClass(activeClasses);

                        // Switch dropdown icon to the active sub-icon one
                        if (t.o.changeActiveDropdownIcon && $btnSvgUse.length > 0) {
                            // Save original icon
                            $dropdownBtn
                              .addClass(originalIconClass)
                              .data(originalIconClass, $dropdownBtnSvgUse.attr('xlink:href'));

                            // Put the active sub-button's icon
                            $dropdownBtnSvgUse
                              .attr('xlink:href', $btnSvgUse.attr('xlink:href'));
                        }
                    } catch (e) {
                    }
                }
            });
        },
        getTagsRecursive: function (element, tags) {
            var t = this;
            tags = tags || (element && element.tagName ? [element.tagName] : []);

            if (element && element.parentNode) {
                element = element.parentNode;
            } else {
                return tags;
            }

            var tag = element.tagName;
            if (tag === 'DIV') {
                return tags;
            }
            if (tag === 'P' && element.style.textAlign !== '') {
                tags.push(element.style.textAlign);
            }

            $.each(t.tagHandlers, function (i, tagHandler) {
                tags = tags.concat(tagHandler(element, t));
            });

            tags.push(tag);

            return t.getTagsRecursive(element, tags).filter(function (tag) {
                return tag != null;
            });
        },

        // Plugins
        initPlugins: function () {
            var t = this;
            t.loadedPlugins = [];
            $.each($.trumbowyg.plugins, function (name, plugin) {
                if (!plugin.shouldInit || plugin.shouldInit(t)) {
                    plugin.init(t);
                    if (plugin.tagHandler) {
                        t.tagHandlers.push(plugin.tagHandler);
                    }
                    t.loadedPlugins.push(plugin);
                }
            });
        },
        destroyPlugins: function () {
            var t = this;
            $.each(this.loadedPlugins, function (i, plugin) {
                if (plugin.destroy) {
                    plugin.destroy(t);
                }
            });
        }
    };
})(navigator, window, document, jQuery);

/* ===========================================================
 * trumbowyg.colors.js v1.2
 * Colors picker plugin for Trumbowyg
 * http://alex-d.github.com/Trumbowyg
 * ===========================================================
 * Author : Alexandre Demode (Alex-D)
 *          Twitter : @AlexandreDemode
 *          Website : alex-d.fr
 */

(function ($) {
    'use strict';

    $.extend(true, $.trumbowyg, {
        langs: {
            // jshint camelcase:false
            cs: {
                foreColor: 'Barva textu',
                backColor: 'Barva pozadí'
            },
            en: {
                foreColor: 'Text color',
                backColor: 'Background color',
                foreColorRemove: 'Remove text color',
                backColorRemove: 'Remove background color'
            },
            da: {
                foreColor: 'Tekstfarve',
                backColor: 'Baggrundsfarve'
            },
            fr: {
                foreColor: 'Couleur du texte',
                backColor: 'Couleur de fond',
                foreColorRemove: 'Supprimer la couleur du texte',
                backColorRemove: 'Supprimer la couleur de fond'
            },
            de: {
                foreColor: 'Textfarbe',
                backColor: 'Hintergrundfarbe'
            },
            nl: {
                foreColor: 'Tekstkleur',
                backColor: 'Achtergrondkleur'
            },
            sk: {
                foreColor: 'Farba textu',
                backColor: 'Farba pozadia'
            },
            zh_cn: {
                foreColor: '文字颜色',
                backColor: '背景颜色'
            },
            zh_tw: {
                foreColor: '文字顏色',
                backColor: '背景顏色'
            },
            ru: {
                foreColor: 'Цвет текста',
                backColor: 'Цвет выделения текста'
            },
            ja: {
                foreColor: '文字色',
                backColor: '背景色'
            },
            tr: {
                foreColor: 'Yazı rengi',
                backColor: 'Arkaplan rengi'
            },
            pt_br: {
                foreColor: 'Cor de fonte',
                backColor: 'Cor de fundo'
            },
            ko: {
                foreColor: '글자색',
                backColor: '배경색',
                foreColorRemove: '글자색 지우기',
                backColorRemove: '배경색 지우기'
            },
        }
    });

    // jshint camelcase:true


    function hex(x) {
        return ('0' + parseInt(x).toString(16)).slice(-2);
    }

    function colorToHex(rgb) {
        if (rgb.search('rgb') === -1) {
            return rgb.replace('#', '');
        } else if (rgb === 'rgba(0, 0, 0, 0)') {
            return 'transparent';
        } else {
            rgb = rgb.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/);
            return hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]);
        }
    }

    function colorTagHandler(element, trumbowyg) {
        var tags = [];

        if (!element.style) {
            return tags;
        }

        // background color
        if (element.style.backgroundColor !== '') {
            var backColor = colorToHex(element.style.backgroundColor);
            if (trumbowyg.o.plugins.colors.colorList.indexOf(backColor) >= 0) {
                tags.push('backColor' + backColor);
            } else {
                tags.push('backColorFree');
            }
        }

        // text color
        var foreColor;
        if (element.style.color !== '') {
            foreColor = colorToHex(element.style.color);
        } else if (element.hasAttribute('color')) {
            foreColor = colorToHex(element.getAttribute('color'));
        }
        if (foreColor) {
            if (trumbowyg.o.plugins.colors.colorList.indexOf(foreColor) >= 0) {
                tags.push('foreColor' + foreColor);
            } else {
                tags.push('foreColorFree');
            }
        }

        return tags;
    }

    var defaultOptions = {
        colorList: [
            'ffffff', '000000', 'eeece1', '1f497d', '4f81bd', 'c0504d', '9bbb59', '8064a2', '4bacc6', 'f79646', 'ffff00',
            'f2f2f2', '7f7f7f', 'ddd9c3', 'c6d9f0', 'dbe5f1', 'f2dcdb', 'ebf1dd', 'e5e0ec', 'dbeef3', 'fdeada', 'fff2ca',
            'd8d8d8', '595959', 'c4bd97', '8db3e2', 'b8cce4', 'e5b9b7', 'd7e3bc', 'ccc1d9', 'b7dde8', 'fbd5b5', 'ffe694',
            'bfbfbf', '3f3f3f', '938953', '548dd4', '95b3d7', 'd99694', 'c3d69b', 'b2a2c7', 'b7dde8', 'fac08f', 'f2c314',
            'a5a5a5', '262626', '494429', '17365d', '366092', '953734', '76923c', '5f497a', '92cddc', 'e36c09', 'c09100',
            '7f7f7f', '0c0c0c', '1d1b10', '0f243e', '244061', '632423', '4f6128', '3f3151', '31859b', '974806', '7f6000'
        ],
        foreColorList: null, // fallbacks on colorList
        backColorList: null, // fallbacks on colorList
        allowCustomForeColor: true,
        allowCustomBackColor: true,
        displayAsList: false,
    };

    // Add all colors in two dropdowns
    $.extend(true, $.trumbowyg, {
        plugins: {
            color: {
                init: function (trumbowyg) {
                    trumbowyg.o.plugins.colors = trumbowyg.o.plugins.colors || defaultOptions;
                    var dropdownClass = trumbowyg.o.plugins.colors.displayAsList ? trumbowyg.o.prefix + 'dropdown--color-list' : '';

                    var foreColorBtnDef = {
                        dropdown: buildDropdown('foreColor', trumbowyg),
                        dropdownClass: dropdownClass,
                    },
                    backColorBtnDef = {
                        dropdown: buildDropdown('backColor', trumbowyg),
                        dropdownClass: dropdownClass,
                    };

                    trumbowyg.addBtnDef('foreColor', foreColorBtnDef);
                    trumbowyg.addBtnDef('backColor', backColorBtnDef);
                },
                tagHandler: colorTagHandler
            }
        }
    });

    function buildDropdown(fn, trumbowyg) {
        var dropdown = [],
            trumbowygColorOptions = trumbowyg.o.plugins.colors,
            colorList = trumbowygColorOptions[fn + 'List'] || trumbowygColorOptions.colorList;

        $.each(colorList, function (i, color) {
            var btn = fn + color,
                btnDef = {
                    fn: fn,
                    forceCss: true,
                    hasIcon: false,
                    text: trumbowyg.lang['#' + color] || ('#' + color),
                    param: '#' + color,
                    style: 'background-color: #' + color + ';'
                };

            if (trumbowygColorOptions.displayAsList && fn === 'foreColor') {
                btnDef.style = 'color: #' + color + ' !important;';
            }

            trumbowyg.addBtnDef(btn, btnDef);
            dropdown.push(btn);
        });

        // Remove color
        var removeColorButtonName = fn + 'Remove',
            removeColorBtnDef = {
                fn: 'removeFormat',
                hasIcon: false,
                param: fn,
                style: 'background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAG0lEQVQIW2NkQAAfEJMRmwBYhoGBYQtMBYoAADziAp0jtJTgAAAAAElFTkSuQmCC);'
            };

        if (trumbowygColorOptions.displayAsList) {
            removeColorBtnDef.style = '';
        }

        trumbowyg.addBtnDef(removeColorButtonName, removeColorBtnDef);
        dropdown.push(removeColorButtonName);

        // Custom color
        if (trumbowygColorOptions['allowCustom' + fn.charAt(0).toUpperCase() + fn.substr(1)]) {
            // add free color btn
            var freeColorButtonName = fn + 'Free',
                freeColorBtnDef = {
                    fn: function () {
                        trumbowyg.openModalInsert(trumbowyg.lang[fn],
                            {
                                color: {
                                    label: fn,
                                    forceCss: true,
                                    type: 'color',
                                    value: '#FFFFFF'
                                }
                            },
                            // callback
                            function (values) {
                                trumbowyg.execCmd(fn, values.color);
                                return true;
                            }
                        );
                    },
                    hasIcon: false,
                    text: '#',
                    // style adjust for displaying the text
                    style: 'text-indent: 0; line-height: 20px; padding: 0 5px;'
                };

            trumbowyg.addBtnDef(freeColorButtonName, freeColorBtnDef);
            dropdown.push(freeColorButtonName);
        }

        return dropdown;
    }
})(jQuery);

/* ===========================================================
 * trumbowyg.base64.js v1.0
 * Base64 plugin for Trumbowyg
 * http://alex-d.github.com/Trumbowyg
 * ===========================================================
 * Author : Cyril Biencourt (lizardK)
 */

(function ($) {
    'use strict';

    var isSupported = function () {
        return typeof FileReader !== 'undefined';
    };

    var isValidImage = function (type) {
        return /^data:image\/[a-z]?/i.test(type);
    };

    $.extend(true, $.trumbowyg, {
        langs: {
            // jshint camelcase:false
            en: {
                base64: 'Image as base64',
                file: 'File',
                errFileReaderNotSupported: 'FileReader is not supported by your browser.',
                errInvalidImage: 'Invalid image file.'
            },
            da: {
                base64: 'Billede som base64',
                file: 'Fil',
                errFileReaderNotSupported: 'FileReader er ikke understøttet af din browser.',
                errInvalidImage: 'Ugyldig billedfil.'
            },
            fr: {
                base64: 'Image en base64',
                file: 'Fichier'
            },
            cs: {
                base64: 'Vložit obrázek',
                file: 'Soubor'
            },
            zh_cn: {
                base64: '图片（Base64编码）',
                file: '文件'
            },
            nl: {
                base64: 'Afbeelding inline',
                file: 'Bestand',
                errFileReaderNotSupported: 'Uw browser ondersteunt deze functionaliteit niet.',
                errInvalidImage: 'De gekozen afbeelding is ongeldig.'
            },
            ru: {
                base64: 'Изображение как код в base64',
                file: 'Файл',
                errFileReaderNotSupported: 'FileReader не поддерживается вашим браузером.',
                errInvalidImage: 'Недопустимый файл изображения.'
            },
            ja: {
                base64: '画像 (Base64形式)',
                file: 'ファイル',
                errFileReaderNotSupported: 'あなたのブラウザーはFileReaderをサポートしていません',
                errInvalidImage: '画像形式が正しくありません'
            },
            tr: {
                base64: 'Base64 olarak resim',
                file: 'Dosya',
                errFileReaderNotSupported: 'FileReader tarayıcınız tarafından desteklenmiyor.',
                errInvalidImage: 'Geçersiz resim dosyası.'
            },
            zh_tw: {
                base64: '圖片(base64編碼)',
                file: '檔案',
                errFileReaderNotSupported: '你的瀏覽器不支援FileReader',
                errInvalidImage: '不正確的檔案格式'
            },
            pt_br: {
                base64: 'Imagem em base64',
                file: 'Arquivo',
                errFileReaderNotSupported: 'FileReader não é suportado pelo seu navegador.',
                errInvalidImage: 'Arquivo de imagem inválido.'
            },
            ko: {
                base64: '그림 넣기(base64)',
                file: '파일',
                errFileReaderNotSupported: 'FileReader가 현재 브라우저를 지원하지 않습니다.',
                errInvalidImage: '유효하지 않은 파일'
            },
        },
        // jshint camelcase:true

        plugins: {
            base64: {
                shouldInit: isSupported,
                init: function (trumbowyg) {
                    var btnDef = {
                        isSupported: isSupported,
                        fn: function () {
                            trumbowyg.saveRange();

                            var file;
                            var $modal = trumbowyg.openModalInsert(
                                // Title
                                trumbowyg.lang.base64,

                                // Fields
                                {
                                    file: {
                                        type: 'file',
                                        required: true,
                                        attributes: {
                                            accept: 'image/*'
                                        }
                                    },
                                    alt: {
                                        label: 'description',
                                        value: trumbowyg.getRangeText()
                                    }
                                },

                                // Callback
                                function (values) {
                                    var fReader = new FileReader();

                                    fReader.onloadend = function (e) {
                                        if (isValidImage(e.target.result)) {
                                            trumbowyg.execCmd('insertImage', fReader.result, false, true);
                                            $(['img[src="', fReader.result, '"]:not([alt])'].join(''), trumbowyg.$box).attr('alt', values.alt);
                                            trumbowyg.closeModal();
                                        } else {
                                            trumbowyg.addErrorOnModalField(
                                                $('input[type=file]', $modal),
                                                trumbowyg.lang.errInvalidImage
                                            );
                                        }
                                    };

                                    fReader.readAsDataURL(file);
                                }
                            );

                            $('input[type=file]').on('change', function (e) {
                                file = e.target.files[0];
                            });
                        }
                    };

                    trumbowyg.addBtnDef('base64', btnDef);
                }
            }
        }
    });
})(jQuery);

/* ===========================================================
 * trumbowyg.noembed.js v1.0
 * noEmbed plugin for Trumbowyg
 * http://alex-d.github.com/Trumbowyg
 * ===========================================================
 * Author : Jake Johns (jakejohns)
 */

(function ($) {
    'use strict';

    var defaultOptions = {
        proxy: 'https://noembed.com/embed?nowrap=on',
        urlFiled: 'url',
        data: [],
        success: undefined,
        error: undefined
    };

    $.extend(true, $.trumbowyg, {
        langs: {
            en: {
                noembed: 'Noembed',
                noembedError: 'Error'
            },
            da: {
                noembedError: 'Fejl'
            },
            sk: {
                noembedError: 'Chyba'
            },
            fr: {
                noembedError: 'Erreur'
            },
            cs: {
                noembedError: 'Chyba'
            },
            ru: {
                noembedError: 'Ошибка'
            },
            ja: {
                noembedError: 'エラー'
            },
            tr: {
                noembedError: 'Hata'
            },
            zh_tw: {
                noembed: '插入影片',
                noembedError: '錯誤'
            },
            pt_br: {
                noembed: 'Incorporar',
                noembedError: 'Erro'
            },
            ko: {
                noembed: 'oEmbed 넣기',
                noembedError: '에러'
            },
        },

        plugins: {
            noembed: {
                init: function (trumbowyg) {
                    trumbowyg.o.plugins.noembed = $.extend(true, {}, defaultOptions, trumbowyg.o.plugins.noembed || {});

                    var btnDef = {
                        fn: function () {
                            var $modal = trumbowyg.openModalInsert(
                                // Title
                                trumbowyg.lang.noembed,

                                // Fields
                                {
                                    url: {
                                        label: 'URL',
                                        required: true
                                    }
                                },

                                // Callback
                                function (data) {
                                    $.ajax({
                                        url: trumbowyg.o.plugins.noembed.proxy,
                                        type: 'GET',
                                        data: data,
                                        cache: false,
                                        dataType: 'json',

                                        success: trumbowyg.o.plugins.noembed.success || function (data) {
                                            if (data.html) {
                                                trumbowyg.execCmd('insertHTML', data.html);
                                                setTimeout(function () {
                                                    trumbowyg.closeModal();
                                                }, 250);
                                            } else {
                                                trumbowyg.addErrorOnModalField(
                                                    $('input[type=text]', $modal),
                                                    data.error
                                                );
                                            }
                                        },
                                        error: trumbowyg.o.plugins.noembed.error || function () {
                                            trumbowyg.addErrorOnModalField(
                                                $('input[type=text]', $modal),
                                                trumbowyg.lang.noembedError
                                            );
                                        }
                                    });
                                }
                            );
                        }
                    };

                    trumbowyg.addBtnDef('noembed', btnDef);
                }
            }
        }
    });
})(jQuery);

/* ===========================================================
 * trumbowyg.pasteembed.js v1.0
 * Url paste to iframe with noembed. Plugin for Trumbowyg
 * http://alex-d.github.com/Trumbowyg
 * ===========================================================
 * Author : Max Seelig
 *          Facebook : https://facebook.com/maxse
 *          Website : https://www.maxmade.nl/
 */

(function($) {
    'use strict';

    var defaultOptions = {
        enabled: true,
        endpoints: [
            'https://noembed.com/embed?nowrap=on',
            'https://api.maxmade.nl/url2iframe/embed'
        ]
    };

    $.extend(true, $.trumbowyg, {
        plugins: {
            pasteEmbed: {
                init: function(trumbowyg) {
                    trumbowyg.o.plugins.pasteEmbed = $.extend(true, {}, defaultOptions, trumbowyg.o.plugins.pasteEmbed || {});

                    if (!trumbowyg.o.plugins.pasteEmbed.enabled) {
                        return;
                    }

                    trumbowyg.pasteHandlers.push(function(pasteEvent) {
                        try {
                            var clipboardData = (pasteEvent.originalEvent || pasteEvent).clipboardData,
                                pastedData = clipboardData.getData('Text'),
                                endpoints = trumbowyg.o.plugins.pasteEmbed.endpoints,
                                request = null;

                            if (pastedData.startsWith('http')) {
                                pasteEvent.stopPropagation();
                                pasteEvent.preventDefault();

                                var query = {
                                    url: pastedData.trim()
                                };
                                var content = '';
                                var index = 0;

                                if (request && request.transport) {
                                    request.transport.abort();
                                }

                                request = $.ajax({
                                    crossOrigin: true,
                                    url: endpoints[index],
                                    type: 'GET',
                                    data: query,
                                    cache: false,
                                    dataType: 'jsonp',
                                    success: function(res) {
                                        if (res.html) {
                                            index = 0;
                                            content = res.html;
                                        } else {
                                            index += 1;
                                        }
                                    },
                                    error: function() {
                                        index += 1;
                                    },
                                    complete: function() {
                                        if (content.length === 0 && index < endpoints.length - 1) {
                                            this.url = endpoints[index];
                                            this.data = query;
                                            $.ajax(this);
                                        }
                                        if (index === endpoints.length - 1) {
                                            content = $('<a>', {
                                                href: pastedData,
                                                text: pastedData
                                            }).prop('outerHTML');
                                        }
                                        if (content.length > 0) {
                                            index = 0;
                                            trumbowyg.execCmd('insertHTML', content);
                                        }
                                    }
                                });
                            }
                        } catch (c) {}
                    });
                }
            }
        }
    });
})(jQuery);

/* ===========================================================
 * trumbowyg.table.custom.js v2.0
 * Table plugin for Trumbowyg
 * http://alex-d.github.com/Trumbowyg
 * ===========================================================
 * Author : Sven Dunemann [dunemann@forelabs.eu]
 */

(function ($) {
    'use strict';

    var defaultOptions = {
        rows: 8,
        columns: 8,
        styler: 'table'
    };

    $.extend(true, $.trumbowyg, {
        langs: {
            // jshint camelcase:false
            en: {
                table: 'Insert table',
                tableAddRow: 'Add row',
                tableAddRowAbove: 'Add row above',
                tableAddColumnLeft: 'Add column to the left',
                tableAddColumn: 'Add column to the right',
                tableDeleteRow: 'Delete row',
                tableDeleteColumn: 'Delete column',
                tableDestroy: 'Delete table',
                error: 'Error'
            },
            da: {
                table: 'Indsæt tabel',
                tableAddRow: 'Tilføj række',
                tableAddRowAbove: 'Tilføj række',
                tableAddColumnLeft: 'Tilføj kolonne',
                tableAddColumn: 'Tilføj kolonne',
                tableDeleteRow: 'Slet række',
                tableDeleteColumn: 'Slet kolonne',
                tableDestroy: 'Slet tabel',
                error: 'Fejl'
            },
            de: {
                table: 'Tabelle einfügen',
                tableAddRow: 'Zeile hinzufügen',
                tableAddRowAbove: 'Zeile hinzufügen',
                tableAddColumnLeft: 'Spalte hinzufügen',
                tableAddColumn: 'Spalte hinzufügen',
                tableDeleteRow: 'Zeile löschen',
                tableDeleteColumn: 'Spalte löschen',
                tableDestroy: 'Tabelle löschen',
                error: 'Error'
            },
            sk: {
                table: 'Vytvoriť tabuľky',
                tableAddRow: 'Pridať riadok',
                tableAddRowAbove: 'Pridať riadok',
                tableAddColumnLeft: 'Pridať stĺpec',
                tableAddColumn: 'Pridať stĺpec',
                error: 'Chyba'
            },
            fr: {
                table: 'Insérer un tableau',
                tableAddRow: 'Ajouter des lignes',
                tableAddRowAbove: 'Ajouter des lignes',
                tableAddColumnLeft: 'Ajouter des colonnes',
                tableAddColumn: 'Ajouter des colonnes',
                tableDeleteRow: 'Effacer la ligne',
                tableDeleteColumn: 'Effacer la colonne',
                tableDestroy: 'Effacer le tableau',
                error: 'Erreur'
            },
            cs: {
                table: 'Vytvořit příkaz Table',
                tableAddRow: 'Přidat řádek',
                tableAddRowAbove: 'Přidat řádek',
                tableAddColumnLeft: 'Přidat sloupec',
                tableAddColumn: 'Přidat sloupec',
                error: 'Chyba'
            },
            ru: {
                table: 'Вставить таблицу',
                tableAddRow: 'Добавить строку',
                tableAddRowAbove: 'Добавить строку',
                tableAddColumnLeft: 'Добавить столбец',
                tableAddColumn: 'Добавить столбец',
                tableDeleteRow: 'Удалить строку',
                tableDeleteColumn: 'Удалить столбец',
                tableDestroy: 'Удалить таблицу',
                error: 'Ошибка'
            },
            ja: {
                table: '表の挿入',
                tableAddRow: '行の追加',
                tableAddRowAbove: '行の追加',
                tableAddColumnLeft: '列の追加',
                tableAddColumn: '列の追加',
                error: 'エラー'
            },
            tr: {
                table: 'Tablo ekle',
                tableAddRow: 'Satır ekle',
                tableAddRowAbove: 'Satır ekle',
                tableAddColumnLeft: 'Kolon ekle',
                tableAddColumn: 'Kolon ekle',
                error: 'Hata'
            },
            zh_tw: {
                table: '插入表格',
                tableAddRow: '加入行',
                tableAddRowAbove: '加入行',
                tableAddColumnLeft: '加入列',
                tableAddColumn: '加入列',
                tableDeleteRow: '刪除行',
                tableDeleteColumn: '刪除列',
                tableDestroy: '刪除表格',
                error: '錯誤'
            },
            id: {
                table: 'Sisipkan tabel',
                tableAddRow: 'Sisipkan baris',
                tableAddRowAbove: 'Sisipkan baris',
                tableAddColumnLeft: 'Sisipkan kolom',
                tableAddColumn: 'Sisipkan kolom',
                tableDeleteRow: 'Hapus baris',
                tableDeleteColumn: 'Hapus kolom',
                tableDestroy: 'Hapus tabel',
                error: 'Galat'
            },
            pt_br: {
                table: 'Inserir tabela',
                tableAddRow: 'Adicionar linha',
                tableAddRowAbove: 'Adicionar linha',
                tableAddColumnLeft: 'Adicionar coluna',
                tableAddColumn: 'Adicionar coluna',
                tableDeleteRow: 'Deletar linha',
                tableDeleteColumn: 'Deletar coluna',
                tableDestroy: 'Deletar tabela',
                error: 'Erro'
            },
            ko: {
                table: '표 넣기',
                tableAddRow: '줄 추가',
                tableAddRowAbove: '줄 추가',
                tableAddColumnLeft: '칸 추가',
                tableAddColumn: '칸 추가',
                tableDeleteRow: '줄 삭제',
                tableDeleteColumn: '칸 삭제',
                tableDestroy: '표 지우기',
                error: '에러'
            },
            // jshint camelcase:true
        },

        plugins: {
            table: {
                init: function (t) {
                    t.o.plugins.table = $.extend(true, {}, defaultOptions, t.o.plugins.table || {});

                    var buildButtonDef = {
                        fn: function () {
                            t.saveRange();

                            var btnName = 'table';

                            var dropdownPrefix = t.o.prefix + 'dropdown',
                                dropdownOptions = { // the dropdown
                                    class: dropdownPrefix + '-' + btnName + ' ' + dropdownPrefix + ' ' + t.o.prefix + 'fixed-top'
                                };
                            dropdownOptions['data-' + dropdownPrefix] = btnName;
                            var $dropdown = $('<div/>', dropdownOptions);

                            if (t.$box.find('.' + dropdownPrefix + '-' + btnName).length === 0) {
                                t.$box.append($dropdown.hide());
                            } else {
                                $dropdown = t.$box.find('.' + dropdownPrefix + '-' + btnName);
                            }

                            // clear dropdown
                            $dropdown.html('');

                            // when active table show AddRow / AddColumn
                            if (t.$box.find('.' + t.o.prefix + 'table-button').hasClass(t.o.prefix + 'active-button')) {
                                $dropdown.append(t.buildSubBtn('tableAddRowAbove'));
                                $dropdown.append(t.buildSubBtn('tableAddRow'));
                                $dropdown.append(t.buildSubBtn('tableAddColumnLeft'));
                                $dropdown.append(t.buildSubBtn('tableAddColumn'));
                                $dropdown.append(t.buildSubBtn('tableDeleteRow'));
                                $dropdown.append(t.buildSubBtn('tableDeleteColumn'));
                                $dropdown.append(t.buildSubBtn('tableDestroy'));
                            } else {
                                var tableSelect = $('<table/>');
                                $('<tbody/>').appendTo(tableSelect);
                                for (var i = 0; i < t.o.plugins.table.rows; i += 1) {
                                    var row = $('<tr/>').appendTo(tableSelect);
                                    for (var j = 0; j < t.o.plugins.table.columns; j += 1) {
                                        $('<td/>').appendTo(row);
                                    }
                                }
                                tableSelect.find('td').on('mouseover', tableAnimate);
                                tableSelect.find('td').on('mousedown', tableBuild);

                                $dropdown.append(tableSelect);
                                $dropdown.append($('<div class="trumbowyg-table-size">1x1</div>'));
                            }

                            t.dropdown(btnName);
                        }
                    };

                    var tableAnimate = function(columnEvent) {
                        var column = $(columnEvent.target),
                            table = column.closest('table'),
                            colIndex = this.cellIndex,
                            rowIndex = this.parentNode.rowIndex;

                        // reset all columns
                        table.find('td').removeClass('active');

                        for (var i = 0; i <= rowIndex; i += 1) {
                            for (var j = 0; j <= colIndex; j += 1) {
                                table.find('tr:nth-of-type('+(i+1)+')').find('td:nth-of-type('+(j+1)+')').addClass('active');
                            }
                        }

                        // set label
                        table.next('.trumbowyg-table-size').html((colIndex+1) + 'x' + (rowIndex+1));
                    };

                    var tableBuild = function() {
                        t.saveRange();

                        var tabler = $('<table/>');
                        $('<tbody/>').appendTo(tabler);
                        if (t.o.plugins.table.styler) {
                            tabler.attr('class', t.o.plugins.table.styler);
                        }

                        var colIndex = this.cellIndex,
                            rowIndex = this.parentNode.rowIndex;

                        for (var i = 0; i <= rowIndex; i += 1) {
                            var row = $('<tr></tr>').appendTo(tabler);
                            for (var j = 0; j <= colIndex; j += 1) {
                                $('<td/>').appendTo(row);
                            }
                        }

                        t.range.deleteContents();
                        t.range.insertNode(tabler[0]);
                        t.$c.trigger('tbwchange');
                    };

                    var addRow = {
                        title: t.lang.tableAddRow,
                        text: t.lang.tableAddRow,
                        ico: 'row-below',

                        fn: function () {
                            t.saveRange();

                            var node = t.doc.getSelection().focusNode;
                            var focusedRow = $(node).closest('tr');
                            var table = $(node).closest('table');

                            if(table.length > 0) {
                                var row = $('<tr/>');
                                // add columns according to current columns count
                                for (var i = 0; i < table.find('tr')[0].childElementCount; i += 1) {
                                    $('<td/>').appendTo(row);
                                }
                                // add row to table
                                focusedRow.after(row);
                            }

                            t.syncCode();
                        }
                    };

                    var addRowAbove = {
                        title: t.lang.tableAddRowAbove,
                        text: t.lang.tableAddRowAbove,
                        ico: 'row-above',

                        fn: function () {
                            t.saveRange();

                            var node = t.doc.getSelection().focusNode;
                            var focusedRow = $(node).closest('tr');
                            var table = $(node).closest('table');

                            if(table.length > 0) {
                                var row = $('<tr/>');
                                // add columns according to current columns count
                                for (var i = 0; i < table.find('tr')[0].childElementCount; i += 1) {
                                    $('<td/>').appendTo(row);
                                }
                                // add row to table
                                focusedRow.before(row);
                            }

                            t.syncCode();
                        }
                    };

                    var addColumn = {
                        title: t.lang.tableAddColumn,
                        text: t.lang.tableAddColumn,
                        ico: 'col-right',

                        fn: function () {
                            t.saveRange();

                            var node = t.doc.getSelection().focusNode;
                            var focusedCol = $(node).closest('td');
                            var table = $(node).closest('table');
                            var focusedColIdx = focusedCol.index();

                            if(table.length > 0) {
                                $(table).find('tr').each(function() {
                                    $($(this).children()[focusedColIdx]).after('<td></td>');
                                });
                            }

                            t.syncCode();
                        }
                    };

                    var addColumnLeft = {
                        title: t.lang.tableAddColumnLeft,
                        text: t.lang.tableAddColumnLeft,
                        ico: 'col-left',

                        fn: function () {
                            t.saveRange();

                            var node = t.doc.getSelection().focusNode;
                            var focusedCol = $(node).closest('td');
                            var table = $(node).closest('table');
                            var focusedColIdx = focusedCol.index();

                            if(table.length > 0) {
                                $(table).find('tr').each(function() {
                                    $($(this).children()[focusedColIdx]).before('<td></td>');
                                });
                            }

                            t.syncCode();
                        }
                    };

                    var destroy = {
                        title: t.lang.tableDestroy,
                        text: t.lang.tableDestroy,
                        ico: 'table-delete',

                        fn: function () {
                            t.saveRange();

                            var node = t.doc.getSelection().focusNode,
                                table = $(node).closest('table');

                            table.remove();

                            t.syncCode();
                        }
                    };

                    var deleteRow = {
                        title: t.lang.tableDeleteRow,
                        text: t.lang.tableDeleteRow,
                        ico: 'row-delete',

                        fn: function () {
                            t.saveRange();

                            var node = t.doc.getSelection().focusNode,
                                row = $(node).closest('tr');

                            row.remove();

                            t.syncCode();
                        }
                    };

                    var deleteColumn = {
                        title: t.lang.tableDeleteColumn,
                        text: t.lang.tableDeleteColumn,
                        ico: 'col-delete',

                        fn: function () {
                            t.saveRange();

                            var node = t.doc.getSelection().focusNode,
                                table = $(node).closest('table'),
                                td = $(node).closest('td'),
                                cellIndex = td.index();

                            $(table).find('tr').each(function() {
                                $(this).find('td:eq(' + cellIndex + ')').remove();
                            });

                            t.syncCode();
                        }
                    };

                    t.addBtnDef('table', buildButtonDef);
                    t.addBtnDef('tableAddRowAbove', addRowAbove);
                    t.addBtnDef('tableAddRow', addRow);
                    t.addBtnDef('tableAddColumnLeft', addColumnLeft);
                    t.addBtnDef('tableAddColumn', addColumn);
                    t.addBtnDef('tableDeleteRow', deleteRow);
                    t.addBtnDef('tableDeleteColumn', deleteColumn);
                    t.addBtnDef('tableDestroy', destroy);
                }
            }
        }
    });
})(jQuery);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRydW1ib3d5Zy5qcyIsImNvbG9ycy90cnVtYm93eWcuY29sb3JzLmpzIiwiYmFzZTY0L3RydW1ib3d5Zy5iYXNlNjQuanMiLCJub2VtYmVkL3RydW1ib3d5Zy5ub2VtYmVkLmpzIiwicGFzdGVlbWJlZC90cnVtYm93eWcucGFzdGVlbWJlZC5qcyIsInRhYmxlL3RydW1ib3d5Zy50YWJsZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5M0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJ0cnVtYm93eWcuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRydW1ib3d5ZyB2Mi4xOS4xIC0gQSBsaWdodHdlaWdodCBXWVNJV1lHIGVkaXRvclxuICogVHJ1bWJvd3lnIGNvcmUgZmlsZVxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBAbGluayBodHRwOi8vYWxleC1kLmdpdGh1Yi5pby9UcnVtYm93eWdcbiAqIEBsaWNlbnNlIE1JVFxuICogQGF1dGhvciBBbGV4YW5kcmUgRGVtb2RlIChBbGV4LUQpXG4gKiAgICAgICAgIFR3aXR0ZXIgOiBAQWxleGFuZHJlRGVtb2RlXG4gKiAgICAgICAgIFdlYnNpdGUgOiBhbGV4LWQuZnJcbiAqL1xuXG5qUXVlcnkudHJ1bWJvd3lnID0ge1xuICAgIGxhbmdzOiB7XG4gICAgICAgIGVuOiB7XG4gICAgICAgICAgICB2aWV3SFRNTDogJ1ZpZXcgSFRNTCcsXG5cbiAgICAgICAgICAgIHVuZG86ICdVbmRvJyxcbiAgICAgICAgICAgIHJlZG86ICdSZWRvJyxcblxuICAgICAgICAgICAgZm9ybWF0dGluZzogJ0Zvcm1hdHRpbmcnLFxuICAgICAgICAgICAgcDogJ1BhcmFncmFwaCcsXG4gICAgICAgICAgICBibG9ja3F1b3RlOiAnUXVvdGUnLFxuICAgICAgICAgICAgY29kZTogJ0NvZGUnLFxuICAgICAgICAgICAgaGVhZGVyOiAnSGVhZGVyJyxcblxuICAgICAgICAgICAgYm9sZDogJ0JvbGQnLFxuICAgICAgICAgICAgaXRhbGljOiAnSXRhbGljJyxcbiAgICAgICAgICAgIHN0cmlrZXRocm91Z2g6ICdTdHJpa2V0aHJvdWdoJyxcbiAgICAgICAgICAgIHVuZGVybGluZTogJ1VuZGVybGluZScsXG5cbiAgICAgICAgICAgIHN0cm9uZzogJ1N0cm9uZycsXG4gICAgICAgICAgICBlbTogJ0VtcGhhc2lzJyxcbiAgICAgICAgICAgIGRlbDogJ0RlbGV0ZWQnLFxuXG4gICAgICAgICAgICBzdXBlcnNjcmlwdDogJ1N1cGVyc2NyaXB0JyxcbiAgICAgICAgICAgIHN1YnNjcmlwdDogJ1N1YnNjcmlwdCcsXG5cbiAgICAgICAgICAgIHVub3JkZXJlZExpc3Q6ICdVbm9yZGVyZWQgbGlzdCcsXG4gICAgICAgICAgICBvcmRlcmVkTGlzdDogJ09yZGVyZWQgbGlzdCcsXG5cbiAgICAgICAgICAgIGluc2VydEltYWdlOiAnSW5zZXJ0IEltYWdlJyxcbiAgICAgICAgICAgIGxpbms6ICdMaW5rJyxcbiAgICAgICAgICAgIGNyZWF0ZUxpbms6ICdJbnNlcnQgbGluaycsXG4gICAgICAgICAgICB1bmxpbms6ICdSZW1vdmUgbGluaycsXG5cbiAgICAgICAgICAgIGp1c3RpZnlMZWZ0OiAnQWxpZ24gTGVmdCcsXG4gICAgICAgICAgICBqdXN0aWZ5Q2VudGVyOiAnQWxpZ24gQ2VudGVyJyxcbiAgICAgICAgICAgIGp1c3RpZnlSaWdodDogJ0FsaWduIFJpZ2h0JyxcbiAgICAgICAgICAgIGp1c3RpZnlGdWxsOiAnQWxpZ24gSnVzdGlmeScsXG5cbiAgICAgICAgICAgIGhvcml6b250YWxSdWxlOiAnSW5zZXJ0IGhvcml6b250YWwgcnVsZScsXG4gICAgICAgICAgICByZW1vdmVmb3JtYXQ6ICdSZW1vdmUgZm9ybWF0JyxcblxuICAgICAgICAgICAgZnVsbHNjcmVlbjogJ0Z1bGxzY3JlZW4nLFxuXG4gICAgICAgICAgICBjbG9zZTogJ0Nsb3NlJyxcblxuICAgICAgICAgICAgc3VibWl0OiAnQ29uZmlybScsXG4gICAgICAgICAgICByZXNldDogJ0NhbmNlbCcsXG5cbiAgICAgICAgICAgIHJlcXVpcmVkOiAnUmVxdWlyZWQnLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdEZXNjcmlwdGlvbicsXG4gICAgICAgICAgICB0aXRsZTogJ1RpdGxlJyxcbiAgICAgICAgICAgIHRleHQ6ICdUZXh0JyxcbiAgICAgICAgICAgIHRhcmdldDogJ1RhcmdldCcsXG4gICAgICAgICAgICB3aWR0aDogJ1dpZHRoJ1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8vIFBsdWdpbnNcbiAgICBwbHVnaW5zOiB7fSxcblxuICAgIC8vIFNWRyBQYXRoIGdsb2JhbGx5XG4gICAgc3ZnUGF0aDogbnVsbCxcblxuICAgIGhpZGVCdXR0b25UZXh0czogbnVsbFxufTtcblxuLy8gTWFrZXMgZGVmYXVsdCBvcHRpb25zIHJlYWQtb25seVxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGpRdWVyeS50cnVtYm93eWcsICdkZWZhdWx0T3B0aW9ucycsIHtcbiAgICB2YWx1ZToge1xuICAgICAgICBsYW5nOiAnZW4nLFxuXG4gICAgICAgIGZpeGVkQnRuUGFuZTogZmFsc2UsXG4gICAgICAgIGZpeGVkRnVsbFdpZHRoOiBmYWxzZSxcbiAgICAgICAgYXV0b2dyb3c6IGZhbHNlLFxuICAgICAgICBhdXRvZ3Jvd09uRW50ZXI6IGZhbHNlLFxuICAgICAgICBpbWFnZVdpZHRoTW9kYWxFZGl0OiBmYWxzZSxcblxuICAgICAgICBwcmVmaXg6ICd0cnVtYm93eWctJyxcblxuICAgICAgICBzZW1hbnRpYzogdHJ1ZSxcbiAgICAgICAgc2VtYW50aWNLZWVwQXR0cmlidXRlczogZmFsc2UsXG4gICAgICAgIHJlc2V0Q3NzOiBmYWxzZSxcbiAgICAgICAgcmVtb3ZlZm9ybWF0UGFzdGVkOiBmYWxzZSxcbiAgICAgICAgdGFiVG9JbmRlbnQ6IGZhbHNlLFxuICAgICAgICB0YWdzVG9SZW1vdmU6IFtdLFxuICAgICAgICB0YWdzVG9LZWVwOiBbJ2hyJywgJ2ltZycsICdlbWJlZCcsICdpZnJhbWUnLCAnaW5wdXQnXSxcbiAgICAgICAgYnRuczogW1xuICAgICAgICAgICAgWyd2aWV3SFRNTCddLFxuICAgICAgICAgICAgWyd1bmRvJywgJ3JlZG8nXSwgLy8gT25seSBzdXBwb3J0ZWQgaW4gQmxpbmsgYnJvd3NlcnNcbiAgICAgICAgICAgIFsnZm9ybWF0dGluZyddLFxuICAgICAgICAgICAgWydzdHJvbmcnLCAnZW0nLCAnZGVsJ10sXG4gICAgICAgICAgICBbJ3N1cGVyc2NyaXB0JywgJ3N1YnNjcmlwdCddLFxuICAgICAgICAgICAgWydsaW5rJ10sXG4gICAgICAgICAgICBbJ2luc2VydEltYWdlJ10sXG4gICAgICAgICAgICBbJ2p1c3RpZnlMZWZ0JywgJ2p1c3RpZnlDZW50ZXInLCAnanVzdGlmeVJpZ2h0JywgJ2p1c3RpZnlGdWxsJ10sXG4gICAgICAgICAgICBbJ3Vub3JkZXJlZExpc3QnLCAnb3JkZXJlZExpc3QnXSxcbiAgICAgICAgICAgIFsnaG9yaXpvbnRhbFJ1bGUnXSxcbiAgICAgICAgICAgIFsncmVtb3ZlZm9ybWF0J10sXG4gICAgICAgICAgICBbJ2Z1bGxzY3JlZW4nXVxuICAgICAgICBdLFxuICAgICAgICAvLyBGb3IgY3VzdG9tIGJ1dHRvbiBkZWZpbml0aW9uc1xuICAgICAgICBidG5zRGVmOiB7fSxcbiAgICAgICAgY2hhbmdlQWN0aXZlRHJvcGRvd25JY29uOiBmYWxzZSxcblxuICAgICAgICBpbmxpbmVFbGVtZW50c1NlbGVjdG9yOiAnYSxhYmJyLGFjcm9ueW0sYixjYXB0aW9uLGNpdGUsY29kZSxjb2wsZGZuLGRpcixkdCxkZCxlbSxmb250LGhyLGksa2JkLGxpLHEsc3BhbixzdHJpa2VvdXQsc3Ryb25nLHN1YixzdXAsdScsXG5cbiAgICAgICAgcGFzdGVIYW5kbGVyczogW10sXG5cbiAgICAgICAgLy8gaW1nRGJsQ2xpY2tIYW5kbGVyOiBkZWZhdWx0IGlzIGRlZmluZWQgaW4gY29uc3RydWN0b3JcblxuICAgICAgICBwbHVnaW5zOiB7fSxcbiAgICAgICAgdXJsUHJvdG9jb2w6IGZhbHNlLFxuICAgICAgICBtaW5pbWFsTGlua3M6IGZhbHNlXG4gICAgfSxcbiAgICB3cml0YWJsZTogZmFsc2UsXG4gICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICBjb25maWd1cmFibGU6IGZhbHNlXG59KTtcblxuXG4oZnVuY3Rpb24gKG5hdmlnYXRvciwgd2luZG93LCBkb2N1bWVudCwgJCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBDT05GSVJNX0VWRU5UID0gJ3Rid2NvbmZpcm0nLFxuICAgICAgICBDQU5DRUxfRVZFTlQgPSAndGJ3Y2FuY2VsJztcblxuICAgICQuZm4udHJ1bWJvd3lnID0gZnVuY3Rpb24gKG9wdGlvbnMsIHBhcmFtcykge1xuICAgICAgICB2YXIgdHJ1bWJvd3lnRGF0YU5hbWUgPSAndHJ1bWJvd3lnJztcbiAgICAgICAgaWYgKG9wdGlvbnMgPT09IE9iamVjdChvcHRpb25zKSB8fCAhb3B0aW9ucykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEkKHRoaXMpLmRhdGEodHJ1bWJvd3lnRGF0YU5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuZGF0YSh0cnVtYm93eWdEYXRhTmFtZSwgbmV3IFRydW1ib3d5Zyh0aGlzLCBvcHRpb25zKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHZhciB0ID0gJCh0aGlzKS5kYXRhKHRydW1ib3d5Z0RhdGFOYW1lKTtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRXhlYyBjb21tYW5kXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2V4ZWNDbWQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuZXhlY0NtZChwYXJhbXMuY21kLCBwYXJhbXMucGFyYW0sIHBhcmFtcy5mb3JjZUNzcywgcGFyYW1zLnNraXBUcnVtYm93eWcpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIE1vZGFsIGJveFxuICAgICAgICAgICAgICAgICAgICBjYXNlICdvcGVuTW9kYWwnOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQub3Blbk1vZGFsKHBhcmFtcy50aXRsZSwgcGFyYW1zLmNvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdjbG9zZU1vZGFsJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmNsb3NlTW9kYWwoKTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnb3Blbk1vZGFsSW5zZXJ0JzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0Lm9wZW5Nb2RhbEluc2VydChwYXJhbXMudGl0bGUsIHBhcmFtcy5maWVsZHMsIHBhcmFtcy5jYWxsYmFjayk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gUmFuZ2VcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc2F2ZVJhbmdlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0LnNhdmVSYW5nZSgpO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdnZXRSYW5nZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5yYW5nZTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZ2V0UmFuZ2VUZXh0JzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmdldFJhbmdlVGV4dCgpO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdyZXN0b3JlUmFuZ2UnOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQucmVzdG9yZVJhbmdlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gRW5hYmxlL2Rpc2FibGVcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZW5hYmxlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0LnNldERpc2FibGVkKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGlzYWJsZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5zZXREaXNhYmxlZCh0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBUb2dnbGVcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAndG9nZ2xlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0LnRvZ2dsZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIERlc3Ryb3lcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGVzdHJveSc6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5kZXN0cm95KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gRW1wdHlcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZW1wdHknOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuZW1wdHkoKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBIVE1MXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2h0bWwnOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuaHRtbChwYXJhbXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gY2F0Y2ggKGMpIHtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuXG4gICAgLy8gQHBhcmFtOiBlZGl0b3JFbGVtIGlzIHRoZSBET00gZWxlbWVudFxuICAgIHZhciBUcnVtYm93eWcgPSBmdW5jdGlvbiAoZWRpdG9yRWxlbSwgb3B0aW9ucykge1xuICAgICAgICB2YXIgdCA9IHRoaXMsXG4gICAgICAgICAgICB0cnVtYm93eWdJY29uc0lkID0gJ3RydW1ib3d5Zy1pY29ucycsXG4gICAgICAgICAgICAkdHJ1bWJvd3lnID0gJC50cnVtYm93eWc7XG5cbiAgICAgICAgLy8gR2V0IHRoZSBkb2N1bWVudCBvZiB0aGUgZWxlbWVudC4gSXQgdXNlIHRvIG1ha2VzIHRoZSBwbHVnaW5cbiAgICAgICAgLy8gY29tcGF0aWJsZSBvbiBpZnJhbWVzLlxuICAgICAgICB0LmRvYyA9IGVkaXRvckVsZW0ub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudDtcblxuICAgICAgICAvLyBqUXVlcnkgb2JqZWN0IG9mIHRoZSBlZGl0b3JcbiAgICAgICAgdC4kdGEgPSAkKGVkaXRvckVsZW0pOyAvLyAkdGEgOiBUZXh0YXJlYVxuICAgICAgICB0LiRjID0gJChlZGl0b3JFbGVtKTsgLy8gJGMgOiBjcmVhdG9yXG5cbiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cbiAgICAgICAgLy8gTG9jYWxpemF0aW9uIG1hbmFnZW1lbnRcbiAgICAgICAgaWYgKG9wdGlvbnMubGFuZyAhPSBudWxsIHx8ICR0cnVtYm93eWcubGFuZ3Nbb3B0aW9ucy5sYW5nXSAhPSBudWxsKSB7XG4gICAgICAgICAgICB0LmxhbmcgPSAkLmV4dGVuZCh0cnVlLCB7fSwgJHRydW1ib3d5Zy5sYW5ncy5lbiwgJHRydW1ib3d5Zy5sYW5nc1tvcHRpb25zLmxhbmddKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHQubGFuZyA9ICR0cnVtYm93eWcubGFuZ3MuZW47XG4gICAgICAgIH1cblxuICAgICAgICB0LmhpZGVCdXR0b25UZXh0cyA9ICR0cnVtYm93eWcuaGlkZUJ1dHRvblRleHRzICE9IG51bGwgPyAkdHJ1bWJvd3lnLmhpZGVCdXR0b25UZXh0cyA6IG9wdGlvbnMuaGlkZUJ1dHRvblRleHRzO1xuXG4gICAgICAgIC8vIFNWRyBwYXRoXG4gICAgICAgIHZhciBzdmdQYXRoT3B0aW9uID0gJHRydW1ib3d5Zy5zdmdQYXRoICE9IG51bGwgPyAkdHJ1bWJvd3lnLnN2Z1BhdGggOiBvcHRpb25zLnN2Z1BhdGg7XG4gICAgICAgIHQuaGFzU3ZnID0gc3ZnUGF0aE9wdGlvbiAhPT0gZmFsc2U7XG4gICAgICAgIHQuc3ZnUGF0aCA9ICEhdC5kb2MucXVlcnlTZWxlY3RvcignYmFzZScpID8gd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoJyMnKVswXSA6ICcnO1xuICAgICAgICBpZiAoJCgnIycgKyB0cnVtYm93eWdJY29uc0lkLCB0LmRvYykubGVuZ3RoID09PSAwICYmIHN2Z1BhdGhPcHRpb24gIT09IGZhbHNlKSB7XG4gICAgICAgICAgICBpZiAoc3ZnUGF0aE9wdGlvbiA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgLy8gSGFjayB0byBnZXQgc3ZnUGF0aE9wdGlvbiBiYXNlZCBvbiB0cnVtYm93eWcuanMgcGF0aFxuICAgICAgICAgICAgICAgIHZhciBzY3JpcHRFbGVtZW50cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzY3JpcHQnKTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNjcmlwdEVsZW1lbnRzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzb3VyY2UgPSBzY3JpcHRFbGVtZW50c1tpXS5zcmM7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtYXRjaGVzID0gc291cmNlLm1hdGNoKCd0cnVtYm93eWcoXFwubWluKT9cXC5qcycpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWF0Y2hlcyAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdmdQYXRoT3B0aW9uID0gc291cmNlLnN1YnN0cmluZygwLCBzb3VyY2UuaW5kZXhPZihtYXRjaGVzWzBdKSkgKyAndWkvaWNvbnMuc3ZnJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoc3ZnUGF0aE9wdGlvbiA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignWW91IG11c3QgZGVmaW5lIHN2Z1BhdGg6IGh0dHBzOi8vZ29vLmdsL0NmVFk5VScpOyAvLyBqc2hpbnQgaWdub3JlOmxpbmVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBkaXYgPSB0LmRvYy5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGRpdi5pZCA9IHRydW1ib3d5Z0ljb25zSWQ7XG4gICAgICAgICAgICB0LmRvYy5ib2R5Lmluc2VydEJlZm9yZShkaXYsIHQuZG9jLmJvZHkuY2hpbGROb2Rlc1swXSk7XG4gICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgIGFzeW5jOiB0cnVlLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdHRVQnLFxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04JyxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ3htbCcsXG4gICAgICAgICAgICAgICAgY3Jvc3NEb21haW46IHRydWUsXG4gICAgICAgICAgICAgICAgdXJsOiBzdmdQYXRoT3B0aW9uLFxuICAgICAgICAgICAgICAgIGRhdGE6IG51bGwsXG4gICAgICAgICAgICAgICAgYmVmb3JlU2VuZDogbnVsbCxcbiAgICAgICAgICAgICAgICBjb21wbGV0ZTogbnVsbCxcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkaXYuaW5uZXJIVE1MID0gbmV3IFhNTFNlcmlhbGl6ZXIoKS5zZXJpYWxpemVUb1N0cmluZyhkYXRhLmRvY3VtZW50RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGVuIHRoZSBidXR0b24gaXMgYXNzb2NpYXRlZCB0byBhIGVtcHR5IG9iamVjdFxuICAgICAgICAgKiBmbiBhbmQgdGl0bGUgYXR0cmlidXRlcyBhcmUgZGVmaW5lZCBmcm9tIHRoZSBidXR0b24ga2V5IHZhbHVlXG4gICAgICAgICAqXG4gICAgICAgICAqIEZvciBleGFtcGxlXG4gICAgICAgICAqICAgICAgZm9vOiB7fVxuICAgICAgICAgKiBpcyBlcXVpdmFsZW50IHRvIDpcbiAgICAgICAgICogICAgICBmb286IHtcbiAgICAgICAgICogICAgICAgICAgZm46ICdmb28nLFxuICAgICAgICAgKiAgICAgICAgICB0aXRsZTogdGhpcy5sYW5nLmZvb1xuICAgICAgICAgKiAgICAgIH1cbiAgICAgICAgICovXG4gICAgICAgIHZhciBoID0gdC5sYW5nLmhlYWRlciwgLy8gSGVhZGVyIHRyYW5zbGF0aW9uXG4gICAgICAgICAgICBpc0JsaW5rRnVuY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICh3aW5kb3cuY2hyb21lIHx8ICh3aW5kb3cuSW50bCAmJiBJbnRsLnY4QnJlYWtJdGVyYXRvcikpICYmICdDU1MnIGluIHdpbmRvdztcbiAgICAgICAgICAgIH07XG4gICAgICAgIHQuYnRuc0RlZiA9IHtcbiAgICAgICAgICAgIHZpZXdIVE1MOiB7XG4gICAgICAgICAgICAgICAgZm46ICd0b2dnbGUnLFxuICAgICAgICAgICAgICAgIGNsYXNzOiAndHJ1bWJvd3lnLW5vdC1kaXNhYmxlJyxcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHVuZG86IHtcbiAgICAgICAgICAgICAgICBpc1N1cHBvcnRlZDogaXNCbGlua0Z1bmN0aW9uLFxuICAgICAgICAgICAgICAgIGtleTogJ1onXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVkbzoge1xuICAgICAgICAgICAgICAgIGlzU3VwcG9ydGVkOiBpc0JsaW5rRnVuY3Rpb24sXG4gICAgICAgICAgICAgICAga2V5OiAnWSdcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHA6IHtcbiAgICAgICAgICAgICAgICBmbjogJ2Zvcm1hdEJsb2NrJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGJsb2NrcXVvdGU6IHtcbiAgICAgICAgICAgICAgICBmbjogJ2Zvcm1hdEJsb2NrJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGgxOiB7XG4gICAgICAgICAgICAgICAgZm46ICdmb3JtYXRCbG9jaycsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGggKyAnIDEnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaDI6IHtcbiAgICAgICAgICAgICAgICBmbjogJ2Zvcm1hdEJsb2NrJyxcbiAgICAgICAgICAgICAgICB0aXRsZTogaCArICcgMidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoMzoge1xuICAgICAgICAgICAgICAgIGZuOiAnZm9ybWF0QmxvY2snLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBoICsgJyAzJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGg0OiB7XG4gICAgICAgICAgICAgICAgZm46ICdmb3JtYXRCbG9jaycsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGggKyAnIDQnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaDU6IHtcbiAgICAgICAgICAgICAgICBmbjogJ2Zvcm1hdEJsb2NrJyxcbiAgICAgICAgICAgICAgICB0aXRsZTogaCArICcgNSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoNjoge1xuICAgICAgICAgICAgICAgIGZuOiAnZm9ybWF0QmxvY2snLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBoICsgJyA2J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN1YnNjcmlwdDoge1xuICAgICAgICAgICAgICAgIHRhZzogJ3N1YidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdXBlcnNjcmlwdDoge1xuICAgICAgICAgICAgICAgIHRhZzogJ3N1cCdcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGJvbGQ6IHtcbiAgICAgICAgICAgICAgICBrZXk6ICdCJyxcbiAgICAgICAgICAgICAgICB0YWc6ICdiJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGl0YWxpYzoge1xuICAgICAgICAgICAgICAgIGtleTogJ0knLFxuICAgICAgICAgICAgICAgIHRhZzogJ2knXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdW5kZXJsaW5lOiB7XG4gICAgICAgICAgICAgICAgdGFnOiAndSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdHJpa2V0aHJvdWdoOiB7XG4gICAgICAgICAgICAgICAgdGFnOiAnc3RyaWtlJ1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgc3Ryb25nOiB7XG4gICAgICAgICAgICAgICAgZm46ICdib2xkJyxcbiAgICAgICAgICAgICAgICBrZXk6ICdCJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVtOiB7XG4gICAgICAgICAgICAgICAgZm46ICdpdGFsaWMnLFxuICAgICAgICAgICAgICAgIGtleTogJ0knXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGVsOiB7XG4gICAgICAgICAgICAgICAgZm46ICdzdHJpa2V0aHJvdWdoJ1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgY3JlYXRlTGluazoge1xuICAgICAgICAgICAgICAgIGtleTogJ0snLFxuICAgICAgICAgICAgICAgIHRhZzogJ2EnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdW5saW5rOiB7fSxcblxuICAgICAgICAgICAgaW5zZXJ0SW1hZ2U6IHt9LFxuXG4gICAgICAgICAgICBqdXN0aWZ5TGVmdDoge1xuICAgICAgICAgICAgICAgIHRhZzogJ2xlZnQnLFxuICAgICAgICAgICAgICAgIGZvcmNlQ3NzOiB0cnVlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAganVzdGlmeUNlbnRlcjoge1xuICAgICAgICAgICAgICAgIHRhZzogJ2NlbnRlcicsXG4gICAgICAgICAgICAgICAgZm9yY2VDc3M6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBqdXN0aWZ5UmlnaHQ6IHtcbiAgICAgICAgICAgICAgICB0YWc6ICdyaWdodCcsXG4gICAgICAgICAgICAgICAgZm9yY2VDc3M6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBqdXN0aWZ5RnVsbDoge1xuICAgICAgICAgICAgICAgIHRhZzogJ2p1c3RpZnknLFxuICAgICAgICAgICAgICAgIGZvcmNlQ3NzOiB0cnVlXG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICB1bm9yZGVyZWRMaXN0OiB7XG4gICAgICAgICAgICAgICAgZm46ICdpbnNlcnRVbm9yZGVyZWRMaXN0JyxcbiAgICAgICAgICAgICAgICB0YWc6ICd1bCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvcmRlcmVkTGlzdDoge1xuICAgICAgICAgICAgICAgIGZuOiAnaW5zZXJ0T3JkZXJlZExpc3QnLFxuICAgICAgICAgICAgICAgIHRhZzogJ29sJ1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgaG9yaXpvbnRhbFJ1bGU6IHtcbiAgICAgICAgICAgICAgICBmbjogJ2luc2VydEhvcml6b250YWxSdWxlJ1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgcmVtb3ZlZm9ybWF0OiB7fSxcblxuICAgICAgICAgICAgZnVsbHNjcmVlbjoge1xuICAgICAgICAgICAgICAgIGNsYXNzOiAndHJ1bWJvd3lnLW5vdC1kaXNhYmxlJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNsb3NlOiB7XG4gICAgICAgICAgICAgICAgZm46ICdkZXN0cm95JyxcbiAgICAgICAgICAgICAgICBjbGFzczogJ3RydW1ib3d5Zy1ub3QtZGlzYWJsZSdcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIC8vIERyb3Bkb3duc1xuICAgICAgICAgICAgZm9ybWF0dGluZzoge1xuICAgICAgICAgICAgICAgIGRyb3Bkb3duOiBbJ3AnLCAnYmxvY2txdW90ZScsICdoMScsICdoMicsICdoMycsICdoNCddLFxuICAgICAgICAgICAgICAgIGljbzogJ3AnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGluazoge1xuICAgICAgICAgICAgICAgIGRyb3Bkb3duOiBbJ2NyZWF0ZUxpbmsnLCAndW5saW5rJ11cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBEZWZhdWx0cyBPcHRpb25zXG4gICAgICAgIHQubyA9ICQuZXh0ZW5kKHRydWUsIHt9LCAkdHJ1bWJvd3lnLmRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcbiAgICAgICAgaWYgKCF0Lm8uaGFzT3duUHJvcGVydHkoJ2ltZ0RibENsaWNrSGFuZGxlcicpKSB7XG4gICAgICAgICAgICB0Lm8uaW1nRGJsQ2xpY2tIYW5kbGVyID0gdC5nZXREZWZhdWx0SW1nRGJsQ2xpY2tIYW5kbGVyKCk7XG4gICAgICAgIH1cblxuICAgICAgICB0LnVybFByZWZpeCA9IHQuc2V0dXBVcmxQcmVmaXgoKTtcblxuICAgICAgICB0LmRpc2FibGVkID0gdC5vLmRpc2FibGVkIHx8IChlZGl0b3JFbGVtLm5vZGVOYW1lID09PSAnVEVYVEFSRUEnICYmIGVkaXRvckVsZW0uZGlzYWJsZWQpO1xuXG4gICAgICAgIGlmIChvcHRpb25zLmJ0bnMpIHtcbiAgICAgICAgICAgIHQuby5idG5zID0gb3B0aW9ucy5idG5zO1xuICAgICAgICB9IGVsc2UgaWYgKCF0Lm8uc2VtYW50aWMpIHtcbiAgICAgICAgICAgIHQuby5idG5zWzNdID0gWydib2xkJywgJ2l0YWxpYycsICd1bmRlcmxpbmUnLCAnc3RyaWtldGhyb3VnaCddO1xuICAgICAgICB9XG5cbiAgICAgICAgJC5lYWNoKHQuby5idG5zRGVmLCBmdW5jdGlvbiAoYnRuTmFtZSwgYnRuRGVmKSB7XG4gICAgICAgICAgICB0LmFkZEJ0bkRlZihidG5OYW1lLCBidG5EZWYpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBwdXQgdGhpcyBoZXJlIGluIHRoZSBldmVudCBpdCB3b3VsZCBiZSBtZXJnZWQgaW4gd2l0aCBvcHRpb25zXG4gICAgICAgIHQuZXZlbnROYW1lc3BhY2UgPSAndHJ1bWJvd3lnLWV2ZW50JztcblxuICAgICAgICAvLyBLZXlib2FyZCBzaG9ydGN1dHMgYXJlIGxvYWQgaW4gdGhpcyBhcnJheVxuICAgICAgICB0LmtleXMgPSBbXTtcblxuICAgICAgICAvLyBUYWcgdG8gYnV0dG9uIGR5bmFtaWNhbGx5IGh5ZHJhdGVkXG4gICAgICAgIHQudGFnVG9CdXR0b24gPSB7fTtcbiAgICAgICAgdC50YWdIYW5kbGVycyA9IFtdO1xuXG4gICAgICAgIC8vIEFkbWl0IG11bHRpcGxlIHBhc3RlIGhhbmRsZXJzXG4gICAgICAgIHQucGFzdGVIYW5kbGVycyA9IFtdLmNvbmNhdCh0Lm8ucGFzdGVIYW5kbGVycyk7XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgYnJvd3NlciBpcyBJRVxuICAgICAgICB0LmlzSUUgPSBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ01TSUUnKSAhPT0gLTEgfHwgbmF2aWdhdG9yLmFwcFZlcnNpb24uaW5kZXhPZignVHJpZGVudC8nKSAhPT0gLTE7XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgd2UgYXJlIG9uIG1hY09zXG4gICAgICAgIHQuaXNNYWMgPSBuYXZpZ2F0b3IucGxhdGZvcm0udG9VcHBlckNhc2UoKS5pbmRleE9mKCdNQUMnKSAhPT0gLTE7XG5cbiAgICAgICAgdC5pbml0KCk7XG4gICAgfTtcblxuICAgIFRydW1ib3d5Zy5wcm90b3R5cGUgPSB7XG4gICAgICAgIERFRkFVTFRfU0VNQU5USUNfTUFQOiB7XG4gICAgICAgICAgICAnYic6ICdzdHJvbmcnLFxuICAgICAgICAgICAgJ2knOiAnZW0nLFxuICAgICAgICAgICAgJ3MnOiAnZGVsJyxcbiAgICAgICAgICAgICdzdHJpa2UnOiAnZGVsJyxcbiAgICAgICAgICAgICdkaXYnOiAncCdcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXM7XG4gICAgICAgICAgICB0LmhlaWdodCA9IHQuJHRhLmhlaWdodCgpO1xuXG4gICAgICAgICAgICB0LmluaXRQbHVnaW5zKCk7XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgLy8gRGlzYWJsZSBpbWFnZSByZXNpemUsIHRyeS1jYXRjaCBmb3Igb2xkIElFXG4gICAgICAgICAgICAgICAgdC5kb2MuZXhlY0NvbW1hbmQoJ2VuYWJsZU9iamVjdFJlc2l6aW5nJywgZmFsc2UsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB0LmRvYy5leGVjQ29tbWFuZCgnZGVmYXVsdFBhcmFncmFwaFNlcGFyYXRvcicsIGZhbHNlLCAncCcpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0LmJ1aWxkRWRpdG9yKCk7XG4gICAgICAgICAgICB0LmJ1aWxkQnRuUGFuZSgpO1xuXG4gICAgICAgICAgICB0LmZpeGVkQnRuUGFuZUV2ZW50cygpO1xuXG4gICAgICAgICAgICB0LmJ1aWxkT3ZlcmxheSgpO1xuXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodC5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICB0LnNldERpc2FibGVkKHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0LiRjLnRyaWdnZXIoJ3Rid2luaXQnKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGFkZEJ0bkRlZjogZnVuY3Rpb24gKGJ0bk5hbWUsIGJ0bkRlZikge1xuICAgICAgICAgICAgdGhpcy5idG5zRGVmW2J0bk5hbWVdID0gJC5leHRlbmQoYnRuRGVmLCB0aGlzLmJ0bnNEZWZbYnRuTmFtZV0gfHwge30pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldHVwVXJsUHJlZml4OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgcHJvdG9jb2wgPSB0aGlzLm8udXJsUHJvdG9jb2w7XG4gICAgICAgICAgICBpZiAoIXByb3RvY29sKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodHlwZW9mKHByb3RvY29sKSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ2h0dHBzOi8vJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBwcm90b2NvbC5yZXBsYWNlKCc6Ly8nLCAnJykgKyAnOi8vJztcbiAgICAgICAgfSxcblxuICAgICAgICBidWlsZEVkaXRvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLFxuICAgICAgICAgICAgICAgIHByZWZpeCA9IHQuby5wcmVmaXgsXG4gICAgICAgICAgICAgICAgaHRtbCA9ICcnO1xuXG4gICAgICAgICAgICB0LiRib3ggPSAkKCc8ZGl2Lz4nLCB7XG4gICAgICAgICAgICAgICAgY2xhc3M6IHByZWZpeCArICdib3ggJyArIHByZWZpeCArICdlZGl0b3ItdmlzaWJsZSAnICsgcHJlZml4ICsgdC5vLmxhbmcgKyAnIHRydW1ib3d5ZydcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyAkdGEgPSBUZXh0YXJlYVxuICAgICAgICAgICAgLy8gJGVkID0gRWRpdG9yXG4gICAgICAgICAgICB0LmlzVGV4dGFyZWEgPSB0LiR0YS5pcygndGV4dGFyZWEnKTtcbiAgICAgICAgICAgIGlmICh0LmlzVGV4dGFyZWEpIHtcbiAgICAgICAgICAgICAgICBodG1sID0gdC4kdGEudmFsKCk7XG4gICAgICAgICAgICAgICAgdC4kZWQgPSAkKCc8ZGl2Lz4nKTtcbiAgICAgICAgICAgICAgICB0LiRib3hcbiAgICAgICAgICAgICAgICAgICAgLmluc2VydEFmdGVyKHQuJHRhKVxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKHQuJGVkLCB0LiR0YSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHQuJGVkID0gdC4kdGE7XG4gICAgICAgICAgICAgICAgaHRtbCA9IHQuJGVkLmh0bWwoKTtcblxuICAgICAgICAgICAgICAgIHQuJHRhID0gJCgnPHRleHRhcmVhLz4nLCB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHQuJHRhLmF0dHIoJ2lkJyksXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogdC5oZWlnaHRcbiAgICAgICAgICAgICAgICB9KS52YWwoaHRtbCk7XG5cbiAgICAgICAgICAgICAgICB0LiRib3hcbiAgICAgICAgICAgICAgICAgICAgLmluc2VydEFmdGVyKHQuJGVkKVxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKHQuJHRhLCB0LiRlZCk7XG4gICAgICAgICAgICAgICAgdC5zeW5jQ29kZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0LiR0YVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhwcmVmaXggKyAndGV4dGFyZWEnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0YWJpbmRleCcsIC0xKVxuICAgICAgICAgICAgO1xuXG4gICAgICAgICAgICB0LiRlZFxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhwcmVmaXggKyAnZWRpdG9yJylcbiAgICAgICAgICAgICAgICAuYXR0cih7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnRlZGl0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgZGlyOiB0LmxhbmcuX2RpciB8fCAnbHRyJ1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmh0bWwoaHRtbClcbiAgICAgICAgICAgIDtcblxuICAgICAgICAgICAgaWYgKHQuby50YWJpbmRleCkge1xuICAgICAgICAgICAgICAgIHQuJGVkLmF0dHIoJ3RhYmluZGV4JywgdC5vLnRhYmluZGV4KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHQuJGMuaXMoJ1twbGFjZWhvbGRlcl0nKSkge1xuICAgICAgICAgICAgICAgIHQuJGVkLmF0dHIoJ3BsYWNlaG9sZGVyJywgdC4kYy5hdHRyKCdwbGFjZWhvbGRlcicpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHQuJGMuaXMoJ1tzcGVsbGNoZWNrXScpKSB7XG4gICAgICAgICAgICAgICAgdC4kZWQuYXR0cignc3BlbGxjaGVjaycsIHQuJGMuYXR0cignc3BlbGxjaGVjaycpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHQuby5yZXNldENzcykge1xuICAgICAgICAgICAgICAgIHQuJGVkLmFkZENsYXNzKHByZWZpeCArICdyZXNldC1jc3MnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCF0Lm8uYXV0b2dyb3cpIHtcbiAgICAgICAgICAgICAgICB0LiR0YS5hZGQodC4kZWQpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogdC5oZWlnaHRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdC5zZW1hbnRpY0NvZGUoKTtcblxuICAgICAgICAgICAgaWYgKHQuby5hdXRvZ3Jvd09uRW50ZXIpIHtcbiAgICAgICAgICAgICAgICB0LiRlZC5hZGRDbGFzcyhwcmVmaXggKyAnYXV0b2dyb3ctb24tZW50ZXInKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGN0cmwgPSBmYWxzZSxcbiAgICAgICAgICAgICAgICBjb21wb3NpdGlvbiA9IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRlYm91bmNlQnV0dG9uUGFuZVN0YXR1cyxcbiAgICAgICAgICAgICAgICB1cGRhdGVFdmVudE5hbWUgPSAna2V5dXAnO1xuXG4gICAgICAgICAgICB0LiRlZFxuICAgICAgICAgICAgICAgIC5vbignZGJsY2xpY2snLCAnaW1nJywgdC5vLmltZ0RibENsaWNrSGFuZGxlcilcbiAgICAgICAgICAgICAgICAub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoKGUuY3RybEtleSB8fCBlLm1ldGFLZXkpICYmICFlLmFsdEtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3RybCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIga2V5ID0gdC5rZXlzW1N0cmluZy5mcm9tQ2hhckNvZGUoZS53aGljaCkudG9VcHBlckNhc2UoKV07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5leGVjQ21kKGtleS5mbiwga2V5LnBhcmFtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChjKSB7fVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQuby50YWJUb0luZGVudCAmJiBlLmtleSA9PT0gJ1RhYicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5zaGlmdEtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5leGVjQ21kKCdvdXRkZW50JywgdHJ1ZSwgbnVsbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmV4ZWNDbWQoJ2luZGVudCcsIHRydWUsIG51bGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChjKSB7fVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAub24oJ2NvbXBvc2l0aW9uc3RhcnQgY29tcG9zaXRpb251cGRhdGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBvc2l0aW9uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5vbih1cGRhdGVFdmVudE5hbWUgKyAnIGNvbXBvc2l0aW9uZW5kJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUudHlwZSA9PT0gJ2NvbXBvc2l0aW9uZW5kJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tcG9zaXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb21wb3NpdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleUNvZGUgPSBlLndoaWNoO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXlDb2RlID49IDM3ICYmIGtleUNvZGUgPD0gNDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICgoZS5jdHJsS2V5IHx8IGUubWV0YUtleSkgJiYgKGtleUNvZGUgPT09IDg5IHx8IGtleUNvZGUgPT09IDkwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdC5zZW1hbnRpY0NvZGUoZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndjaGFuZ2UnKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghY3RybCAmJiBrZXlDb2RlICE9PSAxNykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbXBvc2l0aW9uRW5kSUUgPSB0LmlzSUUgPyBlLnR5cGUgPT09ICdjb21wb3NpdGlvbmVuZCcgOiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdC5zZW1hbnRpY0NvZGUoZmFsc2UsIGNvbXBvc2l0aW9uRW5kSUUgJiYga2V5Q29kZSA9PT0gMTMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndjaGFuZ2UnKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZS53aGljaCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHQuc2VtYW50aWNDb2RlKGZhbHNlLCBmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfSwgNTApO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm9uKCdtb3VzZXVwIGtleWRvd24ga2V5dXAnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoKCFlLmN0cmxLZXkgJiYgIWUubWV0YUtleSkgfHwgZS5hbHRLZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyAvLyBcImhvbGQgb25cIiB0byB0aGUgY3RybCBrZXkgZm9yIDUwbXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHJsID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCA1MCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGRlYm91bmNlQnV0dG9uUGFuZVN0YXR1cyk7XG4gICAgICAgICAgICAgICAgICAgIGRlYm91bmNlQnV0dG9uUGFuZVN0YXR1cyA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdC51cGRhdGVCdXR0b25QYW5lU3RhdHVzKCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDUwKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5vbignZm9jdXMgYmx1cicsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHQuJGMudHJpZ2dlcigndGJ3JyArIGUudHlwZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlLnR5cGUgPT09ICdibHVyJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdC5jbGVhckJ1dHRvblBhbmVTdGF0dXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodC5vLmF1dG9ncm93T25FbnRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQuYXV0b2dyb3dPbkVudGVyRG9udENsb3NlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUudHlwZSA9PT0gJ2ZvY3VzJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuYXV0b2dyb3dPbkVudGVyV2FzRm9jdXNlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5hdXRvZ3Jvd0VkaXRvck9uRW50ZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCF0Lm8uYXV0b2dyb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LiRlZC5jc3Moe2hlaWdodDogdC4kZWQuY3NzKCdtaW4taGVpZ2h0Jyl9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LiRjLnRyaWdnZXIoJ3Rid3Jlc2l6ZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAub24oJ2N1dCBkcm9wJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHQuc2VtYW50aWNDb2RlKGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHQuJGMudHJpZ2dlcigndGJ3Y2hhbmdlJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm9uKCdwYXN0ZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0Lm8ucmVtb3ZlZm9ybWF0UGFzdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uICYmIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5kZWxldGVGcm9tRG9jdW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZGVsZXRlRnJvbURvY3VtZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSUVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGV4dCA9IHdpbmRvdy5jbGlwYm9hcmREYXRhLmdldERhdGEoJ1RleHQnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDw9IElFMTBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5kb2Muc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCkucGFzdGVIVE1MKHRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSUUgMTFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5kb2MuZ2V0U2VsZWN0aW9uKCkuZ2V0UmFuZ2VBdCgwKS5pbnNlcnROb2RlKHQuZG9jLmNyZWF0ZVRleHROb2RlKHRleHQpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndjaGFuZ2UnLCBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3QgSUVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmV4ZWNDbWQoJ2luc2VydFRleHQnLCAoZS5vcmlnaW5hbEV2ZW50IHx8IGUpLmNsaXBib2FyZERhdGEuZ2V0RGF0YSgndGV4dC9wbGFpbicpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIENhbGwgcGFzdGVIYW5kbGVyc1xuICAgICAgICAgICAgICAgICAgICAkLmVhY2godC5wYXN0ZUhhbmRsZXJzLCBmdW5jdGlvbiAoaSwgcGFzdGVIYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXN0ZUhhbmRsZXIoZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdC5zZW1hbnRpY0NvZGUoZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndwYXN0ZScsIGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndjaGFuZ2UnKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHQuJHRhXG4gICAgICAgICAgICAgICAgLm9uKCdrZXl1cCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndjaGFuZ2UnKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5vbigncGFzdGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndjaGFuZ2UnKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQodC5kb2MuYm9keSkub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGlmIChlLndoaWNoID09PSAyNyAmJiAkKCcuJyArIHByZWZpeCArICdtb2RhbC1ib3gnKS5sZW5ndGggPj0gMSkge1xuICAgICAgICAgICAgICAgICAgICB0LmNsb3NlTW9kYWwoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vYXV0b2dyb3cgd2hlbiBlbnRlcmluZyBsb2dpY1xuICAgICAgICBhdXRvZ3Jvd0VkaXRvck9uRW50ZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgICAgICAgIHQuJGVkLnJlbW92ZUNsYXNzKCdhdXRvZ3Jvdy1vbi1lbnRlcicpO1xuICAgICAgICAgICAgdmFyIG9sZEhlaWdodCA9IHQuJGVkWzBdLmNsaWVudEhlaWdodDtcbiAgICAgICAgICAgIHQuJGVkLmhlaWdodCgnYXV0bycpO1xuICAgICAgICAgICAgdmFyIHRvdGFsSGVpZ2h0ID0gdC4kZWRbMF0uc2Nyb2xsSGVpZ2h0O1xuICAgICAgICAgICAgdC4kZWQuYWRkQ2xhc3MoJ2F1dG9ncm93LW9uLWVudGVyJyk7XG4gICAgICAgICAgICBpZiAob2xkSGVpZ2h0ICE9PSB0b3RhbEhlaWdodCkge1xuICAgICAgICAgICAgICAgIHQuJGVkLmhlaWdodChvbGRIZWlnaHQpO1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB0LiRlZC5jc3Moe2hlaWdodDogdG90YWxIZWlnaHR9KTtcbiAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndyZXNpemUnKTtcbiAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuXG4gICAgICAgIC8vIEJ1aWxkIGJ1dHRvbiBwYW5lLCB1c2Ugby5idG5zIG9wdGlvblxuICAgICAgICBidWlsZEJ0blBhbmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcyxcbiAgICAgICAgICAgICAgICBwcmVmaXggPSB0Lm8ucHJlZml4O1xuXG4gICAgICAgICAgICB2YXIgJGJ0blBhbmUgPSB0LiRidG5QYW5lID0gJCgnPGRpdi8+Jywge1xuICAgICAgICAgICAgICAgIGNsYXNzOiBwcmVmaXggKyAnYnV0dG9uLXBhbmUnXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJC5lYWNoKHQuby5idG5zLCBmdW5jdGlvbiAoaSwgYnRuR3JwKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEkLmlzQXJyYXkoYnRuR3JwKSkge1xuICAgICAgICAgICAgICAgICAgICBidG5HcnAgPSBbYnRuR3JwXTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgJGJ0bkdyb3VwID0gJCgnPGRpdi8+Jywge1xuICAgICAgICAgICAgICAgICAgICBjbGFzczogcHJlZml4ICsgJ2J1dHRvbi1ncm91cCAnICsgKChidG5HcnAuaW5kZXhPZignZnVsbHNjcmVlbicpID49IDApID8gcHJlZml4ICsgJ3JpZ2h0JyA6ICcnKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICQuZWFjaChidG5HcnAsIGZ1bmN0aW9uIChpLCBidG4pIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHsgLy8gUHJldmVudCBidWlsZEJ0biBlcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQuaXNTdXBwb3J0ZWRCdG4oYnRuKSkgeyAvLyBJdCdzIGEgc3VwcG9ydGVkIGJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRidG5Hcm91cC5hcHBlbmQodC5idWlsZEJ0bihidG4pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoYykge1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoJGJ0bkdyb3VwLmh0bWwoKS50cmltKCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAkYnRuUGFuZS5hcHBlbmQoJGJ0bkdyb3VwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdC4kYm94LnByZXBlbmQoJGJ0blBhbmUpO1xuICAgICAgICB9LFxuXG5cbiAgICAgICAgLy8gQnVpbGQgYSBidXR0b24gYW5kIGhpcyBhY3Rpb25cbiAgICAgICAgYnVpbGRCdG46IGZ1bmN0aW9uIChidG5OYW1lKSB7IC8vIGJ0bk5hbWUgaXMgbmFtZSBvZiB0aGUgYnV0dG9uXG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMsXG4gICAgICAgICAgICAgICAgcHJlZml4ID0gdC5vLnByZWZpeCxcbiAgICAgICAgICAgICAgICBidG4gPSB0LmJ0bnNEZWZbYnRuTmFtZV0sXG4gICAgICAgICAgICAgICAgaXNEcm9wZG93biA9IGJ0bi5kcm9wZG93bixcbiAgICAgICAgICAgICAgICBoYXNJY29uID0gYnRuLmhhc0ljb24gIT0gbnVsbCA/IGJ0bi5oYXNJY29uIDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0ZXh0RGVmID0gdC5sYW5nW2J0bk5hbWVdIHx8IGJ0bk5hbWUsXG5cbiAgICAgICAgICAgICAgICAkYnRuID0gJCgnPGJ1dHRvbi8+Jywge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnYnV0dG9uJyxcbiAgICAgICAgICAgICAgICAgICAgY2xhc3M6IHByZWZpeCArIGJ0bk5hbWUgKyAnLWJ1dHRvbiAnICsgKGJ0bi5jbGFzcyB8fCAnJykgKyAoIWhhc0ljb24gPyAnICcgKyBwcmVmaXggKyAndGV4dHVhbC1idXR0b24nIDogJycpLFxuICAgICAgICAgICAgICAgICAgICBodG1sOiB0Lmhhc1N2ZyAmJiBoYXNJY29uID9cbiAgICAgICAgICAgICAgICAgICAgICAgICc8c3ZnPjx1c2UgeGxpbms6aHJlZj1cIicgKyB0LnN2Z1BhdGggKyAnIycgKyBwcmVmaXggKyAoYnRuLmljbyB8fCBidG5OYW1lKS5yZXBsYWNlKC8oW0EtWl0rKS9nLCAnLSQxJykudG9Mb3dlckNhc2UoKSArICdcIi8+PC9zdmc+JyA6XG4gICAgICAgICAgICAgICAgICAgICAgICB0LmhpZGVCdXR0b25UZXh0cyA/ICcnIDogKGJ0bi50ZXh0IHx8IGJ0bi50aXRsZSB8fCB0LmxhbmdbYnRuTmFtZV0gfHwgYnRuTmFtZSksXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAoYnRuLnRpdGxlIHx8IGJ0bi50ZXh0IHx8IHRleHREZWYpICsgKGJ0bi5rZXkgPyAnICgnICsgKHQuaXNNYWMgPyAnQ21kJyA6ICdDdHJsJykgKyAnICsgJyArIGJ0bi5rZXkgKyAnKScgOiAnJyksXG4gICAgICAgICAgICAgICAgICAgIHRhYmluZGV4OiAtMSxcbiAgICAgICAgICAgICAgICAgICAgbW91c2Vkb3duOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzRHJvcGRvd24gfHwgJCgnLicgKyBidG5OYW1lICsgJy0nICsgcHJlZml4ICsgJ2Ryb3Bkb3duJywgdC4kYm94KS5pcygnOmhpZGRlbicpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnYm9keScsIHQuZG9jKS50cmlnZ2VyKCdtb3VzZWRvd24nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh0LiRidG5QYW5lLmhhc0NsYXNzKHByZWZpeCArICdkaXNhYmxlJykgfHwgdC4kYm94Lmhhc0NsYXNzKHByZWZpeCArICdkaXNhYmxlZCcpKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICEkKHRoaXMpLmhhc0NsYXNzKHByZWZpeCArICdhY3RpdmUnKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICEkKHRoaXMpLmhhc0NsYXNzKHByZWZpeCArICdub3QtZGlzYWJsZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB0LmV4ZWNDbWQoKGlzRHJvcGRvd24gPyAnZHJvcGRvd24nIDogZmFsc2UpIHx8IGJ0bi5mbiB8fCBidG5OYW1lLCBidG4ucGFyYW0gfHwgYnRuTmFtZSwgYnRuLmZvcmNlQ3NzKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChpc0Ryb3Bkb3duKSB7XG4gICAgICAgICAgICAgICAgJGJ0bi5hZGRDbGFzcyhwcmVmaXggKyAnb3Blbi1kcm9wZG93bicpO1xuICAgICAgICAgICAgICAgIHZhciBkcm9wZG93blByZWZpeCA9IHByZWZpeCArICdkcm9wZG93bicsXG4gICAgICAgICAgICAgICAgICAgIGRyb3Bkb3duT3B0aW9ucyA9IHsgLy8gdGhlIGRyb3Bkb3duXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzczogZHJvcGRvd25QcmVmaXggKyAnLScgKyBidG5OYW1lICsgJyAnICsgZHJvcGRvd25QcmVmaXggKyAnICcgKyBwcmVmaXggKyAnZml4ZWQtdG9wICcgKyAoYnRuLmRyb3Bkb3duQ2xhc3MgfHwgJycpXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgZHJvcGRvd25PcHRpb25zWydkYXRhLScgKyBkcm9wZG93blByZWZpeF0gPSBidG5OYW1lO1xuICAgICAgICAgICAgICAgIHZhciAkZHJvcGRvd24gPSAkKCc8ZGl2Lz4nLCBkcm9wZG93bk9wdGlvbnMpO1xuICAgICAgICAgICAgICAgICQuZWFjaChpc0Ryb3Bkb3duLCBmdW5jdGlvbiAoaSwgZGVmKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0LmJ0bnNEZWZbZGVmXSAmJiB0LmlzU3VwcG9ydGVkQnRuKGRlZikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRkcm9wZG93bi5hcHBlbmQodC5idWlsZFN1YkJ0bihkZWYpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHQuJGJveC5hcHBlbmQoJGRyb3Bkb3duLmhpZGUoKSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGJ0bi5rZXkpIHtcbiAgICAgICAgICAgICAgICB0LmtleXNbYnRuLmtleV0gPSB7XG4gICAgICAgICAgICAgICAgICAgIGZuOiBidG4uZm4gfHwgYnRuTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW06IGJ0bi5wYXJhbSB8fCBidG5OYW1lXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFpc0Ryb3Bkb3duKSB7XG4gICAgICAgICAgICAgICAgdC50YWdUb0J1dHRvblsoYnRuLnRhZyB8fCBidG5OYW1lKS50b0xvd2VyQ2FzZSgpXSA9IGJ0bk5hbWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiAkYnRuO1xuICAgICAgICB9LFxuICAgICAgICAvLyBCdWlsZCBhIGJ1dHRvbiBmb3IgZHJvcGRvd24gbWVudVxuICAgICAgICAvLyBAcGFyYW0gbiA6IG5hbWUgb2YgdGhlIHN1YmJ1dHRvblxuICAgICAgICBidWlsZFN1YkJ0bjogZnVuY3Rpb24gKGJ0bk5hbWUpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcyxcbiAgICAgICAgICAgICAgICBwcmVmaXggPSB0Lm8ucHJlZml4LFxuICAgICAgICAgICAgICAgIGJ0biA9IHQuYnRuc0RlZltidG5OYW1lXSxcbiAgICAgICAgICAgICAgICBoYXNJY29uID0gYnRuLmhhc0ljb24gIT0gbnVsbCA/IGJ0bi5oYXNJY29uIDogdHJ1ZTtcblxuICAgICAgICAgICAgaWYgKGJ0bi5rZXkpIHtcbiAgICAgICAgICAgICAgICB0LmtleXNbYnRuLmtleV0gPSB7XG4gICAgICAgICAgICAgICAgICAgIGZuOiBidG4uZm4gfHwgYnRuTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW06IGJ0bi5wYXJhbSB8fCBidG5OYW1lXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdC50YWdUb0J1dHRvblsoYnRuLnRhZyB8fCBidG5OYW1lKS50b0xvd2VyQ2FzZSgpXSA9IGJ0bk5hbWU7XG5cbiAgICAgICAgICAgIHJldHVybiAkKCc8YnV0dG9uLz4nLCB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2J1dHRvbicsXG4gICAgICAgICAgICAgICAgY2xhc3M6IHByZWZpeCArIGJ0bk5hbWUgKyAnLWRyb3Bkb3duLWJ1dHRvbiAnICsgKGJ0bi5jbGFzcyB8fCAnJykgKyAoYnRuLmljbyA/ICcgJyArIHByZWZpeCArIGJ0bi5pY28gKyAnLWJ1dHRvbicgOiAnJyksXG4gICAgICAgICAgICAgICAgaHRtbDogdC5oYXNTdmcgJiYgaGFzSWNvbiA/XG4gICAgICAgICAgICAgICAgICAnPHN2Zz48dXNlIHhsaW5rOmhyZWY9XCInICsgdC5zdmdQYXRoICsgJyMnICsgcHJlZml4ICsgKGJ0bi5pY28gfHwgYnRuTmFtZSkucmVwbGFjZSgvKFtBLVpdKykvZywgJy0kMScpLnRvTG93ZXJDYXNlKCkgKyAnXCIvPjwvc3ZnPicgKyAoYnRuLnRleHQgfHwgYnRuLnRpdGxlIHx8IHQubGFuZ1tidG5OYW1lXSB8fCBidG5OYW1lKSA6XG4gICAgICAgICAgICAgICAgICAoYnRuLnRleHQgfHwgYnRuLnRpdGxlIHx8IHQubGFuZ1tidG5OYW1lXSB8fCBidG5OYW1lKSxcbiAgICAgICAgICAgICAgICB0aXRsZTogKGJ0bi5rZXkgPyAnKCcgKyAodC5pc01hYyA/ICdDbWQnIDogJ0N0cmwnKSArICcgKyAnICsgYnRuLmtleSArICcpJyA6IG51bGwpLFxuICAgICAgICAgICAgICAgIHN0eWxlOiBidG4uc3R5bGUgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICBtb3VzZWRvd246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnYm9keScsIHQuZG9jKS50cmlnZ2VyKCdtb3VzZWRvd24nKTtcblxuICAgICAgICAgICAgICAgICAgICB0LmV4ZWNDbWQoYnRuLmZuIHx8IGJ0bk5hbWUsIGJ0bi5wYXJhbSB8fCBidG5OYW1lLCBidG4uZm9yY2VDc3MpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLy8gQ2hlY2sgaWYgYnV0dG9uIGlzIHN1cHBvcnRlZFxuICAgICAgICBpc1N1cHBvcnRlZEJ0bjogZnVuY3Rpb24gKGJ0bk5hbWUpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnRuc0RlZltidG5OYW1lXS5pc1N1cHBvcnRlZCgpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gQnVpbGQgb3ZlcmxheSBmb3IgbW9kYWwgYm94XG4gICAgICAgIGJ1aWxkT3ZlcmxheTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzO1xuICAgICAgICAgICAgdC4kb3ZlcmxheSA9ICQoJzxkaXYvPicsIHtcbiAgICAgICAgICAgICAgICBjbGFzczogdC5vLnByZWZpeCArICdvdmVybGF5J1xuICAgICAgICAgICAgfSkuYXBwZW5kVG8odC4kYm94KTtcbiAgICAgICAgICAgIHJldHVybiB0LiRvdmVybGF5O1xuICAgICAgICB9LFxuICAgICAgICBzaG93T3ZlcmxheTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzO1xuICAgICAgICAgICAgJCh3aW5kb3cpLnRyaWdnZXIoJ3Njcm9sbCcpO1xuICAgICAgICAgICAgdC4kb3ZlcmxheS5mYWRlSW4oMjAwKTtcbiAgICAgICAgICAgIHQuJGJveC5hZGRDbGFzcyh0Lm8ucHJlZml4ICsgJ2JveC1ibHVyJyk7XG4gICAgICAgIH0sXG4gICAgICAgIGhpZGVPdmVybGF5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXM7XG4gICAgICAgICAgICB0LiRvdmVybGF5LmZhZGVPdXQoNTApO1xuICAgICAgICAgICAgdC4kYm94LnJlbW92ZUNsYXNzKHQuby5wcmVmaXggKyAnYm94LWJsdXInKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvLyBNYW5hZ2VtZW50IG9mIGZpeGVkIGJ1dHRvbiBwYW5lXG4gICAgICAgIGZpeGVkQnRuUGFuZUV2ZW50czogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLFxuICAgICAgICAgICAgICAgIGZpeGVkRnVsbFdpZHRoID0gdC5vLmZpeGVkRnVsbFdpZHRoLFxuICAgICAgICAgICAgICAgICRib3ggPSB0LiRib3g7XG5cbiAgICAgICAgICAgIGlmICghdC5vLmZpeGVkQnRuUGFuZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdC5pc0ZpeGVkID0gZmFsc2U7XG5cbiAgICAgICAgICAgICQod2luZG93KVxuICAgICAgICAgICAgICAgIC5vbignc2Nyb2xsLicgKyB0LmV2ZW50TmFtZXNwYWNlICsgJyByZXNpemUuJyArIHQuZXZlbnROYW1lc3BhY2UsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkYm94KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0LnN5bmNDb2RlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHNjcm9sbFRvcCA9ICQod2luZG93KS5zY3JvbGxUb3AoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldCA9ICRib3gub2Zmc2V0KCkudG9wICsgMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICRidXR0b25QYW5lID0gdC4kYnRuUGFuZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvblBhbmVPdXRlckhlaWdodCA9ICRidXR0b25QYW5lLm91dGVySGVpZ2h0KCkgLSAyO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICgoc2Nyb2xsVG9wIC0gb2Zmc2V0ID4gMCkgJiYgKChzY3JvbGxUb3AgLSBvZmZzZXQgLSB0LmhlaWdodCkgPCAwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0LmlzRml4ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmlzRml4ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRidXR0b25QYW5lLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGZpeGVkRnVsbFdpZHRoID8gMCA6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgekluZGV4OiA3XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC4kYm94LmNzcyh7cGFkZGluZ1RvcDogJGJ1dHRvblBhbmUuaGVpZ2h0KCl9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICRidXR0b25QYW5lLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGZpeGVkRnVsbFdpZHRoID8gJzEwMCUnIDogKCgkYm94LndpZHRoKCkgLSAxKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuJyArIHQuby5wcmVmaXggKyAnZml4ZWQtdG9wJywgJGJveCkuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogZml4ZWRGdWxsV2lkdGggPyAnZml4ZWQnIDogJ2Fic29sdXRlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IGZpeGVkRnVsbFdpZHRoID8gYnV0dG9uUGFuZU91dGVySGVpZ2h0IDogYnV0dG9uUGFuZU91dGVySGVpZ2h0ICsgKHNjcm9sbFRvcCAtIG9mZnNldCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgekluZGV4OiAxNVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodC5pc0ZpeGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0LmlzRml4ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRidXR0b25QYW5lLnJlbW92ZUF0dHIoJ3N0eWxlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0LiRib3guY3NzKHtwYWRkaW5nVG9wOiAwfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuJyArIHQuby5wcmVmaXggKyAnZml4ZWQtdG9wJywgJGJveCkuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IGJ1dHRvblBhbmVPdXRlckhlaWdodFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvLyBEaXNhYmxlIGVkaXRvclxuICAgICAgICBzZXREaXNhYmxlZDogZnVuY3Rpb24gKGRpc2FibGUpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcyxcbiAgICAgICAgICAgICAgICBwcmVmaXggPSB0Lm8ucHJlZml4O1xuXG4gICAgICAgICAgICB0LmRpc2FibGVkID0gZGlzYWJsZTtcblxuICAgICAgICAgICAgaWYgKGRpc2FibGUpIHtcbiAgICAgICAgICAgICAgICB0LiR0YS5hdHRyKCdkaXNhYmxlZCcsIHRydWUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0LiR0YS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdC4kYm94LnRvZ2dsZUNsYXNzKHByZWZpeCArICdkaXNhYmxlZCcsIGRpc2FibGUpO1xuICAgICAgICAgICAgdC4kZWQuYXR0cignY29udGVudGVkaXRhYmxlJywgIWRpc2FibGUpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vIERlc3Ryb3kgdGhlIGVkaXRvclxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMsXG4gICAgICAgICAgICAgICAgcHJlZml4ID0gdC5vLnByZWZpeDtcblxuICAgICAgICAgICAgaWYgKHQuaXNUZXh0YXJlYSkge1xuICAgICAgICAgICAgICAgIHQuJGJveC5hZnRlcihcbiAgICAgICAgICAgICAgICAgICAgdC4kdGFcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jc3Moe2hlaWdodDogJyd9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLnZhbCh0Lmh0bWwoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhwcmVmaXggKyAndGV4dGFyZWEnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNob3coKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHQuJGJveC5hZnRlcihcbiAgICAgICAgICAgICAgICAgICAgdC4kZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jc3Moe2hlaWdodDogJyd9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKHByZWZpeCArICdlZGl0b3InKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUF0dHIoJ2NvbnRlbnRlZGl0YWJsZScpXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQXR0cignZGlyJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5odG1sKHQuaHRtbCgpKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNob3coKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHQuJGVkLm9mZignZGJsY2xpY2snLCAnaW1nJyk7XG5cbiAgICAgICAgICAgIHQuZGVzdHJveVBsdWdpbnMoKTtcblxuICAgICAgICAgICAgdC4kYm94LnJlbW92ZSgpO1xuICAgICAgICAgICAgdC4kYy5yZW1vdmVEYXRhKCd0cnVtYm93eWcnKTtcbiAgICAgICAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcyhwcmVmaXggKyAnYm9keS1mdWxsc2NyZWVuJyk7XG4gICAgICAgICAgICB0LiRjLnRyaWdnZXIoJ3Rid2Nsb3NlJyk7XG4gICAgICAgICAgICAkKHdpbmRvdykub2ZmKCdzY3JvbGwuJyArIHQuZXZlbnROYW1lc3BhY2UgKyAnIHJlc2l6ZS4nICsgdC5ldmVudE5hbWVzcGFjZSk7XG4gICAgICAgIH0sXG5cblxuICAgICAgICAvLyBFbXB0eSB0aGUgZWRpdG9yXG4gICAgICAgIGVtcHR5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLiR0YS52YWwoJycpO1xuICAgICAgICAgICAgdGhpcy5zeW5jQ29kZSh0cnVlKTtcbiAgICAgICAgfSxcblxuXG4gICAgICAgIC8vIEZ1bmN0aW9uIGNhbGwgd2hlbiBjbGljayBvbiB2aWV3SFRNTCBidXR0b25cbiAgICAgICAgdG9nZ2xlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMsXG4gICAgICAgICAgICAgICAgcHJlZml4ID0gdC5vLnByZWZpeDtcblxuICAgICAgICAgICAgaWYgKHQuby5hdXRvZ3Jvd09uRW50ZXIpIHtcbiAgICAgICAgICAgICAgICB0LmF1dG9ncm93T25FbnRlckRvbnRDbG9zZSA9ICF0LiRib3guaGFzQ2xhc3MocHJlZml4ICsgJ2VkaXRvci1oaWRkZW4nKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdC5zZW1hbnRpY0NvZGUoZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndjaGFuZ2UnKTtcblxuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdC5kb2MuYWN0aXZlRWxlbWVudC5ibHVyKCk7XG4gICAgICAgICAgICAgICAgdC4kYm94LnRvZ2dsZUNsYXNzKHByZWZpeCArICdlZGl0b3ItaGlkZGVuICcgKyBwcmVmaXggKyAnZWRpdG9yLXZpc2libGUnKTtcbiAgICAgICAgICAgICAgICB0LiRidG5QYW5lLnRvZ2dsZUNsYXNzKHByZWZpeCArICdkaXNhYmxlJyk7XG4gICAgICAgICAgICAgICAgJCgnLicgKyBwcmVmaXggKyAndmlld0hUTUwtYnV0dG9uJywgdC4kYnRuUGFuZSkudG9nZ2xlQ2xhc3MocHJlZml4ICsgJ2FjdGl2ZScpO1xuICAgICAgICAgICAgICAgIGlmICh0LiRib3guaGFzQ2xhc3MocHJlZml4ICsgJ2VkaXRvci12aXNpYmxlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgdC4kdGEuYXR0cigndGFiaW5kZXgnLCAtMSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdC4kdGEucmVtb3ZlQXR0cigndGFiaW5kZXgnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodC5vLmF1dG9ncm93T25FbnRlciAmJiAhdC5hdXRvZ3Jvd09uRW50ZXJEb250Q2xvc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdC5hdXRvZ3Jvd0VkaXRvck9uRW50ZXIoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvLyBPcGVuIGRyb3Bkb3duIHdoZW4gY2xpY2sgb24gYSBidXR0b24gd2hpY2ggb3BlbiB0aGF0XG4gICAgICAgIGRyb3Bkb3duOiBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLFxuICAgICAgICAgICAgICAgICRib2R5ID0gJCgnYm9keScsIHQuZG9jKSxcbiAgICAgICAgICAgICAgICBwcmVmaXggPSB0Lm8ucHJlZml4LFxuICAgICAgICAgICAgICAgICRkcm9wZG93biA9ICQoJ1tkYXRhLScgKyBwcmVmaXggKyAnZHJvcGRvd249JyArIG5hbWUgKyAnXScsIHQuJGJveCksXG4gICAgICAgICAgICAgICAgJGJ0biA9ICQoJy4nICsgcHJlZml4ICsgbmFtZSArICctYnV0dG9uJywgdC4kYnRuUGFuZSksXG4gICAgICAgICAgICAgICAgc2hvdyA9ICRkcm9wZG93bi5pcygnOmhpZGRlbicpO1xuXG4gICAgICAgICAgICAkYm9keS50cmlnZ2VyKCdtb3VzZWRvd24nKTtcblxuICAgICAgICAgICAgaWYgKHNob3cpIHtcbiAgICAgICAgICAgICAgICB2YXIgYnRuT2Zmc2V0TGVmdCA9ICRidG4ub2Zmc2V0KCkubGVmdDtcbiAgICAgICAgICAgICAgICAkYnRuLmFkZENsYXNzKHByZWZpeCArICdhY3RpdmUnKTtcblxuICAgICAgICAgICAgICAgICRkcm9wZG93bi5jc3Moe1xuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgICAgICAgICAgICAgdG9wOiAkYnRuLm9mZnNldCgpLnRvcCAtIHQuJGJ0blBhbmUub2Zmc2V0KCkudG9wICsgJGJ0bi5vdXRlckhlaWdodCgpLFxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiAodC5vLmZpeGVkRnVsbFdpZHRoICYmIHQuaXNGaXhlZCkgPyBidG5PZmZzZXRMZWZ0IDogKGJ0bk9mZnNldExlZnQgLSB0LiRidG5QYW5lLm9mZnNldCgpLmxlZnQpXG4gICAgICAgICAgICAgICAgfSkuc2hvdygpO1xuXG4gICAgICAgICAgICAgICAgJCh3aW5kb3cpLnRyaWdnZXIoJ3Njcm9sbCcpO1xuXG4gICAgICAgICAgICAgICAgJGJvZHkub24oJ21vdXNlZG93bi4nICsgdC5ldmVudE5hbWVzcGFjZSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkZHJvcGRvd24uaXMoZS50YXJnZXQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuJyArIHByZWZpeCArICdkcm9wZG93bicsIHQuJGJveCkuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLicgKyBwcmVmaXggKyAnYWN0aXZlJywgdC4kYnRuUGFuZSkucmVtb3ZlQ2xhc3MocHJlZml4ICsgJ2FjdGl2ZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJGJvZHkub2ZmKCdtb3VzZWRvd24uJyArIHQuZXZlbnROYW1lc3BhY2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cblxuICAgICAgICAvLyBIVE1MIENvZGUgbWFuYWdlbWVudFxuICAgICAgICBodG1sOiBmdW5jdGlvbiAoaHRtbCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZiAoaHRtbCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdC4kdGEudmFsKGh0bWwpO1xuICAgICAgICAgICAgICAgIHQuc3luY0NvZGUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndjaGFuZ2UnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHQuJHRhLnZhbCgpO1xuICAgICAgICB9LFxuICAgICAgICBzeW5jVGV4dGFyZWE6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgICAgICAgIHQuJHRhLnZhbCh0LiRlZC50ZXh0KCkudHJpbSgpLmxlbmd0aCA+IDAgfHwgdC4kZWQuZmluZCh0Lm8udGFnc1RvS2VlcC5qb2luKCcsJykpLmxlbmd0aCA+IDAgPyB0LiRlZC5odG1sKCkgOiAnJyk7XG4gICAgICAgIH0sXG4gICAgICAgIHN5bmNDb2RlOiBmdW5jdGlvbiAoZm9yY2UpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgICAgICAgIGlmICghZm9yY2UgJiYgdC4kZWQuaXMoJzp2aXNpYmxlJykpIHtcbiAgICAgICAgICAgICAgICB0LnN5bmNUZXh0YXJlYSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyB3cmFwIHRoZSBjb250ZW50IGluIGEgZGl2IGl0J3MgZWFzaWVyIHRvIGdldCB0aGUgaW5uZXIgaHRtbFxuICAgICAgICAgICAgICAgIHZhciBodG1sID0gJCgnPGRpdj4nKS5odG1sKHQuJHRhLnZhbCgpKTtcbiAgICAgICAgICAgICAgICAvLyBzY3J1YiB0aGUgaHRtbCBiZWZvcmUgbG9hZGluZyBpbnRvIHRoZSBkb2NcbiAgICAgICAgICAgICAgICB2YXIgc2FmZSA9ICQoJzxkaXY+JykuYXBwZW5kKGh0bWwpO1xuICAgICAgICAgICAgICAgICQodC5vLnRhZ3NUb1JlbW92ZS5qb2luKCcsJyksIHNhZmUpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIHQuJGVkLmh0bWwoc2FmZS5jb250ZW50cygpLmh0bWwoKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0Lm8uYXV0b2dyb3cpIHtcbiAgICAgICAgICAgICAgICB0LmhlaWdodCA9IHQuJGVkLmhlaWdodCgpO1xuICAgICAgICAgICAgICAgIGlmICh0LmhlaWdodCAhPT0gdC4kdGEuY3NzKCdoZWlnaHQnKSkge1xuICAgICAgICAgICAgICAgICAgICB0LiR0YS5jc3Moe2hlaWdodDogdC5oZWlnaHR9KTtcbiAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndyZXNpemUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodC5vLmF1dG9ncm93T25FbnRlcikge1xuICAgICAgICAgICAgICAgIHQuJGVkLmhlaWdodCgnYXV0bycpO1xuICAgICAgICAgICAgICAgIHZhciB0b3RhbEhlaWdodCA9IHQuYXV0b2dyb3dPbkVudGVyV2FzRm9jdXNlZCA/IHQuJGVkWzBdLnNjcm9sbEhlaWdodCA6IHQuJGVkLmNzcygnbWluLWhlaWdodCcpO1xuICAgICAgICAgICAgICAgIGlmICh0b3RhbEhlaWdodCAhPT0gdC4kdGEuY3NzKCdoZWlnaHQnKSkge1xuICAgICAgICAgICAgICAgICAgICB0LiRlZC5jc3Moe2hlaWdodDogdG90YWxIZWlnaHR9KTtcbiAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndyZXNpemUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gQW5hbHlzZSBhbmQgdXBkYXRlIHRvIHNlbWFudGljIGNvZGVcbiAgICAgICAgLy8gQHBhcmFtIGZvcmNlIDogZm9yY2UgdG8gc3luYyBjb2RlIGZyb20gdGV4dGFyZWFcbiAgICAgICAgLy8gQHBhcmFtIGZ1bGwgIDogd3JhcCB0ZXh0IG5vZGVzIGluIDxwPlxuICAgICAgICAvLyBAcGFyYW0ga2VlcFJhbmdlICA6IGxlYXZlIHNlbGVjdGlvbiByYW5nZSBhcyBpdCBpc1xuICAgICAgICBzZW1hbnRpY0NvZGU6IGZ1bmN0aW9uIChmb3JjZSwgZnVsbCwga2VlcFJhbmdlKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXM7XG4gICAgICAgICAgICB0LnNhdmVSYW5nZSgpO1xuICAgICAgICAgICAgdC5zeW5jQ29kZShmb3JjZSk7XG5cbiAgICAgICAgICAgIGlmICh0Lm8uc2VtYW50aWMpIHtcbiAgICAgICAgICAgICAgICB0LnNlbWFudGljVGFnKCdiJywgdC5vLnNlbWFudGljS2VlcEF0dHJpYnV0ZXMpO1xuICAgICAgICAgICAgICAgIHQuc2VtYW50aWNUYWcoJ2knLCB0Lm8uc2VtYW50aWNLZWVwQXR0cmlidXRlcyk7XG4gICAgICAgICAgICAgICAgdC5zZW1hbnRpY1RhZygncycsIHQuby5zZW1hbnRpY0tlZXBBdHRyaWJ1dGVzKTtcbiAgICAgICAgICAgICAgICB0LnNlbWFudGljVGFnKCdzdHJpa2UnLCB0Lm8uc2VtYW50aWNLZWVwQXR0cmlidXRlcyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZnVsbCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW5saW5lRWxlbWVudHNTZWxlY3RvciA9IHQuby5pbmxpbmVFbGVtZW50c1NlbGVjdG9yLFxuICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tFbGVtZW50c1NlbGVjdG9yID0gJzpub3QoJyArIGlubGluZUVsZW1lbnRzU2VsZWN0b3IgKyAnKSc7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gV3JhcCB0ZXh0IG5vZGVzIGluIHNwYW4gZm9yIGVhc2llciBwcm9jZXNzaW5nXG4gICAgICAgICAgICAgICAgICAgIHQuJGVkLmNvbnRlbnRzKCkuZmlsdGVyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5vZGVUeXBlID09PSAzICYmIHRoaXMubm9kZVZhbHVlLnRyaW0oKS5sZW5ndGggPiAwO1xuICAgICAgICAgICAgICAgICAgICB9KS53cmFwKCc8c3BhbiBkYXRhLXRidy8+Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gV3JhcCBncm91cHMgb2YgaW5saW5lIGVsZW1lbnRzIGluIHBhcmFncmFwaHMgKHJlY3Vyc2l2ZSlcbiAgICAgICAgICAgICAgICAgICAgdmFyIHdyYXBJbmxpbmVzSW5QYXJhZ3JhcGhzRnJvbSA9IGZ1bmN0aW9uICgkZnJvbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRmcm9tLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkZmluYWxQYXJhZ3JhcGggPSAkZnJvbS5uZXh0VW50aWwoYmxvY2tFbGVtZW50c1NlbGVjdG9yKS5hZGRCYWNrKCkud3JhcEFsbCgnPHAvPicpLnBhcmVudCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbmV4dEVsZW1lbnQgPSAkZmluYWxQYXJhZ3JhcGgubmV4dEFsbChpbmxpbmVFbGVtZW50c1NlbGVjdG9yKS5maXJzdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmaW5hbFBhcmFncmFwaC5uZXh0KCdicicpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyYXBJbmxpbmVzSW5QYXJhZ3JhcGhzRnJvbSgkbmV4dEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB3cmFwSW5saW5lc0luUGFyYWdyYXBoc0Zyb20odC4kZWQuY2hpbGRyZW4oaW5saW5lRWxlbWVudHNTZWxlY3RvcikuZmlyc3QoKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdC5zZW1hbnRpY1RhZygnZGl2JywgdHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gR2V0IHJpZCBvZiB0ZW1wb3Jhcnkgc3BhbidzXG4gICAgICAgICAgICAgICAgICAgICQoJ1tkYXRhLXRid10nLCB0LiRlZCkuY29udGVudHMoKS51bndyYXAoKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgZW1wdHkgPHA+XG4gICAgICAgICAgICAgICAgICAgIHQuJGVkLmZpbmQoJ3A6ZW1wdHknKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoIWtlZXBSYW5nZSkge1xuICAgICAgICAgICAgICAgICAgICB0LnJlc3RvcmVSYW5nZSgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHQuc3luY1RleHRhcmVhKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2VtYW50aWNUYWc6IGZ1bmN0aW9uIChvbGRUYWcsIGNvcHlBdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICB2YXIgbmV3VGFnO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5vLnNlbWFudGljICE9IG51bGwgJiYgdHlwZW9mIHRoaXMuby5zZW1hbnRpYyA9PT0gJ29iamVjdCcgJiYgdGhpcy5vLnNlbWFudGljLmhhc093blByb3BlcnR5KG9sZFRhZykpIHtcbiAgICAgICAgICAgICAgICBuZXdUYWcgPSB0aGlzLm8uc2VtYW50aWNbb2xkVGFnXTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5vLnNlbWFudGljID09PSB0cnVlICYmIHRoaXMuREVGQVVMVF9TRU1BTlRJQ19NQVAuaGFzT3duUHJvcGVydHkob2xkVGFnKSkge1xuICAgICAgICAgICAgICAgIG5ld1RhZyA9IHRoaXMuREVGQVVMVF9TRU1BTlRJQ19NQVBbb2xkVGFnXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkKG9sZFRhZywgdGhpcy4kZWQpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciAkb2xkVGFnID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICBpZigkb2xkVGFnLmNvbnRlbnRzKCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkb2xkVGFnLndyYXAoJzwnICsgbmV3VGFnICsgJy8+Jyk7XG4gICAgICAgICAgICAgICAgaWYgKGNvcHlBdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICQuZWFjaCgkb2xkVGFnLnByb3AoJ2F0dHJpYnV0ZXMnKSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJG9sZFRhZy5wYXJlbnQoKS5hdHRyKHRoaXMubmFtZSwgdGhpcy52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAkb2xkVGFnLmNvbnRlbnRzKCkudW53cmFwKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvLyBGdW5jdGlvbiBjYWxsIHdoZW4gdXNlciBjbGljayBvbiBcIkluc2VydCBMaW5rXCJcbiAgICAgICAgY3JlYXRlTGluazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50U2VsZWN0aW9uID0gdC5kb2MuZ2V0U2VsZWN0aW9uKCksXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRSYW5nZSA9IGRvY3VtZW50U2VsZWN0aW9uLmdldFJhbmdlQXQoMCksXG4gICAgICAgICAgICAgICAgbm9kZSA9IGRvY3VtZW50U2VsZWN0aW9uLmZvY3VzTm9kZSxcbiAgICAgICAgICAgICAgICB0ZXh0ID0gbmV3IFhNTFNlcmlhbGl6ZXIoKS5zZXJpYWxpemVUb1N0cmluZyhzZWxlY3RlZFJhbmdlLmNsb25lQ29udGVudHMoKSkgfHwgc2VsZWN0ZWRSYW5nZSArICcnLFxuICAgICAgICAgICAgICAgIHVybCxcbiAgICAgICAgICAgICAgICB0aXRsZSxcbiAgICAgICAgICAgICAgICB0YXJnZXQ7XG5cbiAgICAgICAgICAgIHdoaWxlIChbJ0EnLCAnRElWJ10uaW5kZXhPZihub2RlLm5vZGVOYW1lKSA8IDApIHtcbiAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobm9kZSAmJiBub2RlLm5vZGVOYW1lID09PSAnQScpIHtcbiAgICAgICAgICAgICAgICB2YXIgJGEgPSAkKG5vZGUpO1xuICAgICAgICAgICAgICAgIHRleHQgPSAkYS50ZXh0KCk7XG4gICAgICAgICAgICAgICAgdXJsID0gJGEuYXR0cignaHJlZicpO1xuICAgICAgICAgICAgICAgIGlmICghdC5vLm1pbmltYWxMaW5rcykge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZSA9ICRhLmF0dHIoJ3RpdGxlJyk7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldCA9ICRhLmF0dHIoJ3RhcmdldCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgcmFuZ2UgPSB0LmRvYy5jcmVhdGVSYW5nZSgpO1xuICAgICAgICAgICAgICAgIHJhbmdlLnNlbGVjdE5vZGUobm9kZSk7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnRTZWxlY3Rpb24ucmVtb3ZlQWxsUmFuZ2VzKCk7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnRTZWxlY3Rpb24uYWRkUmFuZ2UocmFuZ2UpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0LnNhdmVSYW5nZSgpO1xuXG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICB1cmw6IHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdVUkwnLFxuICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHVybFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdGV4dDoge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogdC5sYW5nLnRleHQsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0ZXh0XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmICghdC5vLm1pbmltYWxMaW5rcykge1xuICAgICAgICAgICAgICAgICQuZXh0ZW5kKG9wdGlvbnMsIHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiB0LmxhbmcudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGl0bGVcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogdC5sYW5nLnRhcmdldCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0YXJnZXRcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0Lm9wZW5Nb2RhbEluc2VydCh0LmxhbmcuY3JlYXRlTGluaywgb3B0aW9ucywgZnVuY3Rpb24gKHYpIHsgLy8gdiBpcyB2YWx1ZVxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSB0LnByZXBlbmRVcmxQcmVmaXgodi51cmwpO1xuICAgICAgICAgICAgICAgIGlmICghdXJsLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIGxpbmsgPSAkKFsnPGEgaHJlZj1cIicsIHVybCwgJ1wiPicsIHYudGV4dCB8fCB2LnVybCwgJzwvYT4nXS5qb2luKCcnKSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXQuby5taW5pbWFsTGlua3MpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHYudGl0bGUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGluay5hdHRyKCd0aXRsZScsIHYudGl0bGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh2LnRhcmdldC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rLmF0dHIoJ3RhcmdldCcsIHYudGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0LnJhbmdlLmRlbGV0ZUNvbnRlbnRzKCk7XG4gICAgICAgICAgICAgICAgdC5yYW5nZS5pbnNlcnROb2RlKGxpbmtbMF0pO1xuICAgICAgICAgICAgICAgIHQuc3luY0NvZGUoKTtcbiAgICAgICAgICAgICAgICB0LiRjLnRyaWdnZXIoJ3Rid2NoYW5nZScpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHByZXBlbmRVcmxQcmVmaXg6IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgICAgICAgIGlmICghdC51cmxQcmVmaXgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXJsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgVkFMSURfTElOS19QUkVGSVggPSAvXihbYS16XVstKy5hLXowLTldKjp8XFwvfCMpL2k7XG4gICAgICAgICAgICBpZiAoVkFMSURfTElOS19QUkVGSVgudGVzdCh1cmwpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVybDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIFNJTVBMRV9FTUFJTF9SRUdFWCA9IC9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvO1xuICAgICAgICAgICAgaWYgKFNJTVBMRV9FTUFJTF9SRUdFWC50ZXN0KHVybCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ21haWx0bzonICsgdXJsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdC51cmxQcmVmaXggKyB1cmw7XG4gICAgICAgIH0sXG4gICAgICAgIHVubGluazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50U2VsZWN0aW9uID0gdC5kb2MuZ2V0U2VsZWN0aW9uKCksXG4gICAgICAgICAgICAgICAgbm9kZSA9IGRvY3VtZW50U2VsZWN0aW9uLmZvY3VzTm9kZTtcblxuICAgICAgICAgICAgaWYgKGRvY3VtZW50U2VsZWN0aW9uLmlzQ29sbGFwc2VkKSB7XG4gICAgICAgICAgICAgICAgd2hpbGUgKFsnQScsICdESVYnXS5pbmRleE9mKG5vZGUubm9kZU5hbWUpIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChub2RlICYmIG5vZGUubm9kZU5hbWUgPT09ICdBJykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmFuZ2UgPSB0LmRvYy5jcmVhdGVSYW5nZSgpO1xuICAgICAgICAgICAgICAgICAgICByYW5nZS5zZWxlY3ROb2RlKG5vZGUpO1xuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudFNlbGVjdGlvbi5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnRTZWxlY3Rpb24uYWRkUmFuZ2UocmFuZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHQuZXhlY0NtZCgndW5saW5rJywgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHRydWUpO1xuICAgICAgICB9LFxuICAgICAgICBpbnNlcnRJbWFnZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzO1xuICAgICAgICAgICAgdC5zYXZlUmFuZ2UoKTtcblxuICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgdXJsOiB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnVVJMJyxcbiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGFsdDoge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogdC5sYW5nLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdC5nZXRSYW5nZVRleHQoKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmICh0Lm8uaW1hZ2VXaWR0aE1vZGFsRWRpdCkge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMud2lkdGggPSB7fTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdC5vcGVuTW9kYWxJbnNlcnQodC5sYW5nLmluc2VydEltYWdlLCBvcHRpb25zLCBmdW5jdGlvbiAodikgeyAvLyB2IGFyZSB2YWx1ZXNcbiAgICAgICAgICAgICAgICB0LmV4ZWNDbWQoJ2luc2VydEltYWdlJywgdi51cmwsIGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB2YXIgJGltZyA9ICQoJ2ltZ1tzcmM9XCInICsgdi51cmwgKyAnXCJdOm5vdChbYWx0XSknLCB0LiRib3gpO1xuICAgICAgICAgICAgICAgICRpbWcuYXR0cignYWx0Jywgdi5hbHQpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHQuby5pbWFnZVdpZHRoTW9kYWxFZGl0KSB7XG4gICAgICAgICAgICAgICAgICAgICRpbWcuYXR0cih7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogdi53aWR0aFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0LnN5bmNDb2RlKCk7XG4gICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndjaGFuZ2UnKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bGxzY3JlZW46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcyxcbiAgICAgICAgICAgICAgICBwcmVmaXggPSB0Lm8ucHJlZml4LFxuICAgICAgICAgICAgICAgIGZ1bGxzY3JlZW5Dc3NDbGFzcyA9IHByZWZpeCArICdmdWxsc2NyZWVuJyxcbiAgICAgICAgICAgICAgICBmdWxsc2NyZWVuUGxhY2Vob2xkZXJDbGFzcyA9IGZ1bGxzY3JlZW5Dc3NDbGFzcyArICctcGxhY2Vob2xkZXInLFxuICAgICAgICAgICAgICAgIGlzRnVsbHNjcmVlbixcbiAgICAgICAgICAgICAgICBlZGl0b3JIZWlnaHQgPSB0LiRib3gub3V0ZXJIZWlnaHQoKTtcblxuICAgICAgICAgICAgdC4kYm94LnRvZ2dsZUNsYXNzKGZ1bGxzY3JlZW5Dc3NDbGFzcyk7XG4gICAgICAgICAgICBpc0Z1bGxzY3JlZW4gPSB0LiRib3guaGFzQ2xhc3MoZnVsbHNjcmVlbkNzc0NsYXNzKTtcblxuICAgICAgICAgICAgaWYgKGlzRnVsbHNjcmVlbikge1xuICAgICAgICAgICAgICAgIHQuJGJveC5iZWZvcmUoXG4gICAgICAgICAgICAgICAgICAgICQoJzxkaXYvPicsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzOiBmdWxsc2NyZWVuUGxhY2Vob2xkZXJDbGFzc1xuICAgICAgICAgICAgICAgICAgICB9KS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBlZGl0b3JIZWlnaHRcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKCcuJyArIGZ1bGxzY3JlZW5QbGFjZWhvbGRlckNsYXNzKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJCgnYm9keScpLnRvZ2dsZUNsYXNzKHByZWZpeCArICdib2R5LWZ1bGxzY3JlZW4nLCBpc0Z1bGxzY3JlZW4pO1xuICAgICAgICAgICAgJCh3aW5kb3cpLnRyaWdnZXIoJ3Njcm9sbCcpO1xuICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YncnICsgKGlzRnVsbHNjcmVlbiA/ICdvcGVuJyA6ICdjbG9zZScpICsgJ2Z1bGxzY3JlZW4nKTtcbiAgICAgICAgfSxcblxuXG4gICAgICAgIC8qXG4gICAgICAgICAqIENhbGwgbWV0aG9kIG9mIHRydW1ib3d5ZyBpZiBleGlzdFxuICAgICAgICAgKiBlbHNlIHRyeSB0byBjYWxsIGFub255bW91cyBmdW5jdGlvblxuICAgICAgICAgKiBhbmQgZmluYWxseSBuYXRpdmUgZXhlY0NvbW1hbmRcbiAgICAgICAgICovXG4gICAgICAgIGV4ZWNDbWQ6IGZ1bmN0aW9uIChjbWQsIHBhcmFtLCBmb3JjZUNzcywgc2tpcFRydW1ib3d5Zykge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzO1xuICAgICAgICAgICAgc2tpcFRydW1ib3d5ZyA9ICEhc2tpcFRydW1ib3d5ZyB8fCAnJztcblxuICAgICAgICAgICAgaWYgKGNtZCAhPT0gJ2Ryb3Bkb3duJykge1xuICAgICAgICAgICAgICAgIHQuJGVkLmZvY3VzKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdC5kb2MuZXhlY0NvbW1hbmQoJ3N0eWxlV2l0aENTUycsIGZhbHNlLCBmb3JjZUNzcyB8fCBmYWxzZSk7XG4gICAgICAgICAgICB9IGNhdGNoIChjKSB7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdFtjbWQgKyBza2lwVHJ1bWJvd3lnXShwYXJhbSk7XG4gICAgICAgICAgICB9IGNhdGNoIChjKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY21kKHBhcmFtKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlMikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY21kID09PSAnaW5zZXJ0SG9yaXpvbnRhbFJ1bGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjbWQgPT09ICdmb3JtYXRCbG9jaycgJiYgdC5pc0lFKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbSA9ICc8JyArIHBhcmFtICsgJz4nO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdC5kb2MuZXhlY0NvbW1hbmQoY21kLCBmYWxzZSwgcGFyYW0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHQuc3luY0NvZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgdC5zZW1hbnRpY0NvZGUoZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChjbWQgIT09ICdkcm9wZG93bicpIHtcbiAgICAgICAgICAgICAgICAgICAgdC51cGRhdGVCdXR0b25QYW5lU3RhdHVzKCk7XG4gICAgICAgICAgICAgICAgICAgIHQuJGMudHJpZ2dlcigndGJ3Y2hhbmdlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG5cbiAgICAgICAgLy8gT3BlbiBhIG1vZGFsIGJveFxuICAgICAgICBvcGVuTW9kYWw6IGZ1bmN0aW9uICh0aXRsZSwgY29udGVudCwgYnVpbGRGb3JtKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMsXG4gICAgICAgICAgICAgICAgcHJlZml4ID0gdC5vLnByZWZpeDtcblxuICAgICAgICAgICAgYnVpbGRGb3JtID0gYnVpbGRGb3JtICE9PSBmYWxzZTtcblxuICAgICAgICAgICAgLy8gTm8gb3BlbiBhIG1vZGFsIGJveCB3aGVuIGV4aXN0IG90aGVyIG1vZGFsIGJveFxuICAgICAgICAgICAgaWYgKCQoJy4nICsgcHJlZml4ICsgJ21vZGFsLWJveCcsIHQuJGJveCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0Lm8uYXV0b2dyb3dPbkVudGVyKSB7XG4gICAgICAgICAgICAgICAgdC5hdXRvZ3Jvd09uRW50ZXJEb250Q2xvc2UgPSB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0LnNhdmVSYW5nZSgpO1xuICAgICAgICAgICAgdC5zaG93T3ZlcmxheSgpO1xuXG4gICAgICAgICAgICAvLyBEaXNhYmxlIGFsbCBidG5QYW5lIGJ0bnNcbiAgICAgICAgICAgIHQuJGJ0blBhbmUuYWRkQ2xhc3MocHJlZml4ICsgJ2Rpc2FibGUnKTtcblxuICAgICAgICAgICAgLy8gQnVpbGQgb3V0IG9mIE1vZGFsQm94LCBpdCdzIHRoZSBtYXNrIGZvciBhbmltYXRpb25zXG4gICAgICAgICAgICB2YXIgJG1vZGFsID0gJCgnPGRpdi8+Jywge1xuICAgICAgICAgICAgICAgIGNsYXNzOiBwcmVmaXggKyAnbW9kYWwgJyArIHByZWZpeCArICdmaXhlZC10b3AnXG4gICAgICAgICAgICB9KS5jc3Moe1xuICAgICAgICAgICAgICAgIHRvcDogdC4kYm94Lm9mZnNldCgpLnRvcCArIHQuJGJ0blBhbmUuaGVpZ2h0KCksXG4gICAgICAgICAgICAgICAgekluZGV4OiA5OTk5OVxuICAgICAgICAgICAgfSkuYXBwZW5kVG8oJCh0LmRvYy5ib2R5KSk7XG5cbiAgICAgICAgICAgIC8vIENsaWNrIG9uIG92ZXJsYXkgY2xvc2UgbW9kYWwgYnkgY2FuY2VsbGluZyB0aGVtXG4gICAgICAgICAgICB0LiRvdmVybGF5Lm9uZSgnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJG1vZGFsLnRyaWdnZXIoQ0FOQ0VMX0VWRU5UKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gQnVpbGQgdGhlIGZvcm1cbiAgICAgICAgICAgIHZhciBmb3JtT3JDb250ZW50O1xuICAgICAgICAgICAgaWYgKGJ1aWxkRm9ybSkge1xuICAgICAgICAgICAgICAgIGZvcm1PckNvbnRlbnQgPSAkKCc8Zm9ybS8+Jywge1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICcnLFxuICAgICAgICAgICAgICAgICAgICBodG1sOiBjb250ZW50XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgIC5vbignc3VibWl0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICRtb2RhbC50cmlnZ2VyKENPTkZJUk1fRVZFTlQpO1xuICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAub24oJ3Jlc2V0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICRtb2RhbC50cmlnZ2VyKENBTkNFTF9FVkVOVCk7XG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgIC5vbignc3VibWl0IHJlc2V0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgIGlmICh0Lm8uYXV0b2dyb3dPbkVudGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHQuYXV0b2dyb3dPbkVudGVyRG9udENsb3NlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvcm1PckNvbnRlbnQgPSBjb250ZW50O1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIC8vIEJ1aWxkIE1vZGFsQm94IGFuZCBhbmltYXRlIHRvIHNob3cgdGhlbVxuICAgICAgICAgICAgdmFyICRib3ggPSAkKCc8ZGl2Lz4nLCB7XG4gICAgICAgICAgICAgICAgY2xhc3M6IHByZWZpeCArICdtb2RhbC1ib3gnLFxuICAgICAgICAgICAgICAgIGh0bWw6IGZvcm1PckNvbnRlbnRcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgIHRvcDogJy0nICsgdC4kYnRuUGFuZS5vdXRlckhlaWdodCgpLFxuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgICAgICAgICAgICBwYWRkaW5nQm90dG9tOiBidWlsZEZvcm0gPyBudWxsIDogJzUlJyxcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hcHBlbmRUbygkbW9kYWwpXG4gICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDFcbiAgICAgICAgICAgICAgICB9LCAxMDApO1xuXG5cbiAgICAgICAgICAgIC8vIEFwcGVuZCB0aXRsZVxuICAgICAgICAgICAgaWYgKHRpdGxlKSB7XG4gICAgICAgICAgICAgICAgJCgnPHNwYW4vPicsIHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzOiBwcmVmaXggKyAnbW9kYWwtdGl0bGUnXG4gICAgICAgICAgICAgICAgfSkucHJlcGVuZFRvKCRib3gpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYnVpbGRGb3JtKSB7XG4gICAgICAgICAgICAgICAgLy8gRm9jdXMgaW4gbW9kYWwgYm94XG4gICAgICAgICAgICAgICAgJCgnaW5wdXQ6Zmlyc3QnLCAkYm94KS5mb2N1cygpO1xuXG4gICAgICAgICAgICAgICAgLy8gQXBwZW5kIENvbmZpcm0gYW5kIENhbmNlbCBidXR0b25zXG4gICAgICAgICAgICAgICAgdC5idWlsZE1vZGFsQnRuKCdzdWJtaXQnLCAkYm94KTtcbiAgICAgICAgICAgICAgICB0LmJ1aWxkTW9kYWxCdG4oJ3Jlc2V0JywgJGJveCk7XG5cbiAgICAgICAgICAgICAgICAkbW9kYWwuaGVpZ2h0KCRib3gub3V0ZXJIZWlnaHQoKSArIDEwKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJCh3aW5kb3cpLnRyaWdnZXIoJ3Njcm9sbCcpO1xuXG4gICAgICAgICAgICByZXR1cm4gJG1vZGFsO1xuICAgICAgICB9LFxuICAgICAgICAvLyBAcGFyYW0gbiBpcyBuYW1lIG9mIG1vZGFsXG4gICAgICAgIGJ1aWxkTW9kYWxCdG46IGZ1bmN0aW9uIChuLCAkbW9kYWwpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcyxcbiAgICAgICAgICAgICAgICBwcmVmaXggPSB0Lm8ucHJlZml4O1xuXG4gICAgICAgICAgICByZXR1cm4gJCgnPGJ1dHRvbi8+Jywge1xuICAgICAgICAgICAgICAgIGNsYXNzOiBwcmVmaXggKyAnbW9kYWwtYnV0dG9uICcgKyBwcmVmaXggKyAnbW9kYWwtJyArIG4sXG4gICAgICAgICAgICAgICAgdHlwZTogbixcbiAgICAgICAgICAgICAgICB0ZXh0OiB0Lmxhbmdbbl0gfHwgblxuICAgICAgICAgICAgfSkuYXBwZW5kVG8oJCgnZm9ybScsICRtb2RhbCkpO1xuICAgICAgICB9LFxuICAgICAgICAvLyBjbG9zZSBjdXJyZW50IG1vZGFsIGJveFxuICAgICAgICBjbG9zZU1vZGFsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMsXG4gICAgICAgICAgICAgICAgcHJlZml4ID0gdC5vLnByZWZpeDtcblxuICAgICAgICAgICAgdC4kYnRuUGFuZS5yZW1vdmVDbGFzcyhwcmVmaXggKyAnZGlzYWJsZScpO1xuICAgICAgICAgICAgdC4kb3ZlcmxheS5vZmYoKTtcblxuICAgICAgICAgICAgLy8gRmluZCB0aGUgbW9kYWwgYm94XG4gICAgICAgICAgICB2YXIgJG1vZGFsQm94ID0gJCgnLicgKyBwcmVmaXggKyAnbW9kYWwtYm94JywgJCh0LmRvYy5ib2R5KSk7XG5cbiAgICAgICAgICAgICRtb2RhbEJveC5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICB0b3A6ICctJyArICRtb2RhbEJveC5oZWlnaHQoKVxuICAgICAgICAgICAgfSwgMTAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJG1vZGFsQm94LnBhcmVudCgpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIHQuaGlkZU92ZXJsYXkoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0LnJlc3RvcmVSYW5nZSgpO1xuICAgICAgICB9LFxuICAgICAgICAvLyBQcmUtZm9ybWF0dGVkIGJ1aWxkIGFuZCBtYW5hZ2VtZW50IG1vZGFsXG4gICAgICAgIG9wZW5Nb2RhbEluc2VydDogZnVuY3Rpb24gKHRpdGxlLCBmaWVsZHMsIGNtZCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLFxuICAgICAgICAgICAgICAgIHByZWZpeCA9IHQuby5wcmVmaXgsXG4gICAgICAgICAgICAgICAgbGcgPSB0LmxhbmcsXG4gICAgICAgICAgICAgICAgaHRtbCA9ICcnO1xuXG4gICAgICAgICAgICAkLmVhY2goZmllbGRzLCBmdW5jdGlvbiAoZmllbGROYW1lLCBmaWVsZCkge1xuICAgICAgICAgICAgICAgIHZhciBsID0gZmllbGQubGFiZWwgfHwgZmllbGROYW1lLFxuICAgICAgICAgICAgICAgICAgICBuID0gZmllbGQubmFtZSB8fCBmaWVsZE5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGEgPSBmaWVsZC5hdHRyaWJ1dGVzIHx8IHt9O1xuXG4gICAgICAgICAgICAgICAgdmFyIGF0dHIgPSBPYmplY3Qua2V5cyhhKS5tYXAoZnVuY3Rpb24gKHByb3ApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb3AgKyAnPVwiJyArIGFbcHJvcF0gKyAnXCInO1xuICAgICAgICAgICAgICAgIH0pLmpvaW4oJyAnKTtcblxuICAgICAgICAgICAgICAgIGh0bWwgKz0gJzxsYWJlbD48aW5wdXQgdHlwZT1cIicgKyAoZmllbGQudHlwZSB8fCAndGV4dCcpICsgJ1wiIG5hbWU9XCInICsgbiArICdcIicgK1xuICAgICAgICAgICAgICAgICAgICAoZmllbGQudHlwZSA9PT0gJ2NoZWNrYm94JyAmJiBmaWVsZC52YWx1ZSA/ICcgY2hlY2tlZD1cImNoZWNrZWRcIicgOiAnIHZhbHVlPVwiJyArIChmaWVsZC52YWx1ZSB8fCAnJykucmVwbGFjZSgvXCIvZywgJyZxdW90OycpKSArXG4gICAgICAgICAgICAgICAgICAgICdcIicgKyBhdHRyICsgJz48c3BhbiBjbGFzcz1cIicgKyBwcmVmaXggKyAnaW5wdXQtaW5mb3NcIj48c3Bhbj4nICtcbiAgICAgICAgICAgICAgICAgICAgKGxnW2xdID8gbGdbbF0gOiBsKSArXG4gICAgICAgICAgICAgICAgICAgICc8L3NwYW4+PC9zcGFuPjwvbGFiZWw+JztcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdC5vcGVuTW9kYWwodGl0bGUsIGh0bWwpXG4gICAgICAgICAgICAgICAgLm9uKENPTkZJUk1fRVZFTlQsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyICRmb3JtID0gJCgnZm9ybScsICQodGhpcykpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWQgPSB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0ge307XG5cbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGZpZWxkcywgZnVuY3Rpb24gKGZpZWxkTmFtZSwgZmllbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gZmllbGQubmFtZSB8fCBmaWVsZE5hbWU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkZmllbGQgPSAkKCdpbnB1dFtuYW1lPVwiJyArIG4gKyAnXCJdJywgJGZvcm0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0VHlwZSA9ICRmaWVsZC5hdHRyKCd0eXBlJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoaW5wdXRUeXBlLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdjaGVja2JveCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1tuXSA9ICRmaWVsZC5pcygnOmNoZWNrZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAncmFkaW8nOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbbl0gPSAkZmllbGQuZmlsdGVyKCc6Y2hlY2tlZCcpLnZhbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbbl0gPSAkLnRyaW0oJGZpZWxkLnZhbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBWYWxpZGF0ZSB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkLnJlcXVpcmVkICYmIHZhbHVlc1tuXSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuYWRkRXJyb3JPbk1vZGFsRmllbGQoJGZpZWxkLCB0LmxhbmcucmVxdWlyZWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmaWVsZC5wYXR0ZXJuICYmICFmaWVsZC5wYXR0ZXJuLnRlc3QodmFsdWVzW25dKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5hZGRFcnJvck9uTW9kYWxGaWVsZCgkZmllbGQsIGZpZWxkLnBhdHRlcm5FcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWxpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdC5yZXN0b3JlUmFuZ2UoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNtZCh2YWx1ZXMsIGZpZWxkcykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnN5bmNDb2RlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndjaGFuZ2UnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmNsb3NlTW9kYWwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLm9mZihDT05GSVJNX0VWRU5UKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm9uZShDQU5DRUxfRVZFTlQsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5vZmYoQ09ORklSTV9FVkVOVCk7XG4gICAgICAgICAgICAgICAgICAgIHQuY2xvc2VNb2RhbCgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBhZGRFcnJvck9uTW9kYWxGaWVsZDogZnVuY3Rpb24gKCRmaWVsZCwgZXJyKSB7XG4gICAgICAgICAgICB2YXIgcHJlZml4ID0gdGhpcy5vLnByZWZpeCxcbiAgICAgICAgICAgICAgICBzcGFuRXJyb3JDbGFzcyA9IHByZWZpeCArICdtc2ctZXJyb3InLFxuICAgICAgICAgICAgICAgICRsYWJlbCA9ICRmaWVsZC5wYXJlbnQoKTtcblxuICAgICAgICAgICAgJGZpZWxkXG4gICAgICAgICAgICAgICAgLm9uKCdjaGFuZ2Uga2V5dXAnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICRsYWJlbC5yZW1vdmVDbGFzcyhwcmVmaXggKyAnaW5wdXQtZXJyb3InKTtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkbGFiZWwuZmluZCgnLicgKyBzcGFuRXJyb3JDbGFzcykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDE1MCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICRsYWJlbFxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhwcmVmaXggKyAnaW5wdXQtZXJyb3InKVxuICAgICAgICAgICAgICAgIC5maW5kKCdpbnB1dCtzcGFuJylcbiAgICAgICAgICAgICAgICAuYXBwZW5kKFxuICAgICAgICAgICAgICAgICAgICAkKCc8c3Bhbi8+Jywge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M6IHNwYW5FcnJvckNsYXNzLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogZXJyXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXREZWZhdWx0SW1nRGJsQ2xpY2tIYW5kbGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXM7XG5cbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyICRpbWcgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICBzcmMgPSAkaW1nLmF0dHIoJ3NyYycpLFxuICAgICAgICAgICAgICAgICAgICBiYXNlNjQgPSAnKEJhc2U2NCknO1xuXG4gICAgICAgICAgICAgICAgaWYgKHNyYy5pbmRleE9mKCdkYXRhOmltYWdlJykgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgc3JjID0gYmFzZTY0O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnVVJMJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBzcmMsXG4gICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBhbHQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiB0LmxhbmcuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJGltZy5hdHRyKCdhbHQnKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGlmICh0Lm8uaW1hZ2VXaWR0aE1vZGFsRWRpdCkge1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLndpZHRoID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICRpbWcuYXR0cignd2lkdGgnKSA/ICRpbWcuYXR0cignd2lkdGgnKSA6ICcnXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdC5vcGVuTW9kYWxJbnNlcnQodC5sYW5nLmluc2VydEltYWdlLCBvcHRpb25zLCBmdW5jdGlvbiAodikge1xuICAgICAgICAgICAgICAgICAgICBpZiAodi51cmwgIT09IGJhc2U2NCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGltZy5hdHRyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmM6IHYudXJsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAkaW1nLmF0dHIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgYWx0OiB2LmFsdFxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodC5vLmltYWdlV2lkdGhNb2RhbEVkaXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUludCh2LndpZHRoKSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaW1nLmF0dHIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogdi53aWR0aFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaW1nLnJlbW92ZUF0dHIoJ3dpZHRoJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vIFJhbmdlIG1hbmFnZW1lbnRcbiAgICAgICAgc2F2ZVJhbmdlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMsXG4gICAgICAgICAgICAgICAgZG9jdW1lbnRTZWxlY3Rpb24gPSB0LmRvYy5nZXRTZWxlY3Rpb24oKTtcblxuICAgICAgICAgICAgdC5yYW5nZSA9IG51bGw7XG5cbiAgICAgICAgICAgIGlmICghZG9jdW1lbnRTZWxlY3Rpb24gfHwgIWRvY3VtZW50U2VsZWN0aW9uLnJhbmdlQ291bnQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzYXZlZFJhbmdlID0gdC5yYW5nZSA9IGRvY3VtZW50U2VsZWN0aW9uLmdldFJhbmdlQXQoMCksXG4gICAgICAgICAgICAgICAgcmFuZ2UgPSB0LmRvYy5jcmVhdGVSYW5nZSgpLFxuICAgICAgICAgICAgICAgIHJhbmdlU3RhcnQ7XG4gICAgICAgICAgICByYW5nZS5zZWxlY3ROb2RlQ29udGVudHModC4kZWRbMF0pO1xuICAgICAgICAgICAgcmFuZ2Uuc2V0RW5kKHNhdmVkUmFuZ2Uuc3RhcnRDb250YWluZXIsIHNhdmVkUmFuZ2Uuc3RhcnRPZmZzZXQpO1xuICAgICAgICAgICAgcmFuZ2VTdGFydCA9IChyYW5nZSArICcnKS5sZW5ndGg7XG4gICAgICAgICAgICB0Lm1ldGFSYW5nZSA9IHtcbiAgICAgICAgICAgICAgICBzdGFydDogcmFuZ2VTdGFydCxcbiAgICAgICAgICAgICAgICBlbmQ6IHJhbmdlU3RhcnQgKyAoc2F2ZWRSYW5nZSArICcnKS5sZW5ndGhcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG4gICAgICAgIHJlc3RvcmVSYW5nZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLFxuICAgICAgICAgICAgICAgIG1ldGFSYW5nZSA9IHQubWV0YVJhbmdlLFxuICAgICAgICAgICAgICAgIHNhdmVkUmFuZ2UgPSB0LnJhbmdlLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50U2VsZWN0aW9uID0gdC5kb2MuZ2V0U2VsZWN0aW9uKCksXG4gICAgICAgICAgICAgICAgcmFuZ2U7XG5cbiAgICAgICAgICAgIGlmICghc2F2ZWRSYW5nZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG1ldGFSYW5nZSAmJiBtZXRhUmFuZ2Uuc3RhcnQgIT09IG1ldGFSYW5nZS5lbmQpIHsgLy8gQWxnb3JpdGhtIGZyb20gaHR0cDovL2pzZmlkZGxlLm5ldC9XZVd5Ny8zL1xuICAgICAgICAgICAgICAgIHZhciBjaGFySW5kZXggPSAwLFxuICAgICAgICAgICAgICAgICAgICBub2RlU3RhY2sgPSBbdC4kZWRbMF1dLFxuICAgICAgICAgICAgICAgICAgICBub2RlLFxuICAgICAgICAgICAgICAgICAgICBmb3VuZFN0YXJ0ID0gZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHN0b3AgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIHJhbmdlID0gdC5kb2MuY3JlYXRlUmFuZ2UoKTtcblxuICAgICAgICAgICAgICAgIHdoaWxlICghc3RvcCAmJiAobm9kZSA9IG5vZGVTdGFjay5wb3AoKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXh0Q2hhckluZGV4ID0gY2hhckluZGV4ICsgbm9kZS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZvdW5kU3RhcnQgJiYgbWV0YVJhbmdlLnN0YXJ0ID49IGNoYXJJbmRleCAmJiBtZXRhUmFuZ2Uuc3RhcnQgPD0gbmV4dENoYXJJbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlLnNldFN0YXJ0KG5vZGUsIG1ldGFSYW5nZS5zdGFydCAtIGNoYXJJbmRleCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmRTdGFydCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm91bmRTdGFydCAmJiBtZXRhUmFuZ2UuZW5kID49IGNoYXJJbmRleCAmJiBtZXRhUmFuZ2UuZW5kIDw9IG5leHRDaGFySW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5nZS5zZXRFbmQobm9kZSwgbWV0YVJhbmdlLmVuZCAtIGNoYXJJbmRleCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFySW5kZXggPSBuZXh0Q2hhckluZGV4O1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNuID0gbm9kZS5jaGlsZE5vZGVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgPSBjbi5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgLT0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlU3RhY2sucHVzaChjbltpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEZpeCBJRTExIEVycm9yICdDb3VsZCBub3QgY29tcGxldGUgdGhlIG9wZXJhdGlvbiBkdWUgdG8gZXJyb3IgODAwYTAyNWUnLlxuICAgICAgICAgICAgLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTYxNjA5OTYvY291bGQtbm90LWNvbXBsZXRlLXRoZS1vcGVyYXRpb24tZHVlLXRvLWVycm9yLTgwMGEwMjVlXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50U2VsZWN0aW9uLnJlbW92ZUFsbFJhbmdlcygpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkb2N1bWVudFNlbGVjdGlvbi5hZGRSYW5nZShyYW5nZSB8fCBzYXZlZFJhbmdlKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0UmFuZ2VUZXh0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yYW5nZSArICcnO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNsZWFyQnV0dG9uUGFuZVN0YXR1czogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLFxuICAgICAgICAgICAgICBwcmVmaXggPSB0Lm8ucHJlZml4LFxuICAgICAgICAgICAgICBhY3RpdmVDbGFzc2VzID0gcHJlZml4ICsgJ2FjdGl2ZS1idXR0b24gJyArIHByZWZpeCArICdhY3RpdmUnLFxuICAgICAgICAgICAgICBvcmlnaW5hbEljb25DbGFzcyA9IHByZWZpeCArICdvcmlnaW5hbC1pY29uJztcblxuICAgICAgICAgICAgLy8gUmVzZXQgYWxsIGJ1dHRvbnMgYW5kIGRyb3Bkb3duIHN0YXRlXG4gICAgICAgICAgICAkKCcuJyArIHByZWZpeCArICdhY3RpdmUtYnV0dG9uJywgdC4kYnRuUGFuZSkucmVtb3ZlQ2xhc3MoYWN0aXZlQ2xhc3Nlcyk7XG4gICAgICAgICAgICAkKCcuJyArIG9yaWdpbmFsSWNvbkNsYXNzLCB0LiRidG5QYW5lKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoJ3N2ZyB1c2UnKS5hdHRyKCd4bGluazpocmVmJywgJCh0aGlzKS5kYXRhKG9yaWdpbmFsSWNvbkNsYXNzKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgdXBkYXRlQnV0dG9uUGFuZVN0YXR1czogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLFxuICAgICAgICAgICAgICAgIHByZWZpeCA9IHQuby5wcmVmaXgsXG4gICAgICAgICAgICAgICAgYWN0aXZlQ2xhc3NlcyA9IHByZWZpeCArICdhY3RpdmUtYnV0dG9uICcgKyBwcmVmaXggKyAnYWN0aXZlJyxcbiAgICAgICAgICAgICAgICBvcmlnaW5hbEljb25DbGFzcyA9IHByZWZpeCArICdvcmlnaW5hbC1pY29uJyxcbiAgICAgICAgICAgICAgICB0YWdzID0gdC5nZXRUYWdzUmVjdXJzaXZlKHQuZG9jLmdldFNlbGVjdGlvbigpLmZvY3VzTm9kZSk7XG5cbiAgICAgICAgICAgIHQuY2xlYXJCdXR0b25QYW5lU3RhdHVzKCk7XG5cbiAgICAgICAgICAgICQuZWFjaCh0YWdzLCBmdW5jdGlvbiAoaSwgdGFnKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJ0bk5hbWUgPSB0LnRhZ1RvQnV0dG9uW3RhZy50b0xvd2VyQ2FzZSgpXSxcbiAgICAgICAgICAgICAgICAgICAgJGJ0biA9ICQoJy4nICsgcHJlZml4ICsgYnRuTmFtZSArICctYnV0dG9uJywgdC4kYnRuUGFuZSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoJGJ0bi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICRidG4uYWRkQ2xhc3MoYWN0aXZlQ2xhc3Nlcyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRidG4gPSAkKCcuJyArIHByZWZpeCArICdkcm9wZG93biAuJyArIHByZWZpeCArIGJ0bk5hbWUgKyAnLWRyb3Bkb3duLWJ1dHRvbicsIHQuJGJveCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGJ0blN2Z1VzZSA9ICRidG4uZmluZCgnc3ZnIHVzZScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyb3Bkb3duQnRuTmFtZSA9ICRidG4ucGFyZW50KCkuZGF0YShwcmVmaXggKyAnZHJvcGRvd24nKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZHJvcGRvd25CdG4gPSAkKCcuJyArIHByZWZpeCArIGRyb3Bkb3duQnRuTmFtZSArICctYnV0dG9uJywgdC4kYm94KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZHJvcGRvd25CdG5TdmdVc2UgPSAkZHJvcGRvd25CdG4uZmluZCgnc3ZnIHVzZScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBIaWdobGlnaHQgdGhlIGRyb3Bkb3duIGJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAgJGRyb3Bkb3duQnRuLmFkZENsYXNzKGFjdGl2ZUNsYXNzZXMpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBTd2l0Y2ggZHJvcGRvd24gaWNvbiB0byB0aGUgYWN0aXZlIHN1Yi1pY29uIG9uZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQuby5jaGFuZ2VBY3RpdmVEcm9wZG93bkljb24gJiYgJGJ0blN2Z1VzZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2F2ZSBvcmlnaW5hbCBpY29uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRyb3Bkb3duQnRuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3Mob3JpZ2luYWxJY29uQ2xhc3MpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZGF0YShvcmlnaW5hbEljb25DbGFzcywgJGRyb3Bkb3duQnRuU3ZnVXNlLmF0dHIoJ3hsaW5rOmhyZWYnKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBQdXQgdGhlIGFjdGl2ZSBzdWItYnV0dG9uJ3MgaWNvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkcm9wZG93bkJ0blN2Z1VzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3hsaW5rOmhyZWYnLCAkYnRuU3ZnVXNlLmF0dHIoJ3hsaW5rOmhyZWYnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBnZXRUYWdzUmVjdXJzaXZlOiBmdW5jdGlvbiAoZWxlbWVudCwgdGFncykge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzO1xuICAgICAgICAgICAgdGFncyA9IHRhZ3MgfHwgKGVsZW1lbnQgJiYgZWxlbWVudC50YWdOYW1lID8gW2VsZW1lbnQudGFnTmFtZV0gOiBbXSk7XG5cbiAgICAgICAgICAgIGlmIChlbGVtZW50ICYmIGVsZW1lbnQucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudE5vZGU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB0YWdzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgdGFnID0gZWxlbWVudC50YWdOYW1lO1xuICAgICAgICAgICAgaWYgKHRhZyA9PT0gJ0RJVicpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGFncztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0YWcgPT09ICdQJyAmJiBlbGVtZW50LnN0eWxlLnRleHRBbGlnbiAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICB0YWdzLnB1c2goZWxlbWVudC5zdHlsZS50ZXh0QWxpZ24pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkLmVhY2godC50YWdIYW5kbGVycywgZnVuY3Rpb24gKGksIHRhZ0hhbmRsZXIpIHtcbiAgICAgICAgICAgICAgICB0YWdzID0gdGFncy5jb25jYXQodGFnSGFuZGxlcihlbGVtZW50LCB0KSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGFncy5wdXNoKHRhZyk7XG5cbiAgICAgICAgICAgIHJldHVybiB0LmdldFRhZ3NSZWN1cnNpdmUoZWxlbWVudCwgdGFncykuZmlsdGVyKGZ1bmN0aW9uICh0YWcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGFnICE9IG51bGw7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICAvLyBQbHVnaW5zXG4gICAgICAgIGluaXRQbHVnaW5zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXM7XG4gICAgICAgICAgICB0LmxvYWRlZFBsdWdpbnMgPSBbXTtcbiAgICAgICAgICAgICQuZWFjaCgkLnRydW1ib3d5Zy5wbHVnaW5zLCBmdW5jdGlvbiAobmFtZSwgcGx1Z2luKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFwbHVnaW4uc2hvdWxkSW5pdCB8fCBwbHVnaW4uc2hvdWxkSW5pdCh0KSkge1xuICAgICAgICAgICAgICAgICAgICBwbHVnaW4uaW5pdCh0KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBsdWdpbi50YWdIYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0LnRhZ0hhbmRsZXJzLnB1c2gocGx1Z2luLnRhZ0hhbmRsZXIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHQubG9hZGVkUGx1Z2lucy5wdXNoKHBsdWdpbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGRlc3Ryb3lQbHVnaW5zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXM7XG4gICAgICAgICAgICAkLmVhY2godGhpcy5sb2FkZWRQbHVnaW5zLCBmdW5jdGlvbiAoaSwgcGx1Z2luKSB7XG4gICAgICAgICAgICAgICAgaWYgKHBsdWdpbi5kZXN0cm95KSB7XG4gICAgICAgICAgICAgICAgICAgIHBsdWdpbi5kZXN0cm95KHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbn0pKG5hdmlnYXRvciwgd2luZG93LCBkb2N1bWVudCwgalF1ZXJ5KTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiB0cnVtYm93eWcuY29sb3JzLmpzIHYxLjJcbiAqIENvbG9ycyBwaWNrZXIgcGx1Z2luIGZvciBUcnVtYm93eWdcbiAqIGh0dHA6Ly9hbGV4LWQuZ2l0aHViLmNvbS9UcnVtYm93eWdcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBBdXRob3IgOiBBbGV4YW5kcmUgRGVtb2RlIChBbGV4LUQpXG4gKiAgICAgICAgICBUd2l0dGVyIDogQEFsZXhhbmRyZURlbW9kZVxuICogICAgICAgICAgV2Vic2l0ZSA6IGFsZXgtZC5mclxuICovXG5cbihmdW5jdGlvbiAoJCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgICQuZXh0ZW5kKHRydWUsICQudHJ1bWJvd3lnLCB7XG4gICAgICAgIGxhbmdzOiB7XG4gICAgICAgICAgICAvLyBqc2hpbnQgY2FtZWxjYXNlOmZhbHNlXG4gICAgICAgICAgICBjczoge1xuICAgICAgICAgICAgICAgIGZvcmVDb2xvcjogJ0JhcnZhIHRleHR1JyxcbiAgICAgICAgICAgICAgICBiYWNrQ29sb3I6ICdCYXJ2YSBwb3phZMOtJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVuOiB7XG4gICAgICAgICAgICAgICAgZm9yZUNvbG9yOiAnVGV4dCBjb2xvcicsXG4gICAgICAgICAgICAgICAgYmFja0NvbG9yOiAnQmFja2dyb3VuZCBjb2xvcicsXG4gICAgICAgICAgICAgICAgZm9yZUNvbG9yUmVtb3ZlOiAnUmVtb3ZlIHRleHQgY29sb3InLFxuICAgICAgICAgICAgICAgIGJhY2tDb2xvclJlbW92ZTogJ1JlbW92ZSBiYWNrZ3JvdW5kIGNvbG9yJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRhOiB7XG4gICAgICAgICAgICAgICAgZm9yZUNvbG9yOiAnVGVrc3RmYXJ2ZScsXG4gICAgICAgICAgICAgICAgYmFja0NvbG9yOiAnQmFnZ3J1bmRzZmFydmUnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZnI6IHtcbiAgICAgICAgICAgICAgICBmb3JlQ29sb3I6ICdDb3VsZXVyIGR1IHRleHRlJyxcbiAgICAgICAgICAgICAgICBiYWNrQ29sb3I6ICdDb3VsZXVyIGRlIGZvbmQnLFxuICAgICAgICAgICAgICAgIGZvcmVDb2xvclJlbW92ZTogJ1N1cHByaW1lciBsYSBjb3VsZXVyIGR1IHRleHRlJyxcbiAgICAgICAgICAgICAgICBiYWNrQ29sb3JSZW1vdmU6ICdTdXBwcmltZXIgbGEgY291bGV1ciBkZSBmb25kJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRlOiB7XG4gICAgICAgICAgICAgICAgZm9yZUNvbG9yOiAnVGV4dGZhcmJlJyxcbiAgICAgICAgICAgICAgICBiYWNrQ29sb3I6ICdIaW50ZXJncnVuZGZhcmJlJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG5sOiB7XG4gICAgICAgICAgICAgICAgZm9yZUNvbG9yOiAnVGVrc3RrbGV1cicsXG4gICAgICAgICAgICAgICAgYmFja0NvbG9yOiAnQWNodGVyZ3JvbmRrbGV1cidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzazoge1xuICAgICAgICAgICAgICAgIGZvcmVDb2xvcjogJ0ZhcmJhIHRleHR1JyxcbiAgICAgICAgICAgICAgICBiYWNrQ29sb3I6ICdGYXJiYSBwb3phZGlhJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHpoX2NuOiB7XG4gICAgICAgICAgICAgICAgZm9yZUNvbG9yOiAn5paH5a2X6aKc6ImyJyxcbiAgICAgICAgICAgICAgICBiYWNrQ29sb3I6ICfog4zmma/popzoibInXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgemhfdHc6IHtcbiAgICAgICAgICAgICAgICBmb3JlQ29sb3I6ICfmloflrZfpoY/oibInLFxuICAgICAgICAgICAgICAgIGJhY2tDb2xvcjogJ+iDjOaZr+mhj+iJsidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBydToge1xuICAgICAgICAgICAgICAgIGZvcmVDb2xvcjogJ9Cm0LLQtdGCINGC0LXQutGB0YLQsCcsXG4gICAgICAgICAgICAgICAgYmFja0NvbG9yOiAn0KbQstC10YIg0LLRi9C00LXQu9C10L3QuNGPINGC0LXQutGB0YLQsCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBqYToge1xuICAgICAgICAgICAgICAgIGZvcmVDb2xvcjogJ+aWh+Wtl+iJsicsXG4gICAgICAgICAgICAgICAgYmFja0NvbG9yOiAn6IOM5pmv6ImyJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRyOiB7XG4gICAgICAgICAgICAgICAgZm9yZUNvbG9yOiAnWWF6xLEgcmVuZ2knLFxuICAgICAgICAgICAgICAgIGJhY2tDb2xvcjogJ0Fya2FwbGFuIHJlbmdpJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHB0X2JyOiB7XG4gICAgICAgICAgICAgICAgZm9yZUNvbG9yOiAnQ29yIGRlIGZvbnRlJyxcbiAgICAgICAgICAgICAgICBiYWNrQ29sb3I6ICdDb3IgZGUgZnVuZG8nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAga286IHtcbiAgICAgICAgICAgICAgICBmb3JlQ29sb3I6ICfquIDsnpDsg4knLFxuICAgICAgICAgICAgICAgIGJhY2tDb2xvcjogJ+uwsOqyveyDiScsXG4gICAgICAgICAgICAgICAgZm9yZUNvbG9yUmVtb3ZlOiAn6riA7J6Q7IOJIOyngOyasOq4sCcsXG4gICAgICAgICAgICAgICAgYmFja0NvbG9yUmVtb3ZlOiAn67Cw6rK97IOJIOyngOyasOq4sCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIGpzaGludCBjYW1lbGNhc2U6dHJ1ZVxuXG5cbiAgICBmdW5jdGlvbiBoZXgoeCkge1xuICAgICAgICByZXR1cm4gKCcwJyArIHBhcnNlSW50KHgpLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNvbG9yVG9IZXgocmdiKSB7XG4gICAgICAgIGlmIChyZ2Iuc2VhcmNoKCdyZ2InKSA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiByZ2IucmVwbGFjZSgnIycsICcnKTtcbiAgICAgICAgfSBlbHNlIGlmIChyZ2IgPT09ICdyZ2JhKDAsIDAsIDAsIDApJykge1xuICAgICAgICAgICAgcmV0dXJuICd0cmFuc3BhcmVudCc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZ2IgPSByZ2IubWF0Y2goL15yZ2JhP1xcKChcXGQrKSxcXHMqKFxcZCspLFxccyooXFxkKykoPzosXFxzKihcXGQrKSk/XFwpJC8pO1xuICAgICAgICAgICAgcmV0dXJuIGhleChyZ2JbMV0pICsgaGV4KHJnYlsyXSkgKyBoZXgocmdiWzNdKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNvbG9yVGFnSGFuZGxlcihlbGVtZW50LCB0cnVtYm93eWcpIHtcbiAgICAgICAgdmFyIHRhZ3MgPSBbXTtcblxuICAgICAgICBpZiAoIWVsZW1lbnQuc3R5bGUpIHtcbiAgICAgICAgICAgIHJldHVybiB0YWdzO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gYmFja2dyb3VuZCBjb2xvclxuICAgICAgICBpZiAoZWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgIT09ICcnKSB7XG4gICAgICAgICAgICB2YXIgYmFja0NvbG9yID0gY29sb3JUb0hleChlbGVtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvcik7XG4gICAgICAgICAgICBpZiAodHJ1bWJvd3lnLm8ucGx1Z2lucy5jb2xvcnMuY29sb3JMaXN0LmluZGV4T2YoYmFja0NvbG9yKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgdGFncy5wdXNoKCdiYWNrQ29sb3InICsgYmFja0NvbG9yKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGFncy5wdXNoKCdiYWNrQ29sb3JGcmVlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyB0ZXh0IGNvbG9yXG4gICAgICAgIHZhciBmb3JlQ29sb3I7XG4gICAgICAgIGlmIChlbGVtZW50LnN0eWxlLmNvbG9yICE9PSAnJykge1xuICAgICAgICAgICAgZm9yZUNvbG9yID0gY29sb3JUb0hleChlbGVtZW50LnN0eWxlLmNvbG9yKTtcbiAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50Lmhhc0F0dHJpYnV0ZSgnY29sb3InKSkge1xuICAgICAgICAgICAgZm9yZUNvbG9yID0gY29sb3JUb0hleChlbGVtZW50LmdldEF0dHJpYnV0ZSgnY29sb3InKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZvcmVDb2xvcikge1xuICAgICAgICAgICAgaWYgKHRydW1ib3d5Zy5vLnBsdWdpbnMuY29sb3JzLmNvbG9yTGlzdC5pbmRleE9mKGZvcmVDb2xvcikgPj0gMCkge1xuICAgICAgICAgICAgICAgIHRhZ3MucHVzaCgnZm9yZUNvbG9yJyArIGZvcmVDb2xvcik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRhZ3MucHVzaCgnZm9yZUNvbG9yRnJlZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRhZ3M7XG4gICAgfVxuXG4gICAgdmFyIGRlZmF1bHRPcHRpb25zID0ge1xuICAgICAgICBjb2xvckxpc3Q6IFtcbiAgICAgICAgICAgICdmZmZmZmYnLCAnMDAwMDAwJywgJ2VlZWNlMScsICcxZjQ5N2QnLCAnNGY4MWJkJywgJ2MwNTA0ZCcsICc5YmJiNTknLCAnODA2NGEyJywgJzRiYWNjNicsICdmNzk2NDYnLCAnZmZmZjAwJyxcbiAgICAgICAgICAgICdmMmYyZjInLCAnN2Y3ZjdmJywgJ2RkZDljMycsICdjNmQ5ZjAnLCAnZGJlNWYxJywgJ2YyZGNkYicsICdlYmYxZGQnLCAnZTVlMGVjJywgJ2RiZWVmMycsICdmZGVhZGEnLCAnZmZmMmNhJyxcbiAgICAgICAgICAgICdkOGQ4ZDgnLCAnNTk1OTU5JywgJ2M0YmQ5NycsICc4ZGIzZTInLCAnYjhjY2U0JywgJ2U1YjliNycsICdkN2UzYmMnLCAnY2NjMWQ5JywgJ2I3ZGRlOCcsICdmYmQ1YjUnLCAnZmZlNjk0JyxcbiAgICAgICAgICAgICdiZmJmYmYnLCAnM2YzZjNmJywgJzkzODk1MycsICc1NDhkZDQnLCAnOTViM2Q3JywgJ2Q5OTY5NCcsICdjM2Q2OWInLCAnYjJhMmM3JywgJ2I3ZGRlOCcsICdmYWMwOGYnLCAnZjJjMzE0JyxcbiAgICAgICAgICAgICdhNWE1YTUnLCAnMjYyNjI2JywgJzQ5NDQyOScsICcxNzM2NWQnLCAnMzY2MDkyJywgJzk1MzczNCcsICc3NjkyM2MnLCAnNWY0OTdhJywgJzkyY2RkYycsICdlMzZjMDknLCAnYzA5MTAwJyxcbiAgICAgICAgICAgICc3ZjdmN2YnLCAnMGMwYzBjJywgJzFkMWIxMCcsICcwZjI0M2UnLCAnMjQ0MDYxJywgJzYzMjQyMycsICc0ZjYxMjgnLCAnM2YzMTUxJywgJzMxODU5YicsICc5NzQ4MDYnLCAnN2Y2MDAwJ1xuICAgICAgICBdLFxuICAgICAgICBmb3JlQ29sb3JMaXN0OiBudWxsLCAvLyBmYWxsYmFja3Mgb24gY29sb3JMaXN0XG4gICAgICAgIGJhY2tDb2xvckxpc3Q6IG51bGwsIC8vIGZhbGxiYWNrcyBvbiBjb2xvckxpc3RcbiAgICAgICAgYWxsb3dDdXN0b21Gb3JlQ29sb3I6IHRydWUsXG4gICAgICAgIGFsbG93Q3VzdG9tQmFja0NvbG9yOiB0cnVlLFxuICAgICAgICBkaXNwbGF5QXNMaXN0OiBmYWxzZSxcbiAgICB9O1xuXG4gICAgLy8gQWRkIGFsbCBjb2xvcnMgaW4gdHdvIGRyb3Bkb3duc1xuICAgICQuZXh0ZW5kKHRydWUsICQudHJ1bWJvd3lnLCB7XG4gICAgICAgIHBsdWdpbnM6IHtcbiAgICAgICAgICAgIGNvbG9yOiB7XG4gICAgICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24gKHRydW1ib3d5Zykge1xuICAgICAgICAgICAgICAgICAgICB0cnVtYm93eWcuby5wbHVnaW5zLmNvbG9ycyA9IHRydW1ib3d5Zy5vLnBsdWdpbnMuY29sb3JzIHx8IGRlZmF1bHRPcHRpb25zO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZHJvcGRvd25DbGFzcyA9IHRydW1ib3d5Zy5vLnBsdWdpbnMuY29sb3JzLmRpc3BsYXlBc0xpc3QgPyB0cnVtYm93eWcuby5wcmVmaXggKyAnZHJvcGRvd24tLWNvbG9yLWxpc3QnIDogJyc7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGZvcmVDb2xvckJ0bkRlZiA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyb3Bkb3duOiBidWlsZERyb3Bkb3duKCdmb3JlQ29sb3InLCB0cnVtYm93eWcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZHJvcGRvd25DbGFzczogZHJvcGRvd25DbGFzcyxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgYmFja0NvbG9yQnRuRGVmID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZHJvcGRvd246IGJ1aWxkRHJvcGRvd24oJ2JhY2tDb2xvcicsIHRydW1ib3d5ZyksXG4gICAgICAgICAgICAgICAgICAgICAgICBkcm9wZG93bkNsYXNzOiBkcm9wZG93bkNsYXNzLFxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5hZGRCdG5EZWYoJ2ZvcmVDb2xvcicsIGZvcmVDb2xvckJ0bkRlZik7XG4gICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5hZGRCdG5EZWYoJ2JhY2tDb2xvcicsIGJhY2tDb2xvckJ0bkRlZik7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0YWdIYW5kbGVyOiBjb2xvclRhZ0hhbmRsZXJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gYnVpbGREcm9wZG93bihmbiwgdHJ1bWJvd3lnKSB7XG4gICAgICAgIHZhciBkcm9wZG93biA9IFtdLFxuICAgICAgICAgICAgdHJ1bWJvd3lnQ29sb3JPcHRpb25zID0gdHJ1bWJvd3lnLm8ucGx1Z2lucy5jb2xvcnMsXG4gICAgICAgICAgICBjb2xvckxpc3QgPSB0cnVtYm93eWdDb2xvck9wdGlvbnNbZm4gKyAnTGlzdCddIHx8IHRydW1ib3d5Z0NvbG9yT3B0aW9ucy5jb2xvckxpc3Q7XG5cbiAgICAgICAgJC5lYWNoKGNvbG9yTGlzdCwgZnVuY3Rpb24gKGksIGNvbG9yKSB7XG4gICAgICAgICAgICB2YXIgYnRuID0gZm4gKyBjb2xvcixcbiAgICAgICAgICAgICAgICBidG5EZWYgPSB7XG4gICAgICAgICAgICAgICAgICAgIGZuOiBmbixcbiAgICAgICAgICAgICAgICAgICAgZm9yY2VDc3M6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGhhc0ljb246IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0cnVtYm93eWcubGFuZ1snIycgKyBjb2xvcl0gfHwgKCcjJyArIGNvbG9yKSxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW06ICcjJyArIGNvbG9yLFxuICAgICAgICAgICAgICAgICAgICBzdHlsZTogJ2JhY2tncm91bmQtY29sb3I6ICMnICsgY29sb3IgKyAnOydcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAodHJ1bWJvd3lnQ29sb3JPcHRpb25zLmRpc3BsYXlBc0xpc3QgJiYgZm4gPT09ICdmb3JlQ29sb3InKSB7XG4gICAgICAgICAgICAgICAgYnRuRGVmLnN0eWxlID0gJ2NvbG9yOiAjJyArIGNvbG9yICsgJyAhaW1wb3J0YW50Oyc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRydW1ib3d5Zy5hZGRCdG5EZWYoYnRuLCBidG5EZWYpO1xuICAgICAgICAgICAgZHJvcGRvd24ucHVzaChidG4pO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBSZW1vdmUgY29sb3JcbiAgICAgICAgdmFyIHJlbW92ZUNvbG9yQnV0dG9uTmFtZSA9IGZuICsgJ1JlbW92ZScsXG4gICAgICAgICAgICByZW1vdmVDb2xvckJ0bkRlZiA9IHtcbiAgICAgICAgICAgICAgICBmbjogJ3JlbW92ZUZvcm1hdCcsXG4gICAgICAgICAgICAgICAgaGFzSWNvbjogZmFsc2UsXG4gICAgICAgICAgICAgICAgcGFyYW06IGZuLFxuICAgICAgICAgICAgICAgIHN0eWxlOiAnYmFja2dyb3VuZC1pbWFnZTogdXJsKGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQVFBQUFBRUNBWUFBQUNwOFo1K0FBQUFHMGxFUVZRSVcyTmtRQUFmRUpNUm13Qllob0dCWVF0TUJZb0FBRHppQXAwanRKVGdBQUFBQUVsRlRrU3VRbUNDKTsnXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIGlmICh0cnVtYm93eWdDb2xvck9wdGlvbnMuZGlzcGxheUFzTGlzdCkge1xuICAgICAgICAgICAgcmVtb3ZlQ29sb3JCdG5EZWYuc3R5bGUgPSAnJztcbiAgICAgICAgfVxuXG4gICAgICAgIHRydW1ib3d5Zy5hZGRCdG5EZWYocmVtb3ZlQ29sb3JCdXR0b25OYW1lLCByZW1vdmVDb2xvckJ0bkRlZik7XG4gICAgICAgIGRyb3Bkb3duLnB1c2gocmVtb3ZlQ29sb3JCdXR0b25OYW1lKTtcblxuICAgICAgICAvLyBDdXN0b20gY29sb3JcbiAgICAgICAgaWYgKHRydW1ib3d5Z0NvbG9yT3B0aW9uc1snYWxsb3dDdXN0b20nICsgZm4uY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBmbi5zdWJzdHIoMSldKSB7XG4gICAgICAgICAgICAvLyBhZGQgZnJlZSBjb2xvciBidG5cbiAgICAgICAgICAgIHZhciBmcmVlQ29sb3JCdXR0b25OYW1lID0gZm4gKyAnRnJlZScsXG4gICAgICAgICAgICAgICAgZnJlZUNvbG9yQnRuRGVmID0ge1xuICAgICAgICAgICAgICAgICAgICBmbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLm9wZW5Nb2RhbEluc2VydCh0cnVtYm93eWcubGFuZ1tmbl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGZuLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VDc3M6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnY29sb3InLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICcjRkZGRkZGJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjYWxsYmFja1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICh2YWx1ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLmV4ZWNDbWQoZm4sIHZhbHVlcy5jb2xvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGhhc0ljb246IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnIycsXG4gICAgICAgICAgICAgICAgICAgIC8vIHN0eWxlIGFkanVzdCBmb3IgZGlzcGxheWluZyB0aGUgdGV4dFxuICAgICAgICAgICAgICAgICAgICBzdHlsZTogJ3RleHQtaW5kZW50OiAwOyBsaW5lLWhlaWdodDogMjBweDsgcGFkZGluZzogMCA1cHg7J1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHRydW1ib3d5Zy5hZGRCdG5EZWYoZnJlZUNvbG9yQnV0dG9uTmFtZSwgZnJlZUNvbG9yQnRuRGVmKTtcbiAgICAgICAgICAgIGRyb3Bkb3duLnB1c2goZnJlZUNvbG9yQnV0dG9uTmFtZSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZHJvcGRvd247XG4gICAgfVxufSkoalF1ZXJ5KTtcbiIsIi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiB0cnVtYm93eWcuYmFzZTY0LmpzIHYxLjBcbiAqIEJhc2U2NCBwbHVnaW4gZm9yIFRydW1ib3d5Z1xuICogaHR0cDovL2FsZXgtZC5naXRodWIuY29tL1RydW1ib3d5Z1xuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIEF1dGhvciA6IEN5cmlsIEJpZW5jb3VydCAobGl6YXJkSylcbiAqL1xuXG4oZnVuY3Rpb24gKCQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgaXNTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0eXBlb2YgRmlsZVJlYWRlciAhPT0gJ3VuZGVmaW5lZCc7XG4gICAgfTtcblxuICAgIHZhciBpc1ZhbGlkSW1hZ2UgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICByZXR1cm4gL15kYXRhOmltYWdlXFwvW2Etel0/L2kudGVzdCh0eXBlKTtcbiAgICB9O1xuXG4gICAgJC5leHRlbmQodHJ1ZSwgJC50cnVtYm93eWcsIHtcbiAgICAgICAgbGFuZ3M6IHtcbiAgICAgICAgICAgIC8vIGpzaGludCBjYW1lbGNhc2U6ZmFsc2VcbiAgICAgICAgICAgIGVuOiB7XG4gICAgICAgICAgICAgICAgYmFzZTY0OiAnSW1hZ2UgYXMgYmFzZTY0JyxcbiAgICAgICAgICAgICAgICBmaWxlOiAnRmlsZScsXG4gICAgICAgICAgICAgICAgZXJyRmlsZVJlYWRlck5vdFN1cHBvcnRlZDogJ0ZpbGVSZWFkZXIgaXMgbm90IHN1cHBvcnRlZCBieSB5b3VyIGJyb3dzZXIuJyxcbiAgICAgICAgICAgICAgICBlcnJJbnZhbGlkSW1hZ2U6ICdJbnZhbGlkIGltYWdlIGZpbGUuJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRhOiB7XG4gICAgICAgICAgICAgICAgYmFzZTY0OiAnQmlsbGVkZSBzb20gYmFzZTY0JyxcbiAgICAgICAgICAgICAgICBmaWxlOiAnRmlsJyxcbiAgICAgICAgICAgICAgICBlcnJGaWxlUmVhZGVyTm90U3VwcG9ydGVkOiAnRmlsZVJlYWRlciBlciBpa2tlIHVuZGVyc3TDuHR0ZXQgYWYgZGluIGJyb3dzZXIuJyxcbiAgICAgICAgICAgICAgICBlcnJJbnZhbGlkSW1hZ2U6ICdVZ3lsZGlnIGJpbGxlZGZpbC4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZnI6IHtcbiAgICAgICAgICAgICAgICBiYXNlNjQ6ICdJbWFnZSBlbiBiYXNlNjQnLFxuICAgICAgICAgICAgICAgIGZpbGU6ICdGaWNoaWVyJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNzOiB7XG4gICAgICAgICAgICAgICAgYmFzZTY0OiAnVmxvxb5pdCBvYnLDoXplaycsXG4gICAgICAgICAgICAgICAgZmlsZTogJ1NvdWJvcidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB6aF9jbjoge1xuICAgICAgICAgICAgICAgIGJhc2U2NDogJ+WbvueJh++8iEJhc2U2NOe8luegge+8iScsXG4gICAgICAgICAgICAgICAgZmlsZTogJ+aWh+S7tidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBubDoge1xuICAgICAgICAgICAgICAgIGJhc2U2NDogJ0FmYmVlbGRpbmcgaW5saW5lJyxcbiAgICAgICAgICAgICAgICBmaWxlOiAnQmVzdGFuZCcsXG4gICAgICAgICAgICAgICAgZXJyRmlsZVJlYWRlck5vdFN1cHBvcnRlZDogJ1V3IGJyb3dzZXIgb25kZXJzdGV1bnQgZGV6ZSBmdW5jdGlvbmFsaXRlaXQgbmlldC4nLFxuICAgICAgICAgICAgICAgIGVyckludmFsaWRJbWFnZTogJ0RlIGdla296ZW4gYWZiZWVsZGluZyBpcyBvbmdlbGRpZy4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcnU6IHtcbiAgICAgICAgICAgICAgICBiYXNlNjQ6ICfQmNC30L7QsdGA0LDQttC10L3QuNC1INC60LDQuiDQutC+0LQg0LIgYmFzZTY0JyxcbiAgICAgICAgICAgICAgICBmaWxlOiAn0KTQsNC50LsnLFxuICAgICAgICAgICAgICAgIGVyckZpbGVSZWFkZXJOb3RTdXBwb3J0ZWQ6ICdGaWxlUmVhZGVyINC90LUg0L/QvtC00LTQtdGA0LbQuNCy0LDQtdGC0YHRjyDQstCw0YjQuNC8INCx0YDQsNGD0LfQtdGA0L7QvC4nLFxuICAgICAgICAgICAgICAgIGVyckludmFsaWRJbWFnZTogJ9Cd0LXQtNC+0L/Rg9GB0YLQuNC80YvQuSDRhNCw0LnQuyDQuNC30L7QsdGA0LDQttC10L3QuNGPLidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBqYToge1xuICAgICAgICAgICAgICAgIGJhc2U2NDogJ+eUu+WDjyAoQmFzZTY05b2i5byPKScsXG4gICAgICAgICAgICAgICAgZmlsZTogJ+ODleOCoeOCpOODqycsXG4gICAgICAgICAgICAgICAgZXJyRmlsZVJlYWRlck5vdFN1cHBvcnRlZDogJ+OBguOBquOBn+OBruODluODqeOCpuOCtuODvOOBr0ZpbGVSZWFkZXLjgpLjgrXjg53jg7zjg4jjgZfjgabjgYTjgb7jgZvjgpMnLFxuICAgICAgICAgICAgICAgIGVyckludmFsaWRJbWFnZTogJ+eUu+WDj+W9ouW8j+OBjOato+OBl+OBj+OBguOCiuOBvuOBm+OCkydcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0cjoge1xuICAgICAgICAgICAgICAgIGJhc2U2NDogJ0Jhc2U2NCBvbGFyYWsgcmVzaW0nLFxuICAgICAgICAgICAgICAgIGZpbGU6ICdEb3N5YScsXG4gICAgICAgICAgICAgICAgZXJyRmlsZVJlYWRlck5vdFN1cHBvcnRlZDogJ0ZpbGVSZWFkZXIgdGFyYXnEsWPEsW7EsXogdGFyYWbEsW5kYW4gZGVzdGVrbGVubWl5b3IuJyxcbiAgICAgICAgICAgICAgICBlcnJJbnZhbGlkSW1hZ2U6ICdHZcOnZXJzaXogcmVzaW0gZG9zeWFzxLEuJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHpoX3R3OiB7XG4gICAgICAgICAgICAgICAgYmFzZTY0OiAn5ZyW54mHKGJhc2U2NOe3qOeivCknLFxuICAgICAgICAgICAgICAgIGZpbGU6ICfmqpTmoYgnLFxuICAgICAgICAgICAgICAgIGVyckZpbGVSZWFkZXJOb3RTdXBwb3J0ZWQ6ICfkvaDnmoTngI/opr3lmajkuI3mlK/mj7RGaWxlUmVhZGVyJyxcbiAgICAgICAgICAgICAgICBlcnJJbnZhbGlkSW1hZ2U6ICfkuI3mraPnorrnmoTmqpTmoYjmoLzlvI8nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcHRfYnI6IHtcbiAgICAgICAgICAgICAgICBiYXNlNjQ6ICdJbWFnZW0gZW0gYmFzZTY0JyxcbiAgICAgICAgICAgICAgICBmaWxlOiAnQXJxdWl2bycsXG4gICAgICAgICAgICAgICAgZXJyRmlsZVJlYWRlck5vdFN1cHBvcnRlZDogJ0ZpbGVSZWFkZXIgbsOjbyDDqSBzdXBvcnRhZG8gcGVsbyBzZXUgbmF2ZWdhZG9yLicsXG4gICAgICAgICAgICAgICAgZXJySW52YWxpZEltYWdlOiAnQXJxdWl2byBkZSBpbWFnZW0gaW52w6FsaWRvLidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBrbzoge1xuICAgICAgICAgICAgICAgIGJhc2U2NDogJ+q3uOumvCDrhKPquLAoYmFzZTY0KScsXG4gICAgICAgICAgICAgICAgZmlsZTogJ+2MjOydvCcsXG4gICAgICAgICAgICAgICAgZXJyRmlsZVJlYWRlck5vdFN1cHBvcnRlZDogJ0ZpbGVSZWFkZXLqsIAg7ZiE7J6sIOu4jOudvOyasOyggOulvCDsp4Dsm5DtlZjsp4Ag7JWK7Iq164uI64ukLicsXG4gICAgICAgICAgICAgICAgZXJySW52YWxpZEltYWdlOiAn7Jyg7Zqo7ZWY7KeAIOyViuydgCDtjIzsnbwnXG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICAvLyBqc2hpbnQgY2FtZWxjYXNlOnRydWVcblxuICAgICAgICBwbHVnaW5zOiB7XG4gICAgICAgICAgICBiYXNlNjQ6IHtcbiAgICAgICAgICAgICAgICBzaG91bGRJbml0OiBpc1N1cHBvcnRlZCxcbiAgICAgICAgICAgICAgICBpbml0OiBmdW5jdGlvbiAodHJ1bWJvd3lnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBidG5EZWYgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpc1N1cHBvcnRlZDogaXNTdXBwb3J0ZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBmbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5zYXZlUmFuZ2UoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWxlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkbW9kYWwgPSB0cnVtYm93eWcub3Blbk1vZGFsSW5zZXJ0KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaXRsZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVtYm93eWcubGFuZy5iYXNlNjQsXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRmllbGRzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZmlsZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NlcHQ6ICdpbWFnZS8qJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ2Rlc2NyaXB0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdHJ1bWJvd3lnLmdldFJhbmdlVGV4dCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2FsbGJhY2tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHZhbHVlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmUmVhZGVyLm9ubG9hZGVuZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzVmFsaWRJbWFnZShlLnRhcmdldC5yZXN1bHQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5leGVjQ21kKCdpbnNlcnRJbWFnZScsIGZSZWFkZXIucmVzdWx0LCBmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoWydpbWdbc3JjPVwiJywgZlJlYWRlci5yZXN1bHQsICdcIl06bm90KFthbHRdKSddLmpvaW4oJycpLCB0cnVtYm93eWcuJGJveCkuYXR0cignYWx0JywgdmFsdWVzLmFsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5jbG9zZU1vZGFsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLmFkZEVycm9yT25Nb2RhbEZpZWxkKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnaW5wdXRbdHlwZT1maWxlXScsICRtb2RhbCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVtYm93eWcubGFuZy5lcnJJbnZhbGlkSW1hZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmUmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnaW5wdXRbdHlwZT1maWxlXScpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlID0gZS50YXJnZXQuZmlsZXNbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLmFkZEJ0bkRlZignYmFzZTY0JywgYnRuRGVmKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKGpRdWVyeSk7XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogdHJ1bWJvd3lnLm5vZW1iZWQuanMgdjEuMFxuICogbm9FbWJlZCBwbHVnaW4gZm9yIFRydW1ib3d5Z1xuICogaHR0cDovL2FsZXgtZC5naXRodWIuY29tL1RydW1ib3d5Z1xuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIEF1dGhvciA6IEpha2UgSm9obnMgKGpha2Vqb2hucylcbiAqL1xuXG4oZnVuY3Rpb24gKCQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgICAgIHByb3h5OiAnaHR0cHM6Ly9ub2VtYmVkLmNvbS9lbWJlZD9ub3dyYXA9b24nLFxuICAgICAgICB1cmxGaWxlZDogJ3VybCcsXG4gICAgICAgIGRhdGE6IFtdLFxuICAgICAgICBzdWNjZXNzOiB1bmRlZmluZWQsXG4gICAgICAgIGVycm9yOiB1bmRlZmluZWRcbiAgICB9O1xuXG4gICAgJC5leHRlbmQodHJ1ZSwgJC50cnVtYm93eWcsIHtcbiAgICAgICAgbGFuZ3M6IHtcbiAgICAgICAgICAgIGVuOiB7XG4gICAgICAgICAgICAgICAgbm9lbWJlZDogJ05vZW1iZWQnLFxuICAgICAgICAgICAgICAgIG5vZW1iZWRFcnJvcjogJ0Vycm9yJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRhOiB7XG4gICAgICAgICAgICAgICAgbm9lbWJlZEVycm9yOiAnRmVqbCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzazoge1xuICAgICAgICAgICAgICAgIG5vZW1iZWRFcnJvcjogJ0NoeWJhJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZyOiB7XG4gICAgICAgICAgICAgICAgbm9lbWJlZEVycm9yOiAnRXJyZXVyJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNzOiB7XG4gICAgICAgICAgICAgICAgbm9lbWJlZEVycm9yOiAnQ2h5YmEnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcnU6IHtcbiAgICAgICAgICAgICAgICBub2VtYmVkRXJyb3I6ICfQntGI0LjQsdC60LAnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgamE6IHtcbiAgICAgICAgICAgICAgICBub2VtYmVkRXJyb3I6ICfjgqjjg6njg7wnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdHI6IHtcbiAgICAgICAgICAgICAgICBub2VtYmVkRXJyb3I6ICdIYXRhJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHpoX3R3OiB7XG4gICAgICAgICAgICAgICAgbm9lbWJlZDogJ+aPkuWFpeW9seeJhycsXG4gICAgICAgICAgICAgICAgbm9lbWJlZEVycm9yOiAn6Yyv6KqkJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHB0X2JyOiB7XG4gICAgICAgICAgICAgICAgbm9lbWJlZDogJ0luY29ycG9yYXInLFxuICAgICAgICAgICAgICAgIG5vZW1iZWRFcnJvcjogJ0Vycm8nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAga286IHtcbiAgICAgICAgICAgICAgICBub2VtYmVkOiAnb0VtYmVkIOuEo+q4sCcsXG4gICAgICAgICAgICAgICAgbm9lbWJlZEVycm9yOiAn7JeQ65+sJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcblxuICAgICAgICBwbHVnaW5zOiB7XG4gICAgICAgICAgICBub2VtYmVkOiB7XG4gICAgICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24gKHRydW1ib3d5Zykge1xuICAgICAgICAgICAgICAgICAgICB0cnVtYm93eWcuby5wbHVnaW5zLm5vZW1iZWQgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdE9wdGlvbnMsIHRydW1ib3d5Zy5vLnBsdWdpbnMubm9lbWJlZCB8fCB7fSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGJ0bkRlZiA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRtb2RhbCA9IHRydW1ib3d5Zy5vcGVuTW9kYWxJbnNlcnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRpdGxlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5sYW5nLm5vZW1iZWQsXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRmllbGRzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnVVJMJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENhbGxiYWNrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogdHJ1bWJvd3lnLm8ucGx1Z2lucy5ub2VtYmVkLnByb3h5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVtYm93eWcuby5wbHVnaW5zLm5vZW1iZWQuc3VjY2VzcyB8fCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5odG1sKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVtYm93eWcuZXhlY0NtZCgnaW5zZXJ0SFRNTCcsIGRhdGEuaHRtbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVtYm93eWcuY2xvc2VNb2RhbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMjUwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5hZGRFcnJvck9uTW9kYWxGaWVsZChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCdpbnB1dFt0eXBlPXRleHRdJywgJG1vZGFsKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmVycm9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogdHJ1bWJvd3lnLm8ucGx1Z2lucy5ub2VtYmVkLmVycm9yIHx8IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLmFkZEVycm9yT25Nb2RhbEZpZWxkKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnaW5wdXRbdHlwZT10ZXh0XScsICRtb2RhbCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVtYm93eWcubGFuZy5ub2VtYmVkRXJyb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLmFkZEJ0bkRlZignbm9lbWJlZCcsIGJ0bkRlZik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KShqUXVlcnkpO1xuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIHRydW1ib3d5Zy5wYXN0ZWVtYmVkLmpzIHYxLjBcbiAqIFVybCBwYXN0ZSB0byBpZnJhbWUgd2l0aCBub2VtYmVkLiBQbHVnaW4gZm9yIFRydW1ib3d5Z1xuICogaHR0cDovL2FsZXgtZC5naXRodWIuY29tL1RydW1ib3d5Z1xuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIEF1dGhvciA6IE1heCBTZWVsaWdcbiAqICAgICAgICAgIEZhY2Vib29rIDogaHR0cHM6Ly9mYWNlYm9vay5jb20vbWF4c2VcbiAqICAgICAgICAgIFdlYnNpdGUgOiBodHRwczovL3d3dy5tYXhtYWRlLm5sL1xuICovXG5cbihmdW5jdGlvbigkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGRlZmF1bHRPcHRpb25zID0ge1xuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICBlbmRwb2ludHM6IFtcbiAgICAgICAgICAgICdodHRwczovL25vZW1iZWQuY29tL2VtYmVkP25vd3JhcD1vbicsXG4gICAgICAgICAgICAnaHR0cHM6Ly9hcGkubWF4bWFkZS5ubC91cmwyaWZyYW1lL2VtYmVkJ1xuICAgICAgICBdXG4gICAgfTtcblxuICAgICQuZXh0ZW5kKHRydWUsICQudHJ1bWJvd3lnLCB7XG4gICAgICAgIHBsdWdpbnM6IHtcbiAgICAgICAgICAgIHBhc3RlRW1iZWQ6IHtcbiAgICAgICAgICAgICAgICBpbml0OiBmdW5jdGlvbih0cnVtYm93eWcpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ1bWJvd3lnLm8ucGx1Z2lucy5wYXN0ZUVtYmVkID0gJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRPcHRpb25zLCB0cnVtYm93eWcuby5wbHVnaW5zLnBhc3RlRW1iZWQgfHwge30pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghdHJ1bWJvd3lnLm8ucGx1Z2lucy5wYXN0ZUVtYmVkLmVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5wYXN0ZUhhbmRsZXJzLnB1c2goZnVuY3Rpb24ocGFzdGVFdmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2xpcGJvYXJkRGF0YSA9IChwYXN0ZUV2ZW50Lm9yaWdpbmFsRXZlbnQgfHwgcGFzdGVFdmVudCkuY2xpcGJvYXJkRGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzdGVkRGF0YSA9IGNsaXBib2FyZERhdGEuZ2V0RGF0YSgnVGV4dCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludHMgPSB0cnVtYm93eWcuby5wbHVnaW5zLnBhc3RlRW1iZWQuZW5kcG9pbnRzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0ID0gbnVsbDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXN0ZWREYXRhLnN0YXJ0c1dpdGgoJ2h0dHAnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXN0ZUV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXN0ZUV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBwYXN0ZWREYXRhLnRyaW0oKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSAwO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXF1ZXN0ICYmIHJlcXVlc3QudHJhbnNwb3J0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnRyYW5zcG9ydC5hYm9ydCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdCA9ICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcm9zc09yaWdpbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogZW5kcG9pbnRzW2luZGV4XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogcXVlcnksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb25wJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuaHRtbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSByZXMuaHRtbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCArPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRlbnQubGVuZ3RoID09PSAwICYmIGluZGV4IDwgZW5kcG9pbnRzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cmwgPSBlbmRwb2ludHNbaW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGEgPSBxdWVyeTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5hamF4KHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IGVuZHBvaW50cy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSAkKCc8YT4nLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBocmVmOiBwYXN0ZWREYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogcGFzdGVkRGF0YVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5wcm9wKCdvdXRlckhUTUwnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRlbnQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydW1ib3d5Zy5leGVjQ21kKCdpbnNlcnRIVE1MJywgY29udGVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChjKSB7fVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKGpRdWVyeSk7XG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogdHJ1bWJvd3lnLnRhYmxlLmN1c3RvbS5qcyB2Mi4wXG4gKiBUYWJsZSBwbHVnaW4gZm9yIFRydW1ib3d5Z1xuICogaHR0cDovL2FsZXgtZC5naXRodWIuY29tL1RydW1ib3d5Z1xuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIEF1dGhvciA6IFN2ZW4gRHVuZW1hbm4gW2R1bmVtYW5uQGZvcmVsYWJzLmV1XVxuICovXG5cbihmdW5jdGlvbiAoJCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBkZWZhdWx0T3B0aW9ucyA9IHtcbiAgICAgICAgcm93czogOCxcbiAgICAgICAgY29sdW1uczogOCxcbiAgICAgICAgc3R5bGVyOiAndGFibGUnXG4gICAgfTtcblxuICAgICQuZXh0ZW5kKHRydWUsICQudHJ1bWJvd3lnLCB7XG4gICAgICAgIGxhbmdzOiB7XG4gICAgICAgICAgICAvLyBqc2hpbnQgY2FtZWxjYXNlOmZhbHNlXG4gICAgICAgICAgICBlbjoge1xuICAgICAgICAgICAgICAgIHRhYmxlOiAnSW5zZXJ0IHRhYmxlJyxcbiAgICAgICAgICAgICAgICB0YWJsZUFkZFJvdzogJ0FkZCByb3cnLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkUm93QWJvdmU6ICdBZGQgcm93IGFib3ZlJyxcbiAgICAgICAgICAgICAgICB0YWJsZUFkZENvbHVtbkxlZnQ6ICdBZGQgY29sdW1uIHRvIHRoZSBsZWZ0JyxcbiAgICAgICAgICAgICAgICB0YWJsZUFkZENvbHVtbjogJ0FkZCBjb2x1bW4gdG8gdGhlIHJpZ2h0JyxcbiAgICAgICAgICAgICAgICB0YWJsZURlbGV0ZVJvdzogJ0RlbGV0ZSByb3cnLFxuICAgICAgICAgICAgICAgIHRhYmxlRGVsZXRlQ29sdW1uOiAnRGVsZXRlIGNvbHVtbicsXG4gICAgICAgICAgICAgICAgdGFibGVEZXN0cm95OiAnRGVsZXRlIHRhYmxlJyxcbiAgICAgICAgICAgICAgICBlcnJvcjogJ0Vycm9yJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRhOiB7XG4gICAgICAgICAgICAgICAgdGFibGU6ICdJbmRzw6Z0IHRhYmVsJyxcbiAgICAgICAgICAgICAgICB0YWJsZUFkZFJvdzogJ1RpbGbDuGogcsOma2tlJyxcbiAgICAgICAgICAgICAgICB0YWJsZUFkZFJvd0Fib3ZlOiAnVGlsZsO4aiByw6Zra2UnLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkQ29sdW1uTGVmdDogJ1RpbGbDuGoga29sb25uZScsXG4gICAgICAgICAgICAgICAgdGFibGVBZGRDb2x1bW46ICdUaWxmw7hqIGtvbG9ubmUnLFxuICAgICAgICAgICAgICAgIHRhYmxlRGVsZXRlUm93OiAnU2xldCByw6Zra2UnLFxuICAgICAgICAgICAgICAgIHRhYmxlRGVsZXRlQ29sdW1uOiAnU2xldCBrb2xvbm5lJyxcbiAgICAgICAgICAgICAgICB0YWJsZURlc3Ryb3k6ICdTbGV0IHRhYmVsJyxcbiAgICAgICAgICAgICAgICBlcnJvcjogJ0ZlamwnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGU6IHtcbiAgICAgICAgICAgICAgICB0YWJsZTogJ1RhYmVsbGUgZWluZsO8Z2VuJyxcbiAgICAgICAgICAgICAgICB0YWJsZUFkZFJvdzogJ1plaWxlIGhpbnp1ZsO8Z2VuJyxcbiAgICAgICAgICAgICAgICB0YWJsZUFkZFJvd0Fib3ZlOiAnWmVpbGUgaGluenVmw7xnZW4nLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkQ29sdW1uTGVmdDogJ1NwYWx0ZSBoaW56dWbDvGdlbicsXG4gICAgICAgICAgICAgICAgdGFibGVBZGRDb2x1bW46ICdTcGFsdGUgaGluenVmw7xnZW4nLFxuICAgICAgICAgICAgICAgIHRhYmxlRGVsZXRlUm93OiAnWmVpbGUgbMO2c2NoZW4nLFxuICAgICAgICAgICAgICAgIHRhYmxlRGVsZXRlQ29sdW1uOiAnU3BhbHRlIGzDtnNjaGVuJyxcbiAgICAgICAgICAgICAgICB0YWJsZURlc3Ryb3k6ICdUYWJlbGxlIGzDtnNjaGVuJyxcbiAgICAgICAgICAgICAgICBlcnJvcjogJ0Vycm9yJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNrOiB7XG4gICAgICAgICAgICAgICAgdGFibGU6ICdWeXR2b3JpxaUgdGFidcS+a3knLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkUm93OiAnUHJpZGHFpSByaWFkb2snLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkUm93QWJvdmU6ICdQcmlkYcWlIHJpYWRvaycsXG4gICAgICAgICAgICAgICAgdGFibGVBZGRDb2x1bW5MZWZ0OiAnUHJpZGHFpSBzdMS6cGVjJyxcbiAgICAgICAgICAgICAgICB0YWJsZUFkZENvbHVtbjogJ1ByaWRhxaUgc3TEunBlYycsXG4gICAgICAgICAgICAgICAgZXJyb3I6ICdDaHliYSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmcjoge1xuICAgICAgICAgICAgICAgIHRhYmxlOiAnSW5zw6lyZXIgdW4gdGFibGVhdScsXG4gICAgICAgICAgICAgICAgdGFibGVBZGRSb3c6ICdBam91dGVyIGRlcyBsaWduZXMnLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkUm93QWJvdmU6ICdBam91dGVyIGRlcyBsaWduZXMnLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkQ29sdW1uTGVmdDogJ0Fqb3V0ZXIgZGVzIGNvbG9ubmVzJyxcbiAgICAgICAgICAgICAgICB0YWJsZUFkZENvbHVtbjogJ0Fqb3V0ZXIgZGVzIGNvbG9ubmVzJyxcbiAgICAgICAgICAgICAgICB0YWJsZURlbGV0ZVJvdzogJ0VmZmFjZXIgbGEgbGlnbmUnLFxuICAgICAgICAgICAgICAgIHRhYmxlRGVsZXRlQ29sdW1uOiAnRWZmYWNlciBsYSBjb2xvbm5lJyxcbiAgICAgICAgICAgICAgICB0YWJsZURlc3Ryb3k6ICdFZmZhY2VyIGxlIHRhYmxlYXUnLFxuICAgICAgICAgICAgICAgIGVycm9yOiAnRXJyZXVyJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNzOiB7XG4gICAgICAgICAgICAgICAgdGFibGU6ICdWeXR2b8WZaXQgcMWZw61rYXogVGFibGUnLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkUm93OiAnUMWZaWRhdCDFmcOhZGVrJyxcbiAgICAgICAgICAgICAgICB0YWJsZUFkZFJvd0Fib3ZlOiAnUMWZaWRhdCDFmcOhZGVrJyxcbiAgICAgICAgICAgICAgICB0YWJsZUFkZENvbHVtbkxlZnQ6ICdQxZlpZGF0IHNsb3VwZWMnLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkQ29sdW1uOiAnUMWZaWRhdCBzbG91cGVjJyxcbiAgICAgICAgICAgICAgICBlcnJvcjogJ0NoeWJhJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJ1OiB7XG4gICAgICAgICAgICAgICAgdGFibGU6ICfQktGB0YLQsNCy0LjRgtGMINGC0LDQsdC70LjRhtGDJyxcbiAgICAgICAgICAgICAgICB0YWJsZUFkZFJvdzogJ9CU0L7QsdCw0LLQuNGC0Ywg0YHRgtGA0L7QutGDJyxcbiAgICAgICAgICAgICAgICB0YWJsZUFkZFJvd0Fib3ZlOiAn0JTQvtCx0LDQstC40YLRjCDRgdGC0YDQvtC60YMnLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkQ29sdW1uTGVmdDogJ9CU0L7QsdCw0LLQuNGC0Ywg0YHRgtC+0LvQsdC10YYnLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkQ29sdW1uOiAn0JTQvtCx0LDQstC40YLRjCDRgdGC0L7Qu9Cx0LXRhicsXG4gICAgICAgICAgICAgICAgdGFibGVEZWxldGVSb3c6ICfQo9C00LDQu9C40YLRjCDRgdGC0YDQvtC60YMnLFxuICAgICAgICAgICAgICAgIHRhYmxlRGVsZXRlQ29sdW1uOiAn0KPQtNCw0LvQuNGC0Ywg0YHRgtC+0LvQsdC10YYnLFxuICAgICAgICAgICAgICAgIHRhYmxlRGVzdHJveTogJ9Cj0LTQsNC70LjRgtGMINGC0LDQsdC70LjRhtGDJyxcbiAgICAgICAgICAgICAgICBlcnJvcjogJ9Ce0YjQuNCx0LrQsCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBqYToge1xuICAgICAgICAgICAgICAgIHRhYmxlOiAn6KGo44Gu5oy/5YWlJyxcbiAgICAgICAgICAgICAgICB0YWJsZUFkZFJvdzogJ+ihjOOBrui/veWKoCcsXG4gICAgICAgICAgICAgICAgdGFibGVBZGRSb3dBYm92ZTogJ+ihjOOBrui/veWKoCcsXG4gICAgICAgICAgICAgICAgdGFibGVBZGRDb2x1bW5MZWZ0OiAn5YiX44Gu6L+95YqgJyxcbiAgICAgICAgICAgICAgICB0YWJsZUFkZENvbHVtbjogJ+WIl+OBrui/veWKoCcsXG4gICAgICAgICAgICAgICAgZXJyb3I6ICfjgqjjg6njg7wnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdHI6IHtcbiAgICAgICAgICAgICAgICB0YWJsZTogJ1RhYmxvIGVrbGUnLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkUm93OiAnU2F0xLFyIGVrbGUnLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkUm93QWJvdmU6ICdTYXTEsXIgZWtsZScsXG4gICAgICAgICAgICAgICAgdGFibGVBZGRDb2x1bW5MZWZ0OiAnS29sb24gZWtsZScsXG4gICAgICAgICAgICAgICAgdGFibGVBZGRDb2x1bW46ICdLb2xvbiBla2xlJyxcbiAgICAgICAgICAgICAgICBlcnJvcjogJ0hhdGEnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgemhfdHc6IHtcbiAgICAgICAgICAgICAgICB0YWJsZTogJ+aPkuWFpeihqOagvCcsXG4gICAgICAgICAgICAgICAgdGFibGVBZGRSb3c6ICfliqDlhaXooYwnLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkUm93QWJvdmU6ICfliqDlhaXooYwnLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkQ29sdW1uTGVmdDogJ+WKoOWFpeWIlycsXG4gICAgICAgICAgICAgICAgdGFibGVBZGRDb2x1bW46ICfliqDlhaXliJcnLFxuICAgICAgICAgICAgICAgIHRhYmxlRGVsZXRlUm93OiAn5Yiq6Zmk6KGMJyxcbiAgICAgICAgICAgICAgICB0YWJsZURlbGV0ZUNvbHVtbjogJ+WIqumZpOWIlycsXG4gICAgICAgICAgICAgICAgdGFibGVEZXN0cm95OiAn5Yiq6Zmk6KGo5qC8JyxcbiAgICAgICAgICAgICAgICBlcnJvcjogJ+mMr+iqpCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpZDoge1xuICAgICAgICAgICAgICAgIHRhYmxlOiAnU2lzaXBrYW4gdGFiZWwnLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkUm93OiAnU2lzaXBrYW4gYmFyaXMnLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkUm93QWJvdmU6ICdTaXNpcGthbiBiYXJpcycsXG4gICAgICAgICAgICAgICAgdGFibGVBZGRDb2x1bW5MZWZ0OiAnU2lzaXBrYW4ga29sb20nLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkQ29sdW1uOiAnU2lzaXBrYW4ga29sb20nLFxuICAgICAgICAgICAgICAgIHRhYmxlRGVsZXRlUm93OiAnSGFwdXMgYmFyaXMnLFxuICAgICAgICAgICAgICAgIHRhYmxlRGVsZXRlQ29sdW1uOiAnSGFwdXMga29sb20nLFxuICAgICAgICAgICAgICAgIHRhYmxlRGVzdHJveTogJ0hhcHVzIHRhYmVsJyxcbiAgICAgICAgICAgICAgICBlcnJvcjogJ0dhbGF0J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHB0X2JyOiB7XG4gICAgICAgICAgICAgICAgdGFibGU6ICdJbnNlcmlyIHRhYmVsYScsXG4gICAgICAgICAgICAgICAgdGFibGVBZGRSb3c6ICdBZGljaW9uYXIgbGluaGEnLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkUm93QWJvdmU6ICdBZGljaW9uYXIgbGluaGEnLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkQ29sdW1uTGVmdDogJ0FkaWNpb25hciBjb2x1bmEnLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkQ29sdW1uOiAnQWRpY2lvbmFyIGNvbHVuYScsXG4gICAgICAgICAgICAgICAgdGFibGVEZWxldGVSb3c6ICdEZWxldGFyIGxpbmhhJyxcbiAgICAgICAgICAgICAgICB0YWJsZURlbGV0ZUNvbHVtbjogJ0RlbGV0YXIgY29sdW5hJyxcbiAgICAgICAgICAgICAgICB0YWJsZURlc3Ryb3k6ICdEZWxldGFyIHRhYmVsYScsXG4gICAgICAgICAgICAgICAgZXJyb3I6ICdFcnJvJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGtvOiB7XG4gICAgICAgICAgICAgICAgdGFibGU6ICftkZwg64Sj6riwJyxcbiAgICAgICAgICAgICAgICB0YWJsZUFkZFJvdzogJ+ykhCDstpTqsIAnLFxuICAgICAgICAgICAgICAgIHRhYmxlQWRkUm93QWJvdmU6ICfspIQg7LaU6rCAJyxcbiAgICAgICAgICAgICAgICB0YWJsZUFkZENvbHVtbkxlZnQ6ICfsubgg7LaU6rCAJyxcbiAgICAgICAgICAgICAgICB0YWJsZUFkZENvbHVtbjogJ+y5uCDstpTqsIAnLFxuICAgICAgICAgICAgICAgIHRhYmxlRGVsZXRlUm93OiAn7KSEIOyCreygnCcsXG4gICAgICAgICAgICAgICAgdGFibGVEZWxldGVDb2x1bW46ICfsubgg7IKt7KCcJyxcbiAgICAgICAgICAgICAgICB0YWJsZURlc3Ryb3k6ICftkZwg7KeA7Jqw6riwJyxcbiAgICAgICAgICAgICAgICBlcnJvcjogJ+yXkOufrCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBqc2hpbnQgY2FtZWxjYXNlOnRydWVcbiAgICAgICAgfSxcblxuICAgICAgICBwbHVnaW5zOiB7XG4gICAgICAgICAgICB0YWJsZToge1xuICAgICAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgICAgICAgIHQuby5wbHVnaW5zLnRhYmxlID0gJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRPcHRpb25zLCB0Lm8ucGx1Z2lucy50YWJsZSB8fCB7fSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGJ1aWxkQnV0dG9uRGVmID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnNhdmVSYW5nZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJ0bk5hbWUgPSAndGFibGUnO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRyb3Bkb3duUHJlZml4ID0gdC5vLnByZWZpeCArICdkcm9wZG93bicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyb3Bkb3duT3B0aW9ucyA9IHsgLy8gdGhlIGRyb3Bkb3duXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzczogZHJvcGRvd25QcmVmaXggKyAnLScgKyBidG5OYW1lICsgJyAnICsgZHJvcGRvd25QcmVmaXggKyAnICcgKyB0Lm8ucHJlZml4ICsgJ2ZpeGVkLXRvcCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcm9wZG93bk9wdGlvbnNbJ2RhdGEtJyArIGRyb3Bkb3duUHJlZml4XSA9IGJ0bk5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRkcm9wZG93biA9ICQoJzxkaXYvPicsIGRyb3Bkb3duT3B0aW9ucyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodC4kYm94LmZpbmQoJy4nICsgZHJvcGRvd25QcmVmaXggKyAnLScgKyBidG5OYW1lKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC4kYm94LmFwcGVuZCgkZHJvcGRvd24uaGlkZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZHJvcGRvd24gPSB0LiRib3guZmluZCgnLicgKyBkcm9wZG93blByZWZpeCArICctJyArIGJ0bk5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNsZWFyIGRyb3Bkb3duXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRyb3Bkb3duLmh0bWwoJycpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2hlbiBhY3RpdmUgdGFibGUgc2hvdyBBZGRSb3cgLyBBZGRDb2x1bW5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodC4kYm94LmZpbmQoJy4nICsgdC5vLnByZWZpeCArICd0YWJsZS1idXR0b24nKS5oYXNDbGFzcyh0Lm8ucHJlZml4ICsgJ2FjdGl2ZS1idXR0b24nKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZHJvcGRvd24uYXBwZW5kKHQuYnVpbGRTdWJCdG4oJ3RhYmxlQWRkUm93QWJvdmUnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkcm9wZG93bi5hcHBlbmQodC5idWlsZFN1YkJ0bigndGFibGVBZGRSb3cnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkcm9wZG93bi5hcHBlbmQodC5idWlsZFN1YkJ0bigndGFibGVBZGRDb2x1bW5MZWZ0JykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZHJvcGRvd24uYXBwZW5kKHQuYnVpbGRTdWJCdG4oJ3RhYmxlQWRkQ29sdW1uJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZHJvcGRvd24uYXBwZW5kKHQuYnVpbGRTdWJCdG4oJ3RhYmxlRGVsZXRlUm93JykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZHJvcGRvd24uYXBwZW5kKHQuYnVpbGRTdWJCdG4oJ3RhYmxlRGVsZXRlQ29sdW1uJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZHJvcGRvd24uYXBwZW5kKHQuYnVpbGRTdWJCdG4oJ3RhYmxlRGVzdHJveScpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGVTZWxlY3QgPSAkKCc8dGFibGUvPicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCc8dGJvZHkvPicpLmFwcGVuZFRvKHRhYmxlU2VsZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0Lm8ucGx1Z2lucy50YWJsZS5yb3dzOyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByb3cgPSAkKCc8dHIvPicpLmFwcGVuZFRvKHRhYmxlU2VsZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdC5vLnBsdWdpbnMudGFibGUuY29sdW1uczsgaiArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnPHRkLz4nKS5hcHBlbmRUbyhyb3cpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlU2VsZWN0LmZpbmQoJ3RkJykub24oJ21vdXNlb3ZlcicsIHRhYmxlQW5pbWF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlU2VsZWN0LmZpbmQoJ3RkJykub24oJ21vdXNlZG93bicsIHRhYmxlQnVpbGQpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkcm9wZG93bi5hcHBlbmQodGFibGVTZWxlY3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZHJvcGRvd24uYXBwZW5kKCQoJzxkaXYgY2xhc3M9XCJ0cnVtYm93eWctdGFibGUtc2l6ZVwiPjF4MTwvZGl2PicpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmRyb3Bkb3duKGJ0bk5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZUFuaW1hdGUgPSBmdW5jdGlvbihjb2x1bW5FdmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbiA9ICQoY29sdW1uRXZlbnQudGFyZ2V0KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZSA9IGNvbHVtbi5jbG9zZXN0KCd0YWJsZScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbEluZGV4ID0gdGhpcy5jZWxsSW5kZXgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93SW5kZXggPSB0aGlzLnBhcmVudE5vZGUucm93SW5kZXg7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlc2V0IGFsbCBjb2x1bW5zXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5maW5kKCd0ZCcpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gcm93SW5kZXg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDw9IGNvbEluZGV4OyBqICs9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUuZmluZCgndHI6bnRoLW9mLXR5cGUoJysoaSsxKSsnKScpLmZpbmQoJ3RkOm50aC1vZi10eXBlKCcrKGorMSkrJyknKS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXQgbGFiZWxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLm5leHQoJy50cnVtYm93eWctdGFibGUtc2l6ZScpLmh0bWwoKGNvbEluZGV4KzEpICsgJ3gnICsgKHJvd0luZGV4KzEpKTtcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGVCdWlsZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdC5zYXZlUmFuZ2UoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYmxlciA9ICQoJzx0YWJsZS8+Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCc8dGJvZHkvPicpLmFwcGVuZFRvKHRhYmxlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodC5vLnBsdWdpbnMudGFibGUuc3R5bGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVyLmF0dHIoJ2NsYXNzJywgdC5vLnBsdWdpbnMudGFibGUuc3R5bGVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbEluZGV4ID0gdGhpcy5jZWxsSW5kZXgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93SW5kZXggPSB0aGlzLnBhcmVudE5vZGUucm93SW5kZXg7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IHJvd0luZGV4OyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm93ID0gJCgnPHRyPjwvdHI+JykuYXBwZW5kVG8odGFibGVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8PSBjb2xJbmRleDsgaiArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJzx0ZC8+JykuYXBwZW5kVG8ocm93KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHQucmFuZ2UuZGVsZXRlQ29udGVudHMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHQucmFuZ2UuaW5zZXJ0Tm9kZSh0YWJsZXJbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdC4kYy50cmlnZ2VyKCd0YndjaGFuZ2UnKTtcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgYWRkUm93ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHQubGFuZy50YWJsZUFkZFJvdyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHQubGFuZy50YWJsZUFkZFJvdyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGljbzogJ3Jvdy1iZWxvdycsXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5zYXZlUmFuZ2UoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBub2RlID0gdC5kb2MuZ2V0U2VsZWN0aW9uKCkuZm9jdXNOb2RlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmb2N1c2VkUm93ID0gJChub2RlKS5jbG9zZXN0KCd0cicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZSA9ICQobm9kZSkuY2xvc2VzdCgndGFibGUnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRhYmxlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJvdyA9ICQoJzx0ci8+Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZCBjb2x1bW5zIGFjY29yZGluZyB0byBjdXJyZW50IGNvbHVtbnMgY291bnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0YWJsZS5maW5kKCd0cicpWzBdLmNoaWxkRWxlbWVudENvdW50OyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJzx0ZC8+JykuYXBwZW5kVG8ocm93KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgcm93IHRvIHRhYmxlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvY3VzZWRSb3cuYWZ0ZXIocm93KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnN5bmNDb2RlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGFkZFJvd0Fib3ZlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHQubGFuZy50YWJsZUFkZFJvd0Fib3ZlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdC5sYW5nLnRhYmxlQWRkUm93QWJvdmUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpY286ICdyb3ctYWJvdmUnLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICBmbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuc2F2ZVJhbmdlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IHQuZG9jLmdldFNlbGVjdGlvbigpLmZvY3VzTm9kZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm9jdXNlZFJvdyA9ICQobm9kZSkuY2xvc2VzdCgndHInKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGUgPSAkKG5vZGUpLmNsb3Nlc3QoJ3RhYmxlJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0YWJsZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByb3cgPSAkKCc8dHIvPicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgY29sdW1ucyBhY2NvcmRpbmcgdG8gY3VycmVudCBjb2x1bW5zIGNvdW50XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGFibGUuZmluZCgndHInKVswXS5jaGlsZEVsZW1lbnRDb3VudDsgaSArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCc8dGQvPicpLmFwcGVuZFRvKHJvdyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkIHJvdyB0byB0YWJsZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb2N1c2VkUm93LmJlZm9yZShyb3cpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuc3luY0NvZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgYWRkQ29sdW1uID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHQubGFuZy50YWJsZUFkZENvbHVtbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHQubGFuZy50YWJsZUFkZENvbHVtbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGljbzogJ2NvbC1yaWdodCcsXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5zYXZlUmFuZ2UoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBub2RlID0gdC5kb2MuZ2V0U2VsZWN0aW9uKCkuZm9jdXNOb2RlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmb2N1c2VkQ29sID0gJChub2RlKS5jbG9zZXN0KCd0ZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZSA9ICQobm9kZSkuY2xvc2VzdCgndGFibGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm9jdXNlZENvbElkeCA9IGZvY3VzZWRDb2wuaW5kZXgoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRhYmxlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0YWJsZSkuZmluZCgndHInKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgkKHRoaXMpLmNoaWxkcmVuKClbZm9jdXNlZENvbElkeF0pLmFmdGVyKCc8dGQ+PC90ZD4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5zeW5jQ29kZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBhZGRDb2x1bW5MZWZ0ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHQubGFuZy50YWJsZUFkZENvbHVtbkxlZnQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0LmxhbmcudGFibGVBZGRDb2x1bW5MZWZ0LFxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvOiAnY29sLWxlZnQnLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICBmbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuc2F2ZVJhbmdlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IHQuZG9jLmdldFNlbGVjdGlvbigpLmZvY3VzTm9kZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm9jdXNlZENvbCA9ICQobm9kZSkuY2xvc2VzdCgndGQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGUgPSAkKG5vZGUpLmNsb3Nlc3QoJ3RhYmxlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZvY3VzZWRDb2xJZHggPSBmb2N1c2VkQ29sLmluZGV4KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0YWJsZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGFibGUpLmZpbmQoJ3RyJykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJCh0aGlzKS5jaGlsZHJlbigpW2ZvY3VzZWRDb2xJZHhdKS5iZWZvcmUoJzx0ZD48L3RkPicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnN5bmNDb2RlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGRlc3Ryb3kgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogdC5sYW5nLnRhYmxlRGVzdHJveSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHQubGFuZy50YWJsZURlc3Ryb3ksXG4gICAgICAgICAgICAgICAgICAgICAgICBpY286ICd0YWJsZS1kZWxldGUnLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICBmbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuc2F2ZVJhbmdlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IHQuZG9jLmdldFNlbGVjdGlvbigpLmZvY3VzTm9kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUgPSAkKG5vZGUpLmNsb3Nlc3QoJ3RhYmxlJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5yZW1vdmUoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuc3luY0NvZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgZGVsZXRlUm93ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHQubGFuZy50YWJsZURlbGV0ZVJvdyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHQubGFuZy50YWJsZURlbGV0ZVJvdyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGljbzogJ3Jvdy1kZWxldGUnLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICBmbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuc2F2ZVJhbmdlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IHQuZG9jLmdldFNlbGVjdGlvbigpLmZvY3VzTm9kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93ID0gJChub2RlKS5jbG9zZXN0KCd0cicpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93LnJlbW92ZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5zeW5jQ29kZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBkZWxldGVDb2x1bW4gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogdC5sYW5nLnRhYmxlRGVsZXRlQ29sdW1uLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdC5sYW5nLnRhYmxlRGVsZXRlQ29sdW1uLFxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvOiAnY29sLWRlbGV0ZScsXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5zYXZlUmFuZ2UoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBub2RlID0gdC5kb2MuZ2V0U2VsZWN0aW9uKCkuZm9jdXNOb2RlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZSA9ICQobm9kZSkuY2xvc2VzdCgndGFibGUnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGQgPSAkKG5vZGUpLmNsb3Nlc3QoJ3RkJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxJbmRleCA9IHRkLmluZGV4KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRhYmxlKS5maW5kKCd0cicpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuZmluZCgndGQ6ZXEoJyArIGNlbGxJbmRleCArICcpJykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnN5bmNDb2RlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgdC5hZGRCdG5EZWYoJ3RhYmxlJywgYnVpbGRCdXR0b25EZWYpO1xuICAgICAgICAgICAgICAgICAgICB0LmFkZEJ0bkRlZigndGFibGVBZGRSb3dBYm92ZScsIGFkZFJvd0Fib3ZlKTtcbiAgICAgICAgICAgICAgICAgICAgdC5hZGRCdG5EZWYoJ3RhYmxlQWRkUm93JywgYWRkUm93KTtcbiAgICAgICAgICAgICAgICAgICAgdC5hZGRCdG5EZWYoJ3RhYmxlQWRkQ29sdW1uTGVmdCcsIGFkZENvbHVtbkxlZnQpO1xuICAgICAgICAgICAgICAgICAgICB0LmFkZEJ0bkRlZigndGFibGVBZGRDb2x1bW4nLCBhZGRDb2x1bW4pO1xuICAgICAgICAgICAgICAgICAgICB0LmFkZEJ0bkRlZigndGFibGVEZWxldGVSb3cnLCBkZWxldGVSb3cpO1xuICAgICAgICAgICAgICAgICAgICB0LmFkZEJ0bkRlZigndGFibGVEZWxldGVDb2x1bW4nLCBkZWxldGVDb2x1bW4pO1xuICAgICAgICAgICAgICAgICAgICB0LmFkZEJ0bkRlZigndGFibGVEZXN0cm95JywgZGVzdHJveSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KShqUXVlcnkpO1xuIl19
