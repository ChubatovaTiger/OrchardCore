@using OrchardCore.Forms.Models
@model ShapeViewModel<ValidationRulePart>
@{
    var type =  Model.Value.Type;
    var option = Html.Raw(Model.Value.Option);

    var formElementPart = Model.Value.ContentItem.As<FormElementPart>();
    var elementId = formElementPart.Id;
}

<script asp-src="~/OrchardCore.Forms/Scripts/validator.min.js" debug-src="~/OrchardCore.Forms/Scripts/validator.js" asp-name="validator" depends-on="jQuery" at="Foot" ></script>

<script at="Foot">
    var type = '@type';
    if (type != "none") {
        var elementId = '#' + '@elementId';
        var option = JSON.parse('@option');
        var validateElementId = elementId + type;
        $(elementId).bind("keyup", function (e) {
            var re = window.validator['@type']($(elementId).val(), option);
            var docEle = document.getElementById(validateElementId);
            if (re) {
                if (docEle) {
                    $(elementId).parent().parent().parent().find(":submit").removeAttr('disabled');
                    docEle.remove();
                }
            } else {
                if (!docEle) {
                    var dangerTexgt = "<p id='" + validateElementId + "' class='text-danger'>Validate " + "@type" + " failed.<p>";
                    $(elementId).after(dangerTexgt);
                    $(elementId).parent().parent().parent().find(":submit").attr('disabled', 'true');
                }

            }

        })
    }
</script>

