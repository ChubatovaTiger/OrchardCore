var initialized,mediaApp,root={name:"Media Library",path:"",folder:"",isDirectory:!0},bus=new Vue;function initializeMediaApplication(t,e){initialized||(initialized=!0,e||console.error("mediaApplicationUrl variable is not defined"),$.ajax({url:e,method:"GET",success:function(e){$(".ta-content").append(e),$(document).trigger("mediaapplication:ready"),mediaApp=new Vue({el:"#mediaApp",data:{selectedFolder:root,mediaItems:[],selectedMedia:null,selectedMedias:[],errors:[],dragDropThumbnail:new Image,smallThumbs:!1},created:function(){var r=this;this.dragDropThumbnail.src="../Images/drag-thumbnail.png",bus.$on("folderSelected",function(e){r.selectedFolder=e}),bus.$on("folderDeleted",function(){r.selectRoot()}),bus.$on("folderAdded",function(e){(r.selectedFolder=e).selected=!0}),bus.$on("beforeFolderAdded",function(e){r.loadFolder(e)}),bus.$on("mediaListMoved",function(e){r.loadFolder(r.selectedFolder),e&&r.errors.push(e)}),bus.$on("mediaRenamed",function(e,t,i){var n=r.mediaItems.filter(function(e){return e.mediaPath===i})[0];n.mediaPath=t,n.name=e}),this.currentPrefs=JSON.parse(localStorage.getItem("mediaPreferences"))},computed:{isHome:function(){return this.selectedFolder==root},parents:function(){var e=[];for(parent=this.selectedFolder;parent&&""!=parent.path;)e.unshift(parent),parent=parent.parent;return e},root:function(){return root},thumbSize:function(){return this.smallThumbs?120:240},currentPrefs:{get:function(){return{smallThumbs:this.smallThumbs,selectedFolder:this.selectedFolder}},set:function(e){e&&(this.smallThumbs=e.smallThumbs,this.selectedFolder=e.selectedFolder)}}},watch:{currentPrefs:function(e){localStorage.setItem("mediaPreferences",JSON.stringify(e))},selectedFolder:function(e){this.selectedFolder=e,this.loadFolder(e)}},mounted:function(){this.$refs.rootFolder.toggle()},methods:{uploadUrl:function(){return this.selectedFolder?$("#uploadFiles").val()+"?path="+encodeURIComponent(this.selectedFolder.path):null},selectRoot:function(){this.selectedFolder=this.root},loadFolder:function(e){this.errors=[],this.selectedMedia=null;var t=this;$.ajax({url:$("#getMediaItemsUrl").val()+"?path="+encodeURIComponent(e.path),method:"GET",success:function(e){e.forEach(function(e){e.open=!1}),t.mediaItems=e,t.selectedMedias=[]},error:function(e){console.error(e.responseText)}})},selectMedia:function(e){this.selectedMedia=e},selectAll:function(){this.selectedMedias=[];for(var e=0;e<this.mediaItems.length;e++)this.selectedMedias.push(this.mediaItems[e])},unSelectAll:function(){this.selectedMedias=[]},invertSelection:function(){for(var e=[],t=0;t<this.mediaItems.length;t++)0==this.isMediaSelected(this.mediaItems[t])&&e.push(this.mediaItems[t]);this.selectedMedias=e},toggleSelectionOfMedia:function(e){1==this.isMediaSelected(e)?this.selectedMedias.splice(this.selectedMedias.indexOf(e),1):this.selectedMedias.push(e)},isMediaSelected:function(n){return this.selectedMedias.some(function(e,t,i){return e.url.toLowerCase()===n.url.toLowerCase()})},deleteFolder:function(){var t=this.selectedFolder;t!=this.root.model&&confirm($("#deleteFolderMessage").val())&&$.ajax({url:$("#deleteFolderUrl").val()+"?path="+encodeURIComponent(t.path),method:"POST",data:{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val()},success:function(e){bus.$emit("deleteFolder",t)},error:function(e){console.error(e.responseText)}})},createFolder:function(){$("#createFolderModal-errors").empty(),$("#createFolderModal").modal("show"),$("#createFolderModal .modal-body input").val("").focus()},renameMedia:function(e){$("#renameMediaModal-errors").empty(),$("#renameMediaModal").modal("show"),$("#old-item-name").val(e.name),$("#renameMediaModal .modal-body input").val(e.name).focus()},selectAndDeleteMedia:function(e){this.selectedMedia=e,this.deleteMedia()},deleteMedia:function(){var i=this.selectedMedia,n=this;i&&confirm($("#deleteMediaMessage").val())&&$.ajax({url:$("#deleteMediaUrl").val()+"?path="+encodeURIComponent(n.selectedMedia.mediaPath),method:"POST",data:{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val()},success:function(e){var t=n.mediaItems&&n.mediaItems.indexOf(i);-1<t&&(n.mediaItems.splice(t,1),bus.$emit("mediaDeleted",i)),n.selectedMedia=null},error:function(e){console.error(e.responseText)}})},deleteMediaList:function(){var e=this.selectedMedias,n=this;if(!(e.length<1)&&confirm($("#deleteMediaMessage").val())){for(var t=[],i=0;i<e.length;i++)t.push(e[i].mediaPath);$.ajax({url:$("#deleteMediaListUrl").val(),method:"POST",data:{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val(),paths:t},success:function(e){for(var t=0;t<n.selectedMedias.length;t++){var i=n.mediaItems&&n.mediaItems.indexOf(n.selectedMedias[t]);-1<i&&(n.mediaItems.splice(i,1),bus.$emit("mediaDeleted",n.selectedMedias[t]))}n.selectedMedias=[]},error:function(e){console.error(e.responseText)}})}},handleDragStart:function(e,t){var i=[];this.selectedMedias.forEach(function(e){i.push(e.name)}),0==this.isMediaSelected(e)&&(i.push(e.name),this.selectedMedias.push(e)),t.dataTransfer.setData("mediaNames",JSON.stringify(i)),t.dataTransfer.setData("sourceFolder",this.selectedFolder.path),t.dataTransfer.setDragImage(this.dragDropThumbnail,10,10),t.dataTransfer.effectAllowed="move"}}}),$("#create-folder-name").keypress(function(e){if(13==e.which)return $("#modalFooterOk").click(),!1}),$("#modalFooterOk").on("click",function(e){var t=$("#create-folder-name").val();""!==t&&$.ajax({url:$("#createFolderUrl").val()+"?path="+encodeURIComponent(mediaApp.selectedFolder.path)+"&name="+encodeURIComponent(t),method:"POST",data:{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val()},success:function(e){bus.$emit("addFolder",mediaApp.selectedFolder,e),$("#createFolderModal").modal("hide")},error:function(e){$("#createFolderModal-errors").empty(),$('<div class="alert alert-danger" role="alert"></div>').text(e.responseText).appendTo($("#createFolderModal-errors"))}})}),$("#renameMediaModalFooterOk").on("click",function(e){var t=$("#new-item-name").val(),i=$("#old-item-name").val();if(""!==t){var n=mediaApp.selectedFolder.path+"/";"/"===n&&(n="");var r=n+t,o=n+i;r.toLowerCase()!==o.toLowerCase()?$.ajax({url:$("#renameMediaUrl").val()+"?oldPath="+encodeURIComponent(o)+"&newPath="+encodeURIComponent(r),method:"POST",data:{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val()},success:function(e){$("#renameMediaModal").modal("hide"),bus.$emit("mediaRenamed",t,r,o)},error:function(e){$("#renameMediaModal-errors").empty(),$('<div class="alert alert-danger" role="alert"></div>').text(e.responseText).appendTo($("#renameMediaModal-errors"))}}):$("#renameMediaModal").modal("hide")}}),t&&(document.getElementById("mediaApp").style.display=""),$(document).trigger("mediaApp:ready")},error:function(e){console.error(e.responseText)}}))}$(document).on("mediaApp:ready",function(){$("#fileupload").fileupload({dataType:"json",url:$("#uploadFiles").val(),formData:function(){var e=$("input[name=__RequestVerificationToken]").val();return[{name:"path",value:mediaApp.selectedFolder.path},{name:"__RequestVerificationToken",value:e}]},done:function(e,t){$.each(t.result.files,function(e,t){mediaApp.mediaItems.push(t)}),$("#progress .progress-bar").css("width","0%")}})}),Vue.component("folder",{template:'        <li :class="{selected: isSelected}" v-on:dragenter.prevent="handleDragEnter($event);" v-on:dragleave.prevent="handleDragLeave($event);" ondragover="event.preventDefault();" v-on:drop.stop="moveMediaToFolder(model, $event)" >            <div>                <a href="javascript:;" v-on:click="toggle" class="expand" v-bind:class="{opened: open, closed: !open, empty: empty}"><i class="fas fa-caret-right"></i></a>                <a href="javascript:;" v-on:click="select" draggable="false" >                    <i class="folder fa fa-folder"></i>                    {{model.name}}                </a>            </div>            <ol v-show="open">                <folder v-for="folder in children"                        :key="folder.path"                        :model="folder"                         :selected-in-media-app="selectedInMediaApp">                </folder>            </ol>        </li>        ',props:{model:Object,selectedInMediaApp:Object},data:function(){return{open:!1,children:null,parent:null}},computed:{empty:function(){return this.children&&0==this.children.length},isSelected:function(){return this.selectedInMediaApp.name==this.model.name&&this.selectedInMediaApp.path==this.model.path}},mounted:function(){0==this.isRoot()&&this.isAncestorOfSelectedFolder()&&this.toggle()},created:function(){var i=this;bus.$on("deleteFolder",function(e){if(i.children){var t=i.children&&i.children.indexOf(e);-1<t&&(i.children.splice(t,1),bus.$emit("folderDeleted"))}}),bus.$on("addFolder",function(e,t){i.model==e&&(bus.$emit("beforeFolderAdded",i.model),null!==i.children&&i.children.push(t),t.parent=i.model,bus.$emit("folderAdded",t))})},methods:{isRoot:function(){return""===this.model.path},isAncestorOfSelectedFolder:function(){return-1<mediaApp.selectedFolder.path.indexOf(this.model.path)},toggle:function(){this.open=!this.open;var t=this;this.open&&!this.children&&$.ajax({url:$("#getFoldersUrl").val()+"?path="+encodeURIComponent(t.model.path),method:"GET",success:function(e){t.children=e,t.children.forEach(function(e){e.parent=t.model})},error:function(e){emtpy=!1,console.error(e.responseText)}})},select:function(){bus.$emit("folderSelected",this.model)},handleDragEnter:function(e){!1===e.target.classList.contains("folder-dragover")&&e.target.classList.add("folder-dragover")},handleDragLeave:function(e){!0===e.target.classList.contains("folder-dragover")&&e.target.classList.remove("folder-dragover")},moveMediaToFolder:function(e,t){!0===t.target.classList.contains("folder-dragover")&&t.target.classList.remove("folder-dragover");var i=JSON.parse(t.dataTransfer.getData("mediaNames"));if(!(i.length<1)){var n=t.dataTransfer.getData("sourceFolder"),r=e.path;""===n&&(n="root"),""===r&&(r="root"),n!==r?confirm($("#moveMediaMessage").val())&&$.ajax({url:$("#moveMediaListUrl").val(),method:"POST",data:{__RequestVerificationToken:$("input[name='__RequestVerificationToken']").val(),mediaNames:i,sourceFolder:n,targetFolder:r},success:function(){bus.$emit("mediaListMoved")},error:function(e){console.error(e.responseText),bus.$emit("mediaListMoved",e.responseText)}}):alert($("#sameFolderMessage").val())}}}}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery-ui/ui/widget"],e):"object"==typeof exports?e(require("jquery"),require("./vendor/jquery.ui.widget")):e(window.jQuery)}(function(v){"use strict";function e(i){var n="dragover"===i;return function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var t=e.dataTransfer;t&&-1!==v.inArray("Files",t.types)&&!1!==this._trigger(i,v.Event(i,{delegatedEvent:e}))&&(e.preventDefault(),n&&(t.dropEffect="copy"))}}v.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||v('<input type="file">').prop("disabled")),v.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),v.support.xhrFormDataFileUpload=!!window.FormData,v.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),v.widget("blueimp.fileupload",{options:{dropZone:v(document),pasteZone:void 0,fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(i,e){return i=this.messages[i]||i.toString(),e&&v.each(e,function(e,t){i=i.replace("{"+e+"}",t)}),i},formData:function(e){return e.serializeArray()},add:function(e,t){if(e.isDefaultPrevented())return!1;(t.autoUpload||!1!==t.autoUpload&&v(this).fileupload("option","autoUpload"))&&t.process().done(function(){t.submit()})},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:v.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,i){var n=e-this.timestamp;return(!this.bitrate||!i||i<n)&&(this.bitrate=(t-this.loaded)*(1e3/n)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(e){return!e.forceIframeTransport&&(!e.multipart&&v.support.xhrFileUpload||v.support.xhrFormDataFileUpload)},_getFormData:function(e){var i;return"function"===v.type(e.formData)?e.formData(e.form):v.isArray(e.formData)?e.formData:"object"===v.type(e.formData)?(i=[],v.each(e.formData,function(e,t){i.push({name:e,value:t})}),i):[]},_getTotal:function(e){var i=0;return v.each(e,function(e,t){i+=t.size||1}),i},_initProgressObject:function(e){var t={loaded:0,total:0,bitrate:0};e._progress?v.extend(e._progress,t):e._progress=t},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(e,t){if(e.lengthComputable){var i,n=Date.now?Date.now():(new Date).getTime();if(t._time&&t.progressInterval&&n-t._time<t.progressInterval&&e.loaded!==e.total)return;t._time=n,i=Math.floor(e.loaded/e.total*(t.chunkSize||t._progress.total))+(t.uploadedBytes||0),this._progress.loaded+=i-t._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(n,this._progress.loaded,t.bitrateInterval),t._progress.loaded=t.loaded=i,t._progress.bitrate=t.bitrate=t._bitrateTimer.getBitrate(n,i,t.bitrateInterval),this._trigger("progress",v.Event("progress",{delegatedEvent:e}),t),this._trigger("progressall",v.Event("progressall",{delegatedEvent:e}),this._progress)}},_initProgressListener:function(i){var n=this,e=i.xhr?i.xhr():v.ajaxSettings.xhr();e.upload&&(v(e.upload).bind("progress",function(e){var t=e.originalEvent;e.lengthComputable=t.lengthComputable,e.loaded=t.loaded,e.total=t.total,n._onProgress(e,i)}),i.xhr=function(){return e})},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(i){var n,r=this,e=i.files[0],t=i.multipart||!v.support.xhrFileUpload,o="array"===v.type(i.paramName)?i.paramName[0]:i.paramName;i.headers=v.extend({},i.headers),i.contentRange&&(i.headers["Content-Range"]=i.contentRange),t&&!i.blob&&this._isInstanceOf("File",e)||(i.headers["Content-Disposition"]='attachment; filename="'+encodeURI(e.name)+'"'),t?v.support.xhrFormDataFileUpload&&(i.postMessage?(n=this._getFormData(i),i.blob?n.push({name:o,value:i.blob}):v.each(i.files,function(e,t){n.push({name:"array"===v.type(i.paramName)&&i.paramName[e]||o,value:t})})):(r._isInstanceOf("FormData",i.formData)?n=i.formData:(n=new FormData,v.each(this._getFormData(i),function(e,t){n.append(t.name,t.value)})),i.blob?n.append(o,i.blob,e.name):v.each(i.files,function(e,t){(r._isInstanceOf("File",t)||r._isInstanceOf("Blob",t))&&n.append("array"===v.type(i.paramName)&&i.paramName[e]||o,t,t.uploadName||t.name)})),i.data=n):(i.contentType=e.type||"application/octet-stream",i.data=i.blob||e),i.blob=null},_initIframeSettings:function(e){var t=v("<a></a>").prop("href",e.url).prop("host");e.dataType="iframe "+(e.dataType||""),e.formData=this._getFormData(e),e.redirect&&t&&t!==location.host&&e.formData.push({name:e.redirectParamName||"redirect",value:e.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(e){var t=v(e.fileInput),n=e.paramName;return n?v.isArray(n)||(n=[n]):(n=[],t.each(function(){for(var e=v(this),t=e.prop("name")||"files[]",i=(e.prop("files")||[1]).length;i;)n.push(t),i-=1}),n.length||(n=[t.prop("name")||"files[]"])),n},_initFormSettings:function(e){e.form&&e.form.length||(e.form=v(e.fileInput.prop("form")),e.form.length||(e.form=v(this.options.fileInput.prop("form")))),e.paramName=this._getParamName(e),e.url||(e.url=e.form.prop("action")||location.href),e.type=(e.type||"string"===v.type(e.form.prop("method"))&&e.form.prop("method")||"").toUpperCase(),"POST"!==e.type&&"PUT"!==e.type&&"PATCH"!==e.type&&(e.type="POST"),e.formAcceptCharset||(e.formAcceptCharset=e.form.attr("accept-charset"))},_getAJAXSettings:function(e){var t=v.extend({},this.options,e);return this._initFormSettings(t),this._initDataSettings(t),t},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(e,t,i){var n=v.Deferred(),r=n.promise();return t=t||this.options.context||r,!0===e?n.resolveWith(t,i):!1===e&&n.rejectWith(t,i),r.abort=n.promise,this._enhancePromise(r)},_addConvenienceMethods:function(e,i){var n=this,r=function(e){return v.Deferred().resolveWith(n,e).promise()};i.process=function(e,t){return(e||t)&&(i._processQueue=this._processQueue=(this._processQueue||r([this])).then(function(){return i.errorThrown?v.Deferred().rejectWith(n,[i]).promise():r(arguments)}).then(e,t)),this._processQueue||r([this])},i.submit=function(){return"pending"!==this.state()&&(i.jqXHR=this.jqXHR=!1!==n._trigger("submit",v.Event("submit",{delegatedEvent:e}),this)&&n._onSend(e,this)),this.jqXHR||n._getXHRPromise()},i.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",n._trigger("fail",null,this),n._getXHRPromise(!1))},i.state=function(){return this.jqXHR?n._getDeferredState(this.jqXHR):this._processQueue?n._getDeferredState(this._processQueue):void 0},i.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===n._getDeferredState(this._processQueue)},i.progress=function(){return this._progress},i.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),i=t&&t.split("-"),n=i&&1<i.length&&parseInt(i[1],10);return n&&n+1},_chunkedUpload:function(o,e){o.uploadedBytes=o.uploadedBytes||0;var t,a,s=this,i=o.files[0],l=i.size,d=o.uploadedBytes,c=o.maxChunkSize||l,p=this._blobSlice,u=v.Deferred(),n=u.promise();return!(!(this._isXHRUpload(o)&&p&&(d||c<l))||o.data)&&(!!e||(l<=d?(i.error=o.i18n("uploadedBytes"),this._getXHRPromise(!1,o.context,[null,"error",i.error])):(a=function(){var n=v.extend({},o),r=n._progress.loaded;n.blob=p.call(i,d,d+c,i.type),n.chunkSize=n.blob.size,n.contentRange="bytes "+d+"-"+(d+n.chunkSize-1)+"/"+l,s._initXHRData(n),s._initProgressListener(n),t=(!1!==s._trigger("chunksend",null,n)&&v.ajax(n)||s._getXHRPromise(!1,n.context)).done(function(e,t,i){d=s._getUploadedBytes(i)||d+n.chunkSize,r+n.chunkSize-n._progress.loaded&&s._onProgress(v.Event("progress",{lengthComputable:!0,loaded:d-n.uploadedBytes,total:d-n.uploadedBytes}),n),o.uploadedBytes=n.uploadedBytes=d,n.result=e,n.textStatus=t,n.jqXHR=i,s._trigger("chunkdone",null,n),s._trigger("chunkalways",null,n),d<l?a():u.resolveWith(n.context,[e,t,i])}).fail(function(e,t,i){n.jqXHR=e,n.textStatus=t,n.errorThrown=i,s._trigger("chunkfail",null,n),s._trigger("chunkalways",null,n),u.rejectWith(n.context,[e,t,i])})},this._enhancePromise(n),n.abort=function(){return t.abort()},a(),n)))},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(e,t,i,n){var r=n._progress.total,o=n._response;n._progress.loaded<r&&this._onProgress(v.Event("progress",{lengthComputable:!0,loaded:r,total:r}),n),o.result=n.result=e,o.textStatus=n.textStatus=t,o.jqXHR=n.jqXHR=i,this._trigger("done",null,n)},_onFail:function(e,t,i,n){var r=n._response;n.recalculateProgress&&(this._progress.loaded-=n._progress.loaded,this._progress.total-=n._progress.total),r.jqXHR=n.jqXHR=e,r.textStatus=n.textStatus=t,r.errorThrown=n.errorThrown=i,this._trigger("fail",null,n)},_onAlways:function(e,t,i,n){this._trigger("always",null,n)},_onSend:function(e,t){t.submit||this._addConvenienceMethods(e,t);var i,n,r,o,a=this,s=a._getAJAXSettings(t),l=function(){return a._sending+=1,s._bitrateTimer=new a._BitrateTimer,i=i||((n||!1===a._trigger("send",v.Event("send",{delegatedEvent:e}),s))&&a._getXHRPromise(!1,s.context,n)||a._chunkedUpload(s)||v.ajax(s)).done(function(e,t,i){a._onDone(e,t,i,s)}).fail(function(e,t,i){a._onFail(e,t,i,s)}).always(function(e,t,i){if(a._onAlways(e,t,i,s),a._sending-=1,a._active-=1,s.limitConcurrentUploads&&s.limitConcurrentUploads>a._sending)for(var n=a._slots.shift();n;){if("pending"===a._getDeferredState(n)){n.resolve();break}n=a._slots.shift()}0===a._active&&a._trigger("stop")})};return this._beforeSend(e,s),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(1<this.options.limitConcurrentUploads?(r=v.Deferred(),this._slots.push(r),o=r.then(l)):(this._sequence=this._sequence.then(l,l),o=this._sequence),o.abort=function(){return n=[void 0,"abort","abort"],i?i.abort():(r&&r.rejectWith(s.context,n),l())},this._enhancePromise(o)):l()},_onAdd:function(n,r){var o,e,a,t,s=this,l=!0,i=v.extend({},this.options,r),d=r.files,c=d.length,p=i.limitMultiFileUploads,u=i.limitMultiFileUploadSize,f=i.limitMultiFileUploadSizeOverhead,h=0,m=this._getParamName(i),g=0;if(!c)return!1;if(u&&void 0===d[0].size&&(u=void 0),(i.singleFileUploads||p||u)&&this._isXHRUpload(i))if(i.singleFileUploads||u||!p)if(!i.singleFileUploads&&u)for(a=[],o=[],t=0;t<c;t+=1)h+=d[t].size+f,(t+1===c||h+d[t+1].size+f>u||p&&p<=t+1-g)&&(a.push(d.slice(g,t+1)),(e=m.slice(g,t+1)).length||(e=m),o.push(e),g=t+1,h=0);else o=m;else for(a=[],o=[],t=0;t<c;t+=p)a.push(d.slice(t,t+p)),(e=m.slice(t,t+p)).length||(e=m),o.push(e);else a=[d],o=[m];return r.originalFiles=d,v.each(a||d,function(e,t){var i=v.extend({},r);return i.files=a?t:[t],i.paramName=o[e],s._initResponseObject(i),s._initProgressObject(i),s._addConvenienceMethods(n,i),l=s._trigger("add",v.Event("add",{delegatedEvent:n}),i)}),l},_replaceFileInput:function(e){var i=e.fileInput,n=i.clone(!0),t=i.is(document.activeElement);e.fileInputClone=n,v("<form></form>").append(n)[0].reset(),i.after(n).detach(),t&&n.focus(),v.cleanData(i.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,t){return t===i[0]?n[0]:t}),i[0]===this.element[0]&&(this.element=n)},_handleFileTreeEntry:function(i,n){var e,r=this,o=v.Deferred(),a=[],s=function(e){e&&!e.entry&&(e.entry=i),o.resolve([e])},l=function(){e.readEntries(function(e){var t;e.length?(a=a.concat(e),l()):(t=a,r._handleFileTreeEntries(t,n+i.name+"/").done(function(e){o.resolve(e)}).fail(s))},s)};return n=n||"",i.isFile?i._file?(i._file.relativePath=n,o.resolve(i._file)):i.file(function(e){e.relativePath=n,o.resolve(e)},s):i.isDirectory?(e=i.createReader(),l()):o.resolve([]),o.promise()},_handleFileTreeEntries:function(e,t){var i=this;return v.when.apply(v,v.map(e,function(e){return i._handleFileTreeEntry(e,t)})).then(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(e){var t=(e=e||{}).items;return t&&t.length&&(t[0].webkitGetAsEntry||t[0].getAsEntry)?this._handleFileTreeEntries(v.map(t,function(e){var t;return e.webkitGetAsEntry?((t=e.webkitGetAsEntry())&&(t._file=e.getAsFile()),t):e.getAsEntry()})):v.Deferred().resolve(v.makeArray(e.files)).promise()},_getSingleFileInputFiles:function(e){var t,i,n=(e=v(e)).prop("webkitEntries")||e.prop("entries");if(n&&n.length)return this._handleFileTreeEntries(n);if((t=v.makeArray(e.prop("files"))).length)void 0===t[0].name&&t[0].fileName&&v.each(t,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(!(i=e.prop("value")))return v.Deferred().resolve([]).promise();t=[{name:i.replace(/^.*\\/,"")}]}return v.Deferred().resolve(t).promise()},_getFileInputFiles:function(e){return e instanceof v&&1!==e.length?v.when.apply(v,v.map(e,this._getSingleFileInputFiles)).then(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(e)},_onChange:function(t){var i=this,n={fileInput:v(t.target),form:v(t.target.form)};this._getFileInputFiles(n.fileInput).always(function(e){n.files=e,i.options.replaceFileInput&&i._replaceFileInput(n),!1!==i._trigger("change",v.Event("change",{delegatedEvent:t}),n)&&i._onAdd(t,n)})},_onPaste:function(e){var t=e.originalEvent&&e.originalEvent.clipboardData&&e.originalEvent.clipboardData.items,n={files:[]};t&&t.length&&(v.each(t,function(e,t){var i=t.getAsFile&&t.getAsFile();i&&n.files.push(i)}),!1!==this._trigger("paste",v.Event("paste",{delegatedEvent:e}),n)&&this._onAdd(e,n))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var i=this,e=t.dataTransfer,n={};e&&e.files&&e.files.length&&(t.preventDefault(),this._getDroppedFiles(e).always(function(e){n.files=e,!1!==i._trigger("drop",v.Event("drop",{delegatedEvent:t}),n)&&i._onAdd(t,n)}))},_onDragOver:e("dragover"),_onDragEnter:e("dragenter"),_onDragLeave:e("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),v.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_destroy:function(){this._destroyEventHandlers()},_setOption:function(e,t){var i=-1!==v.inArray(e,this._specialOptions);i&&this._destroyEventHandlers(),this._super(e,t),i&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var e=this.options;void 0===e.fileInput?e.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):e.fileInput instanceof v||(e.fileInput=v(e.fileInput)),e.dropZone instanceof v||(e.dropZone=v(e.dropZone)),e.pasteZone instanceof v||(e.pasteZone=v(e.pasteZone))},_getRegExp:function(e){var t=e.split("/"),i=t.pop();return t.shift(),new RegExp(t.join("/"),i)},_isRegExpOption:function(e,t){return"url"!==e&&"string"===v.type(t)&&/^\/.*\/[igm]{0,3}$/.test(t)},_initDataAttributes:function(){var r=this,o=this.options,a=this.element.data();v.each(this.element[0].attributes,function(e,t){var i,n=t.name.toLowerCase();/^data-/.test(n)&&(n=n.slice(5).replace(/-[a-z]/g,function(e){return e.charAt(1).toUpperCase()}),i=a[n],r._isRegExpOption(n,i)&&(i=r._getRegExp(i)),o[n]=i)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var i=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,i._onAdd(null,t)}):(t.files=v.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var i,n,r=this,o=v.Deferred(),e=o.promise();return e.abort=function(){return n=!0,i?i.abort():(o.reject(null,"abort","abort"),e)},this._getFileInputFiles(t.fileInput).always(function(e){n||(e.length?(t.files=e,(i=r._onSend(null,t)).then(function(e,t,i){o.resolve(e,t,i)},function(e,t,i){o.reject(e,t,i)})):o.reject())}),this._enhancePromise(e)}if(t.files=v.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?e(require("jquery")):e(window.jQuery)}(function(l){"use strict";var n=0,t=l,i="parseJSON";"JSON"in window&&"parse"in JSON&&(t=JSON,i="parse"),l.ajaxTransport("iframe",function(r){if(r.async){var o,a,t,s=r.initialIframeSrc||"javascript:false;";return{send:function(e,i){(o=l('<form style="display:none;"></form>')).attr("accept-charset",r.formAcceptCharset),t=/\?/.test(r.url)?"&":"?","DELETE"===r.type?(r.url=r.url+t+"_method=DELETE",r.type="POST"):"PUT"===r.type?(r.url=r.url+t+"_method=PUT",r.type="POST"):"PATCH"===r.type&&(r.url=r.url+t+"_method=PATCH",r.type="POST"),a=l('<iframe src="'+s+'" name="iframe-transport-'+(n+=1)+'"></iframe>').bind("load",function(){var n,t=l.isArray(r.paramName)?r.paramName:[r.paramName];a.unbind("load").bind("load",function(){var t;try{if(!(t=a.contents()).length||!t[0].firstChild)throw new Error}catch(e){t=void 0}i(200,"success",{iframe:t}),l('<iframe src="'+s+'"></iframe>').appendTo(o),window.setTimeout(function(){o.remove()},0)}),o.prop("target",a.prop("name")).prop("action",r.url).prop("method",r.type),r.formData&&l.each(r.formData,function(e,t){l('<input type="hidden"/>').prop("name",t.name).val(t.value).appendTo(o)}),r.fileInput&&r.fileInput.length&&"POST"===r.type&&(n=r.fileInput.clone(),r.fileInput.after(function(e){return n[e]}),r.paramName&&r.fileInput.each(function(e){l(this).prop("name",t[e]||r.paramName)}),o.append(r.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),r.fileInput.removeAttr("form")),o.submit(),n&&n.length&&r.fileInput.each(function(e,t){var i=l(n[e]);l(t).prop("name",i.prop("name")).attr("form",i.attr("form")),i.replaceWith(t)})}),o.append(a).appendTo(document.body)},abort:function(){a&&a.unbind("load").prop("src",s),o&&o.remove()}}}}),l.ajaxSetup({converters:{"iframe text":function(e){return e&&l(e[0].body).text()},"iframe json":function(e){return e&&t[i](l(e[0].body).text())},"iframe html":function(e){return e&&l(e[0].body).html()},"iframe xml":function(e){var t=e&&e[0];return t&&l.isXMLDoc(t)?t:l.parseXML(t.XMLDocument&&t.XMLDocument.xml||l(t.body).html())},"iframe script":function(e){return e&&l.globalEval(l(e[0].body).text())}}})});var mediaFieldApps=[];function initializeMediaFieldEditor(e,i,o,n){var r,t=$(document.getElementById($(e).data("for"))).data("init"),a=$(e);mediaFieldApps.push(r=new Vue({el:a.get(0),data:{mediaItems:[],selectedMedia:null},computed:{paths:{get:function(){var t=[];return this.mediaItems.forEach(function(e){"not-found"!==e.mediaPath&&t.push(e.mediaPath)}),JSON.stringify(t)},set:function(e){var n=this,t=e||[],r=$.Deferred();t.forEach(function(t,i){n.mediaItems.push({name:" "+t,mime:"",mediaPath:""}),promise=$.when(r).done(function(){$.ajax({url:o+"?path="+encodeURIComponent(t),method:"GET",success:function(e){n.mediaItems.splice(i,1,e)},error:function(e){console.log(JSON.stringify(e)),n.mediaItems.splice(i,1,{name:t,mime:"",mediaPath:"not-found"})}})})}),r.resolve()}},fileSize:function(){return Math.round(this.selectedMedia.size/1024)},canAddMedia:function(){return 0===this.mediaItems.length||0<this.mediaItems.length&&n},canRemoveMedia:function(){return this.selectedMedia||1===this.mediaItems.length}},mounted:function(){this.paths=t},methods:{selectMedia:function(e){this.selectedMedia=e},showModal:function(e){if(this.canAddMedia){$("#mediaApp").detach().appendTo($(i).find(".modal-body")),$("#mediaApp").show();var t=$(i).modal();$(i).find(".mediaFieldSelectButton").off("click").on("click",function(e){return 1<mediaApp.selectedMedias.length&&!1===n?(alert($("#onlyOneItemMessage").val()),r.mediaItems.push(mediaApp.selectedMedias[0])):r.mediaItems=r.mediaItems.concat(mediaApp.selectedMedias),mediaApp.selectedMedias=[],t.modal("hide"),!0})}},removeSelected:function(e){if(this.selectedMedia){var t=this.mediaItems&&this.mediaItems.indexOf(this.selectedMedia);-1<t&&this.mediaItems.splice(t,1)}else 1===this.mediaItems.length&&this.mediaItems.splice(0,1);this.selectedMedia=null},selectAndDeleteMedia:function(e){var t=this;t.selectedMedia=e,setTimeout(function(){t.removeSelected()},100)}},watch:{mediaItems:function(){setTimeout(function(){$(document).trigger("contentpreview:render")},100)}}}))}
