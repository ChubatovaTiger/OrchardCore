@using Fluid;
@model Orchard.Markdown.ViewModels.MarkdownPartViewModel
@inject Orchard.Liquid.ILiquidTemplateManager TemplateManager

@{ 
    string markdown = Model.Markdown;
    var html = Markdig.Markdown.ToHtml(markdown ?? "");

    var templateContext = new TemplateContext();
    templateContext.SetValue("ContentItem", Model.MarkdownPart.ContentItem);

    await TemplateManager.RenderAsync(html, Output, HtmlEncoder, templateContext);
}
