@using Fluid;
@model Orchard.Markdown.ViewModels.MarkdownPartViewModel
@inject Orchard.Liquid.ILiquidTemplateManager TemplateManager

@{ 
    string markdown = Model.Markdown;

    using (var sw = new System.IO.StringWriter())
    {
        var templateContext = new TemplateContext();
        templateContext.SetValue("ContentItem", Model.MarkdownPart.ContentItem);
        await TemplateManager.RenderAsync(markdown, sw, NullEncoder.Default, templateContext);
        markdown = sw.ToString();
    }
}
@Html.Raw(Markdig.Markdown.ToHtml(markdown ?? ""));
