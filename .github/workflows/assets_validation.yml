name: Frontend Assets build validation
on:
# manual trigger
  workflow_dispatch:
jobs:
  test-npm-build:
    name: Test building assets
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
      with:
        ref: ${{ github.head_ref || github.ref_name }} 
    - uses: actions/cache@v4
      with:
        path: ~/.npm
        key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
        restore-keys: |
          ${{ runner.os }}-node-
    - name: Rebuild packages
      run: |
        npm install
        npm run rebuild
    - name: Check if git has changes
      id: changes
      run: echo "changed=$(git status --porcelain | wc -l)" >> $GITHUB_OUTPUT
    - name: Changes detected after building assets
      if: steps.changes.outputs.changed != 0 
      run: | 
        git status
        echo "Please make sure to build them properly before pushing"
        exit -1
